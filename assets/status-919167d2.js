import{a as F,S as be,U as T}from"./UIEventSource-6c338801.js";import{S as H,i as K,s as V,y as me,k as q,l as ee,b as O,p as te,d as b,f as J,q as L,z as pe,A as _e,B as ge,r as he,t as k,g as w,h as D,u as re,v as ne,w as ve,x as E,C as De,D as Z,E as x,O as R,Q as le,n as se,e as P,c as N,m as A,j as I,F as X,a as B,N as Ce}from"./index-e92167ef.js";import{L as ke}from"./Loading-ccdc5f33.js";import{t as M}from"./tw-join-70ce42f3.js";import{E as Se,C as we}from"./Checkbox-7050471b.js";import{A as ye}from"./AccordionSingle-43afa000.js";import{O as Le}from"./OsmConnection-2ba240ce.js";import{C as U}from"./Constants-40dd409b.js";import"./LocalStorageSource-82d6fe4c.js";function Oe(s){let e,n,t,r,l;const i=s[2].default,f=me(i,s,s[1],null);let d=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},s[0]],_={};for(let a=0;a<d.length;a+=1)_=q(_,d[a]);return{c(){e=ee("svg"),f&&f.c(),n=ee("path"),O(n,"fill-rule","evenodd"),O(n,"d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"),O(n,"clip-rule","evenodd"),te(e,_)},m(a,h){b(a,e,h),f&&f.m(e,null),J(e,n),t=!0,r||(l=[L(e,"click",s[3]),L(e,"mouseover",s[4]),L(e,"mouseenter",s[5]),L(e,"mouseleave",s[6]),L(e,"keydown",s[7])],r=!0)},p(a,[h]){f&&f.p&&(!t||h&2)&&pe(f,i,a,a[1],t?ge(i,a[1],h,null):_e(a[1]),null),te(e,_=he(d,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},h&1&&a[0]]))},i(a){t||(k(f,a),t=!0)},o(a){w(f,a),t=!1},d(a){a&&D(e),f&&f.d(a),r=!1,re(l)}}}function Ne(s,e,n){const t=[];let r=ne(e,t),{$$slots:l={},$$scope:i}=e;function f(p){E.call(this,s,p)}function d(p){E.call(this,s,p)}function _(p){E.call(this,s,p)}function a(p){E.call(this,s,p)}function h(p){E.call(this,s,p)}return s.$$set=p=>{e=q(q({},e),ve(p)),n(0,r=ne(e,t)),"$$scope"in p&&n(1,i=p.$$scope)},[r,i,l,f,d,_,a,h]}class Ae extends H{constructor(e){super(),K(this,e,Ne,Oe,V,{})}}function Ie(s){let e,n,t,r,l;const i=s[2].default,f=me(i,s,s[1],null);let d=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},s[0]],_={};for(let a=0;a<d.length;a+=1)_=q(_,d[a]);return{c(){e=ee("svg"),f&&f.c(),n=ee("path"),O(n,"fill-rule","evenodd"),O(n,"d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"),O(n,"clip-rule","evenodd"),te(e,_)},m(a,h){b(a,e,h),f&&f.m(e,null),J(e,n),t=!0,r||(l=[L(e,"click",s[3]),L(e,"mouseover",s[4]),L(e,"mouseenter",s[5]),L(e,"mouseleave",s[6]),L(e,"keydown",s[7])],r=!0)},p(a,[h]){f&&f.p&&(!t||h&2)&&pe(f,i,a,a[1],t?ge(i,a[1],h,null):_e(a[1]),null),te(e,_=he(d,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},h&1&&a[0]]))},i(a){t||(k(f,a),t=!0)},o(a){w(f,a),t=!1},d(a){a&&D(e),f&&f.d(a),r=!1,re(l)}}}function Ue(s,e,n){const t=[];let r=ne(e,t),{$$slots:l={},$$scope:i}=e;function f(p){E.call(this,s,p)}function d(p){E.call(this,s,p)}function _(p){E.call(this,s,p)}function a(p){E.call(this,s,p)}function h(p){E.call(this,s,p)}return s.$$set=p=>{e=q(q({},e),ve(p)),n(0,r=ne(e,t)),"$$scope"in p&&n(1,i=p.$$scope)},[r,i,l,f,d,_,a,h]}class Ee extends H{constructor(e){super(),K(this,e,Ue,Ie,V,{})}}function Te(s){let e,n;return{c(){e=R("? "),n=R(s[0])},m(t,r){b(t,e,r),b(t,n,r)},p(t,r){r&1&&le(n,t[0])},i:se,o:se,d(t){t&&D(e),t&&D(n)}}}function Be(s){let e,n,t,r;return n=new ke({}),{c(){e=P("div"),N(n.$$.fragment),O(e,"class",t=M(s[1],"shrink-0 rounded-full"))},m(l,i){b(l,e,i),A(n,e,null),r=!0},p(l,i){(!r||i&2&&t!==(t=M(l[1],"shrink-0 rounded-full")))&&O(e,"class",t)},i(l){r||(k(n.$$.fragment,l),r=!0)},o(l){w(n.$$.fragment,l),r=!1},d(l){l&&D(e),I(n)}}}function Je(s){let e,n;return e=new Ae({props:{class:M(s[1],"shrink-0 rounded-full"),style:"color: #bb2222"}}),{c(){N(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const l={};r&2&&(l.class=M(t[1],"shrink-0 rounded-full")),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Me(s){let e,n;return e=new Se({props:{class:M(s[1],"shrink-0  rounded-full"),style:"color: #eecc22"}}),{c(){N(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const l={};r&2&&(l.class=M(t[1],"shrink-0  rounded-full")),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function ze(s){let e,n;return e=new Ee({props:{class:M(s[1],"shrink-0 rounded-full"),style:"color: #22cc22"}}),{c(){N(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const l={};r&2&&(l.class=M(t[1],"shrink-0 rounded-full")),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ge(s){let e,n,t,r;const l=[ze,Me,Je,Be,Te],i=[];function f(d,_){return d[0]==="online"?0:d[0]==="degraded"?1:d[0]==="offline"?2:d[0]===void 0?3:4}return e=f(s),n=i[e]=l[e](s),{c(){n.c(),t=De()},m(d,_){i[e].m(d,_),b(d,t,_),r=!0},p(d,[_]){let a=e;e=f(d),e===a?i[e].p(d,_):(Z(),w(i[a],1,1,()=>{i[a]=null}),x(),n=i[e],n?n.p(d,_):(n=i[e]=l[e](d),n.c()),k(n,1),n.m(t.parentNode,t))},i(d){r||(k(n),r=!0)},o(d){w(n),r=!1},d(d){i[e].d(d),d&&D(t)}}}function je(s,e,n){let{status:t}=e,{cls:r="w-6 h-6 mx-1"}=e;return s.$$set=l=>{"status"in l&&n(0,t=l.status),"cls"in l&&n(1,r=l.cls)},[t,r]}class $e extends H{constructor(e){super(),K(this,e,je,Ge,V,{status:0,cls:1})}}function Pe(s){let e;return{c(){e=R("No extra information available")},m(n,t){b(n,e,t)},p:se,d(n){n&&D(e)}}}function Re(s){let e;return{c(){e=R(s[2])},m(n,t){b(n,e,t)},p(n,t){t&4&&le(e,n[2])},d(n){n&&D(e)}}}function Fe(s){let e;function n(l,i){return l[2]?Re:Pe}let t=n(s),r=t(s);return{c(){e=P("div"),r.c(),O(e,"class","mx-4")},m(l,i){b(l,e,i),r.m(e,null)},p(l,i){t===(t=n(l))&&r?r.p(l,i):(r.d(1),r=t(l),r&&(r.c(),r.m(e,null)))},d(l){l&&D(e),r.d()}}}function qe(s){let e,n,t,r=s[0].name+"",l,i;return n=new $e({props:{status:s[1]}}),{c(){e=P("h3"),N(n.$$.fragment),t=B(),l=R(r),O(e,"slot","header"),O(e,"class","m-0 flex items-center")},m(f,d){b(f,e,d),A(n,e,null),J(e,t),J(e,l),i=!0},p(f,d){const _={};d&2&&(_.status=f[1]),n.$set(_),(!i||d&1)&&r!==(r=f[0].name+"")&&le(l,r)},i(f){i||(k(n.$$.fragment,f),i=!0)},o(f){w(n.$$.fragment,f),i=!1},d(f){f&&D(e),I(n)}}}function Qe(s){let e,n;return e=new ye({props:{$$slots:{header:[qe],default:[Fe]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,[r]){const l={};r&39&&(l.$$scope={dirty:r,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Xe(s,e,n){let t,r,{service:l}=e,i=l.status;X(s,i,d=>n(1,t=d));let f=l.message;return X(s,f,d=>n(2,r=d)),s.$$set=d=>{"service"in d&&n(0,l=d.service)},[l,t,r,i,f]}class He extends H{constructor(e){super(),K(this,e,Xe,Qe,V,{service:0})}}function ie(s,e,n){const t=s.slice();return t[16]=e[n],t}function ce(s){let e,n;return e=new ke({}),{c(){N(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ke(s){let e;return{c(){e=R("Automatically check again every 10s")},m(n,t){b(n,e,t)},d(n){n&&D(e)}}}function ue(s){let e,n;return e=new we({props:{selected:s[9],$$slots:{default:[Ve]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p(t,r){const l={};r&524288&&(l.$$scope={dirty:r,ctx:t}),e.$set(l)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ve(s){let e;return{c(){e=R("Enable traffic light")},m(n,t){b(n,e,t)},d(n){n&&D(e)}}}function fe(s){let e,n;return e=new He({props:{service:s[16]}}),{c(){N(e.$$.fragment)},m(t,r){A(e,t,r),n=!0},p:se,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function We(s){var v;let e,n,t,r,l,i,f,d,_,a,h,p,z,G,j,Q,C=s[0]&&ce();l=new $e({props:{status:s[1],cls:"w-16 h-16"}}),_=new we({props:{selected:s[5],$$slots:{default:[Ke]},$$scope:{ctx:s}}});let $=((v=s[2])==null?void 0:v.success)&&ue(s),u=s[3],o=[];for(let c=0;c<u.length;c+=1)o[c]=fe(ie(s,u,c));const m=c=>w(o[c],1,1,()=>{o[c]=null});return{c(){e=P("h1"),e.textContent="MapComplete status indicators",n=B(),t=P("div"),C&&C.c(),r=B(),N(l.$$.fragment),i=B(),f=P("button"),f.textContent="Check again",d=B(),N(_.$$.fragment),a=B(),$&&$.c(),h=B();for(let c=0;c<o.length;c+=1)o[c].c();p=B(),z=P("button"),z.textContent="Test error report function",O(t,"class","flex")},m(c,g){b(c,e,g),b(c,n,g),b(c,t,g),C&&C.m(t,null),J(t,r),A(l,t,null),J(t,i),J(t,f),J(t,d),A(_,t,null),b(c,a,g),$&&$.m(c,g),b(c,h,g);for(let y=0;y<o.length;y+=1)o[y]&&o[y].m(c,g);b(c,p,g),b(c,z,g),G=!0,j||(Q=[L(f,"click",s[10]),L(z,"click",s[11])],j=!0)},p(c,[g]){var ae;c[0]?C?g&1&&k(C,1):(C=ce(),C.c(),k(C,1),C.m(t,r)):C&&(Z(),w(C,1,1,()=>{C=null}),x());const y={};g&2&&(y.status=c[1]),l.$set(y);const W={};if(g&524288&&(W.$$scope={dirty:g,ctx:c}),_.$set(W),(ae=c[2])!=null&&ae.success?$?($.p(c,g),g&4&&k($,1)):($=ue(c),$.c(),k($,1),$.m(h.parentNode,h)):$&&(Z(),w($,1,1,()=>{$=null}),x()),g&8){u=c[3];let S;for(S=0;S<u.length;S+=1){const oe=ie(c,u,S);o[S]?(o[S].p(oe,g),k(o[S],1)):(o[S]=fe(oe),o[S].c(),k(o[S],1),o[S].m(p.parentNode,p))}for(Z(),S=u.length;S<o.length;S+=1)m(S);x()}},i(c){if(!G){k(C),k(l.$$.fragment,c),k(_.$$.fragment,c),k($);for(let g=0;g<u.length;g+=1)k(o[g]);G=!0}},o(c){w(C),w(l.$$.fragment,c),w(_.$$.fragment,c),w($),o=o.filter(Boolean);for(let g=0;g<o.length;g+=1)w(o[g]);G=!1},d(c){c&&D(e),c&&D(n),c&&D(t),C&&C.d(),I(l),I(_),c&&D(a),$&&$.d(c),c&&D(h),Ce(o,c),c&&D(p),c&&D(z),j=!1,re(Q)}}}const de="http://traffic_light_bicycle.local/";function Y(s){return s.mapD(e=>e.success?JSON.stringify(e.success):e.error)}function Ye(s,e,n){let t,r,l,i=[],f=new F(void 0),d=be.Chronic(1e4),_=new F(!1);function a(u,o=!1){const m=new F(void 0);function v(){var g;m.setData(void 0);const c=o?T.download(u):T.downloadJson(u);(g=c==null?void 0:c.then(y=>m.setData({success:y})))==null||g.catch(y=>m.setData({error:y}))}return v(),f.addCallback(c=>v()),d.addCallback(c=>{_.data&&v()}),m}{const u=new Le,o=u.apiIsOnline;i.push({name:u.Backend(),status:o.mapD(m=>{switch(m){case"offline":return"offline";case"online":return"online";case"readonly":return"degraded";case"unknown":return;case"unreachable":return"offline"}}),message:o})}{const u="https://studio.mapcomplete.org",o=a(u+"/overview");i.push({name:u,status:o.mapD(m=>{if(m.error)return"offline";const v=m.success.allFiles;return v.length<10?"offline":v.length<100?"degraded":"online"}),message:o.mapD(m=>m.error?m.error:"Contains "+(m.success.allFiles.length??"no")+" files")})}i.push({name:U.GeoIpServer,status:a(U.GeoIpServer+"/status").mapD(u=>u.success.online?"online":u.error?"offline":"degraded"),message:Y(a(U.GeoIpServer+"/ip"))});{const u=U.ErrorReportServer,o=a(u.replace(/\/report$/,"/status"));i.push({name:u,status:o.mapD(m=>m.error?"offline":m.success.errors_today===0?"online":"degraded"),message:Y(o)})}{const u=U.linkedDataProxy.replace(/\/[^/]*$/,""),o=a(u+"/status");i.push({name:u,status:o.mapD(m=>{if(m.error)return"offline";const v=m.success;return v.cached_entries<10||v.uptime<60*60?"degraded":"online"}),message:Y(o)})}{const u=U.SummaryServer,o=a(u+"/summary/status.json");i.push({name:u,status:o.mapD(m=>{if(m.error)return"offline";console.log(m);const v=m.success.meta,c=new Date(v.current_timestamp);return console.log("Last update:",c,v.current_timestamp,v),(new Date().getTime()-c.getTime())/1e3/(60*60*26)>30?"degraded":"online"}),message:o.mapD(m=>{if(m.error)return m.error;const v=m.success.meta,c=new Date(v.current_timestamp),y=(new Date().getTime()-c.getTime())/1e3/(60*60*26),W=JSON.stringify(m.success,null,"  ");return"Database is "+Math.floor(y)+` days out of sync

`+W})})}{const u=U.countryCoderEndpoint,o=a(u+"/0.0.0.json");i.push({name:u,status:o.mapD(m=>{if(m.error)return"offline";const v=m.success;return Array.isArray(v)?"online":"degraded"}),message:o.map(m=>JSON.stringify(m))})}for(const u of U.defaultOverpassUrls){const o=u.replace(/\/interpreter$/,"/status"),m=a(o,!0);i.push({name:"Overpass-server: "+u,status:m.mapD(v=>v.error?"offline":(v.success.split(`
`),"online")),message:Y(m)})}i.push({name:"Mangrove reviews",status:a("https://api.mangrove.reviews",!0).mapD(u=>u.success?"online":"offline")});let h=new F("online");X(s,h,u=>n(1,r=u));let p=new F(!0);X(s,p,u=>n(0,t=u));function z(){const u=T.NoNull(i.map(o=>o.status.data));p.setData(u.length!==i.length),u.some(o=>o==="offline")?h.setData("offline"):u.some(o=>o==="degraded")?h.setData("degraded"):u.some(o=>o==="online")?h.setData("online"):h.setData(void 0)}for(const u of i)u.status.addCallbackD(()=>{z()});let G=a(de+"/status",!0);X(s,G,u=>n(2,l=u));let j=new F(!0);async function Q(u){try{const o=de,m=await T.downloadJson(o+"status");if(console.log(m),!j.data){await T.download(o+"configure?mode=0");return}switch(u){case"offline":await T.download(o+"configure?mode=3");break;case"degraded":await T.download(o+"configure?mode=2");break;case"online":await T.download(o+"configure?mode=1");break;default:await T.download(o+"configure?mode=7");break}}catch{console.log("Could not connect to the traffic light")}}return h.addCallbackAndRunD(u=>{Q(u)}),j.addCallbackAndRunD(u=>{Q(h.data)}),[t,r,l,i,f,_,h,p,G,j,()=>f.ping(),()=>{fetch(U.ErrorReportServer,{method:"POST",body:JSON.stringify({message:"Test via the status page, not an actual error",version:U.vNumber})})}]}class Ze extends H{constructor(e){super(),K(this,e,Ye,We,V,{})}}class xe{setup(){new Ze({target:document.getElementById("main")})}}new xe().setup();
//# sourceMappingURL=status-919167d2.js.map
