import"./modulepreload-polyfill-3cfb730f.js";import{S as K,i as V,s as W,y as me,k as Q,l as ee,b as O,p as te,d as b,f as J,q as L,z as pe,A as ge,B as _e,r as he,t as k,g as w,h as D,u as re,v as ne,w as ve,x as B,C as be,D as Z,E as x,O as R,Q as ae,n as se,e as P,c as N,m as E,j as I,F as H,a as T,N as De}from"./index-34c7dc31.js";import{a as F,S as ye,U}from"./UIEventSource-f39c8b5a.js";import{L as ke}from"./Loading-aa985c94.js";import{t as M}from"./tw-join-70ce42f3.js";import{E as Ce,C as we}from"./Checkbox-a6af77f2.js";import{A as Se}from"./AccordionSingle-3dc4bc7e.js";import{O as Ae}from"./OsmConnection-1518eca2.js";import{C as S}from"./Constants-269ad162.js";import"./LocalStorageSource-0ef3f4e1.js";function Le(s){let e,n,t,r,a;const c=s[2].default,f=me(c,s,s[1],null);let d=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},s[0]],g={};for(let o=0;o<d.length;o+=1)g=Q(g,d[o]);return{c(){e=ee("svg"),f&&f.c(),n=ee("path"),O(n,"fill-rule","evenodd"),O(n,"d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"),O(n,"clip-rule","evenodd"),te(e,g)},m(o,h){b(o,e,h),f&&f.m(e,null),J(e,n),t=!0,r||(a=[L(e,"click",s[3]),L(e,"mouseover",s[4]),L(e,"mouseenter",s[5]),L(e,"mouseleave",s[6]),L(e,"keydown",s[7])],r=!0)},p(o,[h]){f&&f.p&&(!t||h&2)&&pe(f,c,o,o[1],t?_e(c,o[1],h,null):ge(o[1]),null),te(e,g=he(d,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},h&1&&o[0]]))},i(o){t||(k(f,o),t=!0)},o(o){w(f,o),t=!1},d(o){o&&D(e),f&&f.d(o),r=!1,re(a)}}}function Oe(s,e,n){const t=[];let r=ne(e,t),{$$slots:a={},$$scope:c}=e;function f(p){B.call(this,s,p)}function d(p){B.call(this,s,p)}function g(p){B.call(this,s,p)}function o(p){B.call(this,s,p)}function h(p){B.call(this,s,p)}return s.$$set=p=>{e=Q(Q({},e),ve(p)),n(0,r=ne(e,t)),"$$scope"in p&&n(1,c=p.$$scope)},[r,c,a,f,d,g,o,h]}class Ne extends K{constructor(e){super(),V(this,e,Oe,Le,W,{})}}function Ee(s){let e,n,t,r,a;const c=s[2].default,f=me(c,s,s[1],null);let d=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},s[0]],g={};for(let o=0;o<d.length;o+=1)g=Q(g,d[o]);return{c(){e=ee("svg"),f&&f.c(),n=ee("path"),O(n,"fill-rule","evenodd"),O(n,"d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"),O(n,"clip-rule","evenodd"),te(e,g)},m(o,h){b(o,e,h),f&&f.m(e,null),J(e,n),t=!0,r||(a=[L(e,"click",s[3]),L(e,"mouseover",s[4]),L(e,"mouseenter",s[5]),L(e,"mouseleave",s[6]),L(e,"keydown",s[7])],r=!0)},p(o,[h]){f&&f.p&&(!t||h&2)&&pe(f,c,o,o[1],t?_e(c,o[1],h,null):ge(o[1]),null),te(e,g=he(d,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},h&1&&o[0]]))},i(o){t||(k(f,o),t=!0)},o(o){w(f,o),t=!1},d(o){o&&D(e),f&&f.d(o),r=!1,re(a)}}}function Ie(s,e,n){const t=[];let r=ne(e,t),{$$slots:a={},$$scope:c}=e;function f(p){B.call(this,s,p)}function d(p){B.call(this,s,p)}function g(p){B.call(this,s,p)}function o(p){B.call(this,s,p)}function h(p){B.call(this,s,p)}return s.$$set=p=>{e=Q(Q({},e),ve(p)),n(0,r=ne(e,t)),"$$scope"in p&&n(1,c=p.$$scope)},[r,c,a,f,d,g,o,h]}class Be extends K{constructor(e){super(),V(this,e,Ie,Ee,W,{})}}function Ue(s){let e,n;return{c(){e=R("? "),n=R(s[0])},m(t,r){b(t,e,r),b(t,n,r)},p(t,r){r&1&&ae(n,t[0])},i:se,o:se,d(t){t&&D(e),t&&D(n)}}}function Te(s){let e,n,t,r;return n=new ke({}),{c(){e=P("div"),N(n.$$.fragment),O(e,"class",t=M(s[1],"shrink-0 rounded-full"))},m(a,c){b(a,e,c),E(n,e,null),r=!0},p(a,c){(!r||c&2&&t!==(t=M(a[1],"shrink-0 rounded-full")))&&O(e,"class",t)},i(a){r||(k(n.$$.fragment,a),r=!0)},o(a){w(n.$$.fragment,a),r=!1},d(a){a&&D(e),I(n)}}}function Je(s){let e,n;return e=new Ne({props:{class:M(s[1],"shrink-0 rounded-full"),style:"color: #bb2222"}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=M(t[1],"shrink-0 rounded-full")),e.$set(a)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Me(s){let e,n;return e=new Ce({props:{class:M(s[1],"shrink-0  rounded-full"),style:"color: #eecc22"}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=M(t[1],"shrink-0  rounded-full")),e.$set(a)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function ze(s){let e,n;return e=new Be({props:{class:M(s[1],"shrink-0 rounded-full"),style:"color: #22cc22"}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p(t,r){const a={};r&2&&(a.class=M(t[1],"shrink-0 rounded-full")),e.$set(a)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ge(s){let e,n,t,r;const a=[ze,Me,Je,Te,Ue],c=[];function f(d,g){return d[0]==="online"?0:d[0]==="degraded"?1:d[0]==="offline"?2:d[0]===void 0?3:4}return e=f(s),n=c[e]=a[e](s),{c(){n.c(),t=be()},m(d,g){c[e].m(d,g),b(d,t,g),r=!0},p(d,[g]){let o=e;e=f(d),e===o?c[e].p(d,g):(Z(),w(c[o],1,1,()=>{c[o]=null}),x(),n=c[e],n?n.p(d,g):(n=c[e]=a[e](d),n.c()),k(n,1),n.m(t.parentNode,t))},i(d){r||(k(n),r=!0)},o(d){w(n),r=!1},d(d){c[e].d(d),d&&D(t)}}}function je(s,e,n){let{status:t}=e,{cls:r="w-6 h-6 mx-1"}=e;return s.$$set=a=>{"status"in a&&n(0,t=a.status),"cls"in a&&n(1,r=a.cls)},[t,r]}class $e extends K{constructor(e){super(),V(this,e,je,Ge,W,{status:0,cls:1})}}function qe(s){let e;return{c(){e=R("No extra information available")},m(n,t){b(n,e,t)},p:se,d(n){n&&D(e)}}}function Pe(s){let e;return{c(){e=R(s[2])},m(n,t){b(n,e,t)},p(n,t){t&4&&ae(e,n[2])},d(n){n&&D(e)}}}function Re(s){let e;function n(a,c){return a[2]?Pe:qe}let t=n(s),r=t(s);return{c(){e=P("div"),r.c(),O(e,"class","mx-4")},m(a,c){b(a,e,c),r.m(e,null)},p(a,c){t===(t=n(a))&&r?r.p(a,c):(r.d(1),r=t(a),r&&(r.c(),r.m(e,null)))},d(a){a&&D(e),r.d()}}}function Fe(s){let e,n,t,r=s[0].name+"",a,c;return n=new $e({props:{status:s[1]}}),{c(){e=P("h3"),N(n.$$.fragment),t=T(),a=R(r),O(e,"slot","header"),O(e,"class","m-0 flex items-center")},m(f,d){b(f,e,d),E(n,e,null),J(e,t),J(e,a),c=!0},p(f,d){const g={};d&2&&(g.status=f[1]),n.$set(g),(!c||d&1)&&r!==(r=f[0].name+"")&&ae(a,r)},i(f){c||(k(n.$$.fragment,f),c=!0)},o(f){w(n.$$.fragment,f),c=!1},d(f){f&&D(e),I(n)}}}function Qe(s){let e,n;return e=new Se({props:{$$slots:{header:[Fe],default:[Re]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p(t,[r]){const a={};r&39&&(a.$$scope={dirty:r,ctx:t}),e.$set(a)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Xe(s,e,n){let t,r,{service:a}=e,c=a.status;H(s,c,d=>n(1,t=d));let f=a.message;return H(s,f,d=>n(2,r=d)),s.$$set=d=>{"service"in d&&n(0,a=d.service)},[a,t,r,c,f]}class He extends K{constructor(e){super(),V(this,e,Xe,Qe,W,{service:0})}}function ie(s,e,n){const t=s.slice();return t[16]=e[n],t}function ce(s){let e,n;return e=new ke({}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ke(s){let e;return{c(){e=R("Automatically check again every 10s")},m(n,t){b(n,e,t)},d(n){n&&D(e)}}}function ue(s){let e,n;return e=new we({props:{selected:s[9],$$slots:{default:[Ve]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p(t,r){const a={};r&524288&&(a.$$scope={dirty:r,ctx:t}),e.$set(a)},i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function Ve(s){let e;return{c(){e=R("Enable traffic light")},m(n,t){b(n,e,t)},d(n){n&&D(e)}}}function fe(s){let e,n;return e=new He({props:{service:s[16]}}),{c(){N(e.$$.fragment)},m(t,r){E(e,t,r),n=!0},p:se,i(t){n||(k(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){I(e,t)}}}function We(s){var v;let e,n,t,r,a,c,f,d,g,o,h,p,z,G,j,X,y=s[0]&&ce();a=new $e({props:{status:s[1],cls:"w-16 h-16"}}),g=new we({props:{selected:s[5],$$slots:{default:[Ke]},$$scope:{ctx:s}}});let $=((v=s[2])==null?void 0:v.success)&&ue(s),i=s[3],l=[];for(let u=0;u<i.length;u+=1)l[u]=fe(ie(s,i,u));const m=u=>w(l[u],1,1,()=>{l[u]=null});return{c(){e=P("h1"),e.textContent="MapComplete status indicators",n=T(),t=P("div"),y&&y.c(),r=T(),N(a.$$.fragment),c=T(),f=P("button"),f.textContent="Check again",d=T(),N(g.$$.fragment),o=T(),$&&$.c(),h=T();for(let u=0;u<l.length;u+=1)l[u].c();p=T(),z=P("button"),z.textContent="Test error report function",O(t,"class","flex")},m(u,_){b(u,e,_),b(u,n,_),b(u,t,_),y&&y.m(t,null),J(t,r),E(a,t,null),J(t,c),J(t,f),J(t,d),E(g,t,null),b(u,o,_),$&&$.m(u,_),b(u,h,_);for(let A=0;A<l.length;A+=1)l[A]&&l[A].m(u,_);b(u,p,_),b(u,z,_),G=!0,j||(X=[L(f,"click",s[10]),L(z,"click",s[11])],j=!0)},p(u,[_]){var le;u[0]?y?_&1&&k(y,1):(y=ce(),y.c(),k(y,1),y.m(t,r)):y&&(Z(),w(y,1,1,()=>{y=null}),x());const A={};_&2&&(A.status=u[1]),a.$set(A);const Y={};if(_&524288&&(Y.$$scope={dirty:_,ctx:u}),g.$set(Y),(le=u[2])!=null&&le.success?$?($.p(u,_),_&4&&k($,1)):($=ue(u),$.c(),k($,1),$.m(h.parentNode,h)):$&&(Z(),w($,1,1,()=>{$=null}),x()),_&8){i=u[3];let C;for(C=0;C<i.length;C+=1){const oe=ie(u,i,C);l[C]?(l[C].p(oe,_),k(l[C],1)):(l[C]=fe(oe),l[C].c(),k(l[C],1),l[C].m(p.parentNode,p))}for(Z(),C=i.length;C<l.length;C+=1)m(C);x()}},i(u){if(!G){k(y),k(a.$$.fragment,u),k(g.$$.fragment,u),k($);for(let _=0;_<i.length;_+=1)k(l[_]);G=!0}},o(u){w(y),w(a.$$.fragment,u),w(g.$$.fragment,u),w($),l=l.filter(Boolean);for(let _=0;_<l.length;_+=1)w(l[_]);G=!1},d(u){u&&D(e),u&&D(n),u&&D(t),y&&y.d(),I(a),I(g),u&&D(o),$&&$.d(u),u&&D(h),De(l,u),u&&D(p),u&&D(z),j=!1,re(X)}}}const de="http://traffic_light_bicycle.local/";function q(s){return s.mapD(e=>e.success?JSON.stringify(e.success):e.error)}function Ye(s,e,n){let t,r,a,c=[],f=new F(void 0),d=ye.Chronic(1e4),g=new F(!1);function o(i,l=!1){const m=new F(void 0);function v(){var _;m.setData(void 0);const u=l?U.download(i):U.downloadJson(i);(_=u==null?void 0:u.then(A=>m.setData({success:A})))==null||_.catch(A=>m.setData({error:A}))}return v(),f.addCallback(u=>v()),d.addCallback(u=>{g.data&&v()}),m}{const i=new Ae,l=i.apiIsOnline;c.push({name:i.Backend(),status:l.mapD(m=>{switch(m){case"offline":return"offline";case"online":return"online";case"readonly":return"degraded";case"unknown":return;case"unreachable":return"offline"}}),message:l})}{const i="https://studio.mapcomplete.org",l=o(i+"/overview");c.push({name:i,status:l.mapD(m=>{if(m.error)return"offline";const v=m.success.allFiles;return v.length<10?"offline":v.length<100?"degraded":"online"}),message:l.mapD(m=>m.error?m.error:"Contains "+(m.success.allFiles.length??"no")+" files")})}c.push({name:S.panoramax.url,status:o(S.panoramax.url+"/api").mapD(i=>{var l;return((l=i.success)==null?void 0:l.stac_version)==="1.0.0"?"online":i.error?"offline":"degraded"}),message:q(o(S.panoramax.url+"/api"))}),c.push({name:S.GeoIpServer,status:o(S.GeoIpServer+"/status").mapD(i=>i.success.online?"online":i.error?"offline":"degraded"),message:q(o(S.GeoIpServer+"/ip"))});{const i=S.ErrorReportServer,l=o(i.replace(/\/report$/,"/status"));c.push({name:i,status:l.mapD(m=>m.error?"offline":m.success.errors_today===0?"online":"degraded"),message:q(l)})}{const i=S.linkedDataProxy.replace(/\/[^/]*$/,""),l=o(i+"/status");c.push({name:i,status:l.mapD(m=>{if(m.error)return"offline";const v=m.success;return v.cached_entries<10||v.uptime<60*60?"degraded":"online"}),message:q(l)})}{const i=S.SummaryServer,l=o(i+"/summary/status.json");c.push({name:i,status:l.mapD(m=>{if(m.error)return"offline";console.log(m);const v=m.success.meta,u=new Date(v.current_timestamp);return console.log("Last update:",u,v.current_timestamp,v),(new Date().getTime()-u.getTime())/1e3/(60*60*26)>30?"degraded":"online"}),message:l.mapD(m=>{if(m.error)return m.error;const v=m.success.meta,u=new Date(v.current_timestamp),A=(new Date().getTime()-u.getTime())/1e3/(60*60*26),Y=JSON.stringify(m.success,null,"  ");return"Database is "+Math.floor(A)+` days out of sync

`+Y})})}{const i=S.countryCoderEndpoint,l=o(i+"/0.0.0.json");c.push({name:i,status:l.mapD(m=>{if(m.error)return"offline";const v=m.success;return Array.isArray(v)?"online":"degraded"}),message:l.map(m=>JSON.stringify(m))})}{const i=S.nominatimEndpoint,l=o(i+"/search.php?q=Brugge");c.push({name:i,message:q(l),status:l.mapD(m=>{if(m.error)return"offline";const v=m.success;return Array.isArray(v)?"online":"degraded"})})}{const i=S.photonEndpoint,l=o(i+"/api/?q=Brugge");c.push({name:i,status:l.mapD(m=>{if(m.error)return"offline";const v=m.success;return Array.isArray(v.features)&&v.features.length>0?"online":"degraded"}),message:q(l)})}for(const i of S.defaultOverpassUrls){const l=i.replace(/\/interpreter$/,"/status"),m=o(l,!0);c.push({name:"Overpass-server: "+i,status:m.mapD(v=>v.error?"offline":(v.success.split(`
`),"online")),message:q(m)})}c.push({name:"Mangrove reviews",status:o("https://api.mangrove.reviews",!0).mapD(i=>i.success?"online":"offline")});let h=new F("online");H(s,h,i=>n(1,r=i));let p=new F(!0);H(s,p,i=>n(0,t=i));function z(){const i=U.NoNull(c.map(l=>l.status.data));p.setData(i.length!==c.length),i.some(l=>l==="offline")?h.setData("offline"):i.some(l=>l==="degraded")?h.setData("degraded"):i.some(l=>l==="online")?h.setData("online"):h.setData(void 0)}for(const i of c)i.status.addCallbackD(()=>{z()});let G=o(de+"/status",!0);H(s,G,i=>n(2,a=i));let j=new F(!0);async function X(i){try{const l=de,m=await U.downloadJson(l+"status");if(console.log(m),!j.data){await U.download(l+"configure?mode=0");return}switch(i){case"offline":await U.download(l+"configure?mode=3");break;case"degraded":await U.download(l+"configure?mode=2");break;case"online":await U.download(l+"configure?mode=1");break;default:await U.download(l+"configure?mode=7");break}}catch{console.log("Could not connect to the traffic light")}}return h.addCallbackAndRunD(i=>{X(i)}),j.addCallbackAndRunD(i=>{X(h.data)}),[t,r,a,c,f,g,h,p,G,j,()=>f.ping(),()=>{fetch(S.ErrorReportServer,{method:"POST",body:JSON.stringify({message:"Test via the status page, not an actual error",version:S.vNumber})})}]}class Ze extends K{constructor(e){super(),V(this,e,Ye,We,W,{})}}class xe{setup(){new Ze({target:document.getElementById("main")})}}new xe().setup();
//# sourceMappingURL=status-f589fe16.js.map
