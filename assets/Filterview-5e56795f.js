import{S as x,i as ee,s as te,e as S,b as z,W as V,d as _,t as m,D as k,E as v,g as p,h as g,N as W,F as le,V as ie,C,n as q,G as H,c as h,a as D,m as d,f as I,j as $,ad as oe}from"./index-e92167ef.js";import{a as re,U as se,I as j}from"./UIEventSource-7e6b214a.js";import{L as fe,T as B,a as ae}from"./Tr-d5b6277a.js";import"./placeholder-6327ecfb.js";import"./Constants-6d06315d.js";import{F as ue,i as ce,V as me,T as pe}from"./InputHelper-c089264f.js";import{C as ne}from"./Checkbox-c56969b5.js";import{D as _e}from"./Dropdown-c9199929.js";function G(f,t,n){const l=f.slice();return l[13]=t[n],l[15]=n,l}function ge(f){let t,n=f[13].message+"",l;return{c(){t=new oe(!1),l=C(),t.a=l},m(e,s){t.m(n,e,s),_(e,l,s)},p(e,s){s&1&&n!==(n=e[13].message+"")&&t.p(n)},i:q,o:q,d(e){e&&g(l),e&&t.d()}}}function he(f){let t,n,l,e;return n=new ce({props:{value:f[1][f[13].subs],type:f[2][f[13].subs],$$slots:{fallback:[de]},$$scope:{ctx:f}}}),{c(){t=S("span"),h(n.$$.fragment),l=D(),z(t,"class","mx-1")},m(s,i){_(s,t,i),d(n,t,null),I(t,l),e=!0},p(s,i){const r={};i&3&&(r.value=s[1][s[13].subs]),i&5&&(r.type=s[2][s[13].subs]),i&65543&&(r.$$scope={dirty:i,ctx:s}),n.$set(r)},i(s){e||(m(n.$$.fragment,s),e=!0)},o(s){p(n.$$.fragment,s),e=!1},d(s){s&&g(t),$(n)}}}function de(f){let t,n;return t=new me({props:{slot:"fallback",value:f[1][f[13].subs],type:f[2][f[13].subs]}}),{c(){h(t.$$.fragment)},m(l,e){d(t,l,e),n=!0},p(l,e){const s={};e&3&&(s.value=l[1][l[13].subs]),e&5&&(s.type=l[2][l[13].subs]),t.$set(s)},i(l){n||(m(t.$$.fragment,l),n=!0)},o(l){p(t.$$.fragment,l),n=!1},d(l){$(t,l)}}}function J(f){let t,n,l,e;const s=[he,ge],i=[];function r(o,a){return o[13].subs?0:1}return t=r(f),n=i[t]=s[t](f),{c(){n.c(),l=C()},m(o,a){i[t].m(o,a),_(o,l,a),e=!0},p(o,a){let u=t;t=r(o),t===u?i[t].p(o,a):(k(),p(i[u],1,1,()=>{i[u]=null}),v(),n=i[t],n?n.p(o,a):(n=i[t]=s[t](o),n.c()),m(n,1),n.m(l.parentNode,l))},i(o){e||(m(n),e=!0)},o(o){p(n),e=!1},d(o){i[t].d(o),o&&g(l)}}}function $e(f){let t,n,l=f[0],e=[];for(let i=0;i<l.length;i+=1)e[i]=J(G(f,l,i));const s=i=>p(e[i],1,1,()=>{e[i]=null});return{c(){var i;t=S("div");for(let r=0;r<e.length;r+=1)e[r].c();z(t,"class","low-interaction p-1 rounded-2xl px-3"),V(t,"interactive",((i=f[4])==null?void 0:i.length)>0)},m(i,r){_(i,t,r);for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(t,null);n=!0},p(i,[r]){var o;if(r&7){l=i[0];let a;for(a=0;a<l.length;a+=1){const u=G(i,l,a);e[a]?(e[a].p(u,r),m(e[a],1)):(e[a]=J(u),e[a].c(),m(e[a],1),e[a].m(t,null))}for(k(),a=l.length;a<e.length;a+=1)s(a);v()}(!n||r&16)&&V(t,"interactive",((o=i[4])==null?void 0:o.length)>0)},i(i){if(!n){for(let r=0;r<l.length;r+=1)m(e[r]);n=!0}},o(i){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)p(e[r]);n=!1},d(i){i&&g(t),W(e,i)}}}function be(f,t,n){let l,e,s=q,i=()=>(s(),s=H(F,c=>n(4,e=c)),F);f.$$.on_destroy.push(()=>s());let{filteredLayer:r}=t,{option:o}=t,{id:a}=t,u,b=fe.language;le(f,b,c=>n(9,l=c));let y={},N={},w=r.appliedFilters.get(a),U=JSON.parse((w==null?void 0:w.data)??"{}");function E(){const c={};for(const L in y){const T=y[L].data;T===void 0?c[L]=void 0:c[L]=T}w==null||w.setData(ue.fieldsToString(c))}let F;for(const c of o.fields){const L=new re(U[c.name]??"");i(F??(F=L)),N[c.name]=c.type,console.log(c.name,"-->",c.type),y[c.name]=L,ie(L.stabilized(200).addCallback(()=>{E()}))}return f.$$set=c=>{"filteredLayer"in c&&n(6,r=c.filteredLayer),"option"in c&&n(7,o=c.option),"id"in c&&n(8,a=c.id)},f.$$.update=()=>{if(f.$$.dirty&640){const c=o.question.textFor(l);n(0,u=se.splitIntoSubstitutionParts(c))}},[u,y,N,F,e,b,r,o,a,l]}class ke extends x{constructor(t){super(),ee(this,t,be,$e,te,{filteredLayer:6,option:7,id:8})}}function O(f,t,n){const l=f.slice();return l[11]=t[n],l}function P(f,t,n){const l=f.slice();return l[14]=t[n],l[16]=n,l}function A(f){var i;let t,n,l,e;n=new ne({props:{selected:f[7],$$slots:{default:[ve]},$$scope:{ctx:f}}});let s=f[4]&&((i=f[0].layerDef.filters)==null?void 0:i.length)>0&&M(f);return{c(){t=S("div"),h(n.$$.fragment),l=D(),s&&s.c(),z(t,"class","mb-1.5"),V(t,"focus",f[3]===f[0].layerDef.id)},m(r,o){_(r,t,o),d(n,t,null),I(t,l),s&&s.m(t,null),e=!0},p(r,o){var u;const a={};o&131121&&(a.$$scope={dirty:o,ctx:r}),n.$set(a),r[4]&&((u=r[0].layerDef.filters)==null?void 0:u.length)>0?s?(s.p(r,o),o&17&&m(s,1)):(s=M(r),s.c(),m(s,1),s.m(t,null)):s&&(k(),p(s,1,1,()=>{s=null}),v()),(!e||o&9)&&V(t,"focus",r[3]===r[0].layerDef.id)},i(r){e||(m(n.$$.fragment,r),m(s),e=!0)},o(r){p(n.$$.fragment,r),p(s),e=!1},d(r){r&&g(t),$(n),s&&s.d()}}}function K(f){let t,n,l;return n=new B({props:{t:ae.t.general.layerSelection.zoomInToSeeThisLayer}}),{c(){t=S("span"),h(n.$$.fragment),z(t,"class","alert")},m(e,s){_(e,t,s),d(n,t,null),l=!0},p:q,i(e){l||(m(n.$$.fragment,e),l=!0)},o(e){p(n.$$.fragment,e),l=!1},d(e){e&&g(t),$(n)}}}function ve(f){let t,n,l,e,s,i,r;n=new pe({props:{construct:f[10]}}),e=new B({props:{t:f[0].layerDef.name}});let o=f[5]<f[6].minzoom&&K();return{c(){t=S("div"),h(n.$$.fragment),l=D(),h(e.$$.fragment),s=D(),o&&o.c(),i=C(),z(t,"class","no-image-background block h-6 w-6"),V(t,"opacity-50",!f[4])},m(a,u){_(a,t,u),d(n,t,null),_(a,l,u),d(e,a,u),_(a,s,u),o&&o.m(a,u),_(a,i,u),r=!0},p(a,u){(!r||u&16)&&V(t,"opacity-50",!a[4]);const b={};u&1&&(b.t=a[0].layerDef.name),e.$set(b),a[5]<a[6].minzoom?o?(o.p(a,u),u&32&&m(o,1)):(o=K(),o.c(),m(o,1),o.m(i.parentNode,i)):o&&(k(),p(o,1,1,()=>{o=null}),v())},i(a){r||(m(n.$$.fragment,a),m(e.$$.fragment,a),m(o),r=!0)},o(a){p(n.$$.fragment,a),p(e.$$.fragment,a),p(o),r=!1},d(a){a&&g(t),$(n),a&&g(l),$(e,a),a&&g(s),o&&o.d(a),a&&g(i)}}}function M(f){let t,n,l=f[0].layerDef.filters,e=[];for(let i=0;i<l.length;i+=1)e[i]=Z(O(f,l,i));const s=i=>p(e[i],1,1,()=>{e[i]=null});return{c(){t=S("div");for(let i=0;i<e.length;i+=1)e[i].c();z(t,"id","subfilters"),z(t,"class","ml-4 flex flex-col gap-y-1")},m(i,r){_(i,t,r);for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(t,null);n=!0},p(i,r){if(r&769){l=i[0].layerDef.filters;let o;for(o=0;o<l.length;o+=1){const a=O(i,l,o);e[o]?(e[o].p(a,r),m(e[o],1)):(e[o]=Z(a),e[o].c(),m(e[o],1),e[o].m(t,null))}for(k(),o=l.length;o<e.length;o+=1)s(o);v()}},i(i){if(!n){for(let r=0;r<l.length;r+=1)m(e[r]);n=!0}},o(i){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)p(e[r]);n=!1},d(i){i&&g(t),W(e,i)}}}function Q(f){let t,n;return t=new ne({props:{selected:f[8](f[11]),$$slots:{default:[ye]},$$scope:{ctx:f}}}),{c(){h(t.$$.fragment)},m(l,e){d(t,l,e),n=!0},p(l,e){const s={};e&1&&(s.selected=l[8](l[11])),e&131073&&(s.$$scope={dirty:e,ctx:l}),t.$set(s)},i(l){n||(m(t.$$.fragment,l),n=!0)},o(l){p(t.$$.fragment,l),n=!1},d(l){$(t,l)}}}function ye(f){let t,n;return t=new B({props:{t:f[11].options[0].question}}),{c(){h(t.$$.fragment)},m(l,e){d(t,l,e),n=!0},p(l,e){const s={};e&1&&(s.t=l[11].options[0].question),t.$set(s)},i(l){n||(m(t.$$.fragment,l),n=!0)},o(l){p(t.$$.fragment,l),n=!1},d(l){$(t,l)}}}function R(f){let t,n;return t=new ke({props:{id:f[11].id,filteredLayer:f[0],option:f[11].options[0]}}),{c(){h(t.$$.fragment)},m(l,e){d(t,l,e),n=!0},p(l,e){const s={};e&1&&(s.id=l[11].id),e&1&&(s.filteredLayer=l[0]),e&1&&(s.option=l[11].options[0]),t.$set(s)},i(l){n||(m(t.$$.fragment,l),n=!0)},o(l){p(t.$$.fragment,l),n=!1},d(l){$(t,l)}}}function X(f){let t,n;return t=new _e({props:{value:f[9](f[11]),$$slots:{default:[we]},$$scope:{ctx:f}}}),{c(){h(t.$$.fragment)},m(l,e){d(t,l,e),n=!0},p(l,e){const s={};e&1&&(s.value=l[9](l[11])),e&131073&&(s.$$scope={dirty:e,ctx:l}),t.$set(s)},i(l){n||(m(t.$$.fragment,l),n=!0)},o(l){p(t.$$.fragment,l),n=!1},d(l){$(t,l)}}}function Y(f){let t,n,l,e;return n=new B({props:{t:f[14].question}}),{c(){t=S("option"),h(n.$$.fragment),l=D(),t.__value=f[16],t.value=t.__value},m(s,i){_(s,t,i),d(n,t,null),I(t,l),e=!0},p(s,i){const r={};i&1&&(r.t=s[14].question),n.$set(r)},i(s){e||(m(n.$$.fragment,s),e=!0)},o(s){p(n.$$.fragment,s),e=!1},d(s){s&&g(t),$(n)}}}function we(f){let t,n,l=f[11].options,e=[];for(let i=0;i<l.length;i+=1)e[i]=Y(P(f,l,i));const s=i=>p(e[i],1,1,()=>{e[i]=null});return{c(){for(let i=0;i<e.length;i+=1)e[i].c();t=C()},m(i,r){for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(i,r);_(i,t,r),n=!0},p(i,r){if(r&1){l=i[11].options;let o;for(o=0;o<l.length;o+=1){const a=P(i,l,o);e[o]?(e[o].p(a,r),m(e[o],1)):(e[o]=Y(a),e[o].c(),m(e[o],1),e[o].m(t.parentNode,t))}for(k(),o=l.length;o<e.length;o+=1)s(o);v()}},i(i){if(!n){for(let r=0;r<l.length;r+=1)m(e[r]);n=!0}},o(i){e=e.filter(Boolean);for(let r=0;r<e.length;r+=1)p(e[r]);n=!1},d(i){W(e,i),i&&g(t)}}}function Z(f){let t,n,l,e,s,i=f[11].options.length===1&&f[11].options[0].fields.length===0&&Q(f),r=f[11].options.length===1&&f[11].options[0].fields.length>0&&R(f),o=f[11].options.length>1&&X(f);return{c(){t=S("div"),i&&i.c(),n=D(),r&&r.c(),l=D(),o&&o.c(),e=D()},m(a,u){_(a,t,u),i&&i.m(t,null),I(t,n),r&&r.m(t,null),I(t,l),o&&o.m(t,null),I(t,e),s=!0},p(a,u){a[11].options.length===1&&a[11].options[0].fields.length===0?i?(i.p(a,u),u&1&&m(i,1)):(i=Q(a),i.c(),m(i,1),i.m(t,n)):i&&(k(),p(i,1,1,()=>{i=null}),v()),a[11].options.length===1&&a[11].options[0].fields.length>0?r?(r.p(a,u),u&1&&m(r,1)):(r=R(a),r.c(),m(r,1),r.m(t,l)):r&&(k(),p(r,1,1,()=>{r=null}),v()),a[11].options.length>1?o?(o.p(a,u),u&1&&m(o,1)):(o=X(a),o.c(),m(o,1),o.m(t,e)):o&&(k(),p(o,1,1,()=>{o=null}),v())},i(a){s||(m(i),m(r),m(o),s=!0)},o(a){p(i),p(r),p(o),s=!1},d(a){a&&g(t),i&&i.d(),r&&r.d(),o&&o.d()}}}function Le(f){let t,n,l=f[0].layerDef.name&&A(f);return{c(){l&&l.c(),t=C()},m(e,s){l&&l.m(e,s),_(e,t,s),n=!0},p(e,[s]){e[0].layerDef.name?l?(l.p(e,s),s&1&&m(l,1)):(l=A(e),l.c(),m(l,1),l.m(t.parentNode,t)):l&&(k(),p(l,1,1,()=>{l=null}),v())},i(e){n||(m(l),n=!0)},o(e){p(l),n=!1},d(e){l&&l.d(e),e&&g(t)}}}function De(f,t,n){let l,e=q,s=()=>(e(),e=H(b,c=>n(3,l=c)),b),i,r,o=q,a=()=>(o(),o=H(y,c=>n(5,r=c)),y);f.$$.on_destroy.push(()=>e()),f.$$.on_destroy.push(()=>o());let{filteredLayer:u}=t,{highlightedLayer:b=new j(void 0)}=t;s();let{zoomlevel:y=new j(22)}=t;a();let N=u.layerDef,w=u.isDisplayed;le(f,w,c=>n(4,i=c));function U(c){return u.appliedFilters.get(c.id).sync(T=>T===0,[],T=>T?0:void 0)}function E(c){return u.appliedFilters.get(c.id)}const F=()=>N.defaultIcon();return f.$$set=c=>{"filteredLayer"in c&&n(0,u=c.filteredLayer),"highlightedLayer"in c&&s(n(1,b=c.highlightedLayer)),"zoomlevel"in c&&a(n(2,y=c.zoomlevel))},[u,b,y,l,i,r,N,w,U,E,F]}class Ce extends x{constructor(t){super(),ee(this,t,De,Le,te,{filteredLayer:0,highlightedLayer:1,zoomlevel:2})}}export{Ce as F};
//# sourceMappingURL=Filterview-5e56795f.js.map
