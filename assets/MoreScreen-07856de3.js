var Qe=Object.defineProperty;var He=(_,s,n)=>s in _?Qe(_,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):_[s]=n;var f=(_,s,n)=>(He(_,typeof s!="symbol"?s+"":s,n),n);import{j as ne,e as _e,c as se,k as De,O as ie,l as de,m as re,R as Ze,S as ke,n as Je,o as Ke,T as O,p as Z,E as Xe,q as Ye,r as et,s as tt,F as nt,t as Ce}from"./theme_overview-7a6e02e0.js";import{c as B,B as G,G as P,d as A,A as Ie,a as V,C as H,S as st}from"./UserRelatedState-2f191781.js";import{U as S,V as I,T as x,C as y,a as U,S as D,c as oe,H as Te,d as ot,f as be,g as it}from"./Translations-12d0b742.js";import{L as Me,S as M}from"./SubtleButton-3c31f98b.js";import{T as k}from"./DropDown-900aebed.js";import{L as ue,F as ve,c as Se,M as at,b as Le,A as rt}from"./Button-95f65e40.js";import{T as q}from"./List-981d9381.js";const W=class{constructor(s,n,e,t,o){f(this,"totalValue",0);f(this,"showCount",0);f(this,"hiddenCount",0);f(this,"features",new S(W.empty));f(this,"name");f(this,"_parent");f(this,"_root");f(this,"_z");f(this,"_x");f(this,"_y");f(this,"_tileIndex");f(this,"_counter");f(this,"_subtiles",[void 0,void 0,void 0,void 0]);f(this,"featuresStatic",[]);f(this,"featureProperties");f(this,"_state");f(this,"updateSignal",new S(void 0));this._parent=s,this._state=n,this._root=(s==null?void 0:s._root)??this,this._z=e,this._x=t,this._y=o,this._tileIndex=B.tile_index(e,t,o),this.name="Count("+this._tileIndex+")";const i={id:""+this._tileIndex,tileId:""+this._tileIndex,count:"0",kilocount:"0",showCount:"0",totalCount:"0"};this.featureProperties=i;const u=new Date,c={type:"Feature",properties:i,geometry:{type:"Point",coordinates:B.centerPointOf(e,t,o)}};this.featuresStatic.push({feature:c,freshness:u});const a=G.fromTile(e,t,o),l={type:"Feature",properties:i,geometry:{type:"Polygon",coordinates:[[[a.minLon,a.minLat],[a.minLon,a.maxLat],[a.maxLon,a.maxLat],[a.maxLon,a.minLat],[a.minLon,a.minLat]]]}};this.featuresStatic.push({feature:l,freshness:u})}static createHierarchy(s){return new W(void 0,s,0,0,0)}getTile(s){var c;if(s===this._tileIndex)return this;let[n,e,t]=B.tile_from_index(s);for(;n-1>this._z;)e=Math.floor(e/2),t=Math.floor(t/2),n--;const o=e-2*this._x,u=(t-2*this._y)*2+o;return(c=this._subtiles[u])==null?void 0:c.getTile(s)}addTile(s){const n=this;if(s.tileIndex===this._tileIndex)this._counter===void 0&&(this._counter=new lt(this._tileIndex),this._counter.countsPerLayer.addCallbackAndRun(e=>n.update())),this._counter.addTileCount(s);else{let[e,t,o]=B.tile_from_index(s.tileIndex);for(;e-1>this._z;)t=Math.floor(t/2),o=Math.floor(o/2),e--;const i=t-2*this._x,c=(o-2*this._y)*2+i;this._subtiles[c]===void 0&&(this._subtiles[c]=new W(this,this._state,e,t,o)),this._subtiles[c].addTile(s)}this.updateSignal.setData(s)}getCountsForZoom(s,n,e=0){const t=this,o=[],i=n.map(u=>u.zoom).map(u=>{if(u-1>s.maxZoom)return o;const c=[];return t.visitSubTiles(a=>a.showCount<e?!1:a._z===u?(c.push(...a.features.data),!1):a._z<=u),c},[this.updateSignal.stabilized(500)]);return new ne(i)}update(){var i,u,c,a;const s=new Map;let n=0,e=0,t=0,o=new Map;for(const l of this._state.filteredLayers.data)o.set(l.layerDef.id,l);(c=(u=(i=this==null?void 0:this._counter)==null?void 0:i.countsPerLayer)==null?void 0:u.data)==null||c.forEach((l,r)=>{s.set("layer:"+r,l),n+=l,this.featureProperties["direct_layer:"+r]=l;const d=o.get(r);d.isDisplayed.data&&this._z>=d.layerDef.minzoom?t+=l:e+=l});for(const l of this._subtiles)if(l!==void 0){n+=l.totalValue,t+=l.showCount,e+=l.hiddenCount;for(const r in l.featureProperties)r.startsWith("layer:")&&s.set(r,(s.get(r)??0)+Number(l.featureProperties[r]??0))}this.totalValue=n,this.showCount=t,this.hiddenCount=e,(a=this._parent)==null||a.update(),n===0?this.features.setData(W.empty):(this.featureProperties.count=""+n,this.featureProperties.kilocount=""+Math.floor(n/1e3),this.featureProperties.showCount=""+t,this.featureProperties.totalCount=""+n,s.forEach((l,r)=>{this.featureProperties[r]=""+l}),this.features.data=this.featuresStatic,this.features.ping())}visitSubTiles(s){s(this)&&this._subtiles.forEach(e=>e==null?void 0:e.visitSubTiles(s))}};let J=W;f(J,"empty",[]);class lt{constructor(s){f(this,"bbox");f(this,"tileIndex");f(this,"countsPerLayer",new S(new Map));f(this,"z");f(this,"x");f(this,"y");f(this,"registeredLayers",new Map);this.tileIndex=s,this.bbox=G.fromTileIndex(s);const[n,e,t]=B.tile_from_index(s);this.z=n,this.x=e,this.y=t}addTileCount(s){const n=s.layer.layerDef;this.registeredLayers.set(n.id,n);const e=this;s.features.map(t=>{const o=s.layer.isDisplayed.data;e.countsPerLayer.data.set(n.id,o?t.length:0),e.countsPerLayer.ping()},[s.layer.isDisplayed])}}const Re="cluster_style",Ae="The style for the clustering in all themes. Enable `debug=true` to peak into clustered tiles",Be={osmTags:"tileId~*"},Oe="Clustered data",Fe=["all_tags"],Pe=[{label:{render:"<div class='rounded-full text-xl font-bold' style='width: 2rem; height: 2rem; background: white'>{showCount}</div>",mappings:[{if:"showCount>1000",then:"<div class='rounded-full text-xl font-bold flex flex-col' style='width: 2.5rem; height: 2.5rem; background: white'>{kilocount}K</div>"}]},location:["point"]},{color:{render:"#3c3",mappings:[{if:"showCount>200",then:"#f33"},{if:"showCount>100",then:"#c93"},{if:"showCount>50",then:"#cc3"}]},width:{render:"1"}}],ct={id:Re,description:Ae,source:Be,title:Oe,tagRenderings:Fe,mapRendering:Pe},dt=Object.freeze(Object.defineProperty({__proto__:null,default:ct,description:Ae,id:Re,mapRendering:Pe,source:Be,tagRenderings:Fe,title:Oe},Symbol.toStringTag,{value:"Module"})),pe=class{constructor(s,n){const e=s.source,t=e.features.map(o=>{const i=e.bbox,[u,c,a]=B.tile_from_index(e.tileIndex),l={type:"Feature",properties:{z:u,x:c,y:a,tileIndex:e.tileIndex,source:e.name,count:o.length,tileId:e.name+"/"+e.tileIndex},geometry:{type:"Polygon",coordinates:[[[i.minLon,i.minLat],[i.minLon,i.maxLat],[i.maxLon,i.maxLat],[i.maxLon,i.minLat],[i.minLon,i.minLat]]]}},r=P.centerpoint(l);return[l,r].map(d=>({feature:d,freshness:new Date}))});new se({layerToShow:pe.styling,features:new ne(t),leafletMap:s.leafletMap,doShowLayer:s.doShowLayer,state:n})}};let K=pe;f(K,"styling",new _e(dt,"ShowTileInfo",!0));const me=class{constructor(s,n){f(this,"hash");f(this,"state");this.hash=s,this.state=n;const e=this;s.addCallback(()=>e.setSelectedElementFromHash()),this.initialLoad()}initialLoad(){const s=this.hash.data;s===void 0||s===""||s.indexOf("-")>=0||me._no_trigger_on.has(s)||(s.startsWith("node")||s.startsWith("way")||s.startsWith("relation"))&&A.DownloadObjectAsync(s).then(n=>{try{console.log("Downloaded selected object from OSM-API for initial load: ",s);const e=n.asGeoJson();this.state.allElements.addOrGetElement(e),this.state.selectedElement.setData(e),this.zoomToSelectedFeature()}catch(e){console.error(e)}})}setSelectedElementFromHash(){var e;const s=this.state,n=this.hash.data;if(n===void 0||n==="")s.selectedElement.setData(void 0);else{const t=s.allElements.ContainingFeatures.get(n);if(t===void 0)return;const o=s.selectedElement.data;if(o===void 0){s.selectedElement.setData(t);return}if(((e=o.properties)==null?void 0:e.id)===t.properties.id)return;s.selectedElement.setData(t)}}zoomToSelectedFeature(){var o,i;const s=this.state.selectedElement.data;if(s===void 0)return;const n=P.centerpointCoordinates(s),e=this.state.locationControl;e.data.lon=n[0],e.data.lat=n[1];const t=Math.max(14,...((i=(o=this.state.layoutToUse)==null?void 0:o.layers)==null?void 0:i.map(u=>u.minzoomVisible))??[]);e.data.zoom<t&&(e.data.zoom=t),e.ping()}};let X=me;f(X,"_no_trigger_on",new Set(["welcome","copyright","layers","new","filters","location_track","",void 0]));class ut extends I{constructor(n,e){const t=new S([]),o=e.tagsSource,i=e.units;e.showAllQuestionsAtOnce=e.showAllQuestionsAtOnce??!1;const u=e.tagRenderings.filter(d=>d.question!==void 0).filter(d=>d.question!==null);let c=()=>{};const a=u.map((d,h)=>new Me(()=>new De(o,d,n,{units:i,afterSave:()=>{t.ping(),c()},cancelButton:x.t.general.skip.Clone().SetClass("btn btn-secondary").onClick(()=>{t.data.push(h),t.ping(),c()})}))),l=x.t.general.skippedQuestions.onClick(()=>{t.setData([])});o.map(d=>{if(d!==void 0)for(let h=0;h<a.length;h++){let p=u[h];if(!(t.data.indexOf(h)>=0)&&!p.IsKnown(d)&&!(p.condition&&!p.condition.matchesProperties(d)))return h}},[t]);const r=o.map(d=>{if(d===void 0)return[];const h=[];for(let p=0;p<a.length;p++){let g=u[p];t.data.indexOf(p)>=0||g.IsKnown(d)||g.condition&&!g.condition.matchesProperties(d)||h.push(a[p])}return h},[t]);super(r.map(d=>{const h=n.osmConnection.apiIsOnline.data;if(h!=="online"&&h!=="unknown")return;const p=[];return e.showAllQuestionsAtOnce===!0||e.showAllQuestionsAtOnce.data?p.push(...r.data):p.push(d[0]),t.data.length>0&&p.push(l),new y(p).SetClass("block mb-8")},[n.osmConnection.apiIsOnline]));f(this,"skippedQuestions");f(this,"restingQuestions");this.skippedQuestions=t,this.restingQuestions=r,c=()=>this.ScrollIntoView()}}class ht extends ie{constructor(n,e,t,o){var i;super(n,!0);f(this,"_softDeletionTags");f(this,"meta");f(this,"_id");f(this,"_hardDelete");this._id=n,this._hardDelete=o,this.meta={...t,changeType:"deletion"},((i=e==null?void 0:e.usedKeys())==null?void 0:i.indexOf("fixme"))>=0?this._softDeletionTags=e:this._softDeletionTags=new Ie(U.NoNull([e,new V("fixme",`A mapcomplete user marked this feature to be deleted (${t.specialMotivation})`)]))}async CreateChangeDescriptions(n,e){const t=e??await A.DownloadObjectAsync(this._id);return this._hardDelete?[{meta:this.meta,doDelete:!0,type:t.type,id:t.id}]:await new de(this._id,this._softDeletionTags,t.tags,{...this.meta,changeType:"soft-delete"}).CreateChangeDescriptions(n)}}class $ extends k{constructor(s,n,e){const t=new ft(s,n,e.neededChangesets),o=n.allElements.getEventSourceById(s),i=new S(!1),u=!!e.softDeletionTags,c=new S(!1);function a(w){var L,b,j;let T;w.retagTo!==void 0?T=new de(s,w.retagTo,o.data,{theme:((L=n==null?void 0:n.layoutToUse)==null?void 0:L.id)??"unkown",changeType:"special-delete"}):T=new ht(s,e.softDeletionTags,{theme:((b=n==null?void 0:n.layoutToUse)==null?void 0:b.id)??"unkown",specialMotivation:w.deleteReason},t.canBeDeleted.data.canBeDeleted),(j=n.changes)==null||j.applyAction(T),i.setData(!0)}const l=x.t.delete,r=l.cancel.SetClass("block btn btn-secondary").onClick(()=>c.setData(!1)),d=new M(D.delete_icon_svg().SetStyle("width: 1.5rem; height: 1.5rem;"),l.delete).onClick(()=>{t.CheckDeleteability(!0),c.setData(!0)}),h=o.map(w=>w.id.indexOf("-")<0),p=$.constructMultipleChoice(e,o,n),g=new y([new q(new re(l.whyDelete,o,n).SetClass("question-text"),3),p,new y([$.constructExplanation(p.GetValue(),t,o,n),new y([r,$.constructConfirmButton(p.GetValue()).onClick(()=>a(p.GetValue().data))]).SetClass("flex justify-end flex-wrap-reverse")]).SetClass("flex mt-2 justify-between")]).SetClass("question"),C=new k(new k(new k(g,new M(D.envelope_ui(),l.readMessages),n.osmConnection.userDetails.map(w=>w.csCount>H.userJourney.addNewPointWithUnreadMessagesUnlock||w.unreadMessages==0)),d,c),new I(t.canBeDeleted.map(w=>new y([D.delete_not_allowed_svg().SetStyle("height: 2rem; width: auto").SetClass("mr-2"),new y([l.cannotBeDeleted,w.reason.SetClass("subtle"),l.useSomethingElse.SetClass("subtle")]).SetClass("flex flex-col")]).SetClass("flex m-2 p-2 rounded-lg bg-gray-200 bg-gray-200"))),t.canBeDeleted.map(w=>u||w.canBeDeleted!==!1));super(new k(new y([D.delete_icon_svg().SetClass("h-16 w-16 p-2 m-2 block bg-gray-300 rounded-full"),l.isDeleted]).SetClass("flex m-2 rounded-full"),new ue(C,void 0,n),i),void 0,h);const m=this;c.addCallbackAndRunD(w=>{w&&m.ScrollIntoView()})}static constructConfirmButton(s){const n=x.t.delete,e=new y([D.delete_icon_ui().SetClass("w-6 h-6 mr-3 block"),n.delete]).SetClass("flex btn bg-red-500"),t=new y([D.delete_icon_ui().SetClass("w-6 h-6 mr-3 block"),n.delete]).SetClass("flex btn btn-disabled bg-red-200");return new k(e,t,s.map(o=>o!==void 0))}static constructExplanation(s,n,e,t){const o=x.t.delete;return new I(s.map(i=>{if(i===void 0)return o.explanations.selectReason.SetClass("subtle");const u=i.retagTo;if(u!==void 0)return new y([o.explanations.retagNoOtherThemes,De.CreateTagExplanation(new S(u),e,t).SetClass("subtle")]);if(i.deleteReason!==void 0)return new I(n.canBeDeleted.map(({canBeDeleted:a,reason:l})=>a?o.explanations.hardDelete:o.explanations.softDelete.Subs({reason:l})))},[n.canBeDeleted])).SetClass("block")}static constructMultipleChoice(s,n,e){const t=[];for(const o of s.nonDeleteMappings)t.push(new ve(new re(o.then,n,e),{retagTo:o.if}));for(const o of s.deleteReasons??[])t.push(new ve(new re(o.explanation,n,e),{deleteReason:o.changesetMessage}));return new Ze(t,{selectFirstAsDefault:!1})}}class ft{constructor(s,n,e){f(this,"canBeDeleted");f(this,"_id");f(this,"_allowDeletionAtChangesetCount");f(this,"_state");this._id=s,this._state=n,this._allowDeletionAtChangesetCount=e??Number.MAX_VALUE,this.canBeDeleted=new S({canBeDeleted:void 0,reason:x.t.delete.loading}),this.CheckDeleteability(!1)}CheckDeleteability(s){const n=x.t.delete,e=this._id,t=this.canBeDeleted,o=this;if(!e.startsWith("node")){this.canBeDeleted.setData({canBeDeleted:!1,reason:n.isntAPoint});return}const i=this._state.osmConnection.userDetails.map(h=>{if(h!==void 0)return h.loggedIn?h.csCount>=Math.min(H.userJourney.deletePointsOfOthersUnlock,this._allowDeletionAtChangesetCount):!1}),u=new S(void 0),c=u.map(h=>{if(h==null)return null;const p=o._state.osmConnection.userDetails.data.uid;return!h.some(g=>g!==p)},[o._state.osmConnection.userDetails]),a=i.map(h=>{if(h===void 0)return!1;if(h===!0||(c.data===null&&s&&A.DownloadHistory(e).map(g=>g.map(C=>Number(C.tags["_last_edit:contributor:uid"]))).addCallbackAndRunD(g=>u.setData(g)),c.data===!0))return!0;if(c.data===!1)return!1},[c]),l=new S(null),r=new S(null);a.addCallbackAndRunD(h=>{if(h===!1)return t.setData({canBeDeleted:!1,reason:n.notEnoughExperience}),!0;if(s)return A.DownloadReferencingRelations(e).then(p=>{l.setData(p.length>0)}),A.DownloadReferencingWays(e).then(p=>{r.setData(p.length>0)}),!0}),l.map(h=>h===!0||r.data===!0?!0:r.data===null||h===null?null:r.data===!1&&h===!1?!1:null,[r]).addCallbackAndRun(h=>{h!=null&&(h?t.setData({canBeDeleted:!1,reason:n.partOfOthers}):t.setData({canBeDeleted:!0,reason:c.data===!0?n.onlyEditedByLoggedInUser:n.safeDelete}))})}}class he extends ie{constructor(n,e){super("relation/"+n.relation.id,!1);f(this,"_input");f(this,"_theme");this._input=n,this._theme=e}async targetNodeAt(n,e){const t=this._input.relation.members[n];if(t!==void 0){if(t.type==="node")return t.ref;if(t.type==="way"){const i=(await A.DownloadObjectAsync("way/"+t.ref)).nodes;return e?i[0]:i[i.length-1]}t.type}}}class pt extends he{constructor(s,n){super(s,n)}async CreateChangeDescriptions(s){return this._input.relation.tags.type==="restriction"?new mt(this._input,this._theme).CreateChangeDescriptions(s):new Ee(this._input,this._theme).CreateChangeDescriptions(s)}}class mt extends he{constructor(s,n){super(s,n)}async CreateChangeDescriptions(s){const n=this._input.relation,e=n.members,t=e.filter(d=>d.type==="way"&&d.ref===this._input.originalWayId);t.length>1&&console.warn("Detected a turn restriction where this way has multiple occurances. This is an error");const o=t[0];if(o.role==="via")return new Ee(this._input,this._theme).CreateChangeDescriptions(s);let i=await this.targetNodeAt(e.indexOf(o),!0),u=await this.targetNodeAt(e.indexOf(o),!1),c=i??u;const a=this._input.allWaysNodesInOrder.map((d,h)=>({nodes:d,id:this._input.allWayIdsInOrder[h]})).filter(d=>{const h=d.nodes;return h[0]==c||h[h.length-1]==c})[0];if(a===void 0)return console.error("No common point found, this was a broken turn restriction!",n.id),[];const l=this._input.originalWayId;if(a.id===l)return console.log("Turn_restriction fixer: the original ID can be kept, nothing to do"),[];const r=n.members.map(d=>d.type==="way"&&d.ref===l?{ref:a.id,type:"way",role:d.role}:d);return[{type:"relation",id:n.id,changes:{members:r},meta:{theme:this._theme,changeType:"relation-fix:turn_restriction"}}]}}class Ee extends he{constructor(s,n){super(s,n)}async CreateChangeDescriptions(s){const n=this._input.originalWayId,e=this._input.relation,t=e.members,o=this._input.originalNodes,i=o[0],u=o[o.length-1],c=[];for(let a=0;a<t.length;a++){const l=t[a];if(l.type!=="way"||l.ref!==n){c.push(l);continue}const r=await this.targetNodeAt(a-1,!1),d=await this.targetNodeAt(a+1,!0);if((r===void 0||r===i)&&(d===void 0||d===u)){for(const m of this._input.allWayIdsInOrder)c.push({ref:m,type:"way",role:l.role});continue}if(r===void 0||r===u||(d===void 0||d===i)){for(let m=this._input.allWayIdsInOrder.length-1;m>=0;m--){const w=this._input.allWayIdsInOrder[m];c.push({ref:w,type:"way",role:l.role})}continue}for(const m of this._input.allWayIdsInOrder)c.push({ref:m,type:"way",role:l.role})}return[{id:e.id,type:"relation",changes:{members:c},meta:{changeType:"relation-fix",theme:this._theme}}]}}class fe extends ie{constructor(n,e,t,o=5,i){super(n,!0);f(this,"wayId");f(this,"_splitPointsCoordinates");f(this,"_meta");f(this,"_toleranceInMeters");f(this,"_withNewCoordinates");this.wayId=n,this._splitPointsCoordinates=e,this._toleranceInMeters=o,this._withNewCoordinates=i,this._meta={...t,changeType:"split"}}static SegmentSplitInfo(n){const e=[];let t=[];for(const o of n)t.push(o),o.doSplit&&(e.push(t),t=[o]);return e.push(t),e.filter(o=>o.length>0)}async CreateChangeDescriptions(n){const e=await A.DownloadObjectAsync(this.wayId),t=e.nodes,o=this.CalculateSplitCoordinates(e,this._toleranceInMeters);for(const d of o)d.originalIndex>=0?d.originalIndex=e.nodes[d.originalIndex]:d.originalIndex=n.getNewID();const i=fe.SegmentSplitInfo(o);let u;for(const d of i){if(u===void 0){u=d;continue}d.length>u.length&&(u=d)}const c=[];for(const d of o)d.originalIndex>=0||c.push({type:"node",id:d.originalIndex,changes:{lon:d.lngLat[0],lat:d.lngLat[1]},meta:this._meta});const a=[],l=[];for(const d of i)if(d===u){const p=d.map(C=>C.originalIndex),g=d.map(C=>C.lngLat);c.push({type:"way",id:e.id,changes:{coordinates:g,nodes:p},meta:this._meta}),this._withNewCoordinates&&this._withNewCoordinates(g),a.push(e.id),l.push(p)}else{let p=n.getNewID();const g=[];for(const m in e.tags)e.tags.hasOwnProperty(m)&&(m.startsWith("_")||m==="id"||g.push({k:m,v:e.tags[m]}));const C=d.map(m=>m.originalIndex);if(C.length<=1){console.error("Got a segment with only one node - skipping");continue}c.push({type:"way",id:p,tags:g,changes:{coordinates:d.map(m=>m.lngLat),nodes:C},meta:this._meta}),a.push(p),l.push(C)}const r=await A.DownloadReferencingRelations(this.wayId);for(const d of r){const h=await new pt({relation:d,allWayIdsInOrder:a,originalNodes:t,allWaysNodesInOrder:l,originalWayId:e.id},this._meta.theme).CreateChangeDescriptions(n);c.push(...h)}return c}CalculateSplitCoordinates(n,e=5){const t=n.asGeoJson(),o=n.coordinates.map(a=>[a[1],a[0]]),i=this._splitPointsCoordinates.map(a=>{let l=P.nearestPoint(t,a);return{coordinates:a,isSplitPoint:!0,dist:l.properties.dist,location:l.properties.location}});for(let a=0;a<o.length;a++){let l=o[a],r=P.nearestPoint(t,l);i.push({coordinates:l,isSplitPoint:!1,location:r.properties.location,originalIndex:a,dist:r.properties.dist})}i.sort((a,l)=>a.location-l.location);for(let a=i.length-2;a>=1;a--){const l=i[a];if(l.originalIndex!==void 0)continue;const r=i[a+1],d=i[a-1],h=r.location-l.location,p=l.location-d.location;if(h*1e3>e&&p*1e3>e)continue;let g=r;h>p&&(g=d),!(g.originalIndex===0||g.originalIndex===o.length)&&(g.isSplitPoint=!0,i.splice(a,1))}const u=[];let c=-1;for(const a of i){let l=a.originalIndex;l===void 0&&(l=c,c--);const r={originalIndex:l,lngLat:a.coordinates,doSplit:a.isSplitPoint};u.push(r)}return u}}const Ne="split_point",ze="Layer rendering the little scissors for the minimap in the 'splitRoadWizard'",Ve=1,We={osmTags:"_split_point=yes"},Ge="Split point",Ue="Split point",je=[{location:["point","centroid"],icon:"circle:white;./assets/svg/scissors.svg",iconSize:"30,30,center"}],gt={id:Ne,description:ze,minzoom:Ve,source:We,name:Ge,title:Ue,mapRendering:je},wt=Object.freeze(Object.defineProperty({__proto__:null,default:gt,description:ze,id:Ne,mapRendering:je,minzoom:Ve,name:Ge,source:We,title:Ue},Symbol.toStringTag,{value:"Module"})),Q=class extends y{constructor(n,e){const t=x.t.split,o=new S([]),i=new S(!1),u=new S(!1),c=new S(Q.setupMapComponent(n,o,e)),a=new M(D.scissors_ui().SetStyle("height: 1.5rem; width: auto"),new k(t.splitAgain.Clone().SetClass("text-lg font-bold"),t.inviteToSplit.Clone().SetClass("text-lg font-bold"),i)),l=new ue(a,t.loginToSplit.Clone(),e),r=new Se(t.split.Clone(),async()=>{var T;i.setData(!0),u.setData(!1);const w=new fe(n,o.data.map(L=>L.feature.geometry.coordinates),{theme:(T=e==null?void 0:e.layoutToUse)==null?void 0:T.id},5,L=>{e.allElements.ContainingFeatures.get(n).geometry.coordinates=L});await e.changes.applyAction(w),o.setData([]),c.setData(Q.setupMapComponent(n,o,e)),ke.collapse()});r.SetClass("btn btn-primary mr-3");const d=new Se(t.split.Clone(),void 0);d.SetClass("btn btn-disabled mr-3");const h=new k(d,r,o.map(w=>w.length===0)),p=x.t.general.cancel.Clone().SetClass("btn btn-secondary mr-3").onClick(()=>{o.setData([]),u.setData(!1)});p.SetClass("btn btn-secondary block");const g=new q(t.splitTitle),C=new y([g,new I(c),new y([p,h]).SetClass("flex flex-row")]);C.SetClass("question");super([k.If(i,()=>t.hasBeenSplit.Clone().SetClass("font-bold thanks block w-full")),new k(C,l,u)]);f(this,"dialogIsOpened");this.dialogIsOpened=u;const m=this;a.onClick(()=>{u.setData(!0),m.ScrollIntoView()})}static setupMapComponent(n,e,t){const o=t.allElements.ContainingFeatures.get(n),i=at.createMiniMap({background:t.backgroundLayer,allowMoving:!0,leafletOptions:{minZoom:14}});i.SetStyle("width: 100%; height: 24rem").SetClass("rounded-xl overflow-hidden"),i.installBounds(G.get(o).pad(.25),!1),new Je({features:ne.fromGeojson([o]),layers:t.filteredLayers,leafletMap:i.leafletMap,zoomToFeatures:!0,state:t}),new se({features:new ne(e),leafletMap:i.leafletMap,zoomToFeatures:!1,layerToShow:Q.splitLayerStyling,state:t});function u(c){const a=e.data.map((r,d)=>[r.feature,d]).filter(r=>P.distanceBetween(r[0].geometry.coordinates,c)<5).map(r=>r[1]).sort((r,d)=>r-d).reverse();if(a.length>0){for(const r of a)e.data.splice(r,1);e.ping();return}const l=P.nearestPoint(o,c);l.properties._split_point="yes",e.data.push({feature:l,freshness:new Date}),e.ping()}return i.leafletMap.addCallbackAndRunD(c=>c.on("click",a=>{u([a.latlng.lng,a.latlng.lat])})),i}};let Y=Q;f(Y,"splitLayerStyling",new _e(wt,"(BUILTIN) SplitRoadWizard.ts",!0));class yt extends ie{constructor(n,e,t){super(n,!0);f(this,"_id");f(this,"_newLonLat");f(this,"_meta");if(!n.startsWith("node/"))throw"Invalid ID: only 'node/number' is accepted";this._id=Number(n.substring(5)),this._newLonLat=e,this._meta=t}async CreateChangeDescriptions(n){return[{changes:{lat:this._newLonLat[1],lon:this._newLonLat[0]},type:"node",id:this._id,meta:{changeType:"move",theme:this._meta.theme,specialMotivation:this._meta.reason}}]}}const ge=class{static async Search(s){var t,o;const n=((o=(t=te==null?void 0:te.state)==null?void 0:t.currentBounds)==null?void 0:o.data)??G.global,e=ge.host+`format=json&limit=1&viewbox=${n.getEast()},${n.getNorth()},${n.getWest()},${n.getSouth()}&accept-language=nl&q=`+s;return U.downloadJson(e)}};let ee=ge;f(ee,"host","https://nominatim.openstreetmap.org/search?");class Ct extends y{constructor(n){const e=D.search_ui().SetClass("w-8 h-8 full-rounded border-black float-right"),t=new S(x.t.general.search.search),o=new Le({placeholder:t.map(u=>u.textFor(oe.language.data),[oe.language]),value:new S(""),inputStyle:` background: transparent;
    border: none;
    font-size: large;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    color: var(--foreground-color);`});o.SetClass("relative float-left mt-0 ml-2"),o.SetStyle("width: calc(100% - 3em);height: 100%");super([o,e]);f(this,"_searchField");this.SetClass("block h-8"),this.SetStyle("background: var(--background-color); color: var(--foreground-color); pointer-evetns:all;");async function i(){var c;const u=o.GetValue().data;if(!(u===void 0||u==="")){o.GetValue().setData(""),t.setData(x.t.general.search.searching);try{const a=await ee.Search(u);if(console.log("Search result",a),a.length==0){t.setData(x.t.general.search.nothing);return}const l=a[0],r=l.boundingbox,d=[[r[0],r[2]],[r[1],r[3]]];(c=n.selectedElement)==null||c.setData(void 0),Te.hash.setData(l.osm_type+"/"+l.osm_id),n.leafletMap.data.fitBounds(d),t.setData(x.t.general.search.search)}catch{o.GetValue().setData(""),t.setData(x.t.general.search.error)}}}o.enterPressed.addCallback(i),this._searchField=o,e.onClick(i)}focus(){this._searchField.focus()}}class bt extends k{constructor(s,n,e){const t=x.t.move;new k(t.loginToMove.SetClass("btn").onClick(()=>n.osmConnection.AttemptLogin()),void 0,n.featureSwitchUserbadge);const o=[];e.enableRelocation&&o.push({text:t.reasons.reasonRelocation,invitingText:t.inviteToMove.reasonRelocation,icon:D.relocation_svg(),changesetCommentValue:"relocated",lockBounds:!1,background:void 0,includeSearch:!0,startZoom:12,minZoom:6,eraseAddressFields:!0}),e.enableImproveAccuracy&&o.push({text:t.reasons.reasonInaccurate,invitingText:t.inviteToMove.reasonInaccurate,icon:D.crosshair_svg(),changesetCommentValue:"improve_accuracy",lockBounds:!0,includeSearch:!1,background:"photo",startZoom:17,minZoom:16,eraseAddressFields:!1});const i=new S("start"),u=new S(void 0);let c;if(o.length===1){const b=o[0];u.setData(b),c=new M(b.icon.SetStyle("height: 1.5rem; width: 1.5rem;"),x.T(b.invitingText)).onClick(()=>{i.setData("pick_location")})}else c=new M(D.move_ui().SetStyle("width: 1.5rem; height: 1.5rem"),t.inviteToMove.generic).onClick(()=>{i.setData("reason")});const a=new M(D.move_ui(),t.inviteToMoveAgain).onClick(()=>{i.setData("reason")}),l=new y(o.map(b=>new M(b.icon,b.text).onClick(()=>{u.setData(b),i.setData("pick_location")}))),r=new M(D.close_svg(),t.cancel).onClick(()=>i.setData("start")),[d,h]=P.centerpointCoordinates(s),p=u.map(b=>{if(b===void 0)return;const j=new S({lon:d,lat:h,zoom:(b==null?void 0:b.startZoom)??16});let ae;typeof b.background=="string"?ae=[b.background]:ae=b.background;const qe=rt.SelectBestLayerAccordingTo(j,new S(ae)).data,E=new Ke({minZoom:b.minZoom,centerLocation:j,mapBackground:new S(qe),state:n});b.lockBounds&&E.installBounds(.05,!0);let we;b.includeSearch&&(we=new Ct({leafletMap:E.leafletMap})),E.SetStyle("height: 17.5rem");const ye=new M(D.move_confirm_svg(),t.confirmMove);ye.onClick(async()=>{const N=E.GetValue().data;await n.changes.applyAction(new yt(s.properties.id,[N.lon,N.lat],{reason:b.changesetCommentValue,theme:n.layoutToUse.id})),s.properties._lat=N.lat,s.properties._lon=N.lon,b.eraseAddressFields&&await n.changes.applyAction(new de(s.properties.id,new Ie([new V("addr:housenumber",""),new V("addr:street",""),new V("addr:city",""),new V("addr:postcode","")]),s.properties,{changeType:"relocated",theme:n.layoutToUse.id})),n.allElements.getEventSourceById(m).ping(),i.setData("moved")});const $e=t.zoomInFurther.SetClass("alert block m-6");return new y([we,E,new k(ye,$e,E.GetValue().map(N=>N.zoom>=19))]).SetClass("flex flex-col")}),g="p-2 md:p-4 m-2 border border-gray-400 rounded-xl flex flex-col",C=new ue(new I(i.map(b=>{switch(b){case"start":return c;case"reason":return new y([t.whyMove.SetClass("text-lg font-bold"),l,r]).SetClass(g);case"pick_location":return new y([t.moveTitle.SetClass("text-lg font-bold"),new I(p),r]).SetClass(g);case"moved":return new y([t.pointIsMoved.SetClass("thanks"),a]).SetClass("flex flex-col")}})),void 0,n);let m=s.properties.id;const w=n.osmConnection._oauth_config.url;m.startsWith(w)&&(m=m.substring(w.length));const T=new S(void 0);m.startsWith("way")?T.setData(t.isWay):m.startsWith("relation")?T.setData(t.isRelation):m.indexOf("-")<0&&(A.DownloadReferencingWays(m).then(b=>{b.length>0&&(console.log("Got a referencing way, move not allowed"),T.setData(t.partOfAWay))}),A.DownloadReferencingRelations(m).then(b=>{b.length>0&&T.setData(t.partOfRelation)})),super(C,new y([D.move_not_allowed_svg().SetStyle("height: 2rem").SetClass("m-2"),new y([t.cannotBeMoved,new I(T).SetClass("subtle")]).SetClass("flex flex-col")]).SetClass("flex m-2 p-2 rounded-lg bg-gray-200"),T.map(b=>b===void 0));const L=this;i.addCallback(b=>{b!=="start"&&L.ScrollIntoView()})}}class F extends ke{constructor(s,n,e,t){if(e===void 0)throw"State is undefined!";if(super(()=>F.GenerateTitleBar(s,n,e),()=>F.GenerateContent(s,n,e),(t==null?void 0:t.hashToShow)??s.data.id??"item",t==null?void 0:t.isShown,t),n===void 0)throw"Undefined layerconfig"}static GenerateTitleBar(s,n,e){const t=new O(s,n.title??new Z("POI"),e).SetClass("break-words font-bold sm:p-0.5 md:p-1 sm:p-1.5 md:p-2 text-2xl"),o=new y(n.titleIcons.map(i=>new O(s,i,e,"block h-8 max-h-8 align-baseline box-content sm:p-0.5 titleicon"))).SetClass("flex flex-row flex-wrap pt-0.5 sm:pt-1 items-center mr-2");return new y([new y([t,o]).SetClass("flex flex-col sm:flex-row flex-grow justify-between")])}static GenerateContent(s,n,e){return new k(new y([D.delete_icon_svg().SetClass("w-8 h-8"),x.t.delete.isDeleted]).SetClass("flex justify-center font-bold items-center"),F.GenerateMainContent(s,n,e),s.map(t=>t._deleted=="yes"))}static GenerateMainContent(s,n,e){var a,l;let t=new Map;const o=x.t.general,i=U.Dedup(n.tagRenderings.map(r=>r.group));if(((a=e==null?void 0:e.featureSwitchUserbadge)==null?void 0:a.data)??!0){const r=n.tagRenderings.filter(d=>d.id==="questions");for(const d of i){const h=n.tagRenderings.filter(C=>C.group===d),p=r.filter(C=>C.group===d)[0],g=new ut(e,{tagsSource:s,tagRenderings:h,units:n.units,showAllQuestionsAtOnce:((l=p==null?void 0:p.freeform)==null?void 0:l.helperArgs.showAllQuestions)??e.featureSwitchShowAllQuestions});t.set(d,g)}}const u=n.tagRenderings.filter(r=>r.question!==void 0).length,c=[new I(s.map(r=>r[V.newlyCreated.key]).map(r=>{if(r===void 0)return;const d=new Date(r);if((Date.now()-d.getTime())/1e3>=60*5)return;const p=[],g=new y([D.party_svg().SetClass("w-12 h-12 shrink-0 p-1 m-1 bg-white rounded-full block"),o.newlyCreated]).SetClass("flex w-full thanks content-center");return p.push(g),u>0&&p.push(o.feelFreeToSkip),new y(p).SetClass("pb-4 mb-4 border-b block border-black")}))];for(let r=0;r<i.length;r++){const d=i[r],h=n.tagRenderings.filter(C=>C.group===d),p=[],g="block w-full break-word text-default m-1 p-1 border-b border-gray-200 mb-2 pb-2";for(const C of h)if(C.question===null||C.id==="questions"){const m=t.get(C.group);if(t.delete(C.group),C.render!==void 0){m.SetClass("text-sm");const w=new O(s,C,e,C.group+" questions","",{specialViz:new Map([["questions",m]])}),T=new k(w,void 0,m.restingQuestions.map(L=>(L==null?void 0:L.length)>0));p.push(T)}else p.push(m)}else{let m=p.length===0&&r>0;const w=new Xe(s,C,n.units,e,{innerElementClasses:g});m&&w.SetClass("sticky top-0"),p.push(w)}c.push(...p)}return c.push(new k(new Me(()=>F.createEditElements(t,n,s,e)),void 0,e.featureSwitchUserbadge)),new y(c).SetClass("block")}static createEditElements(s,n,e,t){let o=[];return s.forEach(i=>{o.push(i)}),n.allowMove&&o.push(new I(e.map(i=>i.id).map(i=>{const u=t.allElements.ContainingFeatures.get(i);return u===void 0?"This feature is not register in the state.allElements and cannot be moved":new bt(u,t,n.allowMove)})).SetClass("text-base")),n.deletion&&o.push(new I(e.map(i=>i.id).map(i=>new $(i,t,n.deletion))).SetClass("text-base")),n.allowSplit&&o.push(new I(e.map(i=>i.id).map(i=>new Y(i,t))).SetClass("text-base")),o.push(new I(t.osmConnection.userDetails.map(i=>i.csCount).map(i=>{if(!(i<=H.userJourney.historyLinkVisible&&t.featureSwitchIsDebugging.data==!1&&t.featureSwitchIsTesting.data===!1))return new O(e,Ye.SharedTagRendering.get("last_edit"),t)},[t.featureSwitchIsDebugging,t.featureSwitchIsTesting]))),o.push(k.If(t.featureSwitchIsDebugging,()=>{const i=new Z({render:"{all_tags()}"},""),u=new Z({render:"{export_as_geojson()}"},""),c=new Z({render:"{open_in_iD()}"},"");return new y([new O(e,i,t),new O(e,u,t),new O(e,c,t),"This is layer "+n.id])})),new y(o).SetClass("flex flex-col")}}const R=class{static addMetatags(s,n,e,t,o){var a,l;if(s===void 0||s.length===0)return;console.log("Recalculating metatags...");const i=[];for(const r of st.metatags)r.includesDates?((o==null?void 0:o.includeDates)??!0)&&i.push(r):((o==null?void 0:o.includeNonDates)??!0)&&i.push(r);const u=this.createRetaggingFunc(e,t);let c=!1;for(let r=0;r<s.length;r++){const d=s[r],h=d.feature,p=d.freshness;let g=!1,C=new Set(Object.getOwnPropertyNames(h.properties));for(const m of i)try{if(!m.keys.some(w=>h.properties[w]===void 0))continue;if(m.isLazy){if(!m.keys.some(w=>!C.has(w)))continue;if(g=!0,m.applyMetaTagsOnFeature(h,p,e,t),o!=null&&o.evaluateStrict)for(const w of m.keys)h.properties[w]}else g=m.applyMetaTagsOnFeature(h,p,e,t)||g}catch(w){console.error("Could not calculate metatag for ",m.keys.join(","),":",w,w.stack)}if(u!==void 0){let m=!1;try{m=u(n,h)}catch(w){console.error(w)}g=g||m}g&&((l=(a=t==null?void 0:t.allElements)==null?void 0:a.getEventSourceById(h.properties.id))==null||l.ping(),c=!0)}return c}static createFunctionsForFeature(s,n){const e=[];for(const t of n){const o=t[0],i=t[1],u=t[2];if(i===void 0)continue;const c=l=>{try{let r=new Function("feat","return "+i+";")(l);return r!==void 0&&typeof r!="string"&&(r=JSON.stringify(r)),delete l.properties[o],l.properties[o]=r,r}catch(r){R.errorPrintCount<R.stopErrorOutputAt&&(console.warn("Could not calculate a "+(u?"strict ":"")+" calculated tag for key "+o+" defined by "+i+" (in layer"+s+`) due to 
`+r+`
. Are you the theme creator? Doublecheck your code. Note that the metatags might not be stable on new features`,r,r.stack),R.errorPrintCount++,R.errorPrintCount==R.stopErrorOutputAt&&console.error("Got ",R.stopErrorOutputAt," errors calculating this metatagging - stopping output now"));return}};if(u){e.push(c);continue}const a=l=>{delete l.properties[o],Object.defineProperty(l.properties,o,{configurable:!0,enumerable:!1,get:function(){return c(l)}})};e.push(a)}return e}static createRetaggingFunc(s,n){const e=s.calculatedTags;if(e===void 0||e.length===0)return;let t=R.retaggingFuncCache.get(s.id);return t===void 0&&(t=R.createFunctionsForFeature(s.id,e),R.retaggingFuncCache.set(s.id,t)),(o,i)=>{var c,a;if(i.properties!==void 0){try{et.FullPatchFeature(o,i);for(const l of t)l(i);(a=(c=n==null?void 0:n.allElements)==null?void 0:c.getEventSourceById(i.properties.id))==null||a.ping()}catch(l){console.error("Invalid syntax in calculated tags or some other error: ",l)}return!0}}}};let z=R;f(z,"errorPrintCount",0),f(z,"stopErrorOutputAt",10),f(z,"retaggingFuncCache",new Map);class xe{constructor(s,n,e){f(this,"neededLayerBboxes",new Map);f(this,"source");f(this,"params");f(this,"state");f(this,"isDirty",new S(!1));this.state=n,this.source=s;const t=this;this.params={getFeatureById(o){return n.allElements.ContainingFeatures.get(o)},getFeaturesWithin(o,i){let u=t.neededLayerBboxes.get(o);return u===void 0?t.neededLayerBboxes.set(o,i):i.isContainedIn(u)||t.neededLayerBboxes.set(o,u.unionWith(i)),e.GetFeaturesWithin(o,i)},memberships:e.relationTracker},this.isDirty.stabilized(100).addCallback(o=>{o&&t.updateMetaTags()}),this.source.features.addCallbackAndRunD(o=>t.isDirty.setData(!0))}requestUpdate(){this.isDirty.setData(!0)}updateMetaTags(){const s=this.source.features.data;if(s.length===0){this.isDirty.setData(!1);return}z.addMetatags(s,this.params,this.source.layer.layerDef,this.state),this.isDirty.setData(!1)}}class vt{constructor(s,n){f(this,"_state");f(this,"_featurePipeline");f(this,"_alreadyRegistered",new Set);f(this,"_notifiers",[]);if(this._featurePipeline=n,this._state=s,s.currentView!==void 0){const e=new xe(s.currentView,this._state,this._featurePipeline);this._alreadyRegistered.add(s.currentView),this._notifiers.push(e),s.currentView.features.addCallback(t=>{console.debug("Requesting an update for currentView"),e.updateMetaTags()})}}registerSource(s,n=!1){if(s===void 0||this._alreadyRegistered.has(s))return;this._alreadyRegistered.add(s),this._notifiers.push(new xe(s,this._state,this._featurePipeline));const e=this;s.features.addCallbackAndRunD(t=>{const o=s.layer.layerDef.id;for(const i of e._notifiers){const u=i.neededLayerBboxes.get(o);u!=null&&(s.bbox===void 0||u.overlapsWith(s.bbox))&&i.requestUpdate()}})}}class St extends tt{constructor(n){super(n);f(this,"featurePipeline");f(this,"featureAggregator");f(this,"metatagRecalculator");f(this,"popups",new Map);const e=n==null?void 0:n.clustering;this.featureAggregator=J.createHierarchy(this);const t=this.featureAggregator,o=this,i=[];function u(a){o.metatagRecalculator===void 0?i.push(a):o.metatagRecalculator.registerSource(a)}function c(a){t.addTile(a);const l=a.features.map(d=>G.bboxAroundAll(d.map(h=>G.get(h.feature)))),r=a.features.map(d=>{var w;const h=o.locationControl.data.zoom;if(!a.layer.isDisplayed.data)return!1;const p=o.currentBounds.data;if(p===void 0||!l.data.overlapsWith(p)||h<a.layer.layerDef.minzoom)return!1;if(h>e.maxZoom)return!0;if(d.length>e.minNeededElements)return!1;let[g,C,m]=B.tile_from_index(a.tileIndex);if(g>=h){for(;g>h;)g--,C=Math.floor(C/2),m=Math.floor(m/2);if(((w=t.getTile(B.tile_index(g,C,m)))==null?void 0:w.totalValue)>e.minNeededElements)return!1}return!0},[o.currentBounds,a.layer.isDisplayed,l]);new se({features:a,leafletMap:o.leafletMap,layerToShow:a.layer.layerDef,doShowLayer:r,selectedElement:o.selectedElement,state:o,popup:(d,h)=>o.CreatePopup(d,h)})}this.featurePipeline=new nt(c,this,{handleRawFeatureSource:u}),this.metatagRecalculator=new vt(this,this.featurePipeline),this.metatagRecalculator.registerSource(this.currentView,!0),i.forEach(a=>o.metatagRecalculator.registerSource(a)),new X(Te.hash,this),this.AddClusteringToMap(this.leafletMap)}CreatePopup(n,e){if(this.popups.has(n.data.id))return this.popups.get(n.data.id);const t=new F(n,e,this);return this.popups.set(n.data.id,t),t}AddClusteringToMap(n){const e=this.layoutToUse.clustering,t=this;new se({features:this.featureAggregator.getCountsForZoom(e,this.locationControl,e.minNeededElements),leafletMap:n,layerToShow:K.styling,popup:this.featureSwitchIsDebugging.data?(o,i)=>new F(o,i,t):void 0,state:this})}}class te extends St{constructor(s){super(s)}}f(te,"state");const xt="personal";class le extends I{constructor(s,n,e){s=U.NoNull(s),super(n.map(t=>{if(t===void 0||t==="")return new y(s.map(i=>i.element)).SetClass((e==null?void 0:e.innerClasses)??"");const o=s.filter(i=>(i==null?void 0:i.predicate)!==void 0&&i.predicate(t));return o.length===0?e==null?void 0:e.onEmpty:new y(o.map(i=>i.element)).SetClass((e==null?void 0:e.innerClasses)??"")},[oe.language]))}}const v=class extends y{constructor(s,n=!1){const e=x.t.general.morescreen;let t="",o="";n&&(t="h-32 min-h-32 max-h-32 text-ellipsis overflow-hidden",o="md:grid md:grid-flow-row md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-g4 gap-4");const i=new Le({placeholder:e.searchForATheme});i.enterPressed.addCallbackD(c=>{c=c.toLowerCase(),c==="personal"&&(window.location.href=v.createUrlFor({id:"personal"},!1,s).data),(c==="bugs"||c==="issues")&&(window.location.href="https://github.com/pietervdvn/MapComplete/issues"),c==="source"&&(window.location.href="https://github.com/pietervdvn/MapComplete"),c==="docs"&&(window.location.href="https://github.com/pietervdvn/MapComplete/tree/develop/Docs"),(c==="osmcha"||c==="stats")&&(window.location.href=U.OsmChaLinkFor(7));const a=v.officialThemes.find(r=>r.hideFromOverview==!1&&r.id!=="personal"&&v.MatchesLayoutFunc(r)(c));a!==void 0&&(window.location.href=v.createUrlFor(a,!1,s).data);const l=v.officialThemes.find(r=>r.id!=="personal"&&v.MatchesLayoutFunc(r)(c));l!==void 0&&(window.location.href=v.createUrlFor(l,!1,s).data)}),n&&(i.focus(),document.addEventListener("keydown",function(c){c.ctrlKey&&c.code==="KeyF"&&(i.focus(),c.preventDefault())}));const u=new y([D.search_svg().SetClass("w-8"),i.SetClass("mr-4 w-full")]).SetClass("flex rounded-full border-2 border-black items-center my-2 w-1/2");super([new y([u]).SetClass("flex justify-center"),v.createOfficialThemesList(s,t,o,i.GetValue()),v.createPreviouslyVistedHiddenList(s,t,o,i.GetValue()),v.createUnofficialThemeList(t,s,o,i.GetValue()),e.streetcomplete.Clone().SetClass("block text-base mx-10 my-3 mb-10")])}static NothingFound(s){const n=x.t.general.morescreen;return new y([new q(n.noMatchingThemes,5).SetClass("w-max font-bold"),new M(D.search_disable_ui(),n.noSearch,{imgSize:"h-6"}).SetClass("h-12 w-max").onClick(()=>s.setData(""))]).SetClass("flex flex-col items-center w-full")}static createUrlFor(s,n,e){var c;if(s===void 0)return;if(s.id===void 0){console.error("ID is undefined for layout",s);return}if(s.id===((c=e==null?void 0:e.layoutToUse)==null?void 0:c.id))return;const t=e==null?void 0:e.locationControl;let o=window.location.pathname;o=o.substr(0,o.lastIndexOf("/")),o===""&&(o=".");let i=`${o}/${s.id.toLowerCase()}.html?`;(location.hostname==="localhost"||location.hostname==="127.0.0.1")&&(i=`${o}/theme.html?layout=${s.id}&`),n&&(i=`${o}/theme.html?userlayout=${s.id}&`);let u="";return s.definition!==void 0&&(u="#"+btoa(JSON.stringify(s.definition))),(t==null?void 0:t.map(a=>{const l=[["z",a==null?void 0:a.zoom],["lat",a==null?void 0:a.lat],["lon",a==null?void 0:a.lon]].filter(r=>r[1]!==void 0).map(r=>r[0]+"="+r[1]).join("&");return`${i}${l}${u}`}))??new ot(`${i}`)}static createLinkButton(s,n,e=!1){var i;const t=v.createUrlFor(n,e,s);let o=new y([new be(n.title,!e&&!n.mustHaveLanguage?"themes:"+n.id+".title":void 0),((i=new be(n.shortDescription))==null?void 0:i.SetClass("subtle"))??""]).SetClass("overflow-hidden flex flex-col");return s.layoutToUse===void 0&&(o=new y([o]).SetClass("flex flex-col justify-center h-24")),new M(n.icon,o,{url:t,newTab:!1})}static CreateProffessionalSerivesButton(){const s=x.t.professional.indexPage;return new y([new q(s.hook,4),s.hookMore,new M(void 0,s.button,{url:"./professional.html"})]).SetClass("flex flex-col border border-gray-300 p-2 rounded-lg")}static createUnofficialThemeList(s,n,e,t){var o=n.installedUserThemes,i=it.ListStabilized(o);return new I(i.map(u=>{const c=[];for(const a of u){const l=n.GetUnofficialTheme(a);if(l===void 0)continue;const r=v.createLinkButton(n,l,!0);r!==void 0&&c.push({element:r.SetClass(s),predicate:d=>a.toLowerCase().indexOf(d)>=0})}if(!(c.length<=0))return new y([x.t.general.customThemeIntro,new le(c,t,{innerClasses:e,onEmpty:v.NothingFound(t)})])}))}static createPreviouslyVistedHiddenList(s,n,e,t){const o=x.t.general.morescreen,i="mapcomplete-hidden-theme-",u=Ce.filter(a=>a.hideFromOverview),c=u.length;return new k(new I(s.osmConnection.preferencesHandler.preferences.map(a=>{const l=new Set(U.NoNull(Object.keys(a).filter(h=>h.startsWith(i)).map(h=>h.substring(i.length,h.length-8))));if(l.size===0)return;const r=u.filter(h=>l.has(h.id)).map(h=>{var p;return{element:(p=v.createLinkButton(s,h))==null?void 0:p.SetClass(n),predicate:v.MatchesLayoutFunc(h)}}),d=new le(r,t,{innerClasses:e,onEmpty:v.NothingFound(t)});return new y([new q(o.previouslyHiddenTitle),o.hiddenExplanation.Subs({hidden_discovered:""+l.size,total_hidden:""+c}),d])})).SetClass("flex flex-col"),void 0,s.osmConnection.isLoggedIn)}static MatchesLayoutFunc(s){return n=>{var t;if(n=n.toLocaleLowerCase(),s.id.toLowerCase().indexOf(n)>=0)return!0;const e=[s.shortDescription,s.title,...s.keywords??[]];for(const o of e){if(o===void 0)continue;const i=o["*"]??o[oe.language.data];if(((t=i==null?void 0:i.toLowerCase())==null?void 0:t.indexOf(n))>=0)return!0}return!1}}static createOfficialThemesList(s,n,e,t){let o=v.officialThemes.map(c=>{var l;if(c===void 0){console.trace("Layout is undefined");return}if(c.hideFromOverview)return;const a=(l=v.createLinkButton(s,c))==null?void 0:l.SetClass(n);return c.id===xt?{element:new I(s.osmConnection.userDetails.map(d=>d.csCount).map(d=>{if(!(d<H.userJourney.personalLayoutUnlock))return a}))}:{element:a,predicate:v.MatchesLayoutFunc(c)}});const i=v.CreateProffessionalSerivesButton(),u=v.createCustomGeneratorButton(s);return o.splice(0,0,{element:u},{element:i}),new le(o,t,{innerClasses:e,onEmpty:v.NothingFound(t)})}static createCustomGeneratorButton(s){const n=x.t.general.morescreen;return new I(s.osmConnection.userDetails.map(e=>e.csCount<H.userJourney.themeGeneratorReadOnlyUnlock?new M(null,n.requestATheme.Clone(),{url:"https://github.com/pietervdvn/MapComplete/issues",newTab:!0}):new M(D.pencil_ui(),n.createYourOwnTheme.Clone(),{url:"https://pietervdvn.github.io/mc/legacy/070/customGenerator.html",newTab:!1})))}};let ce=v;f(ce,"officialThemes",Ce);export{F,ce as M,te as S,Ct as a,z as b,St as c};
