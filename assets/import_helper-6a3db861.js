var ot=Object.defineProperty;var it=(B,d,s)=>d in B?ot(B,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):B[d]=s;var G=(B,d,s)=>(it(B,typeof d!="symbol"?d+"":d,s),s);import{C as x,T as Y,V as W,X as Xe,F as Le,U as j,S as le,J as ye,B as lt,L as xe,W as ut,A as et,H as ct}from"./SvelteUIElement-e1615eab.js";import"./ToSvelte-24689d6f.js";/* empty css                        *//* empty css                     *//* empty css                  */import{a as X,L as Je,T as Pe,D as dt}from"./List-264a4bef.js";import{L as ft}from"./LanguagePicker-cc3e6e25.js";import{a as ht,I as pt,d as mt,A as tt,V as Ee,M as Ie,B as rt,L as gt,F as wt,c as Ye,U as yt}from"./ChartJs-f6ae5b16.js";import{G as vt,a as ze,I as bt,H as nt,j as we,b as ge,d as Ce,C as St,J as Ct,K as st,N as _t,P as kt,S as xt,Q as Et,R as It,M as Tt}from"./theme_overview-b1cb811b.js";import{F as Lt}from"./FlowStep-140acdc0.js";import{S as ve,a as Ae}from"./SubtleButton-d23e2598.js";import{c as Ft}from"./_commonjsHelpers-edff4021.js";import{T as Be,L as Rt}from"./LeftIndex-ba3672a5.js";import{G as Ve,B as He,C as De}from"./BBox-0ed745d1.js";import{F as Se,b as Mt,M as Ot}from"./MoreScreen-9d53a70c.js";import{k as Ue,C as At}from"./known_layers-c3746dbc.js";import{A as qe}from"./AllKnownLayouts-939c60ee.js";import"./language_native-373a312a.js";import"./language_translations-d2c4c2fc.js";import"./defineProperty-bf1f4e26.js";import"./BackToIndex-c9b03002.js";var We={},Vt={get exports(){return We},set exports(B){We=B}};/* @license
Papa Parse
v5.3.2
https://github.com/mholt/PapaParse
License: MIT
*/(function(B,d){(function(s,a){B.exports=a()})(Ft,function s(){var a=typeof self<"u"?self:typeof window<"u"?window:a!==void 0?a:{},o=!a.document&&!!a.postMessage,f=o&&/blob:/i.test((a.location||{}).protocol),u={},c=0,r={parse:function(t,e){var l=(e=e||{}).dynamicTyping||!1;if(R(l)&&(e.dynamicTypingFunction=l,l={}),e.dynamicTyping=l,e.transform=!!R(e.transform)&&e.transform,e.worker&&r.WORKERS_SUPPORTED){var p=function(){if(!r.WORKERS_SUPPORTED)return!1;var m=(D=a.URL||a.webkitURL||null,N=s.toString(),r.BLOB_URL||(r.BLOB_URL=D.createObjectURL(new Blob(["(",N,")();"],{type:"text/javascript"})))),C=new a.Worker(m),D,N;return C.onmessage=$,C.id=c++,u[C.id]=C}();return p.userStep=e.step,p.userChunk=e.chunk,p.userComplete=e.complete,p.userError=e.error,e.step=R(e.step),e.chunk=R(e.chunk),e.complete=R(e.complete),e.error=R(e.error),delete e.worker,void p.postMessage({input:t,config:e,workerId:p.id})}var n=null;return r.NODE_STREAM_INPUT,typeof t=="string"?n=e.download?new y(e):new S(e):t.readable===!0&&R(t.read)&&R(t.on)?n=new F(e):(a.File&&t instanceof File||t instanceof Object)&&(n=new b(e)),n.stream(t)},unparse:function(t,e){var l=!1,p=!0,n=",",m=`\r
`,C='"',D=C+C,N=!1,w=null,K=!1;(function(){if(typeof e=="object"){if(typeof e.delimiter!="string"||r.BAD_DELIMITERS.filter(function(g){return e.delimiter.indexOf(g)!==-1}).length||(n=e.delimiter),(typeof e.quotes=="boolean"||typeof e.quotes=="function"||Array.isArray(e.quotes))&&(l=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(N=e.skipEmptyLines),typeof e.newline=="string"&&(m=e.newline),typeof e.quoteChar=="string"&&(C=e.quoteChar),typeof e.header=="boolean"&&(p=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");w=e.columns}e.escapeChar!==void 0&&(D=e.escapeChar+C),(typeof e.escapeFormulae=="boolean"||e.escapeFormulae instanceof RegExp)&&(K=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var _=new RegExp(O(C),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return ce(null,t,N);if(typeof t[0]=="object")return ce(w||Object.keys(t[0]),t,N)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||w),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),ce(t.fields||[],t.data||[],N);throw new Error("Unable to serialize unrecognized input");function ce(g,P,re){var U="";typeof g=="string"&&(g=JSON.parse(g)),typeof P=="string"&&(P=JSON.parse(P));var ee=Array.isArray(g)&&0<g.length,Q=!Array.isArray(P[0]);if(ee&&p){for(var Z=0;Z<g.length;Z++)0<Z&&(U+=n),U+=te(g[Z],Z);0<P.length&&(U+=m)}for(var v=0;v<P.length;v++){var A=ee?g.length:P[v].length,z=!1,J=ee?Object.keys(P[v]).length===0:P[v].length===0;if(re&&!ee&&(z=re==="greedy"?P[v].join("").trim()==="":P[v].length===1&&P[v][0].length===0),re==="greedy"&&ee){for(var L=[],M=0;M<A;M++){var q=Q?g[M]:M;L.push(P[v][q])}z=L.join("").trim()===""}if(!z){for(var k=0;k<A;k++){0<k&&!J&&(U+=n);var he=ee&&Q?g[k]:k;U+=te(P[v][he],k)}v<P.length-1&&(!re||0<A&&!J)&&(U+=m)}}return U}function te(g,P){if(g==null)return"";if(g.constructor===Date)return JSON.stringify(g).slice(1,25);var re=!1;K&&typeof g=="string"&&K.test(g)&&(g="'"+g,re=!0);var U=g.toString().replace(_,D);return(re=re||l===!0||typeof l=="function"&&l(g,P)||Array.isArray(l)&&l[P]||function(ee,Q){for(var Z=0;Z<Q.length;Z++)if(-1<ee.indexOf(Q[Z]))return!0;return!1}(U,r.BAD_DELIMITERS)||-1<U.indexOf(n)||U.charAt(0)===" "||U.charAt(U.length-1)===" ")?C+U+C:U}}};if(r.RECORD_SEP=String.fromCharCode(30),r.UNIT_SEP=String.fromCharCode(31),r.BYTE_ORDER_MARK="\uFEFF",r.BAD_DELIMITERS=["\r",`
`,'"',r.BYTE_ORDER_MARK],r.WORKERS_SUPPORTED=!o&&!!a.Worker,r.NODE_STREAM_INPUT=1,r.LocalChunkSize=10485760,r.RemoteChunkSize=5242880,r.DefaultDelimiter=",",r.Parser=I,r.ParserHandle=E,r.NetworkStreamer=y,r.FileStreamer=b,r.StringStreamer=S,r.ReadableStreamStreamer=F,a.jQuery){var i=a.jQuery;i.fn.parse=function(t){var e=t.config||{},l=[];return this.each(function(m){if(!(i(this).prop("tagName").toUpperCase()==="INPUT"&&i(this).attr("type").toLowerCase()==="file"&&a.FileReader)||!this.files||this.files.length===0)return!0;for(var C=0;C<this.files.length;C++)l.push({file:this.files[C],inputElem:this,instanceConfig:i.extend({},e)})}),p(),this;function p(){if(l.length!==0){var m,C,D,N,w=l[0];if(R(t.before)){var K=t.before(w.file,w.inputElem);if(typeof K=="object"){if(K.action==="abort")return m="AbortError",C=w.file,D=w.inputElem,N=K.reason,void(R(t.error)&&t.error({name:m},C,D,N));if(K.action==="skip")return void n();typeof K.config=="object"&&(w.instanceConfig=i.extend(w.instanceConfig,K.config))}else if(K==="skip")return void n()}var _=w.instanceConfig.complete;w.instanceConfig.complete=function(ce){R(_)&&_(ce,w.file,w.inputElem),n()},r.parse(w.file,w.instanceConfig)}else R(t.complete)&&t.complete()}function n(){l.splice(0,1),p()}}}function h(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var l=H(e);l.chunkSize=parseInt(l.chunkSize),e.step||e.chunk||(l.chunkSize=null),this._handle=new E(l),(this._handle.streamer=this)._config=l}.call(this,t),this.parseChunk=function(e,l){if(this.isFirstChunk&&R(this._config.beforeFirstChunk)){var p=this._config.beforeFirstChunk(e);p!==void 0&&(e=p)}this.isFirstChunk=!1,this._halted=!1;var n=this._partialLine+e;this._partialLine="";var m=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var C=m.meta.cursor;this._finished||(this._partialLine=n.substring(C-this._baseIndex),this._baseIndex=C),m&&m.data&&(this._rowCount+=m.data.length);var D=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(f)a.postMessage({results:m,workerId:r.WORKER_ID,finished:D});else if(R(this._config.chunk)&&!l){if(this._config.chunk(m,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);m=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(m.data),this._completeResults.errors=this._completeResults.errors.concat(m.errors),this._completeResults.meta=m.meta),this._completed||!D||!R(this._config.complete)||m&&m.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),D||m&&m.meta.paused||this._nextChunk(),m}this._halted=!0},this._sendError=function(e){R(this._config.error)?this._config.error(e):f&&this._config.error&&a.postMessage({workerId:r.WORKER_ID,error:e,finished:!1})}}function y(t){var e;(t=t||{}).chunkSize||(t.chunkSize=r.RemoteChunkSize),h.call(this,t),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(l){this._input=l,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),o||(e.onload=ae(this._chunkLoaded,this),e.onerror=ae(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var l=this._config.downloadRequestHeaders;for(var p in l)e.setRequestHeader(p,l[p])}if(this._config.chunkSize){var n=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+n)}try{e.send(this._config.downloadRequestBody)}catch(m){this._chunkError(m.message)}o&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(l){var p=l.getResponseHeader("Content-Range");return p===null?-1:parseInt(p.substring(p.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(l){var p=e.statusText||l;this._sendError(new Error(p))}}function b(t){var e,l;(t=t||{}).chunkSize||(t.chunkSize=r.LocalChunkSize),h.call(this,t);var p=typeof FileReader<"u";this.stream=function(n){this._input=n,l=n.slice||n.webkitSlice||n.mozSlice,p?((e=new FileReader).onload=ae(this._chunkLoaded,this),e.onerror=ae(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var n=this._input;if(this._config.chunkSize){var m=Math.min(this._start+this._config.chunkSize,this._input.size);n=l.call(n,this._start,m)}var C=e.readAsText(n,this._config.encoding);p||this._chunkLoaded({target:{result:C}})},this._chunkLoaded=function(n){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(n.target.result)},this._chunkError=function(){this._sendError(e.error)}}function S(t){var e;h.call(this,t=t||{}),this.stream=function(l){return e=l,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var l,p=this._config.chunkSize;return p?(l=e.substring(0,p),e=e.substring(p)):(l=e,e=""),this._finished=!e,this.parseChunk(l)}}}function F(t){h.call(this,t=t||{});var e=[],l=!0,p=!1;this.pause=function(){h.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){h.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(n){this._input=n,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){p&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):l=!0},this._streamData=ae(function(n){try{e.push(typeof n=="string"?n:n.toString(this._config.encoding)),l&&(l=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(m){this._streamError(m)}},this),this._streamError=ae(function(n){this._streamCleanUp(),this._sendError(n)},this),this._streamEnd=ae(function(){this._streamCleanUp(),p=!0,this._streamData("")},this),this._streamCleanUp=ae(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function E(t){var e,l,p,n=Math.pow(2,53),m=-n,C=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,D=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,N=this,w=0,K=0,_=!1,ce=!1,te=[],g={data:[],errors:[],meta:{}};if(R(t.step)){var P=t.step;t.step=function(v){if(g=v,ee())U();else{if(U(),g.data.length===0)return;w+=v.data.length,t.preview&&w>t.preview?l.abort():(g.data=g.data[0],P(g,N))}}}function re(v){return t.skipEmptyLines==="greedy"?v.join("").trim()==="":v.length===1&&v[0].length===0}function U(){return g&&p&&(Z("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+r.DefaultDelimiter+"'"),p=!1),t.skipEmptyLines&&(g.data=g.data.filter(function(v){return!re(v)})),ee()&&function(){if(!g)return;function v(z,J){R(t.transformHeader)&&(z=t.transformHeader(z,J)),te.push(z)}if(Array.isArray(g.data[0])){for(var A=0;ee()&&A<g.data.length;A++)g.data[A].forEach(v);g.data.splice(0,1)}else g.data.forEach(v)}(),function(){if(!g||!t.header&&!t.dynamicTyping&&!t.transform)return g;function v(z,J){var L,M=t.header?{}:[];for(L=0;L<z.length;L++){var q=L,k=z[L];t.header&&(q=L>=te.length?"__parsed_extra":te[L]),t.transform&&(k=t.transform(k,q)),k=Q(q,k),q==="__parsed_extra"?(M[q]=M[q]||[],M[q].push(k)):M[q]=k}return t.header&&(L>te.length?Z("FieldMismatch","TooManyFields","Too many fields: expected "+te.length+" fields but parsed "+L,K+J):L<te.length&&Z("FieldMismatch","TooFewFields","Too few fields: expected "+te.length+" fields but parsed "+L,K+J)),M}var A=1;return!g.data.length||Array.isArray(g.data[0])?(g.data=g.data.map(v),A=g.data.length):g.data=v(g.data,0),t.header&&g.meta&&(g.meta.fields=te),K+=A,g}()}function ee(){return t.header&&te.length===0}function Q(v,A){return z=v,t.dynamicTypingFunction&&t.dynamicTyping[z]===void 0&&(t.dynamicTyping[z]=t.dynamicTypingFunction(z)),(t.dynamicTyping[z]||t.dynamicTyping)===!0?A==="true"||A==="TRUE"||A!=="false"&&A!=="FALSE"&&(function(J){if(C.test(J)){var L=parseFloat(J);if(m<L&&L<n)return!0}return!1}(A)?parseFloat(A):D.test(A)?new Date(A):A===""?null:A):A;var z}function Z(v,A,z,J){var L={type:v,code:A,message:z};J!==void 0&&(L.row=J),g.errors.push(L)}this.parse=function(v,A,z){var J=t.quoteChar||'"';if(t.newline||(t.newline=function(q,k){q=q.substring(0,1048576);var he=new RegExp(O(k)+"([^]*?)"+O(k),"gm"),ue=(q=q.replace(he,"")).split("\r"),oe=q.split(`
`),pe=1<oe.length&&oe[0].length<ue[0].length;if(ue.length===1||pe)return`
`;for(var de=0,ie=0;ie<ue.length;ie++)ue[ie][0]===`
`&&de++;return de>=ue.length/2?`\r
`:"\r"}(v,J)),p=!1,t.delimiter)R(t.delimiter)&&(t.delimiter=t.delimiter(v),g.meta.delimiter=t.delimiter);else{var L=function(q,k,he,ue,oe){var pe,de,ie,ne;oe=oe||[",","	","|",";",r.RECORD_SEP,r.UNIT_SEP];for(var me=0;me<oe.length;me++){var se=oe[me],be=0,fe=0,Ze=0;ie=void 0;for(var _e=new I({comments:ue,delimiter:se,newline:k,preview:10}).parse(q),Fe=0;Fe<_e.data.length;Fe++)if(he&&re(_e.data[Fe]))Ze++;else{var ke=_e.data[Fe].length;fe+=ke,ie!==void 0?0<ke&&(be+=Math.abs(ke-ie),ie=ke):ie=ke}0<_e.data.length&&(fe/=_e.data.length-Ze),(de===void 0||be<=de)&&(ne===void 0||ne<fe)&&1.99<fe&&(de=be,pe=se,ne=fe)}return{successful:!!(t.delimiter=pe),bestDelimiter:pe}}(v,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);L.successful?t.delimiter=L.bestDelimiter:(p=!0,t.delimiter=r.DefaultDelimiter),g.meta.delimiter=t.delimiter}var M=H(t);return t.preview&&t.header&&M.preview++,e=v,l=new I(M),g=l.parse(e,A,z),U(),_?{meta:{paused:!0}}:g||{meta:{paused:!1}}},this.paused=function(){return _},this.pause=function(){_=!0,l.abort(),e=R(t.chunk)?"":e.substring(l.getCharIndex())},this.resume=function(){N.streamer._halted?(_=!1,N.streamer.parseChunk(e,!0)):setTimeout(N.resume,3)},this.aborted=function(){return ce},this.abort=function(){ce=!0,l.abort(),g.meta.aborted=!0,R(t.complete)&&t.complete(g),e=""}}function O(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function I(t){var e,l=(t=t||{}).delimiter,p=t.newline,n=t.comments,m=t.step,C=t.preview,D=t.fastMode,N=e=t.quoteChar===void 0||t.quoteChar===null?'"':t.quoteChar;if(t.escapeChar!==void 0&&(N=t.escapeChar),(typeof l!="string"||-1<r.BAD_DELIMITERS.indexOf(l))&&(l=","),n===l)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||-1<r.BAD_DELIMITERS.indexOf(n))&&(n=!1),p!==`
`&&p!=="\r"&&p!==`\r
`&&(p=`
`);var w=0,K=!1;this.parse=function(_,ce,te){if(typeof _!="string")throw new Error("Input must be a string");var g=_.length,P=l.length,re=p.length,U=n.length,ee=R(m),Q=[],Z=[],v=[],A=w=0;if(!_)return ne();if(D||D!==!1&&_.indexOf(e)===-1){for(var z=_.split(p),J=0;J<z.length;J++){if(v=z[J],w+=v.length,J!==z.length-1)w+=p.length;else if(te)return ne();if(!n||v.substring(0,U)!==n){if(ee){if(Q=[],oe(v.split(l)),me(),K)return ne()}else oe(v.split(l));if(C&&C<=J)return Q=Q.slice(0,C),ne(!0)}}return ne()}for(var L=_.indexOf(l,w),M=_.indexOf(p,w),q=new RegExp(O(N)+O(e),"g"),k=_.indexOf(e,w);;)if(_[w]!==e)if(n&&v.length===0&&_.substring(w,w+U)===n){if(M===-1)return ne();w=M+re,M=_.indexOf(p,w),L=_.indexOf(l,w)}else if(L!==-1&&(L<M||M===-1))v.push(_.substring(w,L)),w=L+P,L=_.indexOf(l,w);else{if(M===-1)break;if(v.push(_.substring(w,M)),ie(M+re),ee&&(me(),K))return ne();if(C&&Q.length>=C)return ne(!0)}else for(k=w,w++;;){if((k=_.indexOf(e,k+1))===-1)return te||Z.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Q.length,index:w}),de();if(k===g-1)return de(_.substring(w,k).replace(q,e));if(e!==N||_[k+1]!==N){if(e===N||k===0||_[k-1]!==N){L!==-1&&L<k+1&&(L=_.indexOf(l,k+1)),M!==-1&&M<k+1&&(M=_.indexOf(p,k+1));var he=pe(M===-1?L:Math.min(L,M));if(_.substr(k+1+he,P)===l){v.push(_.substring(w,k).replace(q,e)),_[w=k+1+he+P]!==e&&(k=_.indexOf(e,w)),L=_.indexOf(l,w),M=_.indexOf(p,w);break}var ue=pe(M);if(_.substring(k+1+ue,k+1+ue+re)===p){if(v.push(_.substring(w,k).replace(q,e)),ie(k+1+ue+re),L=_.indexOf(l,w),k=_.indexOf(e,w),ee&&(me(),K))return ne();if(C&&Q.length>=C)return ne(!0);break}Z.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Q.length,index:w}),k++}}else k++}return de();function oe(se){Q.push(se),A=w}function pe(se){var be=0;if(se!==-1){var fe=_.substring(k+1,se);fe&&fe.trim()===""&&(be=fe.length)}return be}function de(se){return te||(se===void 0&&(se=_.substring(w)),v.push(se),w=g,oe(v),ee&&me()),ne()}function ie(se){w=se,oe(v),v=[],M=_.indexOf(p,w)}function ne(se){return{data:Q,errors:Z,meta:{delimiter:l,linebreak:p,aborted:K,truncated:!!se,cursor:A+(ce||0)}}}function me(){m(ne()),Q=[],Z=[]}},this.abort=function(){K=!0},this.getCharIndex=function(){return w}}function $(t){var e=t.data,l=u[e.workerId],p=!1;if(e.error)l.userError(e.error,e.file);else if(e.results&&e.results.data){var n={abort:function(){p=!0,T(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:V,resume:V};if(R(l.userStep)){for(var m=0;m<e.results.data.length&&(l.userStep({data:e.results.data[m],errors:e.results.errors,meta:e.results.meta},n),!p);m++);delete e.results}else R(l.userChunk)&&(l.userChunk(e.results,n,e.file),delete e.results)}e.finished&&!p&&T(e.workerId,e.results)}function T(t,e){var l=u[t];R(l.userComplete)&&l.userComplete(e),l.terminate(),delete u[t]}function V(){throw new Error("Not implemented.")}function H(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var l in t)e[l]=H(t[l]);return e}function ae(t,e){return function(){t.apply(e,arguments)}}function R(t){return typeof t=="function"}return f&&(a.onmessage=function(t){var e=t.data;if(r.WORKER_ID===void 0&&e&&(r.WORKER_ID=e.workerId),typeof e.input=="string")a.postMessage({workerId:r.WORKER_ID,results:r.parse(e.input,e.config),finished:!0});else if(a.File&&e.input instanceof File||e.input instanceof Object){var l=r.parse(e.input,e.config);l&&a.postMessage({workerId:r.WORKER_ID,results:l,finished:!0})}}),(y.prototype=Object.create(h.prototype)).constructor=y,(b.prototype=Object.create(h.prototype)).constructor=b,(S.prototype=Object.create(S.prototype)).constructor=S,(F.prototype=Object.create(h.prototype)).constructor=F,r})})(Vt);class Dt extends pt{constructor(d){super(new vt(d,{allowMultiple:!1,acceptType:"*"}),(s,a)=>a===void 0||s===a,s=>{if(s===void 0)return;const a=s.item(0);return{name:a.name,contents:a.text()}},s=>{})}}class Nt extends x{constructor(){const s=Y.t.importHelper.selectFile,a=new Dt(new ve(void 0,s.description)),o=new W(a.GetValue().map(r=>r===void 0?s.noFilesLoaded.SetClass("alert"):s.loadedFilesAre.Subs({file:r.name}).SetClass("thanks"))),u=Xe.flatten(a.GetValue().map(r=>{if(r!==void 0)return Xe.FromPromise(r.contents)})).map(r=>{if(r!==void 0)try{const h=JSON.parse(r);return h.type!=="FeatureCollection"?{error:s.errNotFeatureCollection}:h.features.some(y=>y.geometry.type!="Point")?{error:s.errPointsOnly}:(h.features.forEach(y=>{const b=y.properties;for(const S in b)if((b[S]===void 0||b[S]===null||b[S]==="")&&delete b[S],!ht.isValidKey(S))return{error:"Probably an invalid key: "+S}}),h)}catch{var i=We.parse(r).data;const y=i[0];if(i.splice(0,1),y.indexOf("lat")<0||y.indexOf("lon")<0)return{error:s.errNoLatOrLon};if(y.some(S=>S.trim()==""))return{error:s.errNoName};if(new Set(y).size!==y.length)return{error:s.errDuplicate};const b=[];for(let S=0;S<i.length;S++){const F=i[S];if(F.length==0||F.length==1&&F[0]=="")continue;const E={};for(let $=0;$<y.length;$++){const T=F[$];T===void 0||T===""||(E[y[$]]=T)}const O=[Number(E.lon),Number(E.lat)];if(delete E.lat,delete E.lon,O.some(isNaN))return{error:"A coordinate could not be parsed for line "+(S+2)};const I={type:"Feature",properties:E,geometry:{type:"Point",coordinates:O}};b.push(I)}return{type:"FeatureCollection",features:b}}}),c=new W(u.map(r=>{if(r===void 0||(r==null?void 0:r.error)===void 0)return;let i;return typeof r.error=="string"?i=new Le(r.error):r.error.Clone!==void 0?i=r.error.Clone():i=r.error,i.SetClass("alert")}));super([new X(s.title,1),s.fileFormatDescription,s.fileFormatDescriptionCsv,s.fileFormatDescriptionGeoJson,a,o,c]);G(this,"IsValid");G(this,"Value");this.SetClass("flex flex-col wi"),this.IsValid=u.map(r=>r!==void 0&&r.error===void 0),this.Value=u}}const Ne=class extends W{constructor(d,s,a,o){const f=new j((o==null?void 0:o.sortMode)??"name"),u=new W(f.map(y=>{switch(y){case"name":return le.up_svg();case"name-rev":return le.up_svg().SetStyle("transform: rotate(180deg)");default:return le.circle_svg()}})),c=new x([u.SetClass("w-4 mr-2"),s]).SetClass("flex").onClick(()=>{f.data==="name"?f.setData("name-rev"):f.setData("name")}),r=new W(f.map(y=>{switch(y){case"count":return le.up_svg();case"count-rev":return le.up_svg().SetStyle("transform: rotate(180deg)");default:return le.circle_svg()}})),i=new x([r.SetClass("w-4 mr-2"),a]).SetClass("flex").onClick(()=>{f.data==="count-rev"?f.setData("count"):f.setData("count-rev")}),h=[c,i];super(d.map(y=>{if(y===void 0)return;y=ye.NoNull(y);const b=new Map;for(const I of y){const $=b.get(I)??0;b.set(I,$+1)}const S=Array.from(b.keys());switch(f.data){case"name":S.sort();break;case"name-rev":S.sort().reverse();break;case"count":S.sort((I,$)=>b.get(I)-b.get($));break;case"count-rev":S.sort((I,$)=>b.get($)-b.get(I));break}const F=Math.max(...Array.from(b.values())),E=I=>{const $=S.indexOf(I);return Ne.defaultPalette[$%Ne.defaultPalette.length]};let O;return(o==null?void 0:o.assignColor)===void 0?O=E:O=I=>o.assignColor(I)??E(I),new mt(h,S.map(I=>[I,new x([new x([new Le(""+b.get(I)).SetClass("font-bold rounded-full block")]).SetClass("flex justify-center rounded border border-black").SetStyle(`background: ${O(I)}; width: ${100*b.get(I)/F}%`)]).SetClass("block w-full")]),{contentStyle:S.map(I=>["width: 20%"])}).SetClass("w-full zebra-table")},[f]))}};let Re=Ne;G(Re,"defaultPalette",["#ff5858","#ffad48","#ffff59","#56bd56","#63a9ff","#9d62d9","#fa61fa"]);class Gt extends x{constructor(s,a){const o=Y.t.importHelper.previewAttributes,f=new Set;for(const i of a.features)Object.keys(i.properties).forEach(h=>f.add(h));const u=[],c=a.features.length;for(const i of Array.from(f)){const h=ye.NoNull(a.features.map(F=>F.properties[i])),y=!h.some(F=>F!==h[0]);let b;if(h.length===c?b=o.allAttributesSame:b=o.someHaveSame.Subs({count:h.length,percentage:Math.floor(100*h.length/c)}),y){u.push(new X(i+"="+h[0])),u.push(b);continue}const S=new Set(h).size;if(S!==h.length&&S<15){u.push();let F=new x([b,new Re(new j(h),"Value","Occurence",{sortMode:"count-rev"})]).SetClass("flex flex-col");const E=new X(i+"=*");S>15?F=new Be(E,F.SetClass("block")).Collapse():u.push(E),u.push(F);continue}u.push(new Be(new X(i+"=*"),new x([b,new Je(h)])))}const r=new ze([o.inspectLooksCorrect]);super([new X(o.inspectDataTitle.Subs({count:a.features.length})),"Extra remark: An attribute with 'source' or 'src' will be added as 'source' into the map pin; an attribute 'note' will be added into the map pin as well. These values won't be imported",...u,r]);G(this,"IsValid");G(this,"Value");this.Value=new j(a),this.IsValid=r.GetValue().map(i=>i.length==1)}}const Pt="import_candidate",zt="Layer used in the importHelper",Bt={osmTags:{and:[]}},Ht=[{location:["point","centroid"],icon:"square:red;",iconSize:"15,15,center"}],Ut="Import candidate",qt=[{id:"all_tags",render:"{all_tags()}"}],Ke={id:Pt,description:zt,source:Bt,mapRendering:Ht,title:Ut,tagRenderings:qt};class at{static partitionFeaturesIfNearby(d,s,a){return s.map(o=>{if((o==null?void 0:o.features)===void 0)return;if(o.features.length===0)return{noNearby:d.features,hasNearby:[]};const f=a.data,u=[],c=[];for(const r of d.features)o.features.some(h=>f>=Ve.distanceBetween(r.geometry.coordinates,Ve.centerpointCoordinates(h)))?u.push(r):c.push(r);return{hasNearby:u,noNearby:c}},[a])}}const Wt="current_view",Kt=`A meta-layer which contains one single feature, namely the BBOX of the current map view. This can be used to trigger special actions. If a popup is defined for this layer, this popup will be accessible via an extra button on screen.

The icon on the button is the default icon of the layer, but can be customized by detecting 'button=yes'.`,Jt={osmTags:"current_view=yes",maxCacheAge:0},jt=!1,$t="Current View",Qt=[],Zt=[{color:"#cccc0088"}],Xt={id:Wt,description:Kt,source:Jt,shownByDefault:jt,title:$t,tagRenderings:Qt,mapRendering:Zt};class je extends lt{constructor(s){super();G(this,"_id");this._id=s}InnerConstructElement(){const s=document.createElement("div");return s.id=this._id,s}}class Yt extends x{constructor(s,a){const o=Y.t.importHelper.conflationChecker,f=a.bbox.padAbsolute(1e-4),u=a.layer,c=a;let r=new j("idle");function i(){const n=De.defaultOverpassUrls[1],m=new st,C=new Ct(a.layer.source.osmTags,[],n,new j(180),m,!0);console.log("Loading from overpass!"),r.setData("running"),C.queryGeoJson(f).then(([D,N])=>{console.log("Received overpass-data: ",D.features.length,"features are loaded at ",N),r.setData("success"),h.setData([D,N])},D=>{r.setData({error:D})})}const h=bt.Get("importer-overpass-cache-"+u.id,{whenLoaded:n=>{n!=null?(console.log("Loaded from local storage:",n),r.setData("cached")):i()}}),y=h.map(n=>{if(n===void 0||n[1]===void 0)return;const[m,C]=n;return(new Date().getTime()-C.getTime())/1e3});y.addCallbackD(n=>{if(n<24*60*60){r.setData("cached");return}else i()});const b=h.map(n=>{if(n!==void 0)return n[0]}),S=new j(tt.osmCarto),F=new j({lat:0,lon:0,zoom:1}),E=new j(void 0),O=Ee.ForType("pnat").ConstructInputElement({value:xe.GetParsed("importer-zoom-level","0")});O.SetClass("ml-1 border border-black");const I=Ie.createMiniMap({allowMoving:!0,location:F,background:S,bounds:E,attribution:new nt(F,s.osmConnection.userDetails,void 0,E)});I.SetClass("w-full").SetStyle("height: 500px");const $=b.map(n=>{if((n==null?void 0:n.features)===void 0)return[];const m=O.GetValue().data,C=I.location.data.zoom>=Number(m);if(m!==void 0&&!C)return[];const D=I.bounds.data;return D===void 0?n.features:n.features.filter(N=>He.get(N).overlapsWith(D))},[I.bounds,O.GetValue()]),T=we.fromGeojsonStore($);new ge({layerToShow:new Ce(Xt),state:s,leafletMap:I.leafletMap,popup:void 0,zoomToFeatures:!0,features:we.fromGeojson([f.asGeoJson({})])}),new ge({layerToShow:u,state:s,leafletMap:I.leafletMap,popup:(n,m)=>new Se(n,m,s,{setHash:!1}),zoomToFeatures:!1,features:T}),new ge({layerToShow:new Ce(Ke),state:s,leafletMap:I.leafletMap,popup:(n,m)=>new Se(n,m,s,{setHash:!1}),zoomToFeatures:!1,features:we.fromGeojson(c.features)});const V=Ee.ForType("pnat").ConstructInputElement();V.SetClass("ml-1 border border-black"),V.GetValue().syncWith(xe.Get("importer-cutoff","25"),!0);const H=Ie.createMiniMap({allowMoving:!0,background:S});H.SetClass("w-full").SetStyle("height: 500px");const ae=b.map(n=>{if((n==null?void 0:n.features)===void 0)return[];const m=Number(V.GetValue().data);return n.features.filter(C=>c.features.some(D=>m>=Ve.distanceBetween(D.geometry.coordinates,Ve.centerpointCoordinates(C))))},[V.GetValue().stabilized(500)]),R=we.fromGeojsonStore(ae),t=at.partitionFeaturesIfNearby(c,b,V.GetValue().map(Number)),e=we.fromGeojsonStore(t.map(n=>(n==null?void 0:n.hasNearby)??[]));e.features.addCallback(n=>console.log("The following features are near an already existing object:",n)),new ge({layerToShow:new Ce(Ke),state:s,leafletMap:H.leafletMap,popup:(n,m)=>new Se(n,m,s,{setHash:!1}),zoomToFeatures:!1,features:e});const l=new St(o.showOsmLayerInConflationMap,!0);new ge({layerToShow:u,state:s,leafletMap:H.leafletMap,popup:(n,m)=>new Se(n,m,s,{setHash:!1}),zoomToFeatures:!0,features:R,doShowLayer:l.GetValue()});const p=new x([new W(b.map(n=>{if(n!==void 0)return new ve(le.download_svg(),o.downloadOverpassData).onClick(()=>{ye.offerContentsAsDownloadableFile(JSON.stringify(n,null,"  "),"mapcomplete-"+u.id+".geojson",{mimetype:"application/json+geo"})})})),new W(y.map(n=>{if(n!==void 0)return n<0?o.cacheExpired:new x([o.loadedDataAge.Subs({age:ye.toHumanTime(n)}),new ve(le.reload_svg().SetClass("h-8"),o.reloadTheCache).onClick(i).SetClass("h-12")])})),new X(o.titleLive),o.importCandidatesCount.Subs({count:c.features.length}),new W(b.map(n=>{var m,C;return((m=n==null?void 0:n.features)==null?void 0:m.length)===void 0||((C=n==null?void 0:n.features)==null?void 0:C.length)===0?o.nothingLoaded.Subs(u).SetClass("alert"):new x([o.osmLoaded.Subs({count:n.features.length,name:u.name})])})),I,new x([o.zoomLevelSelection,O,new W(I.location.map(n=>o.zoomIn.Subs({current:n.zoom})))]).SetClass("flex"),new je("fullscreen"),new X(o.titleNearby),new x([o.mapShowingNearbyIntro,V]).SetClass("flex"),new W(e.features.map(n=>o.nearbyWarn.Subs({count:n.length}).SetClass("alert"))),o.setRangeToZero,H,new x([new rt({backgroundLayer:S,locationControl:H.location},S),l]).SetClass("flex")]).SetClass("flex flex-col");super([new X(o.title),new W(r.map(n=>n==="idle"?new Ae(o.states.idle):n==="running"?new Ae(o.states.running):n.error!==void 0?o.states.error.Subs({error:n.error}).SetClass("alert"):n==="cached"||n==="success"?p:o.states.unexpected.Subs({state:n}).SetClass("alert")))]);G(this,"IsValid");G(this,"Value");this.Value=t.map(n=>({theme:a.theme,features:n==null?void 0:n.noNearby,layer:a.layer})),this.IsValid=this.Value.map(n=>(n==null?void 0:n.features)!==void 0&&n.features.length>0)}}class er extends x{constructor(s){const a=Y.t.importHelper.askMetadata,o=Ee.ForType("text").ConstructInputElement({value:xe.Get("import-helper-introduction-text"),inputStyle:"width: 100%"}),f=Ee.ForType("url").ConstructInputElement({value:xe.Get("import-helper-wikilink-text"),inputStyle:"width: 100%"}),u=Ee.ForType("string").ConstructInputElement({value:xe.Get("import-helper-source-text"),inputStyle:"width: 100%"});super([new X(a.title),a.intro.Subs({count:s.features.length}),a.giveDescription,o.SetClass("w-full border border-black"),a.giveSource,u.SetClass("w-full border border-black"),a.giveWikilink,f.SetClass("w-full border border-black"),new W(f.GetValue().map(c=>{try{const r=new URL(c);if(r.hostname.toLowerCase()!=="wiki.openstreetmap.org")return a.shouldBeOsmWikilink.SetClass("alert");if(r.pathname.toLowerCase()==="/wiki/main_page")return a.shouldNotBeHomepage.SetClass("alert")}catch{return a.shouldBeUrl.SetClass("alert")}})),a.orDownload,new ve(le.download_svg(),a.downloadGeojson).OnClickWithLoading("Preparing your download",async()=>{const c={type:"FeatureCollection",features:s.features};ye.offerContentsAsDownloadableFile(JSON.stringify(c),"prepared_import_"+s.theme+".geojson",{mimetype:"application/vnd.geo+json"})})]);G(this,"Value");G(this,"IsValid");this.SetClass("flex flex-col"),this.Value=o.GetValue().map(c=>({features:s.features,wikilink:f.GetValue().data,intro:c,source:u.GetValue().data,theme:s.theme}),[f.GetValue(),u.GetValue()]),this.IsValid=this.Value.map(c=>{if(c===void 0||[c.features,c.intro,c.wikilink,c.source].some(r=>r===void 0))return!1;try{if(new URL(c.wikilink).hostname.toLowerCase()!=="wiki.openstreetmap.org")return!1}catch{return!1}return!0})}}class tr extends x{constructor(s){const a=Y.t.importHelper.confirmProcess,o=[new ut(a.readImportGuidelines,"https://wiki.openstreetmap.org/wiki/Import_guidelines",!0),a.contactedCommunity,a.licenseIsCompatible,a.wikipageIsMade],f=new ze(o);super([new X(a.titleLong),f]);G(this,"IsValid");G(this,"Value");this.SetClass("link-underline"),this.IsValid=f.GetValue().map(u=>o.length==u.length),this.Value=new j(s)}}class Te extends x{static createNoteContentsUi(d,s){const a=d.properties.source??d.properties.src??s.source;delete d.properties.source,delete d.properties.src;let o="";d.properties.note&&(o=d.properties.note+`
`,delete d.properties.note);const f=[];for(const i in d.properties){if(d.properties[i]===null||d.properties[i]===void 0){console.warn("Null or undefined key for ",d.properties);continue}d.properties[i]!==""&&f.push(i+"="+(d.properties[i]+"").replace(/=/,"\\=").replace(/;/g,"\\;").replace(/\n/g,"\\n"))}const u=d.geometry.coordinates[1],c=d.geometry.coordinates[0],r=Y.t.importHelper.noteParts;return[s.intro,o,r.datasource.Subs({source:a}),r.wikilink.Subs(s),"",r.importEasily,`https://mapcomplete.osm.be/${s.theme}.html?z=18&lat=${u}&lon=${c}#import`,...f]}static createNoteContents(d,s){return Te.createNoteContentsUi(d,s).map(a=>typeof a=="string"?a:a.txt)}constructor(d,s){const a=Y.t.importHelper.createNotes,o=new j([]),f=new j([]),u=o.map(c=>c.length);for(const c of s.features){const r=c.geometry.coordinates[1],i=c.geometry.coordinates[0],h=Te.createNoteContents(c,s).join(`
`);d.osmConnection.openNote(r,i,h).then(({id:y})=>{o.data.push(y),o.ping()},y=>{f.data.push(y),f.ping()})}super([new X(a.title),a.loading,new Pe(new Ae(new W(u.map(c=>a.creating.Subs({count:c,total:s.features.length})))),new x([le.party_svg().SetClass("w-24"),a.done.Subs({count:s.features.length}).SetClass("thanks"),new ve(le.note_svg(),a.openImportViewer,{url:"import_viewer.html"})]),u.map(c=>c<s.features.length)),new W(f.map(c=>{if(c.length!==0)return new x([new Le("Some entries failed").SetClass("alert"),...c]).SetClass("flex flex-col")}))]),this.SetClass("flex flex-col")}}class rr extends x{constructor(s,a){const o=Y.t.importHelper.compareToAlreadyExistingNotes,f=Ue.layers.filter(E=>E.id===a.layer.id)[0];f===void 0&&console.error("WEIRD: layer not found in the builtin layer overview");const u=new At(150).convertStrict(f,"CompareToAlreadyExistingNotes"),c=new Ce(u,"import-layer-dynamic"),r={appliedFilters:new j(new Map),isDisplayed:new j(!0),layerDef:c},i=new _t(r,a.bbox.padAbsolute(1e-4));i.features.map(E=>Mt.addMetatags(E,{memberships:new st,getFeaturesWithin:()=>[],getFeatureById:()=>{}},c,s,{includeDates:!0,includeNonDates:!0}));const h=new kt(s,void 0,i),y=Ie.createMiniMap();y.SetClass("w-full").SetStyle("height: 500px");const b=Ie.createMiniMap({location:y.location});b.SetClass("w-full").SetStyle("height: 500px"),new ge({layerToShow:c,state:s,zoomToFeatures:!0,leafletMap:y.leafletMap,features:h,popup:(E,O)=>new Se(E,O,s)});const S=new j(10),F=at.partitionFeaturesIfNearby(a,h.features.map(E=>({features:E.map(O=>O.feature)})),S);new ge({layerToShow:new Ce(Ke),state:s,zoomToFeatures:!0,leafletMap:b.leafletMap,features:we.fromGeojsonStore(F.map(E=>E.hasNearby)),popup:(E,O)=>new Se(E,O,s)});super([new X(o.titleLong),new W(h.features.map(E=>{if(i.state.data!==void 0&&i.state.data.error!==void 0){const O=i.state.data.error;o.loadingFailed.Subs({error:O})}return i.features.data===void 0||i.features.data.length===0?new Ae(o.loading):E.length===0?o.noPreviousNotesFound.SetClass("thanks"):new x([o.mapExplanation.Subs(a.features),y,new je("fullscreen"),new W(F.map(({noNearby:O,hasNearby:I})=>O.length===0?o.completelyImported.SetClass("alert w-full block").SetStyle("padding: 0.5rem"):I.length===0?o.nothingNearby.SetClass("thanks w-full block").SetStyle("padding: 0.5rem"):new x([o.someNearby.Subs({hasNearby:I.length,distance:S.data}).SetClass("alert"),o.wontBeImported,b.SetClass("w-full")]).SetClass("w-full")))]).SetClass("flex flex-col")},[i.features,i.state]))]);G(this,"IsValid");G(this,"Value");this.SetClass("flex flex-col"),this.Value=F.map(({noNearby:E})=>({features:E,bbox:a.bbox,layer:a.layer,theme:a.theme})),this.IsValid=h.features.map(E=>i.features.data.length===0?!1:E.length==0?!0:F.data.noNearby.length>0,[F,i.features])}}class nr extends x{constructor(){const s=Te.createNoteContentsUi({properties:{some_key:"some_value",note:"a note in the original dataset"},geometry:{coordinates:[3.4,51.2]}},{wikilink:"https://wiki.openstreetmap.org/wiki/Imports/<documentation of your import>",intro:"There might be an XYZ here",theme:"theme",source:"source of the data"}).map(a=>a===""?new Le("").SetClass("block"):a);super([new X(Y.t.importHelper.introduction.title),Y.t.importHelper.introduction.description,Y.t.importHelper.introduction.importFormat,new x([new x(s).SetClass("flex flex-col")]).SetClass("literal-code")]);G(this,"IsValid");G(this,"Value");this.SetClass("flex flex-col"),this.IsValid=new j(!0),this.Value=new j(void 0)}}const Qe=class extends x{constructor(s){const a=Y.t.importHelper.login,o=new ze([new W(s.osmConnection.userDetails.map(u=>a.loginIsCorrect.Subs(u)))]),f=s.osmConnection.userDetails.map(u=>Qe.whitelist.indexOf(u.uid)>=0||u.csCount>=De.userJourney.importHelperUnlock);super([new X(a.userAccountTitle),new gt(new W(s.osmConnection.userDetails.map(u=>{if(u!==void 0)return new x([new et(u.img??"./assets/svgs/help.svg").SetClass("w-16 h-16 rounded-full"),a.loggedInWith.Subs(u),new ve(le.logout_svg().SetClass("h-8"),Y.t.general.logout).onClick(()=>s.osmConnection.LogOut()),o])})),a.loginRequired,s),new Pe(void 0,new x([a.lockNotice.Subs(De.userJourney).SetClass("alert"),Ot.CreateProffessionalSerivesButton()]),f)]);G(this,"IsValid");G(this,"Value");this.Value=new j(s),this.IsValid=f.map(u=>u&&o.GetValue().data.length>0,[o.GetValue()])}};let Me=Qe;G(Me,"whitelist",[15015689]);const Ge=class{static getSharedLayersConfigs(){const d=new Map;for(const s of Ue.layers)d.set(s.id,s);return d}static getSharedLayers(){const d=new Map;for(const s of Ue.layers)try{const a=new Ce(s,"shared_layers");d.set(s.id,a)}catch(a){ye.runningFromConsole||console.error("CRITICAL: Could not parse a layer configuration!",s.id," due to",a)}return d}static AllPublicLayers(d){const s=[],a=new Set;if(Ge.sharedLayers.forEach((o,f)=>{a.add(f),s.push(o)}),(d==null?void 0:d.includeInlineLayers)??!0){const o=Array.from(qe.allKnownLayouts.values()).filter(f=>!f.hideFromOverview);for(const f of o)if(!f.hideFromOverview)for(const u of f.layers)a.has(u.id)||(a.add(u.id),s.push(u))}return s}};let Oe=Ge;G(Oe,"sharedLayers",Ge.getSharedLayers());class sr extends xt{constructor(d){super(s=>new Le("Element to import"),s=>new x(["The tags are:",new ct(Et,{tags:d})]).SetClass("flex flex-col"),"element")}}class ar extends x{constructor(s,a){const o=Y.t.importHelper.mapPreview,f=new Set;for(const T of a.features)Object.keys(T.properties).forEach(V=>f.add(V));const u=Oe.AllPublicLayers().filter(T=>T.name!==void 0&&De.priviliged_layers.indexOf(T.id)<0),c=new dt(o.selectLayer,[{shown:o.selectLayer,value:void 0}].concat(u.map(T=>({shown:T.name,value:T}))));let r=new j(!1);for(const T of u)if(!a.features.some(H=>!T.source.osmTags.matchesProperties(H.properties))){console.log("Autodected layer",T.id),c.GetValue().setData(T),c.GetValue().addCallback(H=>r.setData(!1)),r.setData(!0);break}const i=a.features.map((T,V)=>{const H=ye.Clone(T);return H.properties.id="to-import/"+V,H}),h=c.GetValue().map(T=>{if(T===void 0)return console.log("No matching layer found"),[];const V=[];for(const H of i)T.source.osmTags.matchesProperties(H.properties)&&V.push(H);return console.log("Matching features: ",V),V}),y=new j(tt.osmCarto),b=new j({lat:0,lon:0,zoom:1}),S=new j(void 0),F=Ie.createMiniMap({allowMoving:!0,location:b,background:y,bounds:S,attribution:new nt(b,s.osmConnection.userDetails,void 0,S)}),E=new rt({backgroundLayer:y,locationControl:b},y);F.SetClass("w-full").SetStyle("height: 500px"),c.GetValue().addCallbackAndRunD(T=>{new ge({layerToShow:T,zoomToFeatures:!0,features:we.fromDateless(h.map(V=>V.map(H=>({feature:H})))),leafletMap:F.leafletMap,popup:V=>new sr(V)})});const O=h.map(T=>He.bboxAroundAll(T.map(V=>new He([V.geometry.coordinates])))),I=new W(h.map(T=>{var ae,R,t;if(T===void 0)return;const V=a.features.length-T.length;if(V===0)return;const H=(t=(R=(ae=c.GetValue().data)==null?void 0:ae.source)==null?void 0:R.osmTags)==null?void 0:t.asHumanString(!1,!1,{});return o.mismatch.Subs({count:V,tags:H}).SetClass("alert")})),$=new ze([o.confirm]);super([new X(o.title,1),c,new Pe(o.autodetected.SetClass("thanks"),void 0,r),I,F,new je("fullscreen"),E,$]);G(this,"IsValid");G(this,"Value");this.Value=O.map(T=>({bbox:T,features:h.data,layer:c.GetValue().data}),[c.GetValue(),h]),this.IsValid=h.map(T=>T===void 0||$.GetValue().data.length!==1?!1:a.features.length-T.length===0,[$.GetValue()])}}class $e extends x{constructor(s){const a=Y.t.importHelper.selectTheme;let o=Array.from(qe.allKnownLayouts.values()).filter(r=>r.layers.some(i=>i.id===s.layer.id)).filter(r=>r.id!=="personal").map(r=>new wt(new x([new et(r.icon).SetClass("block h-12 w-12 br-4"),new X(r.title)]).SetClass("flex items-center"),r.id));const f=new It(o,{selectFirstAsDefault:!1}),u=f.GetValue().map(r=>r===void 0?[]:qe.allKnownLayouts.get(r).layers.find(y=>y.id===s.layer.id).presets),c=u.map(r=>{if(!(r===void 0||r.length===0))return s.features.filter(i=>!r.some(h=>new Ye(h.tags).matchesProperties(i.properties)))});super([new X(a.title),a.intro,f,new W(u.map(r=>{if(f.GetValue().data!==void 0&&(r===void 0||r.length===0))return a.noMatchingPresets.SetClass("alert")},[f.GetValue()])),new W(c.map(r=>$e.nonMatchedElementsPanel(r,u.data),[u]))]);G(this,"Value");G(this,"IsValid");this.SetClass("flex flex-col"),this.Value=f.GetValue().map(r=>({features:s.features,layer:s.layer,bbox:s.bbox,theme:r})),this.IsValid=this.Value.map(r=>{var i;return!(r===void 0||[r.theme,r.features].some(h=>h===void 0)||u.data===void 0||u.data.length===0||(((i=c.data)==null?void 0:i.length)??0)>0)},[u])}static nonMatchedElementsPanel(s,a){if(s===void 0||s.length===0)return;const o=Y.t.importHelper.selectTheme,f=a.map(c=>o.needsTags.Subs({title:c.title,tags:c.tags.map(r=>r.asHumanString()).join(" & ")}).SetClass("thanks")),u=[];for(const c of s){const r=[];r.push(new x(Object.keys(c.properties).map(i=>i+"="+c.properties[i])).SetClass("flex flex-col"));for(const i of a){const h=new Ye(i.tags).asChange({}),y=[];for(const{k:b,v:S}of h)i[b]===void 0?y.push(o.missing.Subs({k:b,v:S})):c.properties[b]!==S&&y.push(o.misMatch.Subs({k:b,v:S,properties:c.properties}));y.length>0&&r.push(new x([o.notApplicable.Subs(i),new Je(y)]).SetClass("flex flex-col alert"))}u.push(new x(r).SetClass("flex flex-col"))}return new x([o.displayNonMatchingCount.Subs(s).SetClass("alert"),...f,new Be(new X(o.unmatchedTitle),new x(u))]).SetClass("flex flex-col")}}class or extends Rt{constructor(){var r;const d=new yt(void 0),s=Y.t.importHelper,{flow:a,furthestStep:o,titles:f}=Lt.start(s.introduction,new nr).then(s.login,i=>new Me(d)).then(s.selectFile,i=>new Nt).then(s.previewAttributes,i=>new Gt(d,i)).then(s.mapPreview,i=>new ar(d,i)).then(s.selectTheme,i=>new $e(i)).then(s.compareToAlreadyExistingNotes,i=>new rr(d,i)).then(s.conflationChecker,i=>new Yt(d,i)).then(s.confirmProcess,i=>new tr(i)).then(s.askMetadata,i=>new er(i)).finish(s.createNotes.title,i=>new Te(d,i)),u=new Je(f.map((i,h)=>new W(o.map(y=>{if(h>y)return new x([i]).SetClass("subtle");if(h==y)return new x([i]).SetClass("font-bold");if(h<y)return i}))),!0),c=[new ve(void 0,s.gotoImportViewer,{url:"import_viewer.html"}),u,new Pe(s.testMode.SetClass("block alert"),void 0,d.featureSwitchIsTesting),(r=new ft(Y.t.importHelper.title.SupportedLanguages(),""))==null?void 0:r.SetClass("mt-4 self-end flex-col")].map(i=>i==null?void 0:i.SetClass("pl-4"));super(c,a)}}Tt.initialize();new or().AttachTo("main");
