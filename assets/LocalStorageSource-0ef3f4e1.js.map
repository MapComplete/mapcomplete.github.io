{"version":3,"file":"LocalStorageSource-0ef3f4e1.js","sources":["../../src/Logic/Web/LocalStorageSource.ts"],"sourcesContent":["import { UIEventSource } from \"../UIEventSource\"\n\n/**\n * UIEventsource-wrapper around localStorage\n */\nexport class LocalStorageSource {\n    static GetParsed<T>(key: string, defaultValue: T): UIEventSource<T> {\n        return LocalStorageSource.Get(key).sync(\n            (str) => {\n                if (str === undefined) {\n                    return defaultValue\n                }\n                try {\n                    return JSON.parse(str)\n                } catch {\n                    return defaultValue\n                }\n            },\n            [],\n            (value) => JSON.stringify(value)\n        )\n    }\n\n    static Get(key: string, defaultValue: string = undefined): UIEventSource<string> {\n        try {\n            let saved = localStorage.getItem(key)\n            if (saved === \"undefined\") {\n                saved = undefined\n            }\n            const source = new UIEventSource<string>(saved ?? defaultValue, \"localstorage:\" + key)\n\n            source.addCallback((data) => {\n                if(data === undefined || data === \"\" || data === null){\n                    localStorage.removeItem(key)\n                    return\n                }\n                try {\n                    localStorage.setItem(key, data)\n                } catch (e) {\n                    // Probably exceeded the quota with this item!\n                    // Lets nuke everything\n                    localStorage.clear()\n                }\n            })\n            return source\n        } catch (e) {\n            return new UIEventSource<string>(defaultValue)\n        }\n    }\n}\n"],"names":["LocalStorageSource","key","defaultValue","str","value","saved","source","UIEventSource","data"],"mappings":"2CAKO,MAAMA,CAAmB,CAC5B,OAAO,UAAaC,EAAaC,EAAmC,CACzD,OAAAF,EAAmB,IAAIC,CAAG,EAAE,KAC9BE,GAAQ,CACL,GAAIA,IAAQ,OACD,OAAAD,EAEP,GAAA,CACO,OAAA,KAAK,MAAMC,CAAG,CAAA,MACjB,CACG,OAAAD,CACX,CACJ,EACA,CAAC,EACAE,GAAU,KAAK,UAAUA,CAAK,CAAA,CAEvC,CAEA,OAAO,IAAIH,EAAaC,EAAuB,OAAkC,CACzE,GAAA,CACI,IAAAG,EAAQ,aAAa,QAAQJ,CAAG,EAChCI,IAAU,cACFA,EAAA,QAEZ,MAAMC,EAAS,IAAIC,EAAsBF,GAASH,EAAc,gBAAkBD,CAAG,EAE9E,OAAAK,EAAA,YAAaE,GAAS,CACzB,GAAGA,IAAS,QAAaA,IAAS,IAAMA,IAAS,KAAK,CAClD,aAAa,WAAWP,CAAG,EAC3B,MACJ,CACI,GAAA,CACa,aAAA,QAAQA,EAAKO,CAAI,OACtB,CAGR,aAAa,MAAM,CACvB,CAAA,CACH,EACMF,OACC,CACD,OAAA,IAAIC,EAAsBL,CAAY,CACjD,CACJ,CACJ"}