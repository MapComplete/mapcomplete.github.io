var nt=Object.defineProperty;var st=(B,m,s)=>m in B?nt(B,m,{enumerable:!0,configurable:!0,writable:!0,value:s}):B[m]=s;var P=(B,m,s)=>(st(B,typeof m!="symbol"?m+"":m,s),s);import{C as x,T as Y,V as W,X as $e,F as Re,U as j,S as le,J as Se,B as ot,L as ke,W as at,A as Ze,H as it}from"./SvelteUIElement-b654e932.js";import"./ToSvelte-b4464489.js";/* empty css                        *//* empty css                     *//* empty css                  */import{a as X,L as qe,T as Ne,D as lt}from"./List-9a722f4d.js";import{L as ut}from"./LanguagePicker-c41cdcdb.js";import{a as ct,I as dt,d as ft,A as Xe,V as xe,M as Ie,B as Ye,L as pt,F as ht,c as Qe,U as mt}from"./ChartJs-a7a8a0dd.js";import{G as gt,a as Ge,I as wt,H as et,j as we,b as ge,d as Ee,C as yt,J as vt,K as tt,N as bt,P as St,S as Ct,Q as _t,R as kt,M as xt}from"./theme_overview-c56eef4e.js";import{F as Et}from"./FlowStep-c79bf23c.js";import{S as ye,a as Oe}from"./SubtleButton-cde343fc.js";import{c as It}from"./_commonjsHelpers-edff4021.js";import{T as ze,L as Tt}from"./LeftIndex-6460cf7f.js";import{G as Ve,B as Pe,C as Ae}from"./BBox-32b2890b.js";import{F as be,b as Rt,M as Ft}from"./MoreScreen-8bba7082.js";import{k as Lt,C as Mt}from"./known_layers-135183e9.js";import{A as Be}from"./AllKnownLayouts-80bd8e93.js";import"./language_native-373a312a.js";import"./language_translations-f839c02d.js";import"./defineProperty-bf1f4e26.js";import"./BackToIndex-6a6f7103.js";var He={},Ot={get exports(){return He},set exports(B){He=B}};/* @license
Papa Parse
v5.3.2
https://github.com/mholt/PapaParse
License: MIT
*/(function(B,m){(function(s,o){B.exports=o()})(It,function s(){var o=typeof self<"u"?self:typeof window<"u"?window:o!==void 0?o:{},i=!o.document&&!!o.postMessage,g=i&&/blob:/i.test((o.location||{}).protocol),c={},u=0,r={parse:function(t,e){var l=(e=e||{}).dynamicTyping||!1;if(L(l)&&(e.dynamicTypingFunction=l,l={}),e.dynamicTyping=l,e.transform=!!L(e.transform)&&e.transform,e.worker&&r.WORKERS_SUPPORTED){var f=function(){if(!r.WORKERS_SUPPORTED)return!1;var p=(D=o.URL||o.webkitURL||null,N=s.toString(),r.BLOB_URL||(r.BLOB_URL=D.createObjectURL(new Blob(["(",N,")();"],{type:"text/javascript"})))),C=new o.Worker(p),D,N;return C.onmessage=$,C.id=u++,c[C.id]=C}();return f.userStep=e.step,f.userChunk=e.chunk,f.userComplete=e.complete,f.userError=e.error,e.step=L(e.step),e.chunk=L(e.chunk),e.complete=L(e.complete),e.error=L(e.error),delete e.worker,void f.postMessage({input:t,config:e,workerId:f.id})}var n=null;return r.NODE_STREAM_INPUT,typeof t=="string"?n=e.download?new y(e):new S(e):t.readable===!0&&L(t.read)&&L(t.on)?n=new F(e):(o.File&&t instanceof File||t instanceof Object)&&(n=new b(e)),n.stream(t)},unparse:function(t,e){var l=!1,f=!0,n=",",p=`\r
`,C='"',D=C+C,N=!1,w=null,J=!1;(function(){if(typeof e=="object"){if(typeof e.delimiter!="string"||r.BAD_DELIMITERS.filter(function(h){return e.delimiter.indexOf(h)!==-1}).length||(n=e.delimiter),(typeof e.quotes=="boolean"||typeof e.quotes=="function"||Array.isArray(e.quotes))&&(l=e.quotes),typeof e.skipEmptyLines!="boolean"&&typeof e.skipEmptyLines!="string"||(N=e.skipEmptyLines),typeof e.newline=="string"&&(p=e.newline),typeof e.quoteChar=="string"&&(C=e.quoteChar),typeof e.header=="boolean"&&(f=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");w=e.columns}e.escapeChar!==void 0&&(D=e.escapeChar+C),(typeof e.escapeFormulae=="boolean"||e.escapeFormulae instanceof RegExp)&&(J=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var _=new RegExp(O(C),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return ce(null,t,N);if(typeof t[0]=="object")return ce(w||Object.keys(t[0]),t,N)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||w),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),ce(t.fields||[],t.data||[],N);throw new Error("Unable to serialize unrecognized input");function ce(h,G,re){var U="";typeof h=="string"&&(h=JSON.parse(h)),typeof G=="string"&&(G=JSON.parse(G));var ee=Array.isArray(h)&&0<h.length,Q=!Array.isArray(G[0]);if(ee&&f){for(var Z=0;Z<h.length;Z++)0<Z&&(U+=n),U+=te(h[Z],Z);0<G.length&&(U+=p)}for(var v=0;v<G.length;v++){var V=ee?h.length:G[v].length,z=!1,K=ee?Object.keys(G[v]).length===0:G[v].length===0;if(re&&!ee&&(z=re==="greedy"?G[v].join("").trim()==="":G[v].length===1&&G[v][0].length===0),re==="greedy"&&ee){for(var R=[],M=0;M<V;M++){var q=Q?h[M]:M;R.push(G[v][q])}z=R.join("").trim()===""}if(!z){for(var k=0;k<V;k++){0<k&&!K&&(U+=n);var pe=ee&&Q?h[k]:k;U+=te(G[v][pe],k)}v<G.length-1&&(!re||0<V&&!K)&&(U+=p)}}return U}function te(h,G){if(h==null)return"";if(h.constructor===Date)return JSON.stringify(h).slice(1,25);var re=!1;J&&typeof h=="string"&&J.test(h)&&(h="'"+h,re=!0);var U=h.toString().replace(_,D);return(re=re||l===!0||typeof l=="function"&&l(h,G)||Array.isArray(l)&&l[G]||function(ee,Q){for(var Z=0;Z<Q.length;Z++)if(-1<ee.indexOf(Q[Z]))return!0;return!1}(U,r.BAD_DELIMITERS)||-1<U.indexOf(n)||U.charAt(0)===" "||U.charAt(U.length-1)===" ")?C+U+C:U}}};if(r.RECORD_SEP=String.fromCharCode(30),r.UNIT_SEP=String.fromCharCode(31),r.BYTE_ORDER_MARK="\uFEFF",r.BAD_DELIMITERS=["\r",`
`,'"',r.BYTE_ORDER_MARK],r.WORKERS_SUPPORTED=!i&&!!o.Worker,r.NODE_STREAM_INPUT=1,r.LocalChunkSize=10485760,r.RemoteChunkSize=5242880,r.DefaultDelimiter=",",r.Parser=I,r.ParserHandle=E,r.NetworkStreamer=y,r.FileStreamer=b,r.StringStreamer=S,r.ReadableStreamStreamer=F,o.jQuery){var a=o.jQuery;a.fn.parse=function(t){var e=t.config||{},l=[];return this.each(function(p){if(!(a(this).prop("tagName").toUpperCase()==="INPUT"&&a(this).attr("type").toLowerCase()==="file"&&o.FileReader)||!this.files||this.files.length===0)return!0;for(var C=0;C<this.files.length;C++)l.push({file:this.files[C],inputElem:this,instanceConfig:a.extend({},e)})}),f(),this;function f(){if(l.length!==0){var p,C,D,N,w=l[0];if(L(t.before)){var J=t.before(w.file,w.inputElem);if(typeof J=="object"){if(J.action==="abort")return p="AbortError",C=w.file,D=w.inputElem,N=J.reason,void(L(t.error)&&t.error({name:p},C,D,N));if(J.action==="skip")return void n();typeof J.config=="object"&&(w.instanceConfig=a.extend(w.instanceConfig,J.config))}else if(J==="skip")return void n()}var _=w.instanceConfig.complete;w.instanceConfig.complete=function(ce){L(_)&&_(ce,w.file,w.inputElem),n()},r.parse(w.file,w.instanceConfig)}else L(t.complete)&&t.complete()}function n(){l.splice(0,1),f()}}}function d(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var l=H(e);l.chunkSize=parseInt(l.chunkSize),e.step||e.chunk||(l.chunkSize=null),this._handle=new E(l),(this._handle.streamer=this)._config=l}.call(this,t),this.parseChunk=function(e,l){if(this.isFirstChunk&&L(this._config.beforeFirstChunk)){var f=this._config.beforeFirstChunk(e);f!==void 0&&(e=f)}this.isFirstChunk=!1,this._halted=!1;var n=this._partialLine+e;this._partialLine="";var p=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var C=p.meta.cursor;this._finished||(this._partialLine=n.substring(C-this._baseIndex),this._baseIndex=C),p&&p.data&&(this._rowCount+=p.data.length);var D=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(g)o.postMessage({results:p,workerId:r.WORKER_ID,finished:D});else if(L(this._config.chunk)&&!l){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);p=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!D||!L(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),D||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(e){L(this._config.error)?this._config.error(e):g&&this._config.error&&o.postMessage({workerId:r.WORKER_ID,error:e,finished:!1})}}function y(t){var e;(t=t||{}).chunkSize||(t.chunkSize=r.RemoteChunkSize),d.call(this,t),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(l){this._input=l,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),i||(e.onload=oe(this._chunkLoaded,this),e.onerror=oe(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var l=this._config.downloadRequestHeaders;for(var f in l)e.setRequestHeader(f,l[f])}if(this._config.chunkSize){var n=this._start+this._config.chunkSize-1;e.setRequestHeader("Range","bytes="+this._start+"-"+n)}try{e.send(this._config.downloadRequestBody)}catch(p){this._chunkError(p.message)}i&&e.status===0&&this._chunkError()}},this._chunkLoaded=function(){e.readyState===4&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(l){var f=l.getResponseHeader("Content-Range");return f===null?-1:parseInt(f.substring(f.lastIndexOf("/")+1))}(e),this.parseChunk(e.responseText)))},this._chunkError=function(l){var f=e.statusText||l;this._sendError(new Error(f))}}function b(t){var e,l;(t=t||{}).chunkSize||(t.chunkSize=r.LocalChunkSize),d.call(this,t);var f=typeof FileReader<"u";this.stream=function(n){this._input=n,l=n.slice||n.webkitSlice||n.mozSlice,f?((e=new FileReader).onload=oe(this._chunkLoaded,this),e.onerror=oe(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var n=this._input;if(this._config.chunkSize){var p=Math.min(this._start+this._config.chunkSize,this._input.size);n=l.call(n,this._start,p)}var C=e.readAsText(n,this._config.encoding);f||this._chunkLoaded({target:{result:C}})},this._chunkLoaded=function(n){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(n.target.result)},this._chunkError=function(){this._sendError(e.error)}}function S(t){var e;d.call(this,t=t||{}),this.stream=function(l){return e=l,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var l,f=this._config.chunkSize;return f?(l=e.substring(0,f),e=e.substring(f)):(l=e,e=""),this._finished=!e,this.parseChunk(l)}}}function F(t){d.call(this,t=t||{});var e=[],l=!0,f=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(n){this._input=n,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){f&&e.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):l=!0},this._streamData=oe(function(n){try{e.push(typeof n=="string"?n:n.toString(this._config.encoding)),l&&(l=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(p){this._streamError(p)}},this),this._streamError=oe(function(n){this._streamCleanUp(),this._sendError(n)},this),this._streamEnd=oe(function(){this._streamCleanUp(),f=!0,this._streamData("")},this),this._streamCleanUp=oe(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function E(t){var e,l,f,n=Math.pow(2,53),p=-n,C=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,D=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,N=this,w=0,J=0,_=!1,ce=!1,te=[],h={data:[],errors:[],meta:{}};if(L(t.step)){var G=t.step;t.step=function(v){if(h=v,ee())U();else{if(U(),h.data.length===0)return;w+=v.data.length,t.preview&&w>t.preview?l.abort():(h.data=h.data[0],G(h,N))}}}function re(v){return t.skipEmptyLines==="greedy"?v.join("").trim()==="":v.length===1&&v[0].length===0}function U(){return h&&f&&(Z("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+r.DefaultDelimiter+"'"),f=!1),t.skipEmptyLines&&(h.data=h.data.filter(function(v){return!re(v)})),ee()&&function(){if(!h)return;function v(z,K){L(t.transformHeader)&&(z=t.transformHeader(z,K)),te.push(z)}if(Array.isArray(h.data[0])){for(var V=0;ee()&&V<h.data.length;V++)h.data[V].forEach(v);h.data.splice(0,1)}else h.data.forEach(v)}(),function(){if(!h||!t.header&&!t.dynamicTyping&&!t.transform)return h;function v(z,K){var R,M=t.header?{}:[];for(R=0;R<z.length;R++){var q=R,k=z[R];t.header&&(q=R>=te.length?"__parsed_extra":te[R]),t.transform&&(k=t.transform(k,q)),k=Q(q,k),q==="__parsed_extra"?(M[q]=M[q]||[],M[q].push(k)):M[q]=k}return t.header&&(R>te.length?Z("FieldMismatch","TooManyFields","Too many fields: expected "+te.length+" fields but parsed "+R,J+K):R<te.length&&Z("FieldMismatch","TooFewFields","Too few fields: expected "+te.length+" fields but parsed "+R,J+K)),M}var V=1;return!h.data.length||Array.isArray(h.data[0])?(h.data=h.data.map(v),V=h.data.length):h.data=v(h.data,0),t.header&&h.meta&&(h.meta.fields=te),J+=V,h}()}function ee(){return t.header&&te.length===0}function Q(v,V){return z=v,t.dynamicTypingFunction&&t.dynamicTyping[z]===void 0&&(t.dynamicTyping[z]=t.dynamicTypingFunction(z)),(t.dynamicTyping[z]||t.dynamicTyping)===!0?V==="true"||V==="TRUE"||V!=="false"&&V!=="FALSE"&&(function(K){if(C.test(K)){var R=parseFloat(K);if(p<R&&R<n)return!0}return!1}(V)?parseFloat(V):D.test(V)?new Date(V):V===""?null:V):V;var z}function Z(v,V,z,K){var R={type:v,code:V,message:z};K!==void 0&&(R.row=K),h.errors.push(R)}this.parse=function(v,V,z){var K=t.quoteChar||'"';if(t.newline||(t.newline=function(q,k){q=q.substring(0,1048576);var pe=new RegExp(O(k)+"([^]*?)"+O(k),"gm"),ue=(q=q.replace(pe,"")).split("\r"),ae=q.split(`
`),he=1<ae.length&&ae[0].length<ue[0].length;if(ue.length===1||he)return`
`;for(var de=0,ie=0;ie<ue.length;ie++)ue[ie][0]===`
`&&de++;return de>=ue.length/2?`\r
`:"\r"}(v,K)),f=!1,t.delimiter)L(t.delimiter)&&(t.delimiter=t.delimiter(v),h.meta.delimiter=t.delimiter);else{var R=function(q,k,pe,ue,ae){var he,de,ie,ne;ae=ae||[",","	","|",";",r.RECORD_SEP,r.UNIT_SEP];for(var me=0;me<ae.length;me++){var se=ae[me],ve=0,fe=0,je=0;ie=void 0;for(var Ce=new I({comments:ue,delimiter:se,newline:k,preview:10}).parse(q),Fe=0;Fe<Ce.data.length;Fe++)if(pe&&re(Ce.data[Fe]))je++;else{var _e=Ce.data[Fe].length;fe+=_e,ie!==void 0?0<_e&&(ve+=Math.abs(_e-ie),ie=_e):ie=_e}0<Ce.data.length&&(fe/=Ce.data.length-je),(de===void 0||ve<=de)&&(ne===void 0||ne<fe)&&1.99<fe&&(de=ve,he=se,ne=fe)}return{successful:!!(t.delimiter=he),bestDelimiter:he}}(v,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);R.successful?t.delimiter=R.bestDelimiter:(f=!0,t.delimiter=r.DefaultDelimiter),h.meta.delimiter=t.delimiter}var M=H(t);return t.preview&&t.header&&M.preview++,e=v,l=new I(M),h=l.parse(e,V,z),U(),_?{meta:{paused:!0}}:h||{meta:{paused:!1}}},this.paused=function(){return _},this.pause=function(){_=!0,l.abort(),e=L(t.chunk)?"":e.substring(l.getCharIndex())},this.resume=function(){N.streamer._halted?(_=!1,N.streamer.parseChunk(e,!0)):setTimeout(N.resume,3)},this.aborted=function(){return ce},this.abort=function(){ce=!0,l.abort(),h.meta.aborted=!0,L(t.complete)&&t.complete(h),e=""}}function O(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function I(t){var e,l=(t=t||{}).delimiter,f=t.newline,n=t.comments,p=t.step,C=t.preview,D=t.fastMode,N=e=t.quoteChar===void 0||t.quoteChar===null?'"':t.quoteChar;if(t.escapeChar!==void 0&&(N=t.escapeChar),(typeof l!="string"||-1<r.BAD_DELIMITERS.indexOf(l))&&(l=","),n===l)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||-1<r.BAD_DELIMITERS.indexOf(n))&&(n=!1),f!==`
`&&f!=="\r"&&f!==`\r
`&&(f=`
`);var w=0,J=!1;this.parse=function(_,ce,te){if(typeof _!="string")throw new Error("Input must be a string");var h=_.length,G=l.length,re=f.length,U=n.length,ee=L(p),Q=[],Z=[],v=[],V=w=0;if(!_)return ne();if(D||D!==!1&&_.indexOf(e)===-1){for(var z=_.split(f),K=0;K<z.length;K++){if(v=z[K],w+=v.length,K!==z.length-1)w+=f.length;else if(te)return ne();if(!n||v.substring(0,U)!==n){if(ee){if(Q=[],ae(v.split(l)),me(),J)return ne()}else ae(v.split(l));if(C&&C<=K)return Q=Q.slice(0,C),ne(!0)}}return ne()}for(var R=_.indexOf(l,w),M=_.indexOf(f,w),q=new RegExp(O(N)+O(e),"g"),k=_.indexOf(e,w);;)if(_[w]!==e)if(n&&v.length===0&&_.substring(w,w+U)===n){if(M===-1)return ne();w=M+re,M=_.indexOf(f,w),R=_.indexOf(l,w)}else if(R!==-1&&(R<M||M===-1))v.push(_.substring(w,R)),w=R+G,R=_.indexOf(l,w);else{if(M===-1)break;if(v.push(_.substring(w,M)),ie(M+re),ee&&(me(),J))return ne();if(C&&Q.length>=C)return ne(!0)}else for(k=w,w++;;){if((k=_.indexOf(e,k+1))===-1)return te||Z.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Q.length,index:w}),de();if(k===h-1)return de(_.substring(w,k).replace(q,e));if(e!==N||_[k+1]!==N){if(e===N||k===0||_[k-1]!==N){R!==-1&&R<k+1&&(R=_.indexOf(l,k+1)),M!==-1&&M<k+1&&(M=_.indexOf(f,k+1));var pe=he(M===-1?R:Math.min(R,M));if(_.substr(k+1+pe,G)===l){v.push(_.substring(w,k).replace(q,e)),_[w=k+1+pe+G]!==e&&(k=_.indexOf(e,w)),R=_.indexOf(l,w),M=_.indexOf(f,w);break}var ue=he(M);if(_.substring(k+1+ue,k+1+ue+re)===f){if(v.push(_.substring(w,k).replace(q,e)),ie(k+1+ue+re),R=_.indexOf(l,w),k=_.indexOf(e,w),ee&&(me(),J))return ne();if(C&&Q.length>=C)return ne(!0);break}Z.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Q.length,index:w}),k++}}else k++}return de();function ae(se){Q.push(se),V=w}function he(se){var ve=0;if(se!==-1){var fe=_.substring(k+1,se);fe&&fe.trim()===""&&(ve=fe.length)}return ve}function de(se){return te||(se===void 0&&(se=_.substring(w)),v.push(se),w=h,ae(v),ee&&me()),ne()}function ie(se){w=se,ae(v),v=[],M=_.indexOf(f,w)}function ne(se){return{data:Q,errors:Z,meta:{delimiter:l,linebreak:f,aborted:J,truncated:!!se,cursor:V+(ce||0)}}}function me(){p(ne()),Q=[],Z=[]}},this.abort=function(){J=!0},this.getCharIndex=function(){return w}}function $(t){var e=t.data,l=c[e.workerId],f=!1;if(e.error)l.userError(e.error,e.file);else if(e.results&&e.results.data){var n={abort:function(){f=!0,T(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:A,resume:A};if(L(l.userStep)){for(var p=0;p<e.results.data.length&&(l.userStep({data:e.results.data[p],errors:e.results.errors,meta:e.results.meta},n),!f);p++);delete e.results}else L(l.userChunk)&&(l.userChunk(e.results,n,e.file),delete e.results)}e.finished&&!f&&T(e.workerId,e.results)}function T(t,e){var l=c[t];L(l.userComplete)&&l.userComplete(e),l.terminate(),delete c[t]}function A(){throw new Error("Not implemented.")}function H(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var l in t)e[l]=H(t[l]);return e}function oe(t,e){return function(){t.apply(e,arguments)}}function L(t){return typeof t=="function"}return g&&(o.onmessage=function(t){var e=t.data;if(r.WORKER_ID===void 0&&e&&(r.WORKER_ID=e.workerId),typeof e.input=="string")o.postMessage({workerId:r.WORKER_ID,results:r.parse(e.input,e.config),finished:!0});else if(o.File&&e.input instanceof File||e.input instanceof Object){var l=r.parse(e.input,e.config);l&&o.postMessage({workerId:r.WORKER_ID,results:l,finished:!0})}}),(y.prototype=Object.create(d.prototype)).constructor=y,(b.prototype=Object.create(d.prototype)).constructor=b,(S.prototype=Object.create(S.prototype)).constructor=S,(F.prototype=Object.create(d.prototype)).constructor=F,r})})(Ot);class Vt extends dt{constructor(m){super(new gt(m,{allowMultiple:!1,acceptType:"*"}),(s,o)=>o===void 0||s===o,s=>{if(s===void 0)return;const o=s.item(0);return{name:o.name,contents:o.text()}},s=>{})}}class At extends x{constructor(){const s=Y.t.importHelper.selectFile,o=new Vt(new ye(void 0,s.description)),i=new W(o.GetValue().map(r=>r===void 0?s.noFilesLoaded.SetClass("alert"):s.loadedFilesAre.Subs({file:r.name}).SetClass("thanks"))),c=$e.flatten(o.GetValue().map(r=>{if(r!==void 0)return $e.FromPromise(r.contents)})).map(r=>{if(r!==void 0)try{const d=JSON.parse(r);return d.type!=="FeatureCollection"?{error:s.errNotFeatureCollection}:d.features.some(y=>y.geometry.type!="Point")?{error:s.errPointsOnly}:(d.features.forEach(y=>{const b=y.properties;for(const S in b)if((b[S]===void 0||b[S]===null||b[S]==="")&&delete b[S],!ct.isValidKey(S))return{error:"Probably an invalid key: "+S}}),d)}catch{var a=He.parse(r).data;const y=a[0];if(a.splice(0,1),y.indexOf("lat")<0||y.indexOf("lon")<0)return{error:s.errNoLatOrLon};if(y.some(S=>S.trim()==""))return{error:s.errNoName};if(new Set(y).size!==y.length)return{error:s.errDuplicate};const b=[];for(let S=0;S<a.length;S++){const F=a[S];if(F.length==0||F.length==1&&F[0]=="")continue;const E={};for(let $=0;$<y.length;$++){const T=F[$];T===void 0||T===""||(E[y[$]]=T)}const O=[Number(E.lon),Number(E.lat)];if(delete E.lat,delete E.lon,O.some(isNaN))return{error:"A coordinate could not be parsed for line "+(S+2)};const I={type:"Feature",properties:E,geometry:{type:"Point",coordinates:O}};b.push(I)}return{type:"FeatureCollection",features:b}}}),u=new W(c.map(r=>{if(r===void 0||(r==null?void 0:r.error)===void 0)return;let a;return typeof r.error=="string"?a=new Re(r.error):r.error.Clone!==void 0?a=r.error.Clone():a=r.error,a.SetClass("alert")}));super([new X(s.title,1),s.fileFormatDescription,s.fileFormatDescriptionCsv,s.fileFormatDescriptionGeoJson,o,i,u]);P(this,"IsValid");P(this,"Value");this.SetClass("flex flex-col wi"),this.IsValid=c.map(r=>r!==void 0&&r.error===void 0),this.Value=c}}const De=class extends W{constructor(m,s,o,i){const g=new j((i==null?void 0:i.sortMode)??"name"),c=new W(g.map(y=>{switch(y){case"name":return le.up_svg();case"name-rev":return le.up_svg().SetStyle("transform: rotate(180deg)");default:return le.circle_svg()}})),u=new x([c.SetClass("w-4 mr-2"),s]).SetClass("flex").onClick(()=>{g.data==="name"?g.setData("name-rev"):g.setData("name")}),r=new W(g.map(y=>{switch(y){case"count":return le.up_svg();case"count-rev":return le.up_svg().SetStyle("transform: rotate(180deg)");default:return le.circle_svg()}})),a=new x([r.SetClass("w-4 mr-2"),o]).SetClass("flex").onClick(()=>{g.data==="count-rev"?g.setData("count"):g.setData("count-rev")}),d=[u,a];super(m.map(y=>{if(y===void 0)return;y=Se.NoNull(y);const b=new Map;for(const I of y){const $=b.get(I)??0;b.set(I,$+1)}const S=Array.from(b.keys());switch(g.data){case"name":S.sort();break;case"name-rev":S.sort().reverse();break;case"count":S.sort((I,$)=>b.get(I)-b.get($));break;case"count-rev":S.sort((I,$)=>b.get($)-b.get(I));break}const F=Math.max(...Array.from(b.values())),E=I=>{const $=S.indexOf(I);return De.defaultPalette[$%De.defaultPalette.length]};let O;return(i==null?void 0:i.assignColor)===void 0?O=E:O=I=>i.assignColor(I)??E(I),new ft(d,S.map(I=>[I,new x([new x([new Re(""+b.get(I)).SetClass("font-bold rounded-full block")]).SetClass("flex justify-center rounded border border-black").SetStyle(`background: ${O(I)}; width: ${100*b.get(I)/F}%`)]).SetClass("block w-full")]),{contentStyle:S.map(I=>["width: 20%"])}).SetClass("w-full zebra-table")},[g]))}};let Le=De;P(Le,"defaultPalette",["#ff5858","#ffad48","#ffff59","#56bd56","#63a9ff","#9d62d9","#fa61fa"]);class Dt extends x{constructor(s,o){const i=Y.t.importHelper.previewAttributes,g=new Set;for(const a of o.features)Object.keys(a.properties).forEach(d=>g.add(d));const c=[],u=o.features.length;for(const a of Array.from(g)){const d=Se.NoNull(o.features.map(F=>F.properties[a])),y=!d.some(F=>F!==d[0]);let b;if(d.length===u?b=i.allAttributesSame:b=i.someHaveSame.Subs({count:d.length,percentage:Math.floor(100*d.length/u)}),y){c.push(new X(a+"="+d[0])),c.push(b);continue}const S=new Set(d).size;if(S!==d.length&&S<15){c.push();let F=new x([b,new Le(new j(d),"Value","Occurence",{sortMode:"count-rev"})]).SetClass("flex flex-col");const E=new X(a+"=*");S>15?F=new ze(E,F.SetClass("block")).Collapse():c.push(E),c.push(F);continue}c.push(new ze(new X(a+"=*"),new x([b,new qe(d)])))}const r=new Ge([i.inspectLooksCorrect]);super([new X(i.inspectDataTitle.Subs({count:o.features.length})),"Extra remark: An attribute with 'source' or 'src' will be added as 'source' into the map pin; an attribute 'note' will be added into the map pin as well. These values won't be imported",...c,r]);P(this,"IsValid");P(this,"Value");this.Value=new j(o),this.IsValid=r.GetValue().map(a=>a.length==1)}}const Nt="import_candidate",Gt="Layer used in the importHelper",zt={osmTags:{and:[]}},Pt=[{location:["point","centroid"],icon:"square:red;",iconSize:"15,15,center"}],Bt="Import candidate",Ht=[{id:"all_tags",render:"{all_tags()}"}],Ue={id:Nt,description:Gt,source:zt,mapRendering:Pt,title:Bt,tagRenderings:Ht};class rt{static partitionFeaturesIfNearby(m,s,o){return s.map(i=>{if((i==null?void 0:i.features)===void 0)return;if(i.features.length===0)return{noNearby:m.features,hasNearby:[]};const g=o.data,c=[],u=[];for(const r of m.features)i.features.some(d=>g>=Ve.distanceBetween(r.geometry.coordinates,Ve.centerpointCoordinates(d)))?c.push(r):u.push(r);return{hasNearby:c,noNearby:u}},[o])}}const Ut="current_view",qt=`A meta-layer which contains one single feature, namely the BBOX of the current map view. This can be used to trigger special actions. If a popup is defined for this layer, this popup will be accessible via an extra button on screen.

The icon on the button is the default icon of the layer, but can be customized by detecting 'button=yes'.`,Wt={osmTags:"current_view=yes",maxCacheAge:0},Jt=!1,Kt="Current View",jt=[],$t=[{color:"#cccc0088"}],Qt={id:Ut,description:qt,source:Wt,shownByDefault:Jt,title:Kt,tagRenderings:jt,mapRendering:$t};class We extends ot{constructor(s){super();P(this,"_id");this._id=s}InnerConstructElement(){const s=document.createElement("div");return s.id=this._id,s}}class Zt extends x{constructor(s,o){const i=Y.t.importHelper.conflationChecker,g=o.bbox.padAbsolute(1e-4),c=o.layer,u=o;let r=new j("idle");function a(){const n=Ae.defaultOverpassUrls[1],p=new tt,C=new vt(o.layer.source.osmTags,[],n,new j(180),p,!0);console.log("Loading from overpass!"),r.setData("running"),C.queryGeoJson(g).then(([D,N])=>{console.log("Received overpass-data: ",D.features.length,"features are loaded at ",N),r.setData("success"),d.setData([D,N])},D=>{r.setData({error:D})})}const d=wt.Get("importer-overpass-cache-"+c.id,{whenLoaded:n=>{n!=null?(console.log("Loaded from local storage:",n),r.setData("cached")):a()}}),y=d.map(n=>{if(n===void 0||n[1]===void 0)return;const[p,C]=n;return(new Date().getTime()-C.getTime())/1e3});y.addCallbackD(n=>{if(n<24*60*60){r.setData("cached");return}else a()});const b=d.map(n=>{if(n!==void 0)return n[0]}),S=new j(Xe.osmCarto),F=new j({lat:0,lon:0,zoom:1}),E=new j(void 0),O=xe.ForType("pnat").ConstructInputElement({value:ke.GetParsed("importer-zoom-level","0")});O.SetClass("ml-1 border border-black");const I=Ie.createMiniMap({allowMoving:!0,location:F,background:S,bounds:E,attribution:new et(F,s.osmConnection.userDetails,void 0,E)});I.SetClass("w-full").SetStyle("height: 500px");const $=b.map(n=>{if((n==null?void 0:n.features)===void 0)return[];const p=O.GetValue().data,C=I.location.data.zoom>=Number(p);if(p!==void 0&&!C)return[];const D=I.bounds.data;return D===void 0?n.features:n.features.filter(N=>Pe.get(N).overlapsWith(D))},[I.bounds,O.GetValue()]),T=we.fromGeojsonStore($);new ge({layerToShow:new Ee(Qt),state:s,leafletMap:I.leafletMap,popup:void 0,zoomToFeatures:!0,features:we.fromGeojson([g.asGeoJson({})])}),new ge({layerToShow:c,state:s,leafletMap:I.leafletMap,popup:(n,p)=>new be(n,p,s,{setHash:!1}),zoomToFeatures:!1,features:T}),new ge({layerToShow:new Ee(Ue),state:s,leafletMap:I.leafletMap,popup:(n,p)=>new be(n,p,s,{setHash:!1}),zoomToFeatures:!1,features:we.fromGeojson(u.features)});const A=xe.ForType("pnat").ConstructInputElement();A.SetClass("ml-1 border border-black"),A.GetValue().syncWith(ke.Get("importer-cutoff","25"),!0);const H=Ie.createMiniMap({allowMoving:!0,background:S});H.SetClass("w-full").SetStyle("height: 500px");const oe=b.map(n=>{if((n==null?void 0:n.features)===void 0)return[];const p=Number(A.GetValue().data);return n.features.filter(C=>u.features.some(D=>p>=Ve.distanceBetween(D.geometry.coordinates,Ve.centerpointCoordinates(C))))},[A.GetValue().stabilized(500)]),L=we.fromGeojsonStore(oe),t=rt.partitionFeaturesIfNearby(u,b,A.GetValue().map(Number)),e=we.fromGeojsonStore(t.map(n=>(n==null?void 0:n.hasNearby)??[]));e.features.addCallback(n=>console.log("The following features are near an already existing object:",n)),new ge({layerToShow:new Ee(Ue),state:s,leafletMap:H.leafletMap,popup:(n,p)=>new be(n,p,s,{setHash:!1}),zoomToFeatures:!1,features:e});const l=new yt(i.showOsmLayerInConflationMap,!0);new ge({layerToShow:c,state:s,leafletMap:H.leafletMap,popup:(n,p)=>new be(n,p,s,{setHash:!1}),zoomToFeatures:!0,features:L,doShowLayer:l.GetValue()});const f=new x([new W(b.map(n=>{if(n!==void 0)return new ye(le.download_svg(),i.downloadOverpassData).onClick(()=>{Se.offerContentsAsDownloadableFile(JSON.stringify(n,null,"  "),"mapcomplete-"+c.id+".geojson",{mimetype:"application/json+geo"})})})),new W(y.map(n=>{if(n!==void 0)return n<0?i.cacheExpired:new x([i.loadedDataAge.Subs({age:Se.toHumanTime(n)}),new ye(le.reload_svg().SetClass("h-8"),i.reloadTheCache).onClick(a).SetClass("h-12")])})),new X(i.titleLive),i.importCandidatesCount.Subs({count:u.features.length}),new W(b.map(n=>{var p,C;return((p=n==null?void 0:n.features)==null?void 0:p.length)===void 0||((C=n==null?void 0:n.features)==null?void 0:C.length)===0?i.nothingLoaded.Subs(c).SetClass("alert"):new x([i.osmLoaded.Subs({count:n.features.length,name:c.name})])})),I,new x([i.zoomLevelSelection,O,new W(I.location.map(n=>i.zoomIn.Subs({current:n.zoom})))]).SetClass("flex"),new We("fullscreen"),new X(i.titleNearby),new x([i.mapShowingNearbyIntro,A]).SetClass("flex"),new W(e.features.map(n=>i.nearbyWarn.Subs({count:n.length}).SetClass("alert"))),i.setRangeToZero,H,new x([new Ye({backgroundLayer:S,locationControl:H.location},S),l]).SetClass("flex")]).SetClass("flex flex-col");super([new X(i.title),new W(r.map(n=>n==="idle"?new Oe(i.states.idle):n==="running"?new Oe(i.states.running):n.error!==void 0?i.states.error.Subs({error:n.error}).SetClass("alert"):n==="cached"||n==="success"?f:i.states.unexpected.Subs({state:n}).SetClass("alert")))]);P(this,"IsValid");P(this,"Value");this.Value=t.map(n=>({theme:o.theme,features:n==null?void 0:n.noNearby,layer:o.layer})),this.IsValid=this.Value.map(n=>(n==null?void 0:n.features)!==void 0&&n.features.length>0)}}class Xt extends x{constructor(s){const o=Y.t.importHelper.askMetadata,i=xe.ForType("text").ConstructInputElement({value:ke.Get("import-helper-introduction-text"),inputStyle:"width: 100%"}),g=xe.ForType("url").ConstructInputElement({value:ke.Get("import-helper-wikilink-text"),inputStyle:"width: 100%"}),c=xe.ForType("string").ConstructInputElement({value:ke.Get("import-helper-source-text"),inputStyle:"width: 100%"});super([new X(o.title),o.intro.Subs({count:s.features.length}),o.giveDescription,i.SetClass("w-full border border-black"),o.giveSource,c.SetClass("w-full border border-black"),o.giveWikilink,g.SetClass("w-full border border-black"),new W(g.GetValue().map(u=>{try{const r=new URL(u);if(r.hostname.toLowerCase()!=="wiki.openstreetmap.org")return o.shouldBeOsmWikilink.SetClass("alert");if(r.pathname.toLowerCase()==="/wiki/main_page")return o.shouldNotBeHomepage.SetClass("alert")}catch{return o.shouldBeUrl.SetClass("alert")}})),o.orDownload,new ye(le.download_svg(),o.downloadGeojson).OnClickWithLoading("Preparing your download",async()=>{const u={type:"FeatureCollection",features:s.features};Se.offerContentsAsDownloadableFile(JSON.stringify(u),"prepared_import_"+s.theme+".geojson",{mimetype:"application/vnd.geo+json"})})]);P(this,"Value");P(this,"IsValid");this.SetClass("flex flex-col"),this.Value=i.GetValue().map(u=>({features:s.features,wikilink:g.GetValue().data,intro:u,source:c.GetValue().data,theme:s.theme}),[g.GetValue(),c.GetValue()]),this.IsValid=this.Value.map(u=>{if(u===void 0||[u.features,u.intro,u.wikilink,u.source].some(r=>r===void 0))return!1;try{if(new URL(u.wikilink).hostname.toLowerCase()!=="wiki.openstreetmap.org")return!1}catch{return!1}return!0})}}class Yt extends x{constructor(s){const o=Y.t.importHelper.confirmProcess,i=[new at(o.readImportGuidelines,"https://wiki.openstreetmap.org/wiki/Import_guidelines",!0),o.contactedCommunity,o.licenseIsCompatible,o.wikipageIsMade],g=new Ge(i);super([new X(o.titleLong),g]);P(this,"IsValid");P(this,"Value");this.SetClass("link-underline"),this.IsValid=g.GetValue().map(c=>i.length==c.length),this.Value=new j(s)}}class Te extends x{static createNoteContentsUi(m,s){const o=m.properties.source??m.properties.src??s.source;delete m.properties.source,delete m.properties.src;let i="";m.properties.note&&(i=m.properties.note+`
`,delete m.properties.note);const g=[];for(const a in m.properties){if(m.properties[a]===null||m.properties[a]===void 0){console.warn("Null or undefined key for ",m.properties);continue}m.properties[a]!==""&&g.push(a+"="+(m.properties[a]+"").replace(/=/,"\\=").replace(/;/g,"\\;").replace(/\n/g,"\\n"))}const c=m.geometry.coordinates[1],u=m.geometry.coordinates[0],r=Y.t.importHelper.noteParts;return[s.intro,i,r.datasource.Subs({source:o}),r.wikilink.Subs(s),"",r.importEasily,`https://mapcomplete.osm.be/${s.theme}.html?z=18&lat=${c}&lon=${u}#import`,...g]}static createNoteContents(m,s){return Te.createNoteContentsUi(m,s).map(o=>typeof o=="string"?o:o.txt)}constructor(m,s){const o=Y.t.importHelper.createNotes,i=new j([]),g=new j([]),c=i.map(u=>u.length);for(const u of s.features){const r=u.geometry.coordinates[1],a=u.geometry.coordinates[0],d=Te.createNoteContents(u,s).join(`
`);m.osmConnection.openNote(r,a,d).then(({id:y})=>{i.data.push(y),i.ping()},y=>{g.data.push(y),g.ping()})}super([new X(o.title),o.loading,new Ne(new Oe(new W(c.map(u=>o.creating.Subs({count:u,total:s.features.length})))),new x([le.party_svg().SetClass("w-24"),o.done.Subs({count:s.features.length}).SetClass("thanks"),new ye(le.note_svg(),o.openImportViewer,{url:"import_viewer.html"})]),c.map(u=>u<s.features.length)),new W(g.map(u=>{if(u.length!==0)return new x([new Re("Some entries failed").SetClass("alert"),...u]).SetClass("flex flex-col")}))]),this.SetClass("flex flex-col")}}class er extends x{constructor(s,o){const i=Y.t.importHelper.compareToAlreadyExistingNotes,g=Lt.layers.filter(E=>E.id===o.layer.id)[0];g===void 0&&console.error("WEIRD: layer not found in the builtin layer overview");const c=new Mt(150).convertStrict(g,"CompareToAlreadyExistingNotes"),u=new Ee(c,"import-layer-dynamic"),r={appliedFilters:new j(new Map),isDisplayed:new j(!0),layerDef:u},a=new bt(r,o.bbox.padAbsolute(1e-4));a.features.map(E=>Rt.addMetatags(E,{memberships:new tt,getFeaturesWithin:()=>[],getFeatureById:()=>{}},u,s,{includeDates:!0,includeNonDates:!0}));const d=new St(s,void 0,a),y=Ie.createMiniMap();y.SetClass("w-full").SetStyle("height: 500px");const b=Ie.createMiniMap({location:y.location});b.SetClass("w-full").SetStyle("height: 500px"),new ge({layerToShow:u,state:s,zoomToFeatures:!0,leafletMap:y.leafletMap,features:d,popup:(E,O)=>new be(E,O,s)});const S=new j(10),F=rt.partitionFeaturesIfNearby(o,d.features.map(E=>({features:E.map(O=>O.feature)})),S);new ge({layerToShow:new Ee(Ue),state:s,zoomToFeatures:!0,leafletMap:b.leafletMap,features:we.fromGeojsonStore(F.map(E=>E.hasNearby)),popup:(E,O)=>new be(E,O,s)});super([new X(i.titleLong),new W(d.features.map(E=>{if(a.state.data!==void 0&&a.state.data.error!==void 0){const O=a.state.data.error;i.loadingFailed.Subs({error:O})}return a.features.data===void 0||a.features.data.length===0?new Oe(i.loading):E.length===0?i.noPreviousNotesFound.SetClass("thanks"):new x([i.mapExplanation.Subs(o.features),y,new We("fullscreen"),new W(F.map(({noNearby:O,hasNearby:I})=>O.length===0?i.completelyImported.SetClass("alert w-full block").SetStyle("padding: 0.5rem"):I.length===0?i.nothingNearby.SetClass("thanks w-full block").SetStyle("padding: 0.5rem"):new x([i.someNearby.Subs({hasNearby:I.length,distance:S.data}).SetClass("alert"),i.wontBeImported,b.SetClass("w-full")]).SetClass("w-full")))]).SetClass("flex flex-col")},[a.features,a.state]))]);P(this,"IsValid");P(this,"Value");this.SetClass("flex flex-col"),this.Value=F.map(({noNearby:E})=>({features:E,bbox:o.bbox,layer:o.layer,theme:o.theme})),this.IsValid=d.features.map(E=>a.features.data.length===0?!1:E.length==0?!0:F.data.noNearby.length>0,[F,a.features])}}class tr extends x{constructor(){const s=Te.createNoteContentsUi({properties:{some_key:"some_value",note:"a note in the original dataset"},geometry:{coordinates:[3.4,51.2]}},{wikilink:"https://wiki.openstreetmap.org/wiki/Imports/<documentation of your import>",intro:"There might be an XYZ here",theme:"theme",source:"source of the data"}).map(o=>o===""?new Re("").SetClass("block"):o);super([new X(Y.t.importHelper.introduction.title),Y.t.importHelper.introduction.description,Y.t.importHelper.introduction.importFormat,new x([new x(s).SetClass("flex flex-col")]).SetClass("literal-code")]);P(this,"IsValid");P(this,"Value");this.SetClass("flex flex-col"),this.IsValid=new j(!0),this.Value=new j(void 0)}}const Ke=class extends x{constructor(s){const o=Y.t.importHelper.login,i=new Ge([new W(s.osmConnection.userDetails.map(c=>o.loginIsCorrect.Subs(c)))]),g=s.osmConnection.userDetails.map(c=>Ke.whitelist.indexOf(c.uid)>=0||c.csCount>=Ae.userJourney.importHelperUnlock);super([new X(o.userAccountTitle),new pt(new W(s.osmConnection.userDetails.map(c=>{if(c!==void 0)return new x([new Ze(c.img??"./assets/svgs/help.svg").SetClass("w-16 h-16 rounded-full"),o.loggedInWith.Subs(c),new ye(le.logout_svg().SetClass("h-8"),Y.t.general.logout).onClick(()=>s.osmConnection.LogOut()),i])})),o.loginRequired,s),new Ne(void 0,new x([o.lockNotice.Subs(Ae.userJourney).SetClass("alert"),Ft.CreateProffessionalSerivesButton()]),g)]);P(this,"IsValid");P(this,"Value");this.Value=new j(s),this.IsValid=g.map(c=>c&&i.GetValue().data.length>0,[i.GetValue()])}};let Me=Ke;P(Me,"whitelist",[15015689]);class rr extends Ct{constructor(m){super(s=>new Re("Element to import"),s=>new x(["The tags are:",new it(_t,{tags:m})]).SetClass("flex flex-col"),"element")}}class nr extends x{constructor(s,o){const i=Y.t.importHelper.mapPreview,g=new Set;for(const T of o.features)Object.keys(T.properties).forEach(A=>g.add(A));const c=Be.AllPublicLayers().filter(T=>T.name!==void 0&&Ae.priviliged_layers.indexOf(T.id)<0),u=new lt(i.selectLayer,[{shown:i.selectLayer,value:void 0}].concat(c.map(T=>({shown:T.name,value:T}))));let r=new j(!1);for(const T of c)if(!o.features.some(H=>!T.source.osmTags.matchesProperties(H.properties))){console.log("Autodected layer",T.id),u.GetValue().setData(T),u.GetValue().addCallback(H=>r.setData(!1)),r.setData(!0);break}const a=o.features.map((T,A)=>{const H=Se.Clone(T);return H.properties.id="to-import/"+A,H}),d=u.GetValue().map(T=>{if(T===void 0)return console.log("No matching layer found"),[];const A=[];for(const H of a)T.source.osmTags.matchesProperties(H.properties)&&A.push(H);return console.log("Matching features: ",A),A}),y=new j(Xe.osmCarto),b=new j({lat:0,lon:0,zoom:1}),S=new j(void 0),F=Ie.createMiniMap({allowMoving:!0,location:b,background:y,bounds:S,attribution:new et(b,s.osmConnection.userDetails,void 0,S)}),E=new Ye({backgroundLayer:y,locationControl:b},y);F.SetClass("w-full").SetStyle("height: 500px"),u.GetValue().addCallbackAndRunD(T=>{new ge({layerToShow:T,zoomToFeatures:!0,features:we.fromDateless(d.map(A=>A.map(H=>({feature:H})))),leafletMap:F.leafletMap,popup:A=>new rr(A)})});const O=d.map(T=>Pe.bboxAroundAll(T.map(A=>new Pe([A.geometry.coordinates])))),I=new W(d.map(T=>{var oe,L,t;if(T===void 0)return;const A=o.features.length-T.length;if(A===0)return;const H=(t=(L=(oe=u.GetValue().data)==null?void 0:oe.source)==null?void 0:L.osmTags)==null?void 0:t.asHumanString(!1,!1,{});return i.mismatch.Subs({count:A,tags:H}).SetClass("alert")})),$=new Ge([i.confirm]);super([new X(i.title,1),u,new Ne(i.autodetected.SetClass("thanks"),void 0,r),I,F,new We("fullscreen"),E,$]);P(this,"IsValid");P(this,"Value");this.Value=O.map(T=>({bbox:T,features:d.data,layer:u.GetValue().data}),[u.GetValue(),d]),this.IsValid=d.map(T=>T===void 0||$.GetValue().data.length!==1?!1:o.features.length-T.length===0,[$.GetValue()])}}class Je extends x{constructor(s){const o=Y.t.importHelper.selectTheme;let i=Array.from(Be.allKnownLayouts.values()).filter(r=>r.layers.some(a=>a.id===s.layer.id)).filter(r=>r.id!=="personal").map(r=>new ht(new x([new Ze(r.icon).SetClass("block h-12 w-12 br-4"),new X(r.title)]).SetClass("flex items-center"),r.id));const g=new kt(i,{selectFirstAsDefault:!1}),c=g.GetValue().map(r=>r===void 0?[]:Be.allKnownLayouts.get(r).layers.find(y=>y.id===s.layer.id).presets),u=c.map(r=>{if(!(r===void 0||r.length===0))return s.features.filter(a=>!r.some(d=>new Qe(d.tags).matchesProperties(a.properties)))});super([new X(o.title),o.intro,g,new W(c.map(r=>{if(g.GetValue().data!==void 0&&(r===void 0||r.length===0))return o.noMatchingPresets.SetClass("alert")},[g.GetValue()])),new W(u.map(r=>Je.nonMatchedElementsPanel(r,c.data),[c]))]);P(this,"Value");P(this,"IsValid");this.SetClass("flex flex-col"),this.Value=g.GetValue().map(r=>({features:s.features,layer:s.layer,bbox:s.bbox,theme:r})),this.IsValid=this.Value.map(r=>{var a;return!(r===void 0||[r.theme,r.features].some(d=>d===void 0)||c.data===void 0||c.data.length===0||(((a=u.data)==null?void 0:a.length)??0)>0)},[c])}static nonMatchedElementsPanel(s,o){if(s===void 0||s.length===0)return;const i=Y.t.importHelper.selectTheme,g=o.map(u=>i.needsTags.Subs({title:u.title,tags:u.tags.map(r=>r.asHumanString()).join(" & ")}).SetClass("thanks")),c=[];for(const u of s){const r=[];r.push(new x(Object.keys(u.properties).map(a=>a+"="+u.properties[a])).SetClass("flex flex-col"));for(const a of o){const d=new Qe(a.tags).asChange({}),y=[];for(const{k:b,v:S}of d)a[b]===void 0?y.push(i.missing.Subs({k:b,v:S})):u.properties[b]!==S&&y.push(i.misMatch.Subs({k:b,v:S,properties:u.properties}));y.length>0&&r.push(new x([i.notApplicable.Subs(a),new qe(y)]).SetClass("flex flex-col alert"))}c.push(new x(r).SetClass("flex flex-col"))}return new x([i.displayNonMatchingCount.Subs(s).SetClass("alert"),...g,new ze(new X(i.unmatchedTitle),new x(c))]).SetClass("flex flex-col")}}class sr extends Tt{constructor(){var r;const m=new mt(void 0),s=Y.t.importHelper,{flow:o,furthestStep:i,titles:g}=Et.start(s.introduction,new tr).then(s.login,a=>new Me(m)).then(s.selectFile,a=>new At).then(s.previewAttributes,a=>new Dt(m,a)).then(s.mapPreview,a=>new nr(m,a)).then(s.selectTheme,a=>new Je(a)).then(s.compareToAlreadyExistingNotes,a=>new er(m,a)).then(s.conflationChecker,a=>new Zt(m,a)).then(s.confirmProcess,a=>new Yt(a)).then(s.askMetadata,a=>new Xt(a)).finish(s.createNotes.title,a=>new Te(m,a)),c=new qe(g.map((a,d)=>new W(i.map(y=>{if(d>y)return new x([a]).SetClass("subtle");if(d==y)return new x([a]).SetClass("font-bold");if(d<y)return a}))),!0),u=[new ye(void 0,s.gotoImportViewer,{url:"import_viewer.html"}),c,new Ne(s.testMode.SetClass("block alert"),void 0,m.featureSwitchIsTesting),(r=new ut(Y.t.importHelper.title.SupportedLanguages(),""))==null?void 0:r.SetClass("mt-4 self-end flex-col")].map(a=>a==null?void 0:a.SetClass("pl-4"));super(u,o)}}xt.initialize();new sr().AttachTo("main");
