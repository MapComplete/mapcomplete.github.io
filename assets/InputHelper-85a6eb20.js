var fv=Object.defineProperty;var pv=(n,e,t)=>e in n?fv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ge=(n,e,t)=>(pv(n,typeof e!="symbol"?e+"":e,t),t),mv=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var Jf=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var Vu=(n,e,t)=>(mv(n,e,"access private method"),t);import{a as Tt,U as Ni,S as gp,I as id,b as gv}from"./UIEventSource-6c338801.js";import{L as _v}from"./LocalStorageSource-82d6fe4c.js";import{Q as yv,a as gs,S as Sd,B as kh,C as Hp,c as Al,T as mn,e as bv,L as Cd}from"./Tr-bd480c55.js";import{e as Mr,m as xv,A as Jg,o as D0,B as vv,W as mh,a0 as Qf,G as L0,b as wv,M as kv,S as Sv,s as Cv,a1 as _p}from"./placeholder-fb98b221.js";import{S as Gt,i as Xt,s as Kt,e as et,a as xt,b as ie,f as ue,d as qe,n as St,h as je,aa as Td,V as rr,R as xo,y as jn,k as Ht,l as Re,p as An,q as Je,z as qn,A as Hn,B as Wn,r as bs,t as we,g as Ce,u as es,v as Ui,w as _s,x as _t,C as Di,D as oi,E as ai,c as lt,m as ct,j as ht,o as Le,N as Fa,a6 as Rl,O as Si,Q as zs,M as yp,ab as Tv,I as nd,a7 as Md,ae as R0,H as Pd,_ as F0,J as sd,a3 as Qg,K as Id,Z as Qo,T as B0,U as O0,F as pn,G as vo,$ as Ad,Y as qr,ad as Mv,a0 as Pv,a1 as Iv,a8 as Av,a4 as V0}from"./index-e92167ef.js";import{t as Ev}from"./tw-join-70ce42f3.js";import{t as Fl}from"./tw-merge-6ca0df02.js";import{a as zv,L as Wp}from"./Loading-ccdc5f33.js";import{t as mo,F as Zp,E as Dv}from"./Checkbox-7050471b.js";import{a as N0,O as Il,b as Lv}from"./OHTable-64cb6f3e.js";import{c as Rv,g as Fv}from"./_commonjsHelpers-de833af9.js";import{C as Bv}from"./Constants-40dd409b.js";import{D as Ov}from"./Dropdown-16525eae.js";class Xo{constructor(e,t,i){Ge(this,"isDisplayed");Ge(this,"appliedFilters");Ge(this,"layerDef");Ge(this,"hasFilter");Ge(this,"currentFilter");if(this.layerDef=e,this.isDisplayed=i??new Tt(!0),!t){const h=new Map;for(const u of this.layerDef.filters)h.set(u.id,new Tt(void 0));t=h}this.appliedFilters=t;const o=new Tt(void 0);this.appliedFilters.forEach(h=>{h.addCallbackAndRun(()=>{o.setData(this.calculateCurrentTags())})}),this.hasFilter=o.map(h=>h!==void 0),this.currentFilter=o}static fieldsToString(e){for(const t in e)e[t]===""&&delete e[t];return JSON.stringify(e)}static queryParameterKey(e){return"layer-"+e.id}static initLinkedState(e,t,i,o){let h;if(e.syncSelection==="local")h=_v.GetParsed(t+"-layer-"+e.id+"-enabled",e.shownByDefault);else if(e.syncSelection==="theme-only")h=Xo.getPref(i,t+"-layer-"+e.id+"-enabled",e);else if(e.syncSelection==="global")h=Xo.getPref(i,"layer-"+e.id+"-enabled",e);else{let l=e.shownByDefault;o!==void 0&&o.data===!1&&(l=!1),h=yv.GetBooleanQueryParameter(Xo.queryParameterKey(e),l,"Whether or not layer "+e.id+" is shown")}const u=new Map;for(const l of e.filters)u.set(l.id,l.initState(e.id));return new Xo(e,u,h)}static stringToFieldProperties(e){const t=JSON.parse(e);for(const i in t)t[i]===""&&delete t[i];return t}static fieldsToTags(e,t){let i;if(typeof t=="string"?i=Xo.stringToFieldProperties(t):i=t,e.fields.map(u=>u.name).filter(u=>i[u]===void 0).length>0)return;const h=Ni.WalkJson(e.originalTagsSpec,u=>{if(typeof u!="string")return u;for(const l in i)u.match(/[a-zA-Z0-9_:]+~/)?u=u.replace("{"+l+"}","("+i[l]+")"):u=u.replace("{"+l+"}",i[l]);return u});return Mr.Tag(h)}static getPref(e,t,i){return e.GetPreference(t,i.shownByDefault+"").sync(o=>{if(o!==void 0)return o==="true"},[],o=>{if(o!==void 0)return""+o})}disableAllFilters(){this.appliedFilters.forEach(e=>e.setData(void 0))}isShown(e,t){if(e._deleted==="yes")return!1;for(const i of t??[]){const o=i.osmTags;if(o!==void 0&&!o.matchesProperties(e))return!1}{const i=this.layerDef.isShown;if(i!==void 0&&!i.matchesProperties(e))return!1}{const i=this.currentFilter.data;if(i!==void 0&&!i.matchesProperties(e))return!1}return!0}calculateCurrentTags(){let e=[];for(const o of this.layerDef.filters){const h=this.appliedFilters.get(o.id);if(h.data!==void 0){if(o.options[0].fields.length>0){const u=Xo.stringToFieldProperties(h.data),l=Xo.fieldsToTags(o.options[0],u);l&&e.push(l);continue}e.push(o.options[h.data].osmTags)}}if(e=Ni.NoNull(e),e.length==0)return;let t;e.length==1?t=e[0]:t=new xv(e);const i=t.optimize();if(i!==!0)return i===!1?t:i}}var U0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(n,e){(function(t,i){n.exports=i()})(Rv,function(){var t={},i={};function o(u,l,p){if(i[u]=p,u==="index"){var y="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",k={};return i.shared(k),i.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),t}}o("shared",["exports"],function(u){function l(a,s,c,f){return new(c||(c=Promise))(function(_,v){function w(E){try{I(f.next(E))}catch(L){v(L)}}function T(E){try{I(f.throw(E))}catch(L){v(L)}}function I(E){var L;E.done?_(E.value):(L=E.value,L instanceof c?L:new c(function(F){F(L)})).then(w,T)}I((f=f.apply(a,s||[])).next())})}function p(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}typeof SuppressedError=="function"&&SuppressedError;var y=k;function k(a,s){this.x=a,this.y=s}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,c=a.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),c=Math.sin(a),f=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=f,this},_rotateAround:function(a,s){var c=Math.cos(a),f=Math.sin(a),_=s.y+f*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-f*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(a){return a instanceof k?a:Array.isArray(a)?new k(a[0],a[1]):a};var C=p(y),S=z;function z(a,s,c,f){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=s,this.p2x=c,this.p2y=f}z.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,s){if(s===void 0&&(s=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,f=0;f<8;f++){var _=this.sampleCurveX(c)-a;if(Math.abs(_)<s)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=_/v}var w=0,T=1;for(c=a,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-a)<s));f++)a>_?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))}};var R=p(S);let j,H;function X(){return j==null&&(j=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),j}function re(){if(H==null&&(H=!1,X())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let f=0;f<5*5;f++){const _=4*f;s.fillStyle=`rgb(${_},${_+1},${_+2})`,s.fillRect(f%5,Math.floor(f/5),1,1)}const c=s.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){H=!0;break}}}return H||!1}function W(a,s,c,f){const _=new R(a,s,c,f);return function(v){return _.solve(v)}}const ae=W(.25,.1,.25,1);function de(a,s,c){return Math.min(c,Math.max(s,a))}function Ae(a,s,c){const f=c-s,_=((a-s)%f+f)%f+s;return _===s?c:_}function xe(a,...s){for(const c of s)for(const f in c)a[f]=c[f];return a}let pe=1;function ke(a,s,c){const f={};for(const _ in a)f[_]=s.call(c||this,a[_],_,a);return f}function Ie(a,s,c){const f={};for(const _ in a)s.call(c||this,a[_],_,a)&&(f[_]=a[_]);return f}function Ve(a){return Array.isArray(a)?a.map(Ve):typeof a=="object"&&a?ke(a,Ve):a}const We={};function Oe(a){We[a]||(typeof console<"u"&&console.warn(a),We[a]=!0)}function It(a,s,c){return(c.y-a.y)*(s.x-a.x)>(s.y-a.y)*(c.x-a.x)}function mt(a){let s=0;for(let c,f,_=0,v=a.length,w=v-1;_<v;w=_++)c=a[_],f=a[w],s+=(f.x-c.x)*(c.y+f.y);return s}function Ft(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let Yt=null;function Qt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Tn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ji(a,s,c,f,_){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(a,{timestamp:0});try{const w=v==null?void 0:v.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const T=w.startsWith("BGR"),I=new Uint8ClampedArray(f*_*4);if(yield v.copyTo(I,function(E,L,F,N,q){const $=4*Math.max(-L,0),Y=(Math.max(0,F)-F)*N*4+$,ne=4*N,le=Math.max(0,L),ve=Math.max(0,F);return{rect:{x:le,y:ve,width:Math.min(E.width,L+N)-le,height:Math.min(E.height,F+q)-ve},layout:[{offset:Y,stride:ne}]}}(a,s,c,f,_)),T)for(let E=0;E<I.length;E+=4){const L=I[E];I[E]=I[E+2],I[E+2]=L}return I}finally{v.close()}})}let di,ii;const Ci="AbortError";function Ti(){return new Error(Ci)}const Gi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function qi(a){return Gi.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const Xi="global-dispatcher";class nt extends Error{constructor(s,c,f,_){super(`AJAXError: ${c} (${s}): ${f}`),this.status=s,this.statusText=c,this.url=f,this.body=_}}const sn=()=>Ft(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,_n=function(a,s){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const f=qi(a.url);if(f)return f(a,s);if(Ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:a,targetMapId:Xi},s)}if(!(/^file:/.test(c=a.url)||/^file:/.test(sn())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,_){return l(this,void 0,void 0,function*(){const v=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:sn(),signal:_.signal});f.type==="json"&&v.headers.set("Accept","application/json");const w=yield fetch(v);if(!w.ok){const E=yield w.blob();throw new nt(w.status,w.statusText,f.url,E)}let T;T=f.type==="arrayBuffer"||f.type==="image"?w.arrayBuffer():f.type==="json"?w.json():w.text();const I=yield T;if(_.signal.aborted)throw Ti();return{data:I,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(a,s);if(Ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:a,mustQueue:!0,targetMapId:Xi},s)}var c;return function(f,_){return new Promise((v,w)=>{const T=new XMLHttpRequest;T.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(T.responseType="arraybuffer");for(const I in f.headers)T.setRequestHeader(I,f.headers[I]);f.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=f.credentials==="include",T.onerror=()=>{w(new Error(T.statusText))},T.onload=()=>{if(!_.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(f.type==="json")try{I=JSON.parse(T.response)}catch(E){return void w(E)}v({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});w(new nt(T.status,T.statusText,f.url,I))}},_.signal.addEventListener("abort",()=>{T.abort(),w(Ti())}),T.send(f.body)})}(a,s)};function Zn(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const s=new URL(a),c=window.location;return s.protocol===c.protocol&&s.host===c.host}function En(a,s,c){c[a]&&c[a].indexOf(s)!==-1||(c[a]=c[a]||[],c[a].push(s))}function $n(a,s,c){if(c&&c[a]){const f=c[a].indexOf(s);f!==-1&&c[a].splice(f,1)}}class Ds{constructor(s,c={}){xe(this,c),this.type=s}}class Fi extends Ds{constructor(s,c={}){super("error",xe({error:s},c))}}class qs{on(s,c){return this._listeners=this._listeners||{},En(s,c,this._listeners),this}off(s,c){return $n(s,c,this._listeners),$n(s,c,this._oneTimeListeners),this}once(s,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},En(s,c,this._oneTimeListeners),this):new Promise(f=>this.once(s,f))}fire(s,c){typeof s=="string"&&(s=new Ds(s,c||{}));const f=s.type;if(this.listens(f)){s.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of _)T.call(this,s);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of v)$n(f,T,this._oneTimeListeners),T.call(this,s);const w=this._eventedParent;w&&(xe(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(s))}else s instanceof Fi&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,c){return this._eventedParent=s,this._eventedParentData=c,this}}var De={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Hs=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function or(a,s){const c={};for(const f in a)f!=="ref"&&(c[f]=a[f]);return Hs.forEach(f=>{f in s&&(c[f]=s[f])}),c}function Ut(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(let c=0;c<a.length;c++)if(!Ut(a[c],s[c]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(const c in a)if(!Ut(a[c],s[c]))return!1;return!0}return a===s}function Ki(a,s){a.push(s)}function ts(a,s,c){Ki(c,{command:"addSource",args:[a,s[a]]})}function xi(a,s,c){Ki(s,{command:"removeSource",args:[a]}),c[a]=!0}function is(a,s,c,f){xi(a,c,f),ts(a,s,c)}function Mn(a,s,c){let f;for(f in a[c])if(Object.prototype.hasOwnProperty.call(a[c],f)&&f!=="data"&&!Ut(a[c][f],s[c][f]))return!1;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!Ut(a[c][f],s[c][f]))return!1;return!0}function Gn(a,s,c,f,_,v){a=a||{},s=s||{};for(const w in a)Object.prototype.hasOwnProperty.call(a,w)&&(Ut(a[w],s[w])||c.push({command:v,args:[f,w,s[w],_]}));for(const w in s)Object.prototype.hasOwnProperty.call(s,w)&&!Object.prototype.hasOwnProperty.call(a,w)&&(Ut(a[w],s[w])||c.push({command:v,args:[f,w,s[w],_]}))}function Ls(a){return a.id}function Ws(a,s){return a[s.id]=s,a}class Ye{constructor(s,c,f,_){this.message=(s?`${s}: `:"")+f,_&&(this.identifier=_),c!=null&&c.__line__&&(this.line=c.__line__)}}function yn(a,...s){for(const c of s)for(const f in c)a[f]=c[f];return a}class ln extends Error{constructor(s,c){super(c),this.message=c,this.key=s}}class xs{constructor(s,c=[]){this.parent=s,this.bindings={};for(const[f,_]of c)this.bindings[f]=_}concat(s){return new xs(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const vs={kind:"null"},Ke={kind:"number"},At={kind:"string"},Et={kind:"boolean"},Hi={kind:"color"},cn={kind:"object"},Dt={kind:"value"},ns={kind:"collator"},zn={kind:"formatted"},Q={kind:"padding"},V={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function G(a,s){return{kind:"array",itemType:a,N:s}}function J(a){if(a.kind==="array"){const s=J(a.itemType);return typeof a.N=="number"?`array<${s}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${s}>`}return a.kind}const me=[vs,Ke,At,Et,Hi,zn,cn,G(Dt),Q,V,U];function ge(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!ge(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(const c of me)if(!ge(c,s))return null}}return`Expected ${J(a)} but found ${J(s)} instead.`}function be(a,s){return s.some(c=>c.kind===a.kind)}function ce(a,s){return s.some(c=>c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a)}function Se(a,s){return a.kind==="array"&&s.kind==="array"?a.itemType.kind===s.itemType.kind&&typeof a.N=="number":a.kind===s.kind}const Ne=.96422,Ee=.82521,Be=4/29,pt=6/29,wt=3*pt*pt,vt=pt*pt*pt,Nt=Math.PI/180,Mt=180/Math.PI;function ci(a){return(a%=360)<0&&(a+=360),a}function ni([a,s,c,f]){let _,v;const w=Lt((.2225045*(a=fi(a))+.7168786*(s=fi(s))+.0606169*(c=fi(c)))/1);a===s&&s===c?_=v=w:(_=Lt((.4360747*a+.3850649*s+.1430804*c)/Ne),v=Lt((.0139322*a+.0971045*s+.7141733*c)/Ee));const T=116*w-16;return[T<0?0:T,500*(_-w),200*(w-v),f]}function fi(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Lt(a){return a>vt?Math.pow(a,1/3):a/wt+Be}function pi([a,s,c,f]){let _=(a+16)/116,v=isNaN(s)?_:_+s/500,w=isNaN(c)?_:_-c/200;return _=1*hn(_),v=Ne*hn(v),w=Ee*hn(w),[Mi(3.1338561*v-1.6168667*_-.4906146*w),Mi(-.9787684*v+1.9161415*_+.033454*w),Mi(.0719453*v-.2289914*_+1.4052427*w),f]}function Mi(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function hn(a){return a>pt?a*a*a:wt*(a-Be)}function Yi(a){return parseInt(a.padEnd(2,a),16)/255}function Wi(a,s){return Dn(s?a/100:a,0,1)}function Dn(a,s,c){return Math.min(Math.max(s,a),c)}function sa(a){return!a.some(Number.isNaN)}const ra={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ei{constructor(s,c,f,_=1,v=!0){this.r=s,this.g=c,this.b=f,this.a=_,v||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[s,c,f,_]))}static parse(s){if(s instanceof ei)return s;if(typeof s!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=ra[f];if(_){const[w,T,I]=_;return[w/255,T/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let T=1;return[Yi(f.slice(T,T+=w)),Yi(f.slice(T,T+=w)),Yi(f.slice(T,T+=w)),Yi(f.slice(T,T+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[T,I,E,L,F,N,q,$,Y,ne,le,ve]=w,he=[L||" ",q||" ",ne].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const _e=[E,N,Y].join(""),Fe=_e==="%%%"?100:_e===""?255:0;if(Fe){const Ue=[Dn(+I/Fe,0,1),Dn(+F/Fe,0,1),Dn(+$/Fe,0,1),le?Wi(+le,ve):1];if(sa(Ue))return Ue}}return}}const v=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,T,I,E,L,F,N,q,$]=v,Y=[I||" ",L||" ",N].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const ne=[+T,Dn(+E,0,100),Dn(+F,0,100),q?Wi(+q,$):1];if(sa(ne))return function([le,ve,he,_e]){function Fe(Ue){const ot=(Ue+le/30)%12,gt=ve*Math.min(he,1-he);return he-gt*Math.max(-1,Math.min(ot-3,9-ot,1))}return le=ci(le),ve/=100,he/=100,[Fe(0),Fe(8),Fe(4),_e]}(ne)}}}(s);return c?new ei(...c,!1):void 0}get rgb(){const{r:s,g:c,b:f,a:_}=this,v=_||1/0;return this.overwriteGetter("rgb",[s/v,c/v,f/v,_])}get hcl(){return this.overwriteGetter("hcl",function(s){const[c,f,_,v]=ni(s),w=Math.sqrt(f*f+_*_);return[Math.round(1e4*w)?ci(Math.atan2(_,f)*Mt):NaN,w,c,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ni(this.rgb))}overwriteGetter(s,c){return Object.defineProperty(this,s,{value:c}),c}toString(){const[s,c,f,_]=this.rgb;return`rgba(${[s,c,f].map(v=>Math.round(255*v)).join(",")},${_})`}}ei.black=new ei(0,0,0,1),ei.white=new ei(1,1,1,1),ei.transparent=new ei(0,0,0,0),ei.red=new ei(1,0,0,1);class ws{constructor(s,c,f){this.sensitivity=s?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,c){return this.collator.compare(s,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hr{constructor(s,c,f,_,v){this.text=s,this.image=c,this.scale=f,this.fontStack=_,this.textColor=v}}class ks{constructor(s){this.sections=s}static fromString(s){return new ks([new Hr(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof ks?s:ks.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Ss{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Ss)return s;if(typeof s=="number")return new Ss([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const c of s)if(typeof c!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Ss(s)}}toString(){return JSON.stringify(this.values)}}const zh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fn{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Fn)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let c=0;c<s.length;c+=2){const f=s[c],_=s[c+1];if(typeof f!="string"||!zh.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Fn(s)}}toString(){return JSON.stringify(this.values)}}class Rs{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new Rs({name:s,available:!1}):null}}function Dh(a,s,c,f){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[a,s,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[a,s,c,f]:[a,s,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Er(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ei||a instanceof ws||a instanceof ks||a instanceof Ss||a instanceof Fn||a instanceof Rs)return!0;if(Array.isArray(a)){for(const s of a)if(!Er(s))return!1;return!0}if(typeof a=="object"){for(const s in a)if(!Er(a[s]))return!1;return!0}return!1}function un(a){if(a===null)return vs;if(typeof a=="string")return At;if(typeof a=="boolean")return Et;if(typeof a=="number")return Ke;if(a instanceof ei)return Hi;if(a instanceof ws)return ns;if(a instanceof ks)return zn;if(a instanceof Ss)return Q;if(a instanceof Fn)return U;if(a instanceof Rs)return V;if(Array.isArray(a)){const s=a.length;let c;for(const f of a){const _=un(f);if(c){if(c===_)continue;c=Dt;break}c=_}return G(c||Dt,s)}return cn}function oa(a){const s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof ei||a instanceof ks||a instanceof Ss||a instanceof Fn||a instanceof Rs?a.toString():JSON.stringify(a)}class Wr{constructor(s,c){this.type=s,this.value=c}static parse(s,c){if(s.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Er(s[1]))return c.error("invalid value");const f=s[1];let _=un(f);const v=c.expectedType;return _.kind!=="array"||_.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(_=v),new Wr(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ji{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Zr={string:At,number:Ke,boolean:Et,object:cn};class Zs{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");let f,_=1;const v=s[0];if(v==="array"){let T,I;if(s.length>2){const E=s[1];if(typeof E!="string"||!(E in Zr)||E==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=Zr[E],_++}else T=Dt;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=s[2],_++}f=G(T,I)}else{if(!Zr[v])throw new Error(`Types doesn't contain name = ${v}`);f=Zr[v]}const w=[];for(;_<s.length;_++){const T=c.parse(s[_],_,Dt);if(!T)return null;w.push(T)}return new Zs(f,w)}evaluate(s){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(s);if(!ge(this.type,un(f)))return f;if(c===this.args.length-1)throw new Ji(`Expected value to be of type ${J(this.type)}, but found ${J(un(f))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const ja={"to-boolean":Et,"to-color":Hi,"to-number":Ke,"to-string":At};class ar{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");const f=s[0];if(!ja[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&s.length!==2)return c.error("Expected one argument.");const _=ja[f],v=[];for(let w=1;w<s.length;w++){const T=c.parse(s[w],w,Dt);if(!T)return null;v.push(T)}return new ar(_,v)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let c,f;for(const _ of this.args){if(c=_.evaluate(s),f=null,c instanceof ei)return c;if(typeof c=="string"){const v=s.parseColor(c);if(v)return v}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Dh(c[0],c[1],c[2],c[3]),!f))return new ei(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ji(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(s);const _=Ss.parse(c);if(_)return _}throw new Ji(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(s);const _=Fn.parse(c);if(_)return _}throw new Ji(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(s),c===null)return 0;const _=Number(c);if(!isNaN(_))return _}throw new Ji(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return ks.fromString(oa(this.args[0].evaluate(s)));case"resolvedImage":return Rs.fromString(oa(this.args[0].evaluate(s)));default:return oa(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Ul=["Unknown","Point","LineString","Polygon"];class wo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ul[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let c=this._parseColorCache[s];return c||(c=this._parseColorCache[s]=ei.parse(s)),c}}class hi{constructor(s,c,f=[],_,v=new xs,w=[]){this.registry=s,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=v,this.errors=w,this.expectedType=_,this._isConstant=c}parse(s,c,f,_,v={}){return c?this.concat(c,f,_)._parse(s,v):this._parse(s,v)}_parse(s,c){function f(_,v,w){return w==="assert"?new Zs(v,[_]):w==="coerce"?new ar(v,[_]):_}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=s[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[_];if(v){let w=v.parse(s,this);if(!w)return null;if(this.expectedType){const T=this.expectedType,I=w.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(T.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(T,I))return null}else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"assert")}if(!(w instanceof Wr)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const T=new wo;try{w=new Wr(w.type,w.evaluate(T))}catch(I){return this.error(I.message),null}}return w}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,c,f){const _=typeof s=="number"?this.path.concat(s):this.path,v=f?this.scope.concat(f):this.scope;return new hi(this.registry,this._isConstant,_,c||null,v,this.errors)}error(s,...c){const f=`${this.key}${c.map(_=>`[${_}]`).join("")}`;this.errors.push(new ln(f,s))}checkSubtype(s,c){const f=ge(s,c);return f&&this.error(f),f}}class qa{constructor(s,c,f){this.type=ns,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=c}static parse(s,c){if(s.length!==2)return c.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const _=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Et);if(!_)return null;const v=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Et);if(!v)return null;let w=null;return f.locale&&(w=c.parse(f.locale,1,At),!w)?null:new qa(_,v,w)}evaluate(s){return new ws(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const lr=8192;function jl(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function aa(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function Lh(a,s){const c=(180+a[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(c*_*lr),Math.round(f*_*lr)]}function Xd(a,s,c){const f=a[0]-s[0],_=a[1]-s[1],v=a[0]-c[0],w=a[1]-c[1];return f*w-v*_==0&&f*v<=0&&_*w<=0}function Ha(a,s){let c=!1;for(let w=0,T=s.length;w<T;w++){const I=s[w];for(let E=0,L=I.length;E<L-1;E++){if(Xd(a,I[E],I[E+1]))return!1;(_=I[E])[1]>(f=a)[1]!=(v=I[E+1])[1]>f[1]&&f[0]<(v[0]-_[0])*(f[1]-_[1])/(v[1]-_[1])+_[0]&&(c=!c)}}var f,_,v;return c}function Rh(a,s){for(let c=0;c<s.length;c++)if(Ha(a,s[c]))return!0;return!1}function Fh(a,s,c,f){const _=f[0]-c[0],v=f[1]-c[1],w=(a[0]-c[0])*v-_*(a[1]-c[1]),T=(s[0]-c[0])*v-_*(s[1]-c[1]);return w>0&&T<0||w<0&&T>0}function Kd(a,s,c){for(const E of c)for(let L=0;L<E.length-1;++L)if((T=[(w=E[L+1])[0]-(v=E[L])[0],w[1]-v[1]])[0]*(I=[(_=s)[0]-(f=a)[0],_[1]-f[1]])[1]-T[1]*I[0]!=0&&Fh(f,_,v,w)&&Fh(v,w,f,_))return!0;var f,_,v,w,T,I;return!1}function Bh(a,s){for(let c=0;c<a.length;++c)if(!Ha(a[c],s))return!1;for(let c=0;c<a.length-1;++c)if(Kd(a[c],a[c+1],s))return!1;return!0}function Yd(a,s){for(let c=0;c<s.length;c++)if(Bh(a,s[c]))return!0;return!1}function Wa(a,s,c){const f=[];for(let _=0;_<a.length;_++){const v=[];for(let w=0;w<a[_].length;w++){const T=Lh(a[_][w],c);jl(s,T),v.push(T)}f.push(v)}return f}function ql(a,s,c){const f=[];for(let _=0;_<a.length;_++){const v=Wa(a[_],s,c);f.push(v)}return f}function Oh(a,s,c,f){if(a[0]<c[0]||a[0]>c[2]){const _=.5*f;let v=a[0]-c[0]>_?-f:c[0]-a[0]>_?f:0;v===0&&(v=a[0]-c[2]>_?-f:c[2]-a[0]>_?f:0),a[0]+=v}jl(s,a)}function Vh(a,s,c,f){const _=Math.pow(2,f.z)*lr,v=[f.x*lr,f.y*lr],w=[];for(const T of a)for(const I of T){const E=[I.x+v[0],I.y+v[1]];Oh(E,s,c,_),w.push(E)}return w}function Za(a,s,c,f){const _=Math.pow(2,f.z)*lr,v=[f.x*lr,f.y*lr],w=[];for(const I of a){const E=[];for(const L of I){const F=[L.x+v[0],L.y+v[1]];jl(s,F),E.push(F)}w.push(E)}if(s[2]-s[0]<=_/2){(T=s)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of w)for(const E of I)Oh(E,s,c,_)}var T;return w}class $r{constructor(s,c){this.type=Et,this.geojson=s,this.geometries=c}static parse(s,c){if(s.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Er(s[1])){const f=s[1];if(f.type==="FeatureCollection"){const _=[];for(const v of f.features){const{type:w,coordinates:T}=v.geometry;w==="Polygon"&&_.push(T),w==="MultiPolygon"&&_.push(...T)}if(_.length)return new $r(f,{type:"MultiPolygon",coordinates:_})}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new $r(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new $r(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const T=Wa(f.coordinates,v,w),I=Vh(c.geometry(),_,v,w);if(!aa(_,v))return!1;for(const E of I)if(!Ha(E,T))return!1}if(f.type==="MultiPolygon"){const T=ql(f.coordinates,v,w),I=Vh(c.geometry(),_,v,w);if(!aa(_,v))return!1;for(const E of I)if(!Rh(E,T))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const T=Wa(f.coordinates,v,w),I=Za(c.geometry(),_,v,w);if(!aa(_,v))return!1;for(const E of I)if(!Bh(E,T))return!1}if(f.type==="MultiPolygon"){const T=ql(f.coordinates,v,w),I=Za(c.geometry(),_,v,w);if(!aa(_,v))return!1;for(const E of I)if(!Yd(E,T))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $a{constructor(s,c){this.type=c.type,this.name=s,this.boundExpression=c}static parse(s,c){if(s.length!==2||typeof s[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=s[1];return c.scope.has(f)?new $a(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Fs{constructor(s,c,f,_){this.name=s,this.type=c,this._evaluate=f,this.args=_}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,c){const f=s[0],_=Fs.definitions[f];if(!_)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(_)?_[0]:_.type,w=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,T=w.filter(([E])=>!Array.isArray(E)||E.length===s.length-1);let I=null;for(const[E,L]of T){I=new hi(c.registry,la,c.path,null,c.scope);const F=[];let N=!1;for(let q=1;q<s.length;q++){const $=s[q],Y=Array.isArray(E)?E[q-1]:E.type,ne=I.parse($,1+F.length,Y);if(!ne){N=!0;break}F.push(ne)}if(!N)if(Array.isArray(E)&&E.length!==F.length)I.error(`Expected ${E.length} arguments, but found ${F.length} instead.`);else{for(let q=0;q<F.length;q++){const $=Array.isArray(E)?E[q]:E.type,Y=F[q];I.concat(q+1).checkSubtype($,Y.type)}if(I.errors.length===0)return new Fs(f,v,L,F)}}if(T.length===1)c.errors.push(...I.errors);else{const E=(T.length?T:w).map(([F])=>{return N=F,Array.isArray(N)?`(${N.map(J).join(", ")})`:`(${J(N.type)}...)`;var N}).join(" | "),L=[];for(let F=1;F<s.length;F++){const N=c.parse(s[F],1+L.length);if(!N)return null;L.push(J(N.type))}c.error(`Expected arguments of type ${E}, but found (${L.join(", ")}) instead.`)}return null}static register(s,c){Fs.definitions=c;for(const f in c)s[f]=Fs}}function la(a){if(a instanceof $a)return la(a.boundExpression);if(a instanceof Fs&&a.name==="error"||a instanceof qa||a instanceof $r)return!1;const s=a instanceof ar||a instanceof Zs;let c=!0;return a.eachChild(f=>{c=s?c&&la(f):c&&f instanceof Wr}),!!c&&ca(a)&&Ga(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ca(a){if(a instanceof Fs&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof $r)return!1;let s=!0;return a.eachChild(c=>{s&&!ca(c)&&(s=!1)}),s}function ha(a){if(a instanceof Fs&&a.name==="feature-state")return!1;let s=!0;return a.eachChild(c=>{s&&!ha(c)&&(s=!1)}),s}function Ga(a,s){if(a instanceof Fs&&s.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(f=>{c&&!Ga(f,s)&&(c=!1)}),c}function ua(a,s){const c=a.length-1;let f,_,v=0,w=c,T=0;for(;v<=w;)if(T=Math.floor((v+w)/2),f=a[T],_=a[T+1],f<=s){if(T===c||s<_)return T;v=T+1}else{if(!(f>s))throw new Ji("Input is not a number.");w=T-1}return 0}class ko{constructor(s,c,f){this.type=s,this.input=c,this.labels=[],this.outputs=[];for(const[_,v]of f)this.labels.push(_),this.outputs.push(v)}static parse(s,c){if(s.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(s[1],1,Ke);if(!f)return null;const _=[];let v=null;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(let w=1;w<s.length;w+=2){const T=w===1?-1/0:s[w],I=s[w+1],E=w,L=w+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(_.length&&_[_.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const F=c.parse(I,L,v);if(!F)return null;v=v||F.type,_.push([T,F])}return new ko(v,f,_)}evaluate(s){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(s);const _=this.input.evaluate(s);if(_<=c[0])return f[0].evaluate(s);const v=c.length;return _>=c[v-1]?f[v-1].evaluate(s):f[ua(c,_)].evaluate(s)}eachChild(s){s(this.input);for(const c of this.outputs)s(c)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Jd(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Qd=Nh;function Nh(a,s,c,f){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=s,this.p2x=c,this.p2y=f}Nh.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,s){if(s===void 0&&(s=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,f=0;f<8;f++){var _=this.sampleCurveX(c)-a;if(Math.abs(_)<s)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=_/v}var w=0,T=1;for(c=a,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-a)<s));f++)a>_?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))}};var ef=Jd(Qd);function Gr(a,s,c){return a+c*(s-a)}function Xa(a,s,c){return a.map((f,_)=>Gr(f,s[_],c))}const Cs={number:Gr,color:function(a,s,c,f="rgb"){switch(f){case"rgb":{const[_,v,w,T]=Xa(a.rgb,s.rgb,c);return new ei(_,v,w,T,!1)}case"hcl":{const[_,v,w,T]=a.hcl,[I,E,L,F]=s.hcl;let N,q;if(isNaN(_)||isNaN(I))isNaN(_)?isNaN(I)?N=NaN:(N=I,w!==1&&w!==0||(q=E)):(N=_,L!==1&&L!==0||(q=v));else{let ve=I-_;I>_&&ve>180?ve-=360:I<_&&_-I>180&&(ve+=360),N=_+c*ve}const[$,Y,ne,le]=function([ve,he,_e,Fe]){return ve=isNaN(ve)?0:ve*Nt,pi([_e,Math.cos(ve)*he,Math.sin(ve)*he,Fe])}([N,q??Gr(v,E,c),Gr(w,L,c),Gr(T,F,c)]);return new ei($,Y,ne,le,!1)}case"lab":{const[_,v,w,T]=pi(Xa(a.lab,s.lab,c));return new ei(_,v,w,T,!1)}}},array:Xa,padding:function(a,s,c){return new Ss(Xa(a.values,s.values,c))},variableAnchorOffsetCollection:function(a,s,c){const f=a.values,_=s.values;if(f.length!==_.length)throw new Ji(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${s.toString()}`);const v=[];for(let w=0;w<f.length;w+=2){if(f[w]!==_[w])throw new Ji(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${_[w]}`);v.push(f[w]);const[T,I]=f[w+1],[E,L]=_[w+1];v.push([Gr(T,E,c),Gr(I,L,c)])}return new Fn(v)}};class Xn{constructor(s,c,f,_,v){this.type=s,this.operator=c,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[w,T]of v)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(s,c,f,_){let v=0;if(s.name==="exponential")v=So(c,s.base,f,_);else if(s.name==="linear")v=So(c,1,f,_);else if(s.name==="cubic-bezier"){const w=s.controlPoints;v=new ef(w[0],w[1],w[2],w[3]).solve(So(c,1,f,_))}return v}static parse(s,c){let[f,_,v,...w]=s;if(!Array.isArray(_)||_.length===0)return c.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const E=_[1];if(typeof E!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:E}}else{if(_[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const E=_.slice(1);if(E.length!==4||E.some(L=>typeof L!="number"||L<0||L>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:E}}}if(s.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(v=c.parse(v,2,Ke),!v)return null;const T=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Hi:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let E=0;E<w.length;E+=2){const L=w[E],F=w[E+1],N=E+3,q=E+4;if(typeof L!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(T.length&&T[T.length-1][0]>=L)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const $=c.parse(F,q,I);if(!$)return null;I=I||$.type,T.push([L,$])}return Se(I,Ke)||Se(I,Hi)||Se(I,Q)||Se(I,U)||Se(I,G(Ke))?new Xn(I,f,_,v,T):c.error(`Type ${J(I)} is not interpolatable.`)}evaluate(s){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(s);const _=this.input.evaluate(s);if(_<=c[0])return f[0].evaluate(s);const v=c.length;if(_>=c[v-1])return f[v-1].evaluate(s);const w=ua(c,_),T=Xn.interpolationFactor(this.interpolation,_,c[w],c[w+1]),I=f[w].evaluate(s),E=f[w+1].evaluate(s);switch(this.operator){case"interpolate":return Cs[this.type.kind](I,E,T);case"interpolate-hcl":return Cs.color(I,E,T,"hcl");case"interpolate-lab":return Cs.color(I,E,T,"lab")}}eachChild(s){s(this.input);for(const c of this.outputs)s(c)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function So(a,s,c,f){const _=f-c,v=a-c;return _===0?0:s===1?v/_:(Math.pow(s,v)-1)/(Math.pow(s,_)-1)}class ti{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expectected at least one argument.");let f=null;const _=c.expectedType;_&&_.kind!=="value"&&(f=_);const v=[];for(const T of s.slice(1)){const I=c.parse(T,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,v.push(I)}if(!f)throw new Error("No output type");const w=_&&v.some(T=>ge(_,T.type));return new ti(w?Dt:f,v)}evaluate(s){let c,f=null,_=0;for(const v of this.args)if(_++,f=v.evaluate(s),f&&f instanceof Rs&&!f.available&&(c||(c=f.name),f=null,_===this.args.length&&(f=c)),f!==null)break;return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Ka{constructor(s,c){this.type=c.type,this.bindings=[].concat(s),this.result=c}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const c of this.bindings)s(c[1]);s(this.result)}static parse(s,c){if(s.length<4)return c.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let v=1;v<s.length-1;v+=2){const w=s[v];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,v);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=c.parse(s[v+1],v+1);if(!T)return null;f.push([w,T])}const _=c.parse(s[s.length-1],s.length-1,c.expectedType,f);return _?new Ka(f,_):null}outputDefined(){return this.result.outputDefined()}}class Hl{constructor(s,c,f){this.type=s,this.index=c,this.input=f}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,Ke),_=c.parse(s[2],2,G(c.expectedType||Dt));return f&&_?new Hl(_.type.itemType,f,_):null}evaluate(s){const c=this.index.evaluate(s),f=this.input.evaluate(s);if(c<0)throw new Ji(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new Ji(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new Ji(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Wl{constructor(s,c){this.type=Et,this.needle=s,this.haystack=c}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,Dt),_=c.parse(s[2],2,Dt);return f&&_?be(f.type,[Et,At,Ke,vs,Dt])?new Wl(f,_):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(f.type)} instead`):null}evaluate(s){const c=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!ce(c,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${J(un(c))} instead.`);if(!ce(f,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${J(un(f))} instead.`);return f.indexOf(c)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Ya{constructor(s,c,f){this.type=Ke,this.needle=s,this.haystack=c,this.fromIndex=f}static parse(s,c){if(s.length<=2||s.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,Dt),_=c.parse(s[2],2,Dt);if(!f||!_)return null;if(!be(f.type,[Et,At,Ke,vs,Dt]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(f.type)} instead`);if(s.length===4){const v=c.parse(s[3],3,Ke);return v?new Ya(f,_,v):null}return new Ya(f,_)}evaluate(s){const c=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!ce(c,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${J(un(c))} instead.`);if(!ce(f,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${J(un(f))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(s);return f.indexOf(c,_)}return f.indexOf(c)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Zl{constructor(s,c,f,_,v,w){this.inputType=s,this.type=c,this.input=f,this.cases=_,this.outputs=v,this.otherwise=w}static parse(s,c){if(s.length<5)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return c.error("Expected an even number of arguments.");let f,_;c.expectedType&&c.expectedType.kind!=="value"&&(_=c.expectedType);const v={},w=[];for(let E=2;E<s.length-1;E+=2){let L=s[E];const F=s[E+1];Array.isArray(L)||(L=[L]);const N=c.concat(E);if(L.length===0)return N.error("Expected at least one branch label.");for(const $ of L){if(typeof $!="number"&&typeof $!="string")return N.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(f){if(N.checkSubtype(f,un($)))return null}else f=un($);if(v[String($)]!==void 0)return N.error("Branch labels must be unique.");v[String($)]=w.length}const q=c.parse(F,E,_);if(!q)return null;_=_||q.type,w.push(q)}const T=c.parse(s[1],1,Dt);if(!T)return null;const I=c.parse(s[s.length-1],s.length-1,_);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new Zl(f,_,T,v,w,I):null}evaluate(s){const c=this.input.evaluate(s);return(un(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class $l{constructor(s,c,f){this.type=s,this.branches=c,this.otherwise=f}static parse(s,c){if(s.length<4)return c.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const _=[];for(let w=1;w<s.length-1;w+=2){const T=c.parse(s[w],w,Et);if(!T)return null;const I=c.parse(s[w+1],w+1,f);if(!I)return null;_.push([T,I]),f=f||I.type}const v=c.parse(s[s.length-1],s.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new $l(f,_,v)}evaluate(s){for(const[c,f]of this.branches)if(c.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[c,f]of this.branches)s(c),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Ja{constructor(s,c,f,_){this.type=s,this.input=c,this.beginIndex=f,this.endIndex=_}static parse(s,c){if(s.length<=2||s.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,Dt),_=c.parse(s[2],2,Ke);if(!f||!_)return null;if(!be(f.type,[G(Dt),At,Dt]))return c.error(`Expected first argument to be of type array or string, but found ${J(f.type)} instead`);if(s.length===4){const v=c.parse(s[3],3,Ke);return v?new Ja(f.type,f,_,v):null}return new Ja(f.type,f,_)}evaluate(s){const c=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!ce(c,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${J(un(c))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(s);return c.slice(f,_)}return c.slice(f)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Uh(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function jh(a,s,c,f){return f.compare(s,c)===0}function Co(a,s,c){const f=a!=="=="&&a!=="!=";return class j0{constructor(v,w,T){this.type=Et,this.lhs=v,this.rhs=w,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||w.type.kind==="value"}static parse(v,w){if(v.length!==3&&v.length!==4)return w.error("Expected two or three arguments.");const T=v[0];let I=w.parse(v[1],1,Dt);if(!I)return null;if(!Uh(T,I.type))return w.concat(1).error(`"${T}" comparisons are not supported for type '${J(I.type)}'.`);let E=w.parse(v[2],2,Dt);if(!E)return null;if(!Uh(T,E.type))return w.concat(2).error(`"${T}" comparisons are not supported for type '${J(E.type)}'.`);if(I.type.kind!==E.type.kind&&I.type.kind!=="value"&&E.type.kind!=="value")return w.error(`Cannot compare types '${J(I.type)}' and '${J(E.type)}'.`);f&&(I.type.kind==="value"&&E.type.kind!=="value"?I=new Zs(E.type,[I]):I.type.kind!=="value"&&E.type.kind==="value"&&(E=new Zs(I.type,[E])));let L=null;if(v.length===4){if(I.type.kind!=="string"&&E.type.kind!=="string"&&I.type.kind!=="value"&&E.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(L=w.parse(v[3],3,ns),!L)return null}return new j0(I,E,L)}evaluate(v){const w=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const I=un(w),E=un(T);if(I.kind!==E.kind||I.kind!=="string"&&I.kind!=="number")throw new Ji(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${I.kind}, ${E.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=un(w),E=un(T);if(I.kind!=="string"||E.kind!=="string")return s(v,w,T)}return this.collator?c(v,w,T,this.collator.evaluate(v)):s(v,w,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const tf=Co("==",function(a,s,c){return s===c},jh),nf=Co("!=",function(a,s,c){return s!==c},function(a,s,c,f){return!jh(0,s,c,f)}),sf=Co("<",function(a,s,c){return s<c},function(a,s,c,f){return f.compare(s,c)<0}),rf=Co(">",function(a,s,c){return s>c},function(a,s,c,f){return f.compare(s,c)>0}),of=Co("<=",function(a,s,c){return s<=c},function(a,s,c,f){return f.compare(s,c)<=0}),af=Co(">=",function(a,s,c){return s>=c},function(a,s,c,f){return f.compare(s,c)>=0});class Gl{constructor(s,c,f,_,v){this.type=At,this.number=s,this.locale=c,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=v}static parse(s,c){if(s.length!==3)return c.error("Expected two arguments.");const f=c.parse(s[1],1,Ke);if(!f)return null;const _=s[2];if(typeof _!="object"||Array.isArray(_))return c.error("NumberFormat options argument must be an object.");let v=null;if(_.locale&&(v=c.parse(_.locale,1,At),!v))return null;let w=null;if(_.currency&&(w=c.parse(_.currency,1,At),!w))return null;let T=null;if(_["min-fraction-digits"]&&(T=c.parse(_["min-fraction-digits"],1,Ke),!T))return null;let I=null;return _["max-fraction-digits"]&&(I=c.parse(_["max-fraction-digits"],1,Ke),!I)?null:new Gl(f,v,w,T,I)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Qa{constructor(s){this.type=zn,this.sections=s}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const _=[];let v=!1;for(let w=1;w<=s.length-1;++w){const T=s[w];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let I=null;if(T["font-scale"]&&(I=c.parse(T["font-scale"],1,Ke),!I))return null;let E=null;if(T["text-font"]&&(E=c.parse(T["text-font"],1,G(At)),!E))return null;let L=null;if(T["text-color"]&&(L=c.parse(T["text-color"],1,Hi),!L))return null;const F=_[_.length-1];F.scale=I,F.font=E,F.textColor=L}else{const I=c.parse(s[w],1,Dt);if(!I)return null;const E=I.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,_.push({content:I,scale:null,font:null,textColor:null})}}return new Qa(_)}evaluate(s){return new ks(this.sections.map(c=>{const f=c.content.evaluate(s);return un(f)===V?new Hr("",f,null,null,null):new Hr(oa(f),null,c.scale?c.scale.evaluate(s):null,c.font?c.font.evaluate(s).join(","):null,c.textColor?c.textColor.evaluate(s):null)}))}eachChild(s){for(const c of this.sections)s(c.content),c.scale&&s(c.scale),c.font&&s(c.font),c.textColor&&s(c.textColor)}outputDefined(){return!1}}class Xl{constructor(s){this.type=V,this.input=s}static parse(s,c){if(s.length!==2)return c.error("Expected two arguments.");const f=c.parse(s[1],1,At);return f?new Xl(f):c.error("No image name provided.")}evaluate(s){const c=this.input.evaluate(s),f=Rs.fromString(c);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(c)>-1),f}eachChild(s){s(this.input)}outputDefined(){return!1}}class Kl{constructor(s){this.type=Ke,this.input=s}static parse(s,c){if(s.length!==2)return c.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=c.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${J(f.type)} instead.`):new Kl(f):null}evaluate(s){const c=this.input.evaluate(s);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ji(`Expected value to be of type string or array, but found ${J(un(c))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const To={"==":tf,"!=":nf,">":rf,"<":sf,">=":af,"<=":of,array:Zs,at:Hl,boolean:Zs,case:$l,coalesce:ti,collator:qa,format:Qa,image:Xl,in:Wl,"index-of":Ya,interpolate:Xn,"interpolate-hcl":Xn,"interpolate-lab":Xn,length:Kl,let:Ka,literal:Wr,match:Zl,number:Zs,"number-format":Gl,object:Zs,slice:Ja,step:ko,string:Zs,"to-boolean":ar,"to-color":ar,"to-number":ar,"to-string":ar,var:$a,within:$r};function qh(a,[s,c,f,_]){s=s.evaluate(a),c=c.evaluate(a),f=f.evaluate(a);const v=_?_.evaluate(a):1,w=Dh(s,c,f,v);if(w)throw new Ji(w);return new ei(s/255,c/255,f/255,v,!1)}function Hh(a,s){return a in s}function Yl(a,s){const c=s[a];return c===void 0?null:c}function Xr(a){return{type:a}}function Wh(a){return{result:"success",value:a}}function Mo(a){return{result:"error",value:a}}function Po(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Zh(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Jl(a){return!!a.expression&&a.expression.interpolated}function si(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Io(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function lf(a){return a}function $h(a,s){const c=s.type==="color",f=a.stops&&typeof a.stops[0][0]=="object",_=f||!(f||a.property!==void 0),v=a.type||(Jl(s)?"exponential":"interval");if(c||s.type==="padding"){const L=c?ei.parse:Ss.parse;(a=yn({},a)).stops&&(a.stops=a.stops.map(F=>[F[0],L(F[1])])),a.default=L(a.default?a.default:s.default)}if(a.colorSpace&&(w=a.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var w;let T,I,E;if(v==="exponential")T=Gh;else if(v==="interval")T=rn;else if(v==="categorical"){T=cf,I=Object.create(null);for(const L of a.stops)I[L[0]]=L[1];E=typeof a.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);T=Jt}if(f){const L={},F=[];for(let $=0;$<a.stops.length;$++){const Y=a.stops[$],ne=Y[0].zoom;L[ne]===void 0&&(L[ne]={zoom:ne,type:a.type,property:a.property,default:a.default,stops:[]},F.push(ne)),L[ne].stops.push([Y[0].value,Y[1]])}const N=[];for(const $ of F)N.push([L[$].zoom,$h(L[$],s)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Xn.interpolationFactor.bind(void 0,q),zoomStops:N.map($=>$[0]),evaluate:({zoom:$},Y)=>Gh({stops:N,base:a.base},s,$).evaluate($,Y)}}if(_){const L=v==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:Xn.interpolationFactor.bind(void 0,L),zoomStops:a.stops.map(F=>F[0]),evaluate:({zoom:F})=>T(a,s,F,I,E)}}return{kind:"source",evaluate(L,F){const N=F&&F.properties?F.properties[a.property]:void 0;return N===void 0?da(a.default,s.default):T(a,s,N,I,E)}}}function da(a,s,c){return a!==void 0?a:s!==void 0?s:c!==void 0?c:void 0}function cf(a,s,c,f,_){return da(typeof c===_?f[c]:void 0,a.default,s.default)}function rn(a,s,c){if(si(c)!=="number")return da(a.default,s.default);const f=a.stops.length;if(f===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[f-1][0])return a.stops[f-1][1];const _=ua(a.stops.map(v=>v[0]),c);return a.stops[_][1]}function Gh(a,s,c){const f=a.base!==void 0?a.base:1;if(si(c)!=="number")return da(a.default,s.default);const _=a.stops.length;if(_===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[_-1][0])return a.stops[_-1][1];const v=ua(a.stops.map(L=>L[0]),c),w=function(L,F,N,q){const $=q-N,Y=L-N;return $===0?0:F===1?Y/$:(Math.pow(F,Y)-1)/(Math.pow(F,$)-1)}(c,f,a.stops[v][0],a.stops[v+1][0]),T=a.stops[v][1],I=a.stops[v+1][1],E=Cs[s.type]||lf;return typeof T.evaluate=="function"?{evaluate(...L){const F=T.evaluate.apply(void 0,L),N=I.evaluate.apply(void 0,L);if(F!==void 0&&N!==void 0)return E(F,N,w,a.colorSpace)}}:E(T,I,w,a.colorSpace)}function Jt(a,s,c){switch(s.type){case"color":c=ei.parse(c);break;case"formatted":c=ks.fromString(c.toString());break;case"resolvedImage":c=Rs.fromString(c.toString());break;case"padding":c=Ss.parse(c);break;default:si(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0)}return da(c,a.default,s.default)}Fs.register(To,{error:[{kind:"error"},[At],(a,[s])=>{throw new Ji(s.evaluate(a))}],typeof:[At,[Dt],(a,[s])=>J(un(s.evaluate(a)))],"to-rgba":[G(Ke,4),[Hi],(a,[s])=>{const[c,f,_,v]=s.evaluate(a).rgb;return[255*c,255*f,255*_,v]}],rgb:[Hi,[Ke,Ke,Ke],qh],rgba:[Hi,[Ke,Ke,Ke,Ke],qh],has:{type:Et,overloads:[[[At],(a,[s])=>Hh(s.evaluate(a),a.properties())],[[At,cn],(a,[s,c])=>Hh(s.evaluate(a),c.evaluate(a))]]},get:{type:Dt,overloads:[[[At],(a,[s])=>Yl(s.evaluate(a),a.properties())],[[At,cn],(a,[s,c])=>Yl(s.evaluate(a),c.evaluate(a))]]},"feature-state":[Dt,[At],(a,[s])=>Yl(s.evaluate(a),a.featureState||{})],properties:[cn,[],a=>a.properties()],"geometry-type":[At,[],a=>a.geometryType()],id:[Dt,[],a=>a.id()],zoom:[Ke,[],a=>a.globals.zoom],"heatmap-density":[Ke,[],a=>a.globals.heatmapDensity||0],"line-progress":[Ke,[],a=>a.globals.lineProgress||0],accumulated:[Dt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Ke,Xr(Ke),(a,s)=>{let c=0;for(const f of s)c+=f.evaluate(a);return c}],"*":[Ke,Xr(Ke),(a,s)=>{let c=1;for(const f of s)c*=f.evaluate(a);return c}],"-":{type:Ke,overloads:[[[Ke,Ke],(a,[s,c])=>s.evaluate(a)-c.evaluate(a)],[[Ke],(a,[s])=>-s.evaluate(a)]]},"/":[Ke,[Ke,Ke],(a,[s,c])=>s.evaluate(a)/c.evaluate(a)],"%":[Ke,[Ke,Ke],(a,[s,c])=>s.evaluate(a)%c.evaluate(a)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(a,[s,c])=>Math.pow(s.evaluate(a),c.evaluate(a))],sqrt:[Ke,[Ke],(a,[s])=>Math.sqrt(s.evaluate(a))],log10:[Ke,[Ke],(a,[s])=>Math.log(s.evaluate(a))/Math.LN10],ln:[Ke,[Ke],(a,[s])=>Math.log(s.evaluate(a))],log2:[Ke,[Ke],(a,[s])=>Math.log(s.evaluate(a))/Math.LN2],sin:[Ke,[Ke],(a,[s])=>Math.sin(s.evaluate(a))],cos:[Ke,[Ke],(a,[s])=>Math.cos(s.evaluate(a))],tan:[Ke,[Ke],(a,[s])=>Math.tan(s.evaluate(a))],asin:[Ke,[Ke],(a,[s])=>Math.asin(s.evaluate(a))],acos:[Ke,[Ke],(a,[s])=>Math.acos(s.evaluate(a))],atan:[Ke,[Ke],(a,[s])=>Math.atan(s.evaluate(a))],min:[Ke,Xr(Ke),(a,s)=>Math.min(...s.map(c=>c.evaluate(a)))],max:[Ke,Xr(Ke),(a,s)=>Math.max(...s.map(c=>c.evaluate(a)))],abs:[Ke,[Ke],(a,[s])=>Math.abs(s.evaluate(a))],round:[Ke,[Ke],(a,[s])=>{const c=s.evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[Ke,[Ke],(a,[s])=>Math.floor(s.evaluate(a))],ceil:[Ke,[Ke],(a,[s])=>Math.ceil(s.evaluate(a))],"filter-==":[Et,[At,Dt],(a,[s,c])=>a.properties()[s.value]===c.value],"filter-id-==":[Et,[Dt],(a,[s])=>a.id()===s.value],"filter-type-==":[Et,[At],(a,[s])=>a.geometryType()===s.value],"filter-<":[Et,[At,Dt],(a,[s,c])=>{const f=a.properties()[s.value],_=c.value;return typeof f==typeof _&&f<_}],"filter-id-<":[Et,[Dt],(a,[s])=>{const c=a.id(),f=s.value;return typeof c==typeof f&&c<f}],"filter->":[Et,[At,Dt],(a,[s,c])=>{const f=a.properties()[s.value],_=c.value;return typeof f==typeof _&&f>_}],"filter-id->":[Et,[Dt],(a,[s])=>{const c=a.id(),f=s.value;return typeof c==typeof f&&c>f}],"filter-<=":[Et,[At,Dt],(a,[s,c])=>{const f=a.properties()[s.value],_=c.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[Et,[Dt],(a,[s])=>{const c=a.id(),f=s.value;return typeof c==typeof f&&c<=f}],"filter->=":[Et,[At,Dt],(a,[s,c])=>{const f=a.properties()[s.value],_=c.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[Et,[Dt],(a,[s])=>{const c=a.id(),f=s.value;return typeof c==typeof f&&c>=f}],"filter-has":[Et,[Dt],(a,[s])=>s.value in a.properties()],"filter-has-id":[Et,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Et,[G(At)],(a,[s])=>s.value.indexOf(a.geometryType())>=0],"filter-id-in":[Et,[G(Dt)],(a,[s])=>s.value.indexOf(a.id())>=0],"filter-in-small":[Et,[At,G(Dt)],(a,[s,c])=>c.value.indexOf(a.properties()[s.value])>=0],"filter-in-large":[Et,[At,G(Dt)],(a,[s,c])=>function(f,_,v,w){for(;v<=w;){const T=v+w>>1;if(_[T]===f)return!0;_[T]>f?w=T-1:v=T+1}return!1}(a.properties()[s.value],c.value,0,c.value.length-1)],all:{type:Et,overloads:[[[Et,Et],(a,[s,c])=>s.evaluate(a)&&c.evaluate(a)],[Xr(Et),(a,s)=>{for(const c of s)if(!c.evaluate(a))return!1;return!0}]]},any:{type:Et,overloads:[[[Et,Et],(a,[s,c])=>s.evaluate(a)||c.evaluate(a)],[Xr(Et),(a,s)=>{for(const c of s)if(c.evaluate(a))return!0;return!1}]]},"!":[Et,[Et],(a,[s])=>!s.evaluate(a)],"is-supported-script":[Et,[At],(a,[s])=>{const c=a.globals&&a.globals.isSupportedScript;return!c||c(s.evaluate(a))}],upcase:[At,[At],(a,[s])=>s.evaluate(a).toUpperCase()],downcase:[At,[At],(a,[s])=>s.evaluate(a).toLowerCase()],concat:[At,Xr(Dt),(a,s)=>s.map(c=>oa(c.evaluate(a))).join("")],"resolved-locale":[At,[ns],(a,[s])=>s.evaluate(a).resolvedLocale()]});class fa{constructor(s,c){var f;this.expression=s,this._warningHistory={},this._evaluator=new wo,this._defaultValue=c?(f=c).type==="color"&&Io(f.default)?new ei(0,0,0,0):f.type==="color"?ei.parse(f.default)||null:f.type==="padding"?Ss.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Fn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(s,c,f,_,v,w){return this._evaluator.globals=s,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(s,c,f,_,v,w){this._evaluator.globals=s,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function vi(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in To}function _i(a,s){const c=new hi(To,la,[],s?function(_){const v={color:Hi,string:At,number:Ke,enum:At,boolean:Et,formatted:zn,padding:Q,resolvedImage:V,variableAnchorOffsetCollection:U};return _.type==="array"?G(v[_.value]||Dt,_.length):v[_.type]}(s):void 0),f=c.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Wh(new fa(f,s)):Mo(c.errors)}class Ao{constructor(s,c){this.kind=s,this._styleExpression=c,this.isStateDependent=s!=="constant"&&!ha(c.expression)}evaluateWithoutErrorHandling(s,c,f,_,v,w){return this._styleExpression.evaluateWithoutErrorHandling(s,c,f,_,v,w)}evaluate(s,c,f,_,v,w){return this._styleExpression.evaluate(s,c,f,_,v,w)}}class el{constructor(s,c,f,_){this.kind=s,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=s!=="camera"&&!ha(c.expression),this.interpolationType=_}evaluateWithoutErrorHandling(s,c,f,_,v,w){return this._styleExpression.evaluateWithoutErrorHandling(s,c,f,_,v,w)}evaluate(s,c,f,_,v,w){return this._styleExpression.evaluate(s,c,f,_,v,w)}interpolationFactor(s,c,f){return this.interpolationType?Xn.interpolationFactor(this.interpolationType,s,c,f):0}}function Xh(a,s){const c=_i(a,s);if(c.result==="error")return c;const f=c.value.expression,_=ca(f);if(!_&&!Po(s))return Mo([new ln("","data expressions not supported")]);const v=Ga(f,["zoom"]);if(!v&&!Zh(s))return Mo([new ln("","zoom expressions not supported")]);const w=il(f);return w||v?w instanceof ln?Mo([w]):w instanceof Xn&&!Jl(s)?Mo([new ln("",'"interpolate" expressions cannot be used with this property')]):Wh(w?new el(_?"camera":"composite",c.value,w.labels,w instanceof Xn?w.interpolation:void 0):new Ao(_?"constant":"source",c.value)):Mo([new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tl{constructor(s,c){this._parameters=s,this._specification=c,yn(this,$h(this._parameters,this._specification))}static deserialize(s){return new tl(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function il(a){let s=null;if(a instanceof Ka)s=il(a.result);else if(a instanceof ti){for(const c of a.args)if(s=il(c),s)break}else(a instanceof ko||a instanceof Xn)&&a.input instanceof Fs&&a.input.name==="zoom"&&(s=a);return s instanceof ln||a.eachChild(c=>{const f=il(c);f instanceof ln?s=f:!s&&f?s=new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&f&&s!==f&&(s=new ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Ql(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const s of a.slice(1))if(!Ql(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Kh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function nl(a){if(a==null)return{filter:()=>!0,needGeometry:!1};Ql(a)||(a=Eo(a));const s=_i(a,Kh);if(s.result==="error")throw new Error(s.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,_)=>s.value.evaluate(c,f,{},_),needGeometry:ec(a)}}function Yh(a,s){return a<s?-1:a>s?1:0}function ec(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let s=1;s<a.length;s++)if(ec(a[s]))return!0;return!1}function Eo(a){if(!a)return!0;const s=a[0];return a.length<=1?s!=="any":s==="=="?tc(a[1],a[2],"=="):s==="!="?sl(tc(a[1],a[2],"==")):s==="<"||s===">"||s==="<="||s===">="?tc(a[1],a[2],s):s==="any"?(c=a.slice(1),["any"].concat(c.map(Eo))):s==="all"?["all"].concat(a.slice(1).map(Eo)):s==="none"?["all"].concat(a.slice(1).map(Eo).map(sl)):s==="in"?Jh(a[1],a.slice(2)):s==="!in"?sl(Jh(a[1],a.slice(2))):s==="has"?Qh(a[1]):s==="!has"?sl(Qh(a[1])):s!=="within"||a;var c}function tc(a,s,c){switch(a){case"$type":return[`filter-type-${c}`,s];case"$id":return[`filter-id-${c}`,s];default:return[`filter-${c}`,a,s]}}function Jh(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(c=>typeof c!=typeof s[0])?["filter-in-large",a,["literal",s.sort(Yh)]]:["filter-in-small",a,["literal",s]]}}function Qh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function sl(a){return["!",a]}function ic(a){const s=typeof a;if(s==="number"||s==="boolean"||s==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let _="[";for(const v of a)_+=`${ic(v)},`;return`${_}]`}const c=Object.keys(a).sort();let f="{";for(let _=0;_<c.length;_++)f+=`${JSON.stringify(c[_])}:${ic(a[c[_]])},`;return`${f}}`}function hf(a){let s="";for(const c of Hs)s+=`/${ic(a[c])}`;return s}function eu(a){const s=a.value;return s?[new Ye(a.key,s,"constants have been deprecated as of v8")]:[]}function Qi(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function zr(a){if(Array.isArray(a))return a.map(zr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const s={};for(const c in a)s[c]=zr(a[c]);return s}return Qi(a)}function Ts(a){const s=a.key,c=a.value,f=a.valueSpec||{},_=a.objectElementValidators||{},v=a.style,w=a.styleSpec,T=a.validateSpec;let I=[];const E=si(c);if(E!=="object")return[new Ye(s,c,`object expected, ${E} found`)];for(const L in c){const F=L.split(".")[0],N=f[F]||f["*"];let q;if(_[F])q=_[F];else if(f[F])q=T;else if(_["*"])q=_["*"];else{if(!f["*"]){I.push(new Ye(s,c[L],`unknown property "${L}"`));continue}q=T}I=I.concat(q({key:(s&&`${s}.`)+L,value:c[L],valueSpec:N,style:v,styleSpec:w,object:c,objectKey:L,validateSpec:T},c))}for(const L in f)_[L]||f[L].required&&f[L].default===void 0&&c[L]===void 0&&I.push(new Ye(s,c,`missing required property "${L}"`));return I}function zo(a){const s=a.value,c=a.valueSpec,f=a.style,_=a.styleSpec,v=a.key,w=a.arrayElementValidator||a.validateSpec;if(si(s)!=="array")return[new Ye(v,s,`array expected, ${si(s)} found`)];if(c.length&&s.length!==c.length)return[new Ye(v,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new Ye(v,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let T={type:c.value,values:c.values};_.$version<7&&(T.function=c.function),si(c.value)==="object"&&(T=c.value);let I=[];for(let E=0;E<s.length;E++)I=I.concat(w({array:s,arrayIndex:E,value:s[E],valueSpec:T,validateSpec:a.validateSpec,style:f,styleSpec:_,key:`${v}[${E}]`}));return I}function nc(a){const s=a.key,c=a.value,f=a.valueSpec;let _=si(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new Ye(s,c,`number expected, ${_} found`)]:"minimum"in f&&c<f.minimum?[new Ye(s,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new Ye(s,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function sc(a){const s=a.valueSpec,c=Qi(a.value.type);let f,_,v,w={};const T=c!=="categorical"&&a.value.property===void 0,I=!T,E=si(a.value.stops)==="array"&&si(a.value.stops[0])==="array"&&si(a.value.stops[0][0])==="object",L=Ts({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(q){if(c==="identity")return[new Ye(q.key,q.value,'identity function may not have a "stops" property')];let $=[];const Y=q.value;return $=$.concat(zo({key:q.key,value:Y,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:F})),si(Y)==="array"&&Y.length===0&&$.push(new Ye(q.key,Y,"array must have at least one stop")),$},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:s,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return c==="identity"&&T&&L.push(new Ye(a.key,a.value,'missing required property "property"')),c==="identity"||a.value.stops||L.push(new Ye(a.key,a.value,'missing required property "stops"')),c==="exponential"&&a.valueSpec.expression&&!Jl(a.valueSpec)&&L.push(new Ye(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(I&&!Po(a.valueSpec)?L.push(new Ye(a.key,a.value,"property functions not supported")):T&&!Zh(a.valueSpec)&&L.push(new Ye(a.key,a.value,"zoom functions not supported"))),c!=="categorical"&&!E||a.value.property!==void 0||L.push(new Ye(a.key,a.value,'"property" property is required')),L;function F(q){let $=[];const Y=q.value,ne=q.key;if(si(Y)!=="array")return[new Ye(ne,Y,`array expected, ${si(Y)} found`)];if(Y.length!==2)return[new Ye(ne,Y,`array length 2 expected, length ${Y.length} found`)];if(E){if(si(Y[0])!=="object")return[new Ye(ne,Y,`object expected, ${si(Y[0])} found`)];if(Y[0].zoom===void 0)return[new Ye(ne,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new Ye(ne,Y,"object stop key must have value")];if(v&&v>Qi(Y[0].zoom))return[new Ye(ne,Y[0].zoom,"stop zoom values must appear in ascending order")];Qi(Y[0].zoom)!==v&&(v=Qi(Y[0].zoom),_=void 0,w={}),$=$.concat(Ts({key:`${ne}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:nc,value:N}}))}else $=$.concat(N({key:`${ne}[0]`,value:Y[0],valueSpec:{},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},Y));return vi(zr(Y[1]))?$.concat([new Ye(`${ne}[1]`,Y[1],"expressions are not allowed in function stops.")]):$.concat(q.validateSpec({key:`${ne}[1]`,value:Y[1],valueSpec:s,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function N(q,$){const Y=si(q.value),ne=Qi(q.value),le=q.value!==null?q.value:$;if(f){if(Y!==f)return[new Ye(q.key,le,`${Y} stop domain type must match previous stop domain type ${f}`)]}else f=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new Ye(q.key,le,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&c!=="categorical"){let ve=`number expected, ${Y} found`;return Po(s)&&c===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(q.key,le,ve)]}return c!=="categorical"||Y!=="number"||isFinite(ne)&&Math.floor(ne)===ne?c!=="categorical"&&Y==="number"&&_!==void 0&&ne<_?[new Ye(q.key,le,"stop domain values must appear in ascending order")]:(_=ne,c==="categorical"&&ne in w?[new Ye(q.key,le,"stop domain values must be unique")]:(w[ne]=!0,[])):[new Ye(q.key,le,`integer expected, found ${ne}`)]}}function Do(a){const s=(a.expressionContext==="property"?Xh:_i)(zr(a.value),a.valueSpec);if(s.result==="error")return s.value.map(f=>new Ye(`${a.key}${f.key}`,a.value,f.message));const c=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new Ye(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ha(c))return[new Ye(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ha(c))return[new Ye(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ga(c,["zoom","feature-state"]))return[new Ye(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!ca(c))return[new Ye(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kr(a){const s=a.key,c=a.value,f=a.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(Qi(c))===-1&&_.push(new Ye(s,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(Qi(c))===-1&&_.push(new Ye(s,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Lo(a){return Ql(zr(a.value))?Do(yn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pa(a)}function pa(a){const s=a.value,c=a.key;if(si(s)!=="array")return[new Ye(c,s,`array expected, ${si(s)} found`)];const f=a.styleSpec;let _,v=[];if(s.length<1)return[new Ye(c,s,"filter array must have at least 1 element")];switch(v=v.concat(Kr({key:`${c}[0]`,value:s[0],valueSpec:f.filter_operator,style:a.style,styleSpec:a.styleSpec})),Qi(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Qi(s[1])==="$type"&&v.push(new Ye(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&v.push(new Ye(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(_=si(s[1]),_!=="string"&&v.push(new Ye(`${c}[1]`,s[1],`string expected, ${_} found`)));for(let w=2;w<s.length;w++)_=si(s[w]),Qi(s[1])==="$type"?v=v.concat(Kr({key:`${c}[${w}]`,value:s[w],valueSpec:f.geometry_type,style:a.style,styleSpec:a.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new Ye(`${c}[${w}]`,s[w],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)v=v.concat(pa({key:`${c}[${w}]`,value:s[w],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":_=si(s[1]),s.length!==2?v.push(new Ye(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new Ye(`${c}[1]`,s[1],`string expected, ${_} found`));break;case"within":_=si(s[1]),s.length!==2?v.push(new Ye(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="object"&&v.push(new Ye(`${c}[1]`,s[1],`object expected, ${_} found`))}return v}function rc(a,s){const c=a.key,f=a.validateSpec,_=a.style,v=a.styleSpec,w=a.value,T=a.objectKey,I=v[`${s}_${a.layerType}`];if(!I)return[];const E=T.match(/^(.*)-transition$/);if(s==="paint"&&E&&I[E[1]]&&I[E[1]].transition)return f({key:c,value:w,valueSpec:v.transition,style:_,styleSpec:v});const L=a.valueSpec||I[T];if(!L)return[new Ye(c,w,`unknown property "${T}"`)];let F;if(si(w)==="string"&&Po(L)&&!L.tokens&&(F=/^{([^}]+)}$/.exec(w)))return[new Ye(c,w,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const N=[];return a.layerType==="symbol"&&(T==="text-field"&&_&&!_.glyphs&&N.push(new Ye(c,w,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Io(zr(w))&&Qi(w.type)==="identity"&&N.push(new Ye(c,w,'"text-font" does not support identity functions'))),N.concat(f({key:a.key,value:w,valueSpec:L,style:_,styleSpec:v,expressionContext:"property",propertyType:s,propertyKey:T}))}function rl(a){return rc(a,"paint")}function oc(a){return rc(a,"layout")}function ac(a){let s=[];const c=a.value,f=a.key,_=a.style,v=a.styleSpec;c.type||c.ref||s.push(new Ye(f,c,'either "type" or "ref" is required'));let w=Qi(c.type);const T=Qi(c.ref);if(c.id){const I=Qi(c.id);for(let E=0;E<a.arrayIndex;E++){const L=_.layers[E];Qi(L.id)===I&&s.push(new Ye(f,c.id,`duplicate layer id "${c.id}", previously used at line ${L.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(E=>{E in c&&s.push(new Ye(f,c[E],`"${E}" is prohibited for ref layers`))}),_.layers.forEach(E=>{Qi(E.id)===T&&(I=E)}),I?I.ref?s.push(new Ye(f,c.ref,"ref cannot reference another ref layer")):w=Qi(I.type):s.push(new Ye(f,c.ref,`ref layer "${T}" not found`))}else if(w!=="background")if(c.source){const I=_.sources&&_.sources[c.source],E=I&&Qi(I.type);I?E==="vector"&&w==="raster"?s.push(new Ye(f,c.source,`layer "${c.id}" requires a raster source`)):E!=="raster-dem"&&w==="hillshade"?s.push(new Ye(f,c.source,`layer "${c.id}" requires a raster-dem source`)):E==="raster"&&w!=="raster"?s.push(new Ye(f,c.source,`layer "${c.id}" requires a vector source`)):E!=="vector"||c["source-layer"]?E==="raster-dem"&&w!=="hillshade"?s.push(new Ye(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!c.paint||!c.paint["line-gradient"]||E==="geojson"&&I.lineMetrics||s.push(new Ye(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new Ye(f,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new Ye(f,c.source,`source "${c.source}" not found`))}else s.push(new Ye(f,c,'missing required property "source"'));return s=s.concat(Ts({key:f,value:c,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${f}.type`,value:c.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:c,objectKey:"type"}),filter:Lo,layout:I=>Ts({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":E=>oc(yn({layerType:w},E))}}),paint:I=>Ts({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":E=>rl(yn({layerType:w},E))}})}})),s}function cr(a){const s=a.value,c=a.key,f=si(s);return f!=="string"?[new Ye(c,s,`string expected, ${f} found`)]:[]}const tu={promoteId:function({key:a,value:s}){if(si(s)==="string")return cr({key:a,value:s});{const c=[];for(const f in s)c.push(...cr({key:`${a}.${f}`,value:s[f]}));return c}}};function iu(a){const s=a.value,c=a.key,f=a.styleSpec,_=a.style,v=a.validateSpec;if(!s.type)return[new Ye(c,s,'"type" is required')];const w=Qi(s.type);let T;switch(w){case"vector":case"raster":return T=Ts({key:c,value:s,valueSpec:f[`source_${w.replace("-","_")}`],style:a.style,styleSpec:f,objectElementValidators:tu,validateSpec:v}),T;case"raster-dem":return T=function(I){var E;const L=(E=I.sourceName)!==null&&E!==void 0?E:"",F=I.value,N=I.styleSpec,q=N.source_raster_dem,$=I.style;let Y=[];const ne=si(F);if(F===void 0)return Y;if(ne!=="object")return Y.push(new Ye("source_raster_dem",F,`object expected, ${ne} found`)),Y;const le=Qi(F.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],he=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const _e in F)!le&&ve.includes(_e)?Y.push(new Ye(_e,F[_e],`In "${L}": "${_e}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):q[_e]?Y=Y.concat(I.validateSpec({key:_e,value:F[_e],valueSpec:q[_e],validateSpec:I.validateSpec,style:$,styleSpec:N})):Y.push(new Ye(_e,F[_e],`unknown property "${_e}"`));return Y}({sourceName:c,value:s,style:a.style,styleSpec:f,validateSpec:v}),T;case"geojson":if(T=Ts({key:c,value:s,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:v,objectElementValidators:tu}),s.cluster)for(const I in s.clusterProperties){const[E,L]=s.clusterProperties[I],F=typeof E=="string"?[E,["accumulated"],["get",I]]:E;T.push(...Do({key:`${c}.${I}.map`,value:L,validateSpec:v,expressionContext:"cluster-map"})),T.push(...Do({key:`${c}.${I}.reduce`,value:F,validateSpec:v,expressionContext:"cluster-reduce"}))}return T;case"video":return Ts({key:c,value:s,valueSpec:f.source_video,style:_,validateSpec:v,styleSpec:f});case"image":return Ts({key:c,value:s,valueSpec:f.source_image,style:_,validateSpec:v,styleSpec:f});case"canvas":return[new Ye(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kr({key:`${c}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:v,styleSpec:f})}}function nu(a){const s=a.value,c=a.styleSpec,f=c.light,_=a.style;let v=[];const w=si(s);if(s===void 0)return v;if(w!=="object")return v=v.concat([new Ye("light",s,`object expected, ${w} found`)]),v;for(const T in s){const I=T.match(/^(.*)-transition$/);v=v.concat(I&&f[I[1]]&&f[I[1]].transition?a.validateSpec({key:T,value:s[T],valueSpec:c.transition,validateSpec:a.validateSpec,style:_,styleSpec:c}):f[T]?a.validateSpec({key:T,value:s[T],valueSpec:f[T],validateSpec:a.validateSpec,style:_,styleSpec:c}):[new Ye(T,s[T],`unknown property "${T}"`)])}return v}function su(a){const s=a.value,c=a.styleSpec,f=c.sky,_=a.style,v=si(s);if(s===void 0)return[];if(v!=="object")return[new Ye("sky",s,`object expected, ${v} found`)];let w=[];for(const T in s)w=w.concat(f[T]?Pn({key:T,value:s[T],valueSpec:f[T],style:_,styleSpec:c}):[new Ye(T,s[T],`unknown property "${T}"`)]);return w}function ru(a){const s=a.value,c=a.styleSpec,f=c.terrain,_=a.style;let v=[];const w=si(s);if(s===void 0)return v;if(w!=="object")return v=v.concat([new Ye("terrain",s,`object expected, ${w} found`)]),v;for(const T in s)v=v.concat(f[T]?a.validateSpec({key:T,value:s[T],valueSpec:f[T],validateSpec:a.validateSpec,style:_,styleSpec:c}):[new Ye(T,s[T],`unknown property "${T}"`)]);return v}function ma(a){let s=[];const c=a.value,f=a.key;if(Array.isArray(c)){const _=[],v=[];for(const w in c)c[w].id&&_.includes(c[w].id)&&s.push(new Ye(f,c,`all the sprites' ids must be unique, but ${c[w].id} is duplicated`)),_.push(c[w].id),c[w].url&&v.includes(c[w].url)&&s.push(new Ye(f,c,`all the sprites' URLs must be unique, but ${c[w].url} is duplicated`)),v.push(c[w].url),s=s.concat(Ts({key:`${f}[${w}]`,value:c[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return s}return cr({key:f,value:c})}const ga={"*":()=>[],array:zo,boolean:function(a){const s=a.value,c=a.key,f=si(s);return f!=="boolean"?[new Ye(c,s,`boolean expected, ${f} found`)]:[]},number:nc,color:function(a){const s=a.key,c=a.value,f=si(c);return f!=="string"?[new Ye(s,c,`color expected, ${f} found`)]:ei.parse(String(c))?[]:[new Ye(s,c,`color expected, "${c}" found`)]},constants:eu,enum:Kr,filter:Lo,function:sc,layer:ac,object:Ts,source:iu,light:nu,sky:su,terrain:ru,string:cr,formatted:function(a){return cr(a).length===0?[]:Do(a)},resolvedImage:function(a){return cr(a).length===0?[]:Do(a)},padding:function(a){const s=a.key,c=a.value;if(si(c)==="array"){if(c.length<1||c.length>4)return[new Ye(s,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let _=[];for(let v=0;v<c.length;v++)_=_.concat(a.validateSpec({key:`${s}[${v}]`,value:c[v],validateSpec:a.validateSpec,valueSpec:f}));return _}return nc({key:s,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(a){const s=a.key,c=a.value,f=si(c),_=a.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new Ye(s,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let w=0;w<c.length;w+=2)v=v.concat(Kr({key:`${s}[${w}]`,value:c[w],valueSpec:_.layout_symbol["text-anchor"]})),v=v.concat(zo({key:`${s}[${w+1}]`,value:c[w+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:_}));return v},sprite:ma};function Pn(a){const s=a.value,c=a.valueSpec,f=a.styleSpec;return a.validateSpec=Pn,c.expression&&Io(Qi(s))?sc(a):c.expression&&vi(zr(s))?Do(a):c.type&&ga[c.type]?ga[c.type](a):Ts(yn({},a,{valueSpec:c.type?f[c.type]:c}))}function Ro(a){const s=a.value,c=a.key,f=cr(a);return f.length||(s.indexOf("{fontstack}")===-1&&f.push(new Ye(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&f.push(new Ye(c,s,'"glyphs" url must include a "{range}" token'))),f}function Bs(a,s=De){let c=[];return c=c.concat(Pn({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,validateSpec:Pn,objectElementValidators:{glyphs:Ro,"*":()=>[]}})),a.constants&&(c=c.concat(eu({key:"constants",value:a.constants,style:a,styleSpec:s,validateSpec:Pn}))),ou(c)}function hr(a){return function(s){return a({...s,validateSpec:Pn})}}function ou(a){return[].concat(a).sort((s,c)=>s.line-c.line)}function ss(a){return function(...s){return ou(a.apply(this,s))}}Bs.source=ss(hr(iu)),Bs.sprite=ss(hr(ma)),Bs.glyphs=ss(hr(Ro)),Bs.light=ss(hr(nu)),Bs.sky=ss(hr(su)),Bs.terrain=ss(hr(ru)),Bs.layer=ss(hr(ac)),Bs.filter=ss(hr(Lo)),Bs.paintProperty=ss(hr(rl)),Bs.layoutProperty=ss(hr(oc));const Fo=Bs,lc=Fo.light,uf=Fo.paintProperty,cc=Fo.layoutProperty;function au(a,s){let c=!1;if(s&&s.length)for(const f of s)a.fire(new Fi(new Error(f.message))),c=!0;return c}class br{constructor(s,c,f){const _=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const w=new Int32Array(this.arrayBuffer);s=w[0],this.d=(c=w[1])+2*(f=w[2]);for(let I=0;I<this.d*this.d;I++){const E=w[3+I],L=w[3+I+1];_.push(E===L?null:w.subarray(E,L))}const T=w[3+_.length+1];this.keys=w.subarray(w[3+_.length],T),this.bboxes=w.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let w=0;w<this.d*this.d;w++)_.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=s,this.padding=f,this.scale=c/s,this.uid=0;const v=f/c*s;this.min=-v,this.max=s+v}insert(s,c,f,_,v){this._forEachCell(c,f,_,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,c,f,_,v,w){this.cells[v].push(w)}query(s,c,f,_,v){const w=this.min,T=this.max;if(s<=w&&c<=w&&T<=f&&T<=_&&!v)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(s,c,f,_,this._queryCell,I,{},v),I}}_queryCell(s,c,f,_,v,w,T,I){const E=this.cells[v];if(E!==null){const L=this.keys,F=this.bboxes;for(let N=0;N<E.length;N++){const q=E[N];if(T[q]===void 0){const $=4*q;(I?I(F[$+0],F[$+1],F[$+2],F[$+3]):s<=F[$+2]&&c<=F[$+3]&&f>=F[$+0]&&_>=F[$+1])?(T[q]=!0,w.push(L[q])):T[q]=!1}}}}_forEachCell(s,c,f,_,v,w,T,I){const E=this._convertToCellCoord(s),L=this._convertToCellCoord(c),F=this._convertToCellCoord(f),N=this._convertToCellCoord(_);for(let q=E;q<=F;q++)for(let $=L;$<=N;$++){const Y=this.d*$+q;if((!I||I(this._convertFromCellCoord(q),this._convertFromCellCoord($),this._convertFromCellCoord(q+1),this._convertFromCellCoord($+1)))&&v.call(this,s,c,f,_,Y,w,T,I))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,c=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const _=new Int32Array(c+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let v=c;for(let w=0;w<s.length;w++){const T=s[w];_[3+w]=v,_.set(T,v),v+=T.length}return _[3+s.length]=v,_.set(this.keys,v),v+=this.keys.length,_[3+s.length+1]=v,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer}static serialize(s,c){const f=s.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(s){return new br(s.buffer)}}const Dr={};function dt(a,s,c={}){if(Dr[a])throw new Error(`${a} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),Dr[a]={klass:s,omit:c.omit||[],shallow:c.shallow||[]}}dt("Object",Object),dt("TransferableGridIndex",br),dt("Color",ei),dt("Error",Error),dt("AJAXError",nt),dt("ResolvedImage",Rs),dt("StylePropertyFunction",tl),dt("StyleExpression",fa,{omit:["_evaluator"]}),dt("ZoomDependentExpression",el),dt("ZoomConstantExpression",Ao),dt("CompoundExpression",Fs,{omit:["_evaluate"]});for(const a in To)To[a]._classRegistryKey||dt(`Expression_${a}`,To[a]);function hc(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Yr(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error)return a;if(hc(a)||Qt(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){const c=a;return s&&s.push(c.buffer),c}if(a instanceof ImageData)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){const c=[];for(const f of a)c.push(Yr(f,s));return c}if(typeof a=="object"){const c=a.constructor,f=c._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!Dr[f])throw new Error(`${f} is not registered.`);const _=c.serialize?c.serialize(a,s):{};if(c.serialize){if(s&&_===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in a){if(!a.hasOwnProperty(v)||Dr[f].omit.indexOf(v)>=0)continue;const w=a[v];_[v]=Dr[f].shallow.indexOf(v)>=0?w:Yr(w,s)}a instanceof Error&&(_.message=a.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(_.$name=f),_}throw new Error("can't serialize object of type "+typeof a)}function Bo(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||hc(a)||Qt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Bo);if(typeof a=="object"){const s=a.$name||"Object";if(!Dr[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:c}=Dr[s];if(!c)throw new Error(`can't deserialize unregistered class ${s}`);if(c.deserialize)return c.deserialize(a);const f=Object.create(c.prototype);for(const _ of Object.keys(a)){if(_==="$name")continue;const v=a[_];f[_]=Dr[s].shallow.indexOf(_)>=0?v:Bo(v)}return f}throw new Error("can't deserialize object of type "+typeof a)}class uc{constructor(){this.first=!0}update(s,c){const f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))}}const at={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function _a(a){for(const s of a)if(al(s.charCodeAt(0)))return!0;return!1}function ol(a){for(const s of a)if(!lu(s.charCodeAt(0)))return!1;return!0}function lu(a){return!(at.Arabic(a)||at["Arabic Supplement"](a)||at["Arabic Extended-A"](a)||at["Arabic Presentation Forms-A"](a)||at["Arabic Presentation Forms-B"](a))}function al(a){return!(a!==746&&a!==747&&(a<4352||!(at["Bopomofo Extended"](a)||at.Bopomofo(a)||at["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||at["CJK Compatibility Ideographs"](a)||at["CJK Compatibility"](a)||at["CJK Radicals Supplement"](a)||at["CJK Strokes"](a)||!(!at["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||at["CJK Unified Ideographs Extension A"](a)||at["CJK Unified Ideographs"](a)||at["Enclosed CJK Letters and Months"](a)||at["Hangul Compatibility Jamo"](a)||at["Hangul Jamo Extended-A"](a)||at["Hangul Jamo Extended-B"](a)||at["Hangul Jamo"](a)||at["Hangul Syllables"](a)||at.Hiragana(a)||at["Ideographic Description Characters"](a)||at.Kanbun(a)||at["Kangxi Radicals"](a)||at["Katakana Phonetic Extensions"](a)||at.Katakana(a)&&a!==12540||!(!at["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!at["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||at["Unified Canadian Aboriginal Syllabics"](a)||at["Unified Canadian Aboriginal Syllabics Extended"](a)||at["Vertical Forms"](a)||at["Yijing Hexagram Symbols"](a)||at["Yi Syllables"](a)||at["Yi Radicals"](a))))}function dc(a){return!(al(a)||function(s){return!!(at["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||at["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||at["Letterlike Symbols"](s)||at["Number Forms"](s)||at["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||at["Control Pictures"](s)&&s!==9251||at["Optical Character Recognition"](s)||at["Enclosed Alphanumerics"](s)||at["Geometric Shapes"](s)||at["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||at["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||at["CJK Symbols and Punctuation"](s)||at.Katakana(s)||at["Private Use Area"](s)||at["CJK Compatibility Forms"](s)||at["Small Form Variants"](s)||at["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function fc(a){return a>=1424&&a<=2303||at["Arabic Presentation Forms-A"](a)||at["Arabic Presentation Forms-B"](a)}function pc(a,s){return!(!s&&fc(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||at.Khmer(a))}function cu(a){for(const s of a)if(fc(s.charCodeAt(0)))return!0;return!1}const Jr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Pi{constructor(s,c){this.zoom=s,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uc,this.transition={})}isSupportedScript(s){return function(c,f){for(const _ of c)if(!pc(_.charCodeAt(0),f))return!1;return!0}(s,Jr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,c=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class ll{constructor(s,c){this.property=s,this.value=c,this.expression=function(f,_){if(Io(f))return new tl(f,_);if(vi(f)){const v=Xh(f,_);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));return v.value}{let v=f;return _.type==="color"&&typeof f=="string"?v=ei.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(v=Fn.parse(f)):v=Ss.parse(f),{kind:"constant",evaluate:()=>v}}}(c===void 0?s.specification.default:c,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,c,f){return this.property.possiblyEvaluate(this,s,c,f)}}class cl{constructor(s){this.property=s,this.value=new ll(s,void 0)}transitioned(s,c){return new gc(this.property,this.value,c,xe({},s.transition,this.transition),s.now)}untransitioned(){return new gc(this.property,this.value,null,{},0)}}class mc{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Ve(this._values[s].value.value)}setValue(s,c){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new cl(this._values[s].property)),this._values[s].value=new ll(this._values[s].property,c===null?void 0:Ve(c))}getTransition(s){return Ve(this._values[s].transition)}setTransition(s,c){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new cl(this._values[s].property)),this._values[s].transition=Ve(c)||void 0}serialize(){const s={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(s[c]=f);const _=this.getTransition(c);_!==void 0&&(s[`${c}-transition`]=_)}return s}transitioned(s,c){const f=new hu(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(s,c._values[_]);return f}untransitioned(){const s=new hu(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].untransitioned();return s}}class gc{constructor(s,c,f,_,v){this.property=s,this.value=c,this.begin=v+_.delay||0,this.end=this.begin+_.duration||0,s.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(s,c,f){const _=s.now||0,v=this.value.possiblyEvaluate(s,c,f),w=this.prior;if(w){if(_>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(_<this.begin)return w.possiblyEvaluate(s,c,f);{const T=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(s,c,f),v,function(I){if(I<=0)return 0;if(I>=1)return 1;const E=I*I,L=E*I;return 4*(I<.5?L:3*(I-E)+L-.75)}(T))}}return v}}class hu{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,c,f){const _=new ya(this._properties);for(const v of Object.keys(this._values))_._values[v]=this._values[v].possiblyEvaluate(s,c,f);return _}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class df{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Ve(this._values[s].value)}setValue(s,c){this._values[s]=new ll(this._values[s].property,c===null?void 0:Ve(c))}serialize(){const s={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(s[c]=f)}return s}possiblyEvaluate(s,c,f){const _=new ya(this._properties);for(const v of Object.keys(this._values))_._values[v]=this._values[v].possiblyEvaluate(s,c,f);return _}}class $s{constructor(s,c,f){this.property=s,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,c,f,_){return this.property.evaluate(this.value,this.parameters,s,c,f,_)}}class ya{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class bt{constructor(s){this.specification=s}possiblyEvaluate(s,c){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(c)}interpolate(s,c,f){const _=Cs[this.specification.type];return _?_(s,c,f):s}}class Ct{constructor(s,c){this.specification=s,this.overrides=c}possiblyEvaluate(s,c,f,_){return new $s(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(c,null,{},f,_)}:s.expression,c)}interpolate(s,c,f){if(s.value.kind!=="constant"||c.value.kind!=="constant")return s;if(s.value.value===void 0||c.value.value===void 0)return new $s(this,{kind:"constant",value:void 0},s.parameters);const _=Cs[this.specification.type];if(_){const v=_(s.value.value,c.value.value,f);return new $s(this,{kind:"constant",value:v},s.parameters)}return s}evaluate(s,c,f,_,v,w){return s.kind==="constant"?s.value:s.evaluate(c,f,_,v,w)}}class Qr extends Ct{possiblyEvaluate(s,c,f,_){if(s.value===void 0)return new $s(this,{kind:"constant",value:void 0},c);if(s.expression.kind==="constant"){const v=s.expression.evaluate(c,null,{},f,_),w=s.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,T=this._calculate(w,w,w,c);return new $s(this,{kind:"constant",value:T},c)}if(s.expression.kind==="camera"){const v=this._calculate(s.expression.evaluate({zoom:c.zoom-1}),s.expression.evaluate({zoom:c.zoom}),s.expression.evaluate({zoom:c.zoom+1}),c);return new $s(this,{kind:"constant",value:v},c)}return new $s(this,s.expression,c)}evaluate(s,c,f,_,v,w){if(s.kind==="source"){const T=s.evaluate(c,f,_,v,w);return this._calculate(T,T,T,c)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(c.zoom)-1},f,_),s.evaluate({zoom:Math.floor(c.zoom)},f,_),s.evaluate({zoom:Math.floor(c.zoom)+1},f,_),c):s.value}_calculate(s,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:c}:{from:f,to:c}}interpolate(s){return s}}class _c{constructor(s){this.specification=s}possiblyEvaluate(s,c,f,_){if(s.value!==void 0){if(s.expression.kind==="constant"){const v=s.expression.evaluate(c,null,{},f,_);return this._calculate(v,v,v,c)}return this._calculate(s.expression.evaluate(new Pi(Math.floor(c.zoom-1),c)),s.expression.evaluate(new Pi(Math.floor(c.zoom),c)),s.expression.evaluate(new Pi(Math.floor(c.zoom+1),c)),c)}}_calculate(s,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:c}:{from:f,to:c}}interpolate(s){return s}}class ba{constructor(s){this.specification=s}possiblyEvaluate(s,c,f,_){return!!s.expression.evaluate(c,null,{},f,_)}interpolate(){return!1}}class rs{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in s){const f=s[c];f.specification.overridable&&this.overridableProperties.push(c);const _=this.defaultPropertyValues[c]=new ll(f,void 0),v=this.defaultTransitionablePropertyValues[c]=new cl(f);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=_.possiblyEvaluate({})}}}dt("DataDrivenProperty",Ct),dt("DataConstantProperty",bt),dt("CrossFadedDataDrivenProperty",Qr),dt("CrossFadedProperty",_c),dt("ColorRampProperty",ba);const uu="-transition";class Gs extends qs{constructor(s,c){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),c.layout&&(this._unevaluatedLayout=new df(c.layout)),c.paint)){this._transitionablePaint=new mc(c.paint);for(const f in s.paint)this.setPaintProperty(f,s.paint[f],{validate:!1});for(const f in s.layout)this.setLayoutProperty(f,s.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ya(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,c,f={}){c!=null&&this._validate(cc,`layers.${this.id}.layout.${s}`,s,c,f)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,c):this.visibility=c)}getPaintProperty(s){return s.endsWith(uu)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,c,f={}){if(c!=null&&this._validate(uf,`layers.${this.id}.paint.${s}`,s,c,f))return!1;if(s.endsWith(uu))return this._transitionablePaint.setTransition(s.slice(0,-11),c||void 0),!1;{const _=this._transitionablePaint._values[s],v=_.property.specification["property-type"]==="cross-faded-data-driven",w=_.value.isDataDriven(),T=_.value;this._transitionablePaint.setValue(s,c),this._handleSpecialPaintPropertyUpdate(s);const I=this._transitionablePaint._values[s].value;return I.isDataDriven()||w||v||this._handleOverridablePaintPropertyUpdate(s,T,I)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,c,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,c){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,c)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Ie(s,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(s,c,f,_,v={}){return(!v||v.validate!==!1)&&au(this,s.call(Fo,{key:c,layerType:this.type,objectKey:f,value:_,styleSpec:De,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const c=this.paint.get(s);if(c instanceof $s&&Po(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const du={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Oo{constructor(s,c){this._structArray=s,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,c){return s._trim(),c&&(s.isTransferred=!0,c.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const c=Object.create(this.prototype);return c.arrayBuffer=s.arrayBuffer,c.length=s.length,c.capacity=s.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function on(a,s=1){let c=0,f=0;return{members:a.map(_=>{const v=du[_.type].BYTES_PER_ELEMENT,w=c=fu(c,Math.max(s,v)),T=_.components||1;return f=Math.max(f,v),c+=v*T,{name:_.name,type:_.type,components:T,offset:w}}),size:fu(c,Math.max(f,s)),alignment:s}}function fu(a,s){return Math.ceil(a/s)*s}class xa extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c){const f=this.length;return this.resize(f+1),this.emplace(f,s,c)}emplace(s,c,f){const _=2*s;return this.int16[_+0]=c,this.int16[_+1]=f,s}}xa.prototype.bytesPerElement=4,dt("StructArrayLayout2i4",xa);class hl extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,c,f)}emplace(s,c,f,_){const v=3*s;return this.int16[v+0]=c,this.int16[v+1]=f,this.int16[v+2]=_,s}}hl.prototype.bytesPerElement=6,dt("StructArrayLayout3i6",hl);class Lr extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,c,f,_)}emplace(s,c,f,_,v){const w=4*s;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=_,this.int16[w+3]=v,s}}Lr.prototype.bytesPerElement=8,dt("StructArrayLayout4i8",Lr);class yc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,f,_,v,w)}emplace(s,c,f,_,v,w,T){const I=6*s;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=_,this.int16[I+3]=v,this.int16[I+4]=w,this.int16[I+5]=T,s}}yc.prototype.bytesPerElement=12,dt("StructArrayLayout2i4i12",yc);class bc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,f,_,v,w)}emplace(s,c,f,_,v,w,T){const I=4*s,E=8*s;return this.int16[I+0]=c,this.int16[I+1]=f,this.uint8[E+4]=_,this.uint8[E+5]=v,this.uint8[E+6]=w,this.uint8[E+7]=T,s}}bc.prototype.bytesPerElement=8,dt("StructArrayLayout2i4ub8",bc);class va extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c){const f=this.length;return this.resize(f+1),this.emplace(f,s,c)}emplace(s,c,f){const _=2*s;return this.float32[_+0]=c,this.float32[_+1]=f,s}}va.prototype.bytesPerElement=8,dt("StructArrayLayout2f8",va);class xc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w,T,I,E,L){const F=this.length;return this.resize(F+1),this.emplace(F,s,c,f,_,v,w,T,I,E,L)}emplace(s,c,f,_,v,w,T,I,E,L,F){const N=10*s;return this.uint16[N+0]=c,this.uint16[N+1]=f,this.uint16[N+2]=_,this.uint16[N+3]=v,this.uint16[N+4]=w,this.uint16[N+5]=T,this.uint16[N+6]=I,this.uint16[N+7]=E,this.uint16[N+8]=L,this.uint16[N+9]=F,s}}xc.prototype.bytesPerElement=20,dt("StructArrayLayout10ui20",xc);class ul extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w,T,I,E,L,F,N){const q=this.length;return this.resize(q+1),this.emplace(q,s,c,f,_,v,w,T,I,E,L,F,N)}emplace(s,c,f,_,v,w,T,I,E,L,F,N,q){const $=12*s;return this.int16[$+0]=c,this.int16[$+1]=f,this.int16[$+2]=_,this.int16[$+3]=v,this.uint16[$+4]=w,this.uint16[$+5]=T,this.uint16[$+6]=I,this.uint16[$+7]=E,this.int16[$+8]=L,this.int16[$+9]=F,this.int16[$+10]=N,this.int16[$+11]=q,s}}ul.prototype.bytesPerElement=24,dt("StructArrayLayout4i4ui4i24",ul);class vc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,c,f)}emplace(s,c,f,_){const v=3*s;return this.float32[v+0]=c,this.float32[v+1]=f,this.float32[v+2]=_,s}}vc.prototype.bytesPerElement=12,dt("StructArrayLayout3f12",vc);class wc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint32[1*s+0]=c,s}}wc.prototype.bytesPerElement=4,dt("StructArrayLayout1ul4",wc);class xr extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w,T,I,E){const L=this.length;return this.resize(L+1),this.emplace(L,s,c,f,_,v,w,T,I,E)}emplace(s,c,f,_,v,w,T,I,E,L){const F=10*s,N=5*s;return this.int16[F+0]=c,this.int16[F+1]=f,this.int16[F+2]=_,this.int16[F+3]=v,this.int16[F+4]=w,this.int16[F+5]=T,this.uint32[N+3]=I,this.uint16[F+8]=E,this.uint16[F+9]=L,s}}xr.prototype.bytesPerElement=20,dt("StructArrayLayout6i1ul2ui20",xr);class dl extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,f,_,v,w)}emplace(s,c,f,_,v,w,T){const I=6*s;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=_,this.int16[I+3]=v,this.int16[I+4]=w,this.int16[I+5]=T,s}}dl.prototype.bytesPerElement=12,dt("StructArrayLayout2i2i2i12",dl);class wa extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,s,c,f,_,v)}emplace(s,c,f,_,v,w){const T=4*s,I=8*s;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=_,this.int16[I+6]=v,this.int16[I+7]=w,s}}wa.prototype.bytesPerElement=16,dt("StructArrayLayout2f1f2i16",wa);class fl extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,c,f,_)}emplace(s,c,f,_,v){const w=12*s,T=3*s;return this.uint8[w+0]=c,this.uint8[w+1]=f,this.float32[T+1]=_,this.float32[T+2]=v,s}}fl.prototype.bytesPerElement=12,dt("StructArrayLayout2ub2f12",fl);class Vo extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,c,f)}emplace(s,c,f,_){const v=3*s;return this.uint16[v+0]=c,this.uint16[v+1]=f,this.uint16[v+2]=_,s}}Vo.prototype.bytesPerElement=6,dt("StructArrayLayout3ui6",Vo);class kc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w,T,I,E,L,F,N,q,$,Y,ne,le){const ve=this.length;return this.resize(ve+1),this.emplace(ve,s,c,f,_,v,w,T,I,E,L,F,N,q,$,Y,ne,le)}emplace(s,c,f,_,v,w,T,I,E,L,F,N,q,$,Y,ne,le,ve){const he=24*s,_e=12*s,Fe=48*s;return this.int16[he+0]=c,this.int16[he+1]=f,this.uint16[he+2]=_,this.uint16[he+3]=v,this.uint32[_e+2]=w,this.uint32[_e+3]=T,this.uint32[_e+4]=I,this.uint16[he+10]=E,this.uint16[he+11]=L,this.uint16[he+12]=F,this.float32[_e+7]=N,this.float32[_e+8]=q,this.uint8[Fe+36]=$,this.uint8[Fe+37]=Y,this.uint8[Fe+38]=ne,this.uint32[_e+10]=le,this.int16[he+22]=ve,s}}kc.prototype.bytesPerElement=48,dt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",kc);class No extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,_,v,w,T,I,E,L,F,N,q,$,Y,ne,le,ve,he,_e,Fe,Ue,ot,gt,rt,st,Qe,ft){const it=this.length;return this.resize(it+1),this.emplace(it,s,c,f,_,v,w,T,I,E,L,F,N,q,$,Y,ne,le,ve,he,_e,Fe,Ue,ot,gt,rt,st,Qe,ft)}emplace(s,c,f,_,v,w,T,I,E,L,F,N,q,$,Y,ne,le,ve,he,_e,Fe,Ue,ot,gt,rt,st,Qe,ft,it){const Xe=32*s,kt=16*s;return this.int16[Xe+0]=c,this.int16[Xe+1]=f,this.int16[Xe+2]=_,this.int16[Xe+3]=v,this.int16[Xe+4]=w,this.int16[Xe+5]=T,this.int16[Xe+6]=I,this.int16[Xe+7]=E,this.uint16[Xe+8]=L,this.uint16[Xe+9]=F,this.uint16[Xe+10]=N,this.uint16[Xe+11]=q,this.uint16[Xe+12]=$,this.uint16[Xe+13]=Y,this.uint16[Xe+14]=ne,this.uint16[Xe+15]=le,this.uint16[Xe+16]=ve,this.uint16[Xe+17]=he,this.uint16[Xe+18]=_e,this.uint16[Xe+19]=Fe,this.uint16[Xe+20]=Ue,this.uint16[Xe+21]=ot,this.uint16[Xe+22]=gt,this.uint32[kt+12]=rt,this.float32[kt+13]=st,this.float32[kt+14]=Qe,this.uint16[Xe+30]=ft,this.uint16[Xe+31]=it,s}}No.prototype.bytesPerElement=64,dt("StructArrayLayout8i15ui1ul2f2ui64",No);class Rr extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.float32[1*s+0]=c,s}}Rr.prototype.bytesPerElement=4,dt("StructArrayLayout1f4",Rr);class Sc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,c,f)}emplace(s,c,f,_){const v=3*s;return this.uint16[6*s+0]=c,this.float32[v+1]=f,this.float32[v+2]=_,s}}Sc.prototype.bytesPerElement=12,dt("StructArrayLayout1ui2f12",Sc);class pl extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,s,c,f)}emplace(s,c,f,_){const v=4*s;return this.uint32[2*s+0]=c,this.uint16[v+2]=f,this.uint16[v+3]=_,s}}pl.prototype.bytesPerElement=8,dt("StructArrayLayout1ul2ui8",pl);class eo extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c){const f=this.length;return this.resize(f+1),this.emplace(f,s,c)}emplace(s,c,f){const _=2*s;return this.uint16[_+0]=c,this.uint16[_+1]=f,s}}eo.prototype.bytesPerElement=4,dt("StructArrayLayout2ui4",eo);class Cc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint16[1*s+0]=c,s}}Cc.prototype.bytesPerElement=2,dt("StructArrayLayout1ui2",Cc);class Tc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,c,f,_)}emplace(s,c,f,_,v){const w=4*s;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,this.float32[w+3]=v,s}}Tc.prototype.bytesPerElement=16,dt("StructArrayLayout4f16",Tc);class Mc extends Oo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}Mc.prototype.size=20;class pu extends xr{get(s){return new Mc(this,s)}}dt("CollisionBoxArray",pu);class b extends Oo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}b.prototype.size=48;class r extends kc{get(s){return new b(this,s)}}dt("PlacedSymbolArray",r);class d extends Oo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class m extends No{get(s){return new d(this,s)}}dt("SymbolInstanceArray",m);class g extends Rr{getoffsetX(s){return this.float32[1*s+0]}}dt("GlyphOffsetArray",g);class x extends hl{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}dt("SymbolLineVertexArray",x);class M extends Oo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class P extends Sc{get(s){return new M(this,s)}}dt("TextAnchorOffsetArray",P);class A extends Oo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}A.prototype.size=8;class D extends pl{get(s){return new A(this,s)}}dt("FeatureIndexArray",D);class B extends xa{}class O extends xa{}class Z extends xa{}class te extends yc{}class ee extends bc{}class se extends va{}class K extends xc{}class fe extends ul{}class Te extends vc{}class oe extends wc{}class ye extends dl{}class Me extends fl{}class Pe extends Vo{}class ze extends eo{}const $e=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:He}=$e;class Ze{constructor(s=[]){this.segments=s}prepareSegment(s,c,f,_){let v=this.segments[this.segments.length-1];return s>Ze.MAX_VERTEX_ARRAY_LENGTH&&Oe(`Max vertices per segment is ${Ze.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!v||v.vertexLength+s>Ze.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==_)&&(v={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},_!==void 0&&(v.sortKey=_),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const s of this.segments)for(const c in s.vaos)s.vaos[c].destroy()}static simpleSegment(s,c,f,_){return new Ze([{vertexOffset:s,primitiveOffset:c,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function ut(a,s){return 256*(a=de(Math.floor(a),0,255))+de(Math.floor(s),0,255)}Ze.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dt("SegmentVector",Ze);const Rt=on([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var tt={exports:{}},Pt={exports:{}};Pt.exports=function(a,s){var c,f,_,v,w,T,I,E;for(f=a.length-(c=3&a.length),_=s,w=3432918353,T=461845907,E=0;E<f;)I=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24,++E,_=27492+(65535&(v=5*(65535&(_=(_^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&a.charCodeAt(E+2))<<16;case 2:I^=(255&a.charCodeAt(E+1))<<8;case 1:_^=I=(65535&(I=(I=(65535&(I^=255&a.charCodeAt(E)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var Bt=Pt.exports,Wt={exports:{}};Wt.exports=function(a,s){for(var c,f=a.length,_=s^f,v=0;f>=4;)c=1540483477*(65535&(c=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:_^=(255&a.charCodeAt(v+2))<<16;case 2:_^=(255&a.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var zt=Bt,Ot=Wt.exports;tt.exports=zt,tt.exports.murmur3=zt,tt.exports.murmur2=Ot;var Vt=p(tt.exports);class Bi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,c,f,_){this.ids.push(yi(s)),this.positions.push(c,f,_)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=yi(s);let f=0,_=this.ids.length-1;for(;f<_;){const w=f+_>>1;this.ids[w]>=c?_=w:f=w+1}const v=[];for(;this.ids[f]===c;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(s,c){const f=new Float64Array(s.ids),_=new Uint32Array(s.positions);return os(f,_,0,f.length-1),c&&c.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(s){const c=new Bi;return c.ids=s.ids,c.positions=s.positions,c.indexed=!0,c}}function yi(a){const s=+a;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:Vt(String(a))}function os(a,s,c,f){for(;c<f;){const _=a[c+f>>1];let v=c-1,w=f+1;for(;;){do v++;while(a[v]<_);do w--;while(a[w]>_);if(v>=w)break;dn(a,v,w),dn(s,3*v,3*w),dn(s,3*v+1,3*w+1),dn(s,3*v+2,3*w+2)}w-c<f-w?(os(a,s,c,w),c=w+1):(os(a,s,w+1,f),f=w)}}function dn(a,s,c){const f=a[s];a[s]=a[c],a[c]=f}dt("FeaturePositionMap",Bi);class wi{constructor(s,c){this.gl=s.gl,this.location=c}}class Bn extends wi{constructor(s,c){super(s,c),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Xs extends wi{constructor(s,c){super(s,c),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class ur extends wi{constructor(s,c){super(s,c),this.current=ei.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const to=new Float32Array(16);function io(a){return[ut(255*a.r,255*a.g),ut(255*a.b,255*a.a)]}class dr{constructor(s,c,f){this.value=s,this.uniformNames=c.map(_=>`u_${_}`),this.type=f}setUniform(s,c,f){s.set(f.constantOr(this.value))}getBinding(s,c,f){return this.type==="color"?new ur(s,c):new Bn(s,c)}}class Ks{constructor(s,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=s.tlbr}setUniform(s,c,f,_){const v=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&s.set(v)}getBinding(s,c,f){return f.substr(0,9)==="u_pattern"?new Xs(s,c):new Bn(s,c)}}class $i{constructor(s,c,f,_){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(s,c,f,_,v){const w=this.paintVertexArray.length,T=this.expression.evaluate(new Pi(0),c,{},_,[],v);this.paintVertexArray.resize(s),this._setPaintValue(w,s,T)}updatePaintArray(s,c,f,_){const v=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(s,c,v)}_setPaintValue(s,c,f){if(this.type==="color"){const _=io(f);for(let v=s;v<c;v++)this.paintVertexArray.emplace(v,_[0],_[1])}else{for(let _=s;_<c;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ii{constructor(s,c,f,_,v,w){this.expression=s,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(s,c,f,_,v){const w=this.expression.evaluate(new Pi(this.zoom),c,{},_,[],v),T=this.expression.evaluate(new Pi(this.zoom+1),c,{},_,[],v),I=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(I,s,w,T)}updatePaintArray(s,c,f,_){const v=this.expression.evaluate({zoom:this.zoom},f,_),w=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(s,c,v,w)}_setPaintValue(s,c,f,_){if(this.type==="color"){const v=io(f),w=io(_);for(let T=s;T<c;T++)this.paintVertexArray.emplace(T,v[0],v[1],w[0],w[1])}else{for(let v=s;v<c;v++)this.paintVertexArray.emplace(v,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,_=de(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(_)}getBinding(s,c,f){return new Bn(s,c)}}class en{constructor(s,c,f,_,v,w){this.expression=s,this.type=c,this.useIntegerZoom=f,this.zoom=_,this.layerId=w,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(s,c,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(_,s,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(s,c,f,_,v){this._setPaintValues(s,c,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(s,c,f,_){if(!_||!f)return;const{min:v,mid:w,max:T}=f,I=_[v],E=_[w],L=_[T];if(I&&E&&L)for(let F=s;F<c;F++)this.zoomInPaintVertexArray.emplace(F,E.tl[0],E.tl[1],E.br[0],E.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],E.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,E.tl[0],E.tl[1],E.br[0],E.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],E.pixelRatio,L.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Rt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Rt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Uo{constructor(s,c,f){this.binders={},this._buffers=[];const _=[];for(const v in s.paint._values){if(!f(v))continue;const w=s.paint.get(v);if(!(w instanceof $s&&Po(w.property.specification)))continue;const T=In(v,s.type),I=w.value,E=w.property.specification.type,L=w.property.useIntegerZoom,F=w.property.specification["property-type"],N=F==="cross-faded"||F==="cross-faded-data-driven";if(I.kind==="constant")this.binders[v]=N?new Ks(I.value,T):new dr(I.value,T,E),_.push(`/u_${v}`);else if(I.kind==="source"||N){const q=Ms(v,E,"source");this.binders[v]=N?new en(I,E,L,c,q,s.id):new $i(I,T,E,q),_.push(`/a_${v}`)}else{const q=Ms(v,E,"composite");this.binders[v]=new Ii(I,T,E,L,c,q),_.push(`/z_${v}`)}}this.cacheKey=_.sort().join("")}getMaxValue(s){const c=this.binders[s];return c instanceof $i||c instanceof Ii?c.maxValue:0}populatePaintArrays(s,c,f,_,v){for(const w in this.binders){const T=this.binders[w];(T instanceof $i||T instanceof Ii||T instanceof en)&&T.populatePaintArray(s,c,f,_,v)}}setConstantPatternPositions(s,c){for(const f in this.binders){const _=this.binders[f];_ instanceof Ks&&_.setConstantPatternPositions(s,c)}}updatePaintArrays(s,c,f,_,v){let w=!1;for(const T in s){const I=c.getPositions(T);for(const E of I){const L=f.feature(E.index);for(const F in this.binders){const N=this.binders[F];if((N instanceof $i||N instanceof Ii||N instanceof en)&&N.expression.isStateDependent===!0){const q=_.paint.get(F);N.expression=q.value,N.updatePaintArray(E.start,E.end,L,s[T],v),w=!0}}}}return w}defines(){const s=[];for(const c in this.binders){const f=this.binders[c];(f instanceof dr||f instanceof Ks)&&s.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return s}getBinderAttributes(){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof $i||f instanceof Ii)for(let _=0;_<f.paintVertexAttributes.length;_++)s.push(f.paintVertexAttributes[_].name);else if(f instanceof en)for(let _=0;_<Rt.members.length;_++)s.push(Rt.members[_].name)}return s}getBinderUniforms(){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof dr||f instanceof Ks||f instanceof Ii)for(const _ of f.uniformNames)s.push(_)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,c){const f=[];for(const _ in this.binders){const v=this.binders[_];if(v instanceof dr||v instanceof Ks||v instanceof Ii){for(const w of v.uniformNames)if(c[w]){const T=v.getBinding(s,c[w],w);f.push({name:w,property:_,binding:T})}}}return f}setUniforms(s,c,f,_){for(const{name:v,property:w,binding:T}of c)this.binders[w].setUniform(T,_,f.get(w),v)}updatePaintBuffers(s){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(s&&f instanceof en){const _=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof $i||f instanceof Ii)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(s){for(const c in this.binders){const f=this.binders[c];(f instanceof $i||f instanceof Ii||f instanceof en)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const c=this.binders[s];(c instanceof $i||c instanceof Ii||c instanceof en)&&c.destroy()}}}class Li{constructor(s,c,f=()=>!0){this.programConfigurations={};for(const _ of s)this.programConfigurations[_.id]=new Uo(_,c,f);this.needsUpload=!1,this._featureMap=new Bi,this._bufferOffset=0}populatePaintArrays(s,c,f,_,v,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(s,c,_,v,w);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,c,f,_){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(s,this._featureMap,c,v,_)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function In(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${s}-`,"").replace(/-/g,"_")]}function Ms(a,s,c){const f={color:{source:va,composite:Tc},number:{source:Rr,composite:va}},_=function(v){return{"line-pattern":{source:K,composite:K},"fill-pattern":{source:K,composite:K},"fill-extrusion-pattern":{source:K,composite:K}}[v]}(a);return _&&_[c]||f[s][c]}dt("ConstantBinder",dr),dt("CrossFadedConstantBinder",Ks),dt("SourceExpressionBinder",$i),dt("CrossFadedCompositeBinder",en),dt("CompositeExpressionBinder",Ii),dt("ProgramConfiguration",Uo,{omit:["_buffers"]}),dt("ProgramConfigurationSet",Li);const qt=8192,Pc=Math.pow(2,14)-1,mu=-Pc-1;function no(a){const s=qt/a.extent,c=a.loadGeometry();for(let f=0;f<c.length;f++){const _=c[f];for(let v=0;v<_.length;v++){const w=_[v],T=Math.round(w.x*s),I=Math.round(w.y*s);w.x=de(T,mu,Pc),w.y=de(I,mu,Pc),(T<w.x||T>w.x+1||I<w.y||I>w.y+1)&&Oe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function so(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?no(a):[]}}function ml(a,s,c,f,_){a.emplaceBack(2*s+(f+1)/2,2*c+(_+1)/2)}class Ic{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new O,this.indexArray=new Pe,this.segments=new Ze,this.programConfigurations=new Li(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(s,c,f){const _=this.layers[0],v=[];let w=null,T=!1;_.type==="circle"&&(w=_.layout.get("circle-sort-key"),T=!w.isConstant());for(const{feature:I,id:E,index:L,sourceLayerIndex:F}of s){const N=this.layers[0]._featureFilter.needGeometry,q=so(I,N);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),q,f))continue;const $=T?w.evaluate(q,{},f):void 0,Y={id:E,properties:I.properties,type:I.type,sourceLayerIndex:F,index:L,geometry:N?q.geometry:no(I),patterns:{},sortKey:$};v.push(Y)}T&&v.sort((I,E)=>I.sortKey-E.sortKey);for(const I of v){const{geometry:E,index:L,sourceLayerIndex:F}=I,N=s[L].feature;this.addFeature(I,E,L,f),c.featureIndex.insert(N,E,L,F,this.index)}}update(s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,He),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,c,f,_){for(const v of c)for(const w of v){const T=w.x,I=w.y;if(T<0||T>=qt||I<0||I>=qt)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),L=E.vertexLength;ml(this.layoutVertexArray,T,I,-1,-1),ml(this.layoutVertexArray,T,I,1,-1),ml(this.layoutVertexArray,T,I,1,1),ml(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},_)}}function ro(a,s){for(let c=0;c<a.length;c++)if(gl(s,a[c]))return!0;for(let c=0;c<s.length;c++)if(gl(a,s[c]))return!0;return!!ka(a,s)}function gu(a,s,c){return!!gl(a,s)||!!Sa(s,a,c)}function Ac(a,s){if(a.length===1)return Sm(s,a[0]);for(let c=0;c<s.length;c++){const f=s[c];for(let _=0;_<f.length;_++)if(gl(a,f[_]))return!0}for(let c=0;c<a.length;c++)if(Sm(s,a[c]))return!0;for(let c=0;c<s.length;c++)if(ka(a,s[c]))return!0;return!1}function _u(a,s,c){if(a.length>1){if(ka(a,s))return!0;for(let f=0;f<s.length;f++)if(Sa(s[f],a,c))return!0}for(let f=0;f<a.length;f++)if(Sa(a[f],s,c))return!0;return!1}function ka(a,s){if(a.length===0||s.length===0)return!1;for(let c=0;c<a.length-1;c++){const f=a[c],_=a[c+1];for(let v=0;v<s.length-1;v++)if(yu(f,_,s[v],s[v+1]))return!0}return!1}function yu(a,s,c,f){return It(a,c,f)!==It(s,c,f)&&It(a,s,c)!==It(a,s,f)}function Sa(a,s,c){const f=c*c;if(s.length===1)return a.distSqr(s[0])<f;for(let _=1;_<s.length;_++)if(km(a,s[_-1],s[_])<f)return!0;return!1}function km(a,s,c){const f=s.distSqr(c);if(f===0)return a.distSqr(s);const _=((a.x-s.x)*(c.x-s.x)+(a.y-s.y)*(c.y-s.y))/f;return a.distSqr(_<0?s:_>1?c:c.sub(s)._mult(_)._add(s))}function Sm(a,s){let c,f,_,v=!1;for(let w=0;w<a.length;w++){c=a[w];for(let T=0,I=c.length-1;T<c.length;I=T++)f=c[T],_=c[I],f.y>s.y!=_.y>s.y&&s.x<(_.x-f.x)*(s.y-f.y)/(_.y-f.y)+f.x&&(v=!v)}return v}function gl(a,s){let c=!1;for(let f=0,_=a.length-1;f<a.length;_=f++){const v=a[f],w=a[_];v.y>s.y!=w.y>s.y&&s.x<(w.x-v.x)*(s.y-v.y)/(w.y-v.y)+v.x&&(c=!c)}return c}function kb(a,s,c){const f=c[0],_=c[2];if(a.x<f.x&&s.x<f.x||a.x>_.x&&s.x>_.x||a.y<f.y&&s.y<f.y||a.y>_.y&&s.y>_.y)return!1;const v=It(a,s,c[0]);return v!==It(a,s,c[1])||v!==It(a,s,c[2])||v!==It(a,s,c[3])}function Ec(a,s,c){const f=s.paint.get(a).value;return f.kind==="constant"?f.value:c.programConfigurations.get(s.id).getMaxValue(a)}function bu(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function xu(a,s,c,f,_){if(!s[0]&&!s[1])return a;const v=C.convert(s)._mult(_);c==="viewport"&&v._rotate(-f);const w=[];for(let T=0;T<a.length;T++)w.push(a[T].sub(v));return w}let Cm,Tm;dt("CircleBucket",Ic,{omit:["layers"]});var Sb={get paint(){return Tm=Tm||new rs({"circle-radius":new Ct(De.paint_circle["circle-radius"]),"circle-color":new Ct(De.paint_circle["circle-color"]),"circle-blur":new Ct(De.paint_circle["circle-blur"]),"circle-opacity":new Ct(De.paint_circle["circle-opacity"]),"circle-translate":new bt(De.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ct(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ct(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ct(De.paint_circle["circle-stroke-opacity"])})},get layout(){return Cm=Cm||new rs({"circle-sort-key":new Ct(De.layout_circle["circle-sort-key"])})}},as=1e-6,_l=typeof Float32Array<"u"?Float32Array:Array;function ff(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Mm(a,s,c){var f=s[0],_=s[1],v=s[2],w=s[3],T=s[4],I=s[5],E=s[6],L=s[7],F=s[8],N=s[9],q=s[10],$=s[11],Y=s[12],ne=s[13],le=s[14],ve=s[15],he=c[0],_e=c[1],Fe=c[2],Ue=c[3];return a[0]=he*f+_e*T+Fe*F+Ue*Y,a[1]=he*_+_e*I+Fe*N+Ue*ne,a[2]=he*v+_e*E+Fe*q+Ue*le,a[3]=he*w+_e*L+Fe*$+Ue*ve,a[4]=(he=c[4])*f+(_e=c[5])*T+(Fe=c[6])*F+(Ue=c[7])*Y,a[5]=he*_+_e*I+Fe*N+Ue*ne,a[6]=he*v+_e*E+Fe*q+Ue*le,a[7]=he*w+_e*L+Fe*$+Ue*ve,a[8]=(he=c[8])*f+(_e=c[9])*T+(Fe=c[10])*F+(Ue=c[11])*Y,a[9]=he*_+_e*I+Fe*N+Ue*ne,a[10]=he*v+_e*E+Fe*q+Ue*le,a[11]=he*w+_e*L+Fe*$+Ue*ve,a[12]=(he=c[12])*f+(_e=c[13])*T+(Fe=c[14])*F+(Ue=c[15])*Y,a[13]=he*_+_e*I+Fe*N+Ue*ne,a[14]=he*v+_e*E+Fe*q+Ue*le,a[15]=he*w+_e*L+Fe*$+Ue*ve,a}Math.hypot||(Math.hypot=function(){for(var a=0,s=arguments.length;s--;)a+=arguments[s]*arguments[s];return Math.sqrt(a)});var zc,Cb=Mm;function vu(a,s,c){var f=s[0],_=s[1],v=s[2],w=s[3];return a[0]=c[0]*f+c[4]*_+c[8]*v+c[12]*w,a[1]=c[1]*f+c[5]*_+c[9]*v+c[13]*w,a[2]=c[2]*f+c[6]*_+c[10]*v+c[14]*w,a[3]=c[3]*f+c[7]*_+c[11]*v+c[15]*w,a}zc=new _l(4),_l!=Float32Array&&(zc[0]=0,zc[1]=0,zc[2]=0,zc[3]=0);class Tb extends Gs{constructor(s){super(s,Sb)}createBucket(s){return new Ic(s)}queryRadius(s){const c=s;return Ec("circle-radius",this,c)+Ec("circle-stroke-width",this,c)+bu(this.paint.get("circle-translate"))}queryIntersectsFeature(s,c,f,_,v,w,T,I){const E=xu(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,T),L=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),F=this.paint.get("circle-pitch-alignment")==="map",N=F?E:function($,Y){return $.map(ne=>Pm(ne,Y))}(E,I),q=F?L*T:L;for(const $ of _)for(const Y of $){const ne=F?Y:Pm(Y,I);let le=q;const ve=vu([],[Y.x,Y.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=ve[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=w.cameraToCenterDistance/ve[3]),gu(N,ne,le))return!0}return!1}}function Pm(a,s){const c=vu([],[a.x,a.y,0,1],s);return new C(c[0]/c[3],c[1]/c[3])}class Im extends Ic{}let Am;dt("HeatmapBucket",Im,{omit:["layers"]});var Mb={get paint(){return Am=Am||new rs({"heatmap-radius":new Ct(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ct(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ba(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(De.paint_heatmap["heatmap-opacity"])})}};function pf(a,{width:s,height:c},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==s*c*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${s*c*f}`)}else _=new Uint8Array(s*c*f);return a.width=s,a.height=c,a.data=_,a}function Em(a,{width:s,height:c},f){if(s===a.width&&c===a.height)return;const _=pf({},{width:s,height:c},f);mf(a,_,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,s),height:Math.min(a.height,c)},f),a.width=s,a.height=c,a.data=_.data}function mf(a,s,c,f,_,v){if(_.width===0||_.height===0)return s;if(_.width>a.width||_.height>a.height||c.x>a.width-_.width||c.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||f.x>s.width-_.width||f.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const w=a.data,T=s.data;if(w===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<_.height;I++){const E=((c.y+I)*a.width+c.x)*v,L=((f.y+I)*s.width+f.x)*v;for(let F=0;F<_.width*v;F++)T[L+F]=w[E+F]}return s}class Dc{constructor(s,c){pf(this,s,1,c)}resize(s){Em(this,s,1)}clone(){return new Dc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,c,f,_,v){mf(s,c,f,_,v,1)}}class Ys{constructor(s,c){pf(this,s,4,c)}resize(s){Em(this,s,4)}replace(s,c){c?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,c,f,_,v){mf(s,c,f,_,v,4)}}function zm(a){const s={},c=a.resolution||256,f=a.clips?a.clips.length:1,_=a.image||new Ys({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const v=(w,T,I)=>{s[a.evaluationKey]=I;const E=a.expression.evaluate(s);_.data[w+T+0]=Math.floor(255*E.r/E.a),_.data[w+T+1]=Math.floor(255*E.g/E.a),_.data[w+T+2]=Math.floor(255*E.b/E.a),_.data[w+T+3]=Math.floor(255*E.a)};if(a.clips)for(let w=0,T=0;w<f;++w,T+=4*c)for(let I=0,E=0;I<c;I++,E+=4){const L=I/(c-1),{start:F,end:N}=a.clips[w];v(T,E,F*(1-L)+N*L)}else for(let w=0,T=0;w<c;w++,T+=4)v(0,T,w/(c-1));return _}dt("AlphaImage",Dc),dt("RGBAImage",Ys);class Pb extends Gs{createBucket(s){return new Im(s)}constructor(s){super(s,Mb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=zm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Dm;var Ib={get paint(){return Dm=Dm||new rs({"hillshade-illumination-direction":new bt(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(De.paint_hillshade["hillshade-accent-color"])})}};class Ab extends Gs{constructor(s){super(s,Ib)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Eb=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:zb}=Eb;var gf={exports:{}};function wu(a,s,c){c=c||2;var f,_,v,w,T,I,E,L=s&&s.length,F=L?s[0]*c:a.length,N=Lm(a,0,F,c,!0),q=[];if(!N||N.next===N.prev)return q;if(L&&(N=function(Y,ne,le,ve){var he,_e,Fe,Ue=[];for(he=0,_e=ne.length;he<_e;he++)(Fe=Lm(Y,ne[he]*ve,he<_e-1?ne[he+1]*ve:Y.length,ve,!1))===Fe.next&&(Fe.steiner=!0),Ue.push(Nb(Fe));for(Ue.sort(Bb),he=0;he<Ue.length;he++)le=Ob(Ue[he],le);return le}(a,s,N,c)),a.length>80*c){f=v=a[0],_=w=a[1];for(var $=c;$<F;$+=c)(T=a[$])<f&&(f=T),(I=a[$+1])<_&&(_=I),T>v&&(v=T),I>w&&(w=I);E=(E=Math.max(v-f,w-_))!==0?32767/E:0}return Lc(N,q,c,f,_,E,0),q}function Lm(a,s,c,f,_){var v,w;if(_===bf(a,s,c,f)>0)for(v=s;v<c;v+=f)w=Bm(v,a[v],a[v+1],w);else for(v=c-f;v>=s;v-=f)w=Bm(v,a[v],a[v+1],w);return w&&ku(w,w.next)&&(Fc(w),w=w.next),w}function Ca(a,s){if(!a)return a;s||(s=a);var c,f=a;do if(c=!1,f.steiner||!ku(f,f.next)&&an(f.prev,f,f.next)!==0)f=f.next;else{if(Fc(f),(f=s=f.prev)===f.next)break;c=!0}while(c||f!==s);return s}function Lc(a,s,c,f,_,v,w){if(a){!w&&v&&function(L,F,N,q){var $=L;do $.z===0&&($.z=_f($.x,$.y,F,N,q)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==L);$.prevZ.nextZ=null,$.prevZ=null,function(Y){var ne,le,ve,he,_e,Fe,Ue,ot,gt=1;do{for(le=Y,Y=null,_e=null,Fe=0;le;){for(Fe++,ve=le,Ue=0,ne=0;ne<gt&&(Ue++,ve=ve.nextZ);ne++);for(ot=gt;Ue>0||ot>0&&ve;)Ue!==0&&(ot===0||!ve||le.z<=ve.z)?(he=le,le=le.nextZ,Ue--):(he=ve,ve=ve.nextZ,ot--),_e?_e.nextZ=he:Y=he,he.prevZ=_e,_e=he;le=ve}_e.nextZ=null,gt*=2}while(Fe>1)}($)}(a,f,_,v);for(var T,I,E=a;a.prev!==a.next;)if(T=a.prev,I=a.next,v?Lb(a,f,_,v):Db(a))s.push(T.i/c|0),s.push(a.i/c|0),s.push(I.i/c|0),Fc(a),a=I.next,E=I.next;else if((a=I)===E){w?w===1?Lc(a=Rb(Ca(a),s,c),s,c,f,_,v,2):w===2&&Fb(a,s,c,f,_,v):Lc(Ca(a),s,c,f,_,v,1);break}}}function Db(a){var s=a.prev,c=a,f=a.next;if(an(s,c,f)>=0)return!1;for(var _=s.x,v=c.x,w=f.x,T=s.y,I=c.y,E=f.y,L=_<v?_<w?_:w:v<w?v:w,F=T<I?T<E?T:E:I<E?I:E,N=_>v?_>w?_:w:v>w?v:w,q=T>I?T>E?T:E:I>E?I:E,$=f.next;$!==s;){if($.x>=L&&$.x<=N&&$.y>=F&&$.y<=q&&yl(_,T,v,I,w,E,$.x,$.y)&&an($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Lb(a,s,c,f){var _=a.prev,v=a,w=a.next;if(an(_,v,w)>=0)return!1;for(var T=_.x,I=v.x,E=w.x,L=_.y,F=v.y,N=w.y,q=T<I?T<E?T:E:I<E?I:E,$=L<F?L<N?L:N:F<N?F:N,Y=T>I?T>E?T:E:I>E?I:E,ne=L>F?L>N?L:N:F>N?F:N,le=_f(q,$,s,c,f),ve=_f(Y,ne,s,c,f),he=a.prevZ,_e=a.nextZ;he&&he.z>=le&&_e&&_e.z<=ve;){if(he.x>=q&&he.x<=Y&&he.y>=$&&he.y<=ne&&he!==_&&he!==w&&yl(T,L,I,F,E,N,he.x,he.y)&&an(he.prev,he,he.next)>=0||(he=he.prevZ,_e.x>=q&&_e.x<=Y&&_e.y>=$&&_e.y<=ne&&_e!==_&&_e!==w&&yl(T,L,I,F,E,N,_e.x,_e.y)&&an(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;he&&he.z>=le;){if(he.x>=q&&he.x<=Y&&he.y>=$&&he.y<=ne&&he!==_&&he!==w&&yl(T,L,I,F,E,N,he.x,he.y)&&an(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;_e&&_e.z<=ve;){if(_e.x>=q&&_e.x<=Y&&_e.y>=$&&_e.y<=ne&&_e!==_&&_e!==w&&yl(T,L,I,F,E,N,_e.x,_e.y)&&an(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function Rb(a,s,c){var f=a;do{var _=f.prev,v=f.next.next;!ku(_,v)&&Rm(_,f,f.next,v)&&Rc(_,v)&&Rc(v,_)&&(s.push(_.i/c|0),s.push(f.i/c|0),s.push(v.i/c|0),Fc(f),Fc(f.next),f=a=v),f=f.next}while(f!==a);return Ca(f)}function Fb(a,s,c,f,_,v){var w=a;do{for(var T=w.next.next;T!==w.prev;){if(w.i!==T.i&&Ub(w,T)){var I=Fm(w,T);return w=Ca(w,w.next),I=Ca(I,I.next),Lc(w,s,c,f,_,v,0),void Lc(I,s,c,f,_,v,0)}T=T.next}w=w.next}while(w!==a)}function Bb(a,s){return a.x-s.x}function Ob(a,s){var c=function(_,v){var w,T=v,I=_.x,E=_.y,L=-1/0;do{if(E<=T.y&&E>=T.next.y&&T.next.y!==T.y){var F=T.x+(E-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(F<=I&&F>L&&(L=F,w=T.x<T.next.x?T:T.next,F===I))return w}T=T.next}while(T!==v);if(!w)return null;var N,q=w,$=w.x,Y=w.y,ne=1/0;T=w;do I>=T.x&&T.x>=$&&I!==T.x&&yl(E<Y?I:L,E,$,Y,E<Y?L:I,E,T.x,T.y)&&(N=Math.abs(E-T.y)/(I-T.x),Rc(T,_)&&(N<ne||N===ne&&(T.x>w.x||T.x===w.x&&Vb(w,T)))&&(w=T,ne=N)),T=T.next;while(T!==q);return w}(a,s);if(!c)return s;var f=Fm(c,a);return Ca(f,f.next),Ca(c,c.next)}function Vb(a,s){return an(a.prev,a,s.prev)<0&&an(s.next,a,a.next)<0}function _f(a,s,c,f,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-c)*_|0)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Nb(a){var s=a,c=a;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==a);return c}function yl(a,s,c,f,_,v,w,T){return(_-w)*(s-T)>=(a-w)*(v-T)&&(a-w)*(f-T)>=(c-w)*(s-T)&&(c-w)*(v-T)>=(_-w)*(f-T)}function Ub(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(c,f){var _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==f.i&&_.next.i!==f.i&&Rm(_,_.next,c,f))return!0;_=_.next}while(_!==c);return!1}(a,s)&&(Rc(a,s)&&Rc(s,a)&&function(c,f){var _=c,v=!1,w=(c.x+f.x)/2,T=(c.y+f.y)/2;do _.y>T!=_.next.y>T&&_.next.y!==_.y&&w<(_.next.x-_.x)*(T-_.y)/(_.next.y-_.y)+_.x&&(v=!v),_=_.next;while(_!==c);return v}(a,s)&&(an(a.prev,a,s.prev)||an(a,s.prev,s))||ku(a,s)&&an(a.prev,a,a.next)>0&&an(s.prev,s,s.next)>0)}function an(a,s,c){return(s.y-a.y)*(c.x-s.x)-(s.x-a.x)*(c.y-s.y)}function ku(a,s){return a.x===s.x&&a.y===s.y}function Rm(a,s,c,f){var _=Cu(an(a,s,c)),v=Cu(an(a,s,f)),w=Cu(an(c,f,a)),T=Cu(an(c,f,s));return _!==v&&w!==T||!(_!==0||!Su(a,c,s))||!(v!==0||!Su(a,f,s))||!(w!==0||!Su(c,a,f))||!(T!==0||!Su(c,s,f))}function Su(a,s,c){return s.x<=Math.max(a.x,c.x)&&s.x>=Math.min(a.x,c.x)&&s.y<=Math.max(a.y,c.y)&&s.y>=Math.min(a.y,c.y)}function Cu(a){return a>0?1:a<0?-1:0}function Rc(a,s){return an(a.prev,a,a.next)<0?an(a,s,a.next)>=0&&an(a,a.prev,s)>=0:an(a,s,a.prev)<0||an(a,a.next,s)<0}function Fm(a,s){var c=new yf(a.i,a.x,a.y),f=new yf(s.i,s.x,s.y),_=a.next,v=s.prev;return a.next=s,s.prev=a,c.next=_,_.prev=c,f.next=c,c.prev=f,v.next=f,f.prev=v,f}function Bm(a,s,c,f){var _=new yf(a,s,c);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function Fc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function yf(a,s,c){this.i=a,this.x=s,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bf(a,s,c,f){for(var _=0,v=s,w=c-f;v<c;v+=f)_+=(a[w]-a[v])*(a[v+1]+a[w+1]),w=v;return _}gf.exports=wu,gf.exports.default=wu,wu.deviation=function(a,s,c,f){var _=s&&s.length,v=Math.abs(bf(a,0,_?s[0]*c:a.length,c));if(_)for(var w=0,T=s.length;w<T;w++)v-=Math.abs(bf(a,s[w]*c,w<T-1?s[w+1]*c:a.length,c));var I=0;for(w=0;w<f.length;w+=3){var E=f[w]*c,L=f[w+1]*c,F=f[w+2]*c;I+=Math.abs((a[E]-a[F])*(a[L+1]-a[E+1])-(a[E]-a[L])*(a[F+1]-a[E+1]))}return v===0&&I===0?0:Math.abs((I-v)/v)},wu.flatten=function(a){for(var s=a[0][0].length,c={vertices:[],holes:[],dimensions:s},f=0,_=0;_<a.length;_++){for(var v=0;v<a[_].length;v++)for(var w=0;w<s;w++)c.vertices.push(a[_][v][w]);_>0&&c.holes.push(f+=a[_-1].length)}return c};var Om=p(gf.exports);function jb(a,s,c,f,_){Vm(a,s,c||0,f||a.length-1,_||qb)}function Vm(a,s,c,f,_){for(;f>c;){if(f-c>600){var v=f-c+1,w=s-c+1,T=Math.log(v),I=.5*Math.exp(2*T/3),E=.5*Math.sqrt(T*I*(v-I)/v)*(w-v/2<0?-1:1);Vm(a,s,Math.max(c,Math.floor(s-w*I/v+E)),Math.min(f,Math.floor(s+(v-w)*I/v+E)),_)}var L=a[s],F=c,N=f;for(Bc(a,c,s),_(a[f],L)>0&&Bc(a,c,f);F<N;){for(Bc(a,F,N),F++,N--;_(a[F],L)<0;)F++;for(;_(a[N],L)>0;)N--}_(a[c],L)===0?Bc(a,c,N):Bc(a,++N,f),N<=s&&(c=N+1),s<=N&&(f=N-1)}}function Bc(a,s,c){var f=a[s];a[s]=a[c],a[c]=f}function qb(a,s){return a<s?-1:a>s?1:0}function xf(a,s){const c=a.length;if(c<=1)return[a];const f=[];let _,v;for(let w=0;w<c;w++){const T=mt(a[w]);T!==0&&(a[w].area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(_&&f.push(_),_=[a[w]]):_.push(a[w]))}if(_&&f.push(_),s>1)for(let w=0;w<f.length;w++)f[w].length<=s||(jb(f[w],s,1,f[w].length-1,Hb),f[w]=f[w].slice(0,s));return f}function Hb(a,s){return s.area-a.area}function vf(a,s,c){const f=c.patternDependencies;let _=!1;for(const v of s){const w=v.paint.get(`${a}-pattern`);w.isConstant()||(_=!0);const T=w.constantOr(null);T&&(_=!0,f[T.to]=!0,f[T.from]=!0)}return _}function wf(a,s,c,f,_){const v=_.patternDependencies;for(const w of s){const T=w.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:f-1},c,{},_.availableImages),E=T.evaluate({zoom:f},c,{},_.availableImages),L=T.evaluate({zoom:f+1},c,{},_.availableImages);I=I&&I.name?I.name:I,E=E&&E.name?E.name:E,L=L&&L.name?L.name:L,v[I]=!0,v[E]=!0,v[L]=!0,c.patterns[w.id]={min:I,mid:E,max:L}}}return c}class kf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Z,this.indexArray=new Pe,this.indexArray2=new ze,this.programConfigurations=new Li(s.layers,s.zoom),this.segments=new Ze,this.segments2=new Ze,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(s,c,f){this.hasPattern=vf("fill",this.layers,c);const _=this.layers[0].layout.get("fill-sort-key"),v=!_.isConstant(),w=[];for(const{feature:T,id:I,index:E,sourceLayerIndex:L}of s){const F=this.layers[0]._featureFilter.needGeometry,N=so(T,F);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),N,f))continue;const q=v?_.evaluate(N,{},f,c.availableImages):void 0,$={id:I,properties:T.properties,type:T.type,sourceLayerIndex:L,index:E,geometry:F?N.geometry:no(T),patterns:{},sortKey:q};w.push($)}v&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:E,sourceLayerIndex:L}=T;if(this.hasPattern){const F=wf("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(T,I,E,f,{});c.featureIndex.insert(s[E].feature,I,E,L,this.index)}}update(s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,c,this.stateDependentLayers,f)}addFeatures(s,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,zb),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,c,f,_,v){for(const w of xf(c,500)){let T=0;for(const q of w)T+=q.length;const I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),E=I.vertexLength,L=[],F=[];for(const q of w){if(q.length===0)continue;q!==w[0]&&F.push(L.length/2);const $=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),Y=$.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(Y+q.length-1,Y),L.push(q[0].x),L.push(q[0].y);for(let ne=1;ne<q.length;ne++)this.layoutVertexArray.emplaceBack(q[ne].x,q[ne].y),this.indexArray2.emplaceBack(Y+ne-1,Y+ne),L.push(q[ne].x),L.push(q[ne].y);$.vertexLength+=q.length,$.primitiveLength+=q.length}const N=Om(L,F);for(let q=0;q<N.length;q+=3)this.indexArray.emplaceBack(E+N[q],E+N[q+1],E+N[q+2]);I.vertexLength+=T,I.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,_)}}let Nm,Um;dt("FillBucket",kf,{omit:["layers","patternFeatures"]});var Wb={get paint(){return Um=Um||new rs({"fill-antialias":new bt(De.paint_fill["fill-antialias"]),"fill-opacity":new Ct(De.paint_fill["fill-opacity"]),"fill-color":new Ct(De.paint_fill["fill-color"]),"fill-outline-color":new Ct(De.paint_fill["fill-outline-color"]),"fill-translate":new bt(De.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qr(De.paint_fill["fill-pattern"])})},get layout(){return Nm=Nm||new rs({"fill-sort-key":new Ct(De.layout_fill["fill-sort-key"])})}};class Zb extends Gs{constructor(s){super(s,Wb)}recalculate(s,c){super.recalculate(s,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new kf(s)}queryRadius(){return bu(this.paint.get("fill-translate"))}queryIntersectsFeature(s,c,f,_,v,w,T){return Ac(xu(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,T),_)}isTileClipped(){return!0}}const $b=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Gb=on([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Xb}=$b;var jo={},Kb=y,jm=bl;function bl(a,s,c,f,_){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=f,this._values=_,a.readFields(Yb,this,s)}function Yb(a,s,c){a==1?s.id=c.readVarint():a==2?function(f,_){for(var v=f.readVarint()+f.pos;f.pos<v;){var w=_._keys[f.readVarint()],T=_._values[f.readVarint()];_.properties[w]=T}}(c,s):a==3?s.type=c.readVarint():a==4&&(s._geometry=c.pos)}function Jb(a){for(var s,c,f=0,_=0,v=a.length,w=v-1;_<v;w=_++)f+=((c=a[w]).x-(s=a[_]).x)*(s.y+c.y);return f}bl.types=["Unknown","Point","LineString","Polygon"],bl.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,c=a.readVarint()+a.pos,f=1,_=0,v=0,w=0,T=[];a.pos<c;){if(_<=0){var I=a.readVarint();f=7&I,_=I>>3}if(_--,f===1||f===2)v+=a.readSVarint(),w+=a.readSVarint(),f===1&&(s&&T.push(s),s=[]),s.push(new Kb(v,w));else{if(f!==7)throw new Error("unknown command "+f);s&&s.push(s[0].clone())}}return s&&T.push(s),T},bl.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,c=1,f=0,_=0,v=0,w=1/0,T=-1/0,I=1/0,E=-1/0;a.pos<s;){if(f<=0){var L=a.readVarint();c=7&L,f=L>>3}if(f--,c===1||c===2)(_+=a.readSVarint())<w&&(w=_),_>T&&(T=_),(v+=a.readSVarint())<I&&(I=v),v>E&&(E=v);else if(c!==7)throw new Error("unknown command "+c)}return[w,I,T,E]},bl.prototype.toGeoJSON=function(a,s,c){var f,_,v=this.extent*Math.pow(2,c),w=this.extent*a,T=this.extent*s,I=this.loadGeometry(),E=bl.types[this.type];function L(q){for(var $=0;$<q.length;$++){var Y=q[$];q[$]=[360*(Y.x+w)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Y.y+T)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(f=0;f<I.length;f++)F[f]=I[f][0];L(I=F);break;case 2:for(f=0;f<I.length;f++)L(I[f]);break;case 3:for(I=function(q){var $=q.length;if($<=1)return[q];for(var Y,ne,le=[],ve=0;ve<$;ve++){var he=Jb(q[ve]);he!==0&&(ne===void 0&&(ne=he<0),ne===he<0?(Y&&le.push(Y),Y=[q[ve]]):Y.push(q[ve]))}return Y&&le.push(Y),le}(I),f=0;f<I.length;f++)for(_=0;_<I[f].length;_++)L(I[f][_])}I.length===1?I=I[0]:E="Multi"+E;var N={type:"Feature",geometry:{type:E,coordinates:I},properties:this.properties};return"id"in this&&(N.id=this.id),N};var Qb=jm,qm=Hm;function Hm(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(ex,this,s),this.length=this._features.length}function ex(a,s,c){a===15?s.version=c.readVarint():a===1?s.name=c.readString():a===5?s.extent=c.readVarint():a===2?s._features.push(c.pos):a===3?s._keys.push(c.readString()):a===4&&s._values.push(function(f){for(var _=null,v=f.readVarint()+f.pos;f.pos<v;){var w=f.readVarint()>>3;_=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return _}(c))}Hm.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new Qb(this._pbf,s,this.extent,this._keys,this._values)};var tx=qm;function ix(a,s,c){if(a===3){var f=new tx(c,c.readVarint()+c.pos);f.length&&(s[f.name]=f)}}jo.VectorTile=function(a,s){this.layers=a.readFields(ix,{},s)},jo.VectorTileFeature=jm,jo.VectorTileLayer=qm;const nx=jo.VectorTileFeature.types,Sf=Math.pow(2,13);function Oc(a,s,c,f,_,v,w,T){a.emplaceBack(s,c,2*Math.floor(f*Sf)+w,_*Sf*2,v*Sf*2,Math.round(T))}class Cf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new te,this.centroidVertexArray=new B,this.indexArray=new Pe,this.programConfigurations=new Li(s.layers,s.zoom),this.segments=new Ze,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(s,c,f){this.features=[],this.hasPattern=vf("fill-extrusion",this.layers,c);for(const{feature:_,id:v,index:w,sourceLayerIndex:T}of s){const I=this.layers[0]._featureFilter.needGeometry,E=so(_,I);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),E,f))continue;const L={id:v,sourceLayerIndex:T,index:w,geometry:I?E.geometry:no(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(wf("fill-extrusion",this.layers,L,this.zoom,c)):this.addFeature(L,L.geometry,w,f,{}),c.featureIndex.insert(_,L.geometry,w,T,this.index,!0)}}addFeatures(s,c,f){for(const _ of this.features){const{geometry:v}=_;this.addFeature(_,v,_.index,c,f)}}update(s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Xb),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Gb.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,c,f,_,v){const w={x:0,y:0,vertexCount:0};for(const T of xf(c,500)){let I=0;for(const $ of T)I+=$.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of T){if($.length===0||rx($))continue;let Y=0;for(let ne=0;ne<$.length;ne++){const le=$[ne];if(ne>=1){const ve=$[ne-1];if(!sx(le,ve)){E.vertexLength+4>Ze.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const he=le.sub(ve)._perp()._unit(),_e=ve.dist(le);Y+_e>32768&&(Y=0),Oc(this.layoutVertexArray,le.x,le.y,he.x,he.y,0,0,Y),Oc(this.layoutVertexArray,le.x,le.y,he.x,he.y,0,1,Y),w.x+=2*le.x,w.y+=2*le.y,w.vertexCount+=2,Y+=_e,Oc(this.layoutVertexArray,ve.x,ve.y,he.x,he.y,0,0,Y),Oc(this.layoutVertexArray,ve.x,ve.y,he.x,he.y,0,1,Y),w.x+=2*ve.x,w.y+=2*ve.y,w.vertexCount+=2;const Fe=E.vertexLength;this.indexArray.emplaceBack(Fe,Fe+2,Fe+1),this.indexArray.emplaceBack(Fe+1,Fe+2,Fe+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+I>Ze.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),nx[s.type]!=="Polygon")continue;const L=[],F=[],N=E.vertexLength;for(const $ of T)if($.length!==0){$!==T[0]&&F.push(L.length/2);for(let Y=0;Y<$.length;Y++){const ne=$[Y];Oc(this.layoutVertexArray,ne.x,ne.y,0,0,1,1,0),w.x+=ne.x,w.y+=ne.y,w.vertexCount+=1,L.push(ne.x),L.push(ne.y)}}const q=Om(L,F);for(let $=0;$<q.length;$+=3)this.indexArray.emplaceBack(N+q[$],N+q[$+2],N+q[$+1]);E.primitiveLength+=q.length/3,E.vertexLength+=I}for(let T=0;T<w.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,_)}}function sx(a,s){return a.x===s.x&&(a.x<0||a.x>qt)||a.y===s.y&&(a.y<0||a.y>qt)}function rx(a){return a.every(s=>s.x<0)||a.every(s=>s.x>qt)||a.every(s=>s.y<0)||a.every(s=>s.y>qt)}let Wm;dt("FillExtrusionBucket",Cf,{omit:["layers","features"]});var ox={get paint(){return Wm=Wm||new rs({"fill-extrusion-opacity":new bt(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ct(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qr(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ct(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ct(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ax extends Gs{constructor(s){super(s,ox)}createBucket(s){return new Cf(s)}queryRadius(){return bu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,c,f,_,v,w,T,I){const E=xu(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,T),L=this.paint.get("fill-extrusion-height").evaluate(c,f),F=this.paint.get("fill-extrusion-base").evaluate(c,f),N=function($,Y,ne,le){const ve=[];for(const he of $){const _e=[he.x,he.y,0,1];vu(_e,_e,Y),ve.push(new C(_e[0]/_e[3],_e[1]/_e[3]))}return ve}(E,I),q=function($,Y,ne,le){const ve=[],he=[],_e=le[8]*Y,Fe=le[9]*Y,Ue=le[10]*Y,ot=le[11]*Y,gt=le[8]*ne,rt=le[9]*ne,st=le[10]*ne,Qe=le[11]*ne;for(const ft of $){const it=[],Xe=[];for(const kt of ft){const yt=kt.x,jt=kt.y,Ai=le[0]*yt+le[4]*jt+le[12],Ri=le[1]*yt+le[5]*jt+le[13],xn=le[2]*yt+le[6]*jt+le[14],Os=le[3]*yt+le[7]*jt+le[15],ls=xn+Ue,fn=Os+ot,Ln=Ai+gt,Vn=Ri+rt,cs=xn+st,hs=Os+Qe,vn=new C((Ai+_e)/fn,(Ri+Fe)/fn);vn.z=ls/fn,it.push(vn);const wn=new C(Ln/hs,Vn/hs);wn.z=cs/hs,Xe.push(wn)}ve.push(it),he.push(Xe)}return[ve,he]}(_,F,L,I);return function($,Y,ne){let le=1/0;Ac(ne,Y)&&(le=Zm(ne,Y[0]));for(let ve=0;ve<Y.length;ve++){const he=Y[ve],_e=$[ve];for(let Fe=0;Fe<he.length-1;Fe++){const Ue=he[Fe],ot=[Ue,he[Fe+1],_e[Fe+1],_e[Fe],Ue];ro(ne,ot)&&(le=Math.min(le,Zm(ne,ot)))}}return le!==1/0&&le}(q[0],q[1],N)}}function Vc(a,s){return a.x*s.x+a.y*s.y}function Zm(a,s){if(a.length===1){let c=0;const f=s[c++];let _;for(;!_||f.equals(_);)if(_=s[c++],!_)return 1/0;for(;c<s.length;c++){const v=s[c],w=a[0],T=_.sub(f),I=v.sub(f),E=w.sub(f),L=Vc(T,T),F=Vc(T,I),N=Vc(I,I),q=Vc(E,T),$=Vc(E,I),Y=L*N-F*F,ne=(N*q-F*$)/Y,le=(L*$-F*q)/Y,ve=f.z*(1-ne-le)+_.z*ne+v.z*le;if(isFinite(ve))return ve}return 1/0}{let c=1/0;for(const f of s)c=Math.min(c,f.z);return c}}const lx=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:cx}=lx,hx=on([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ux}=hx,dx=jo.VectorTileFeature.types,fx=Math.cos(Math.PI/180*37.5),$m=Math.pow(2,14)/.5;class Tf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new ee,this.layoutVertexArray2=new se,this.indexArray=new Pe,this.programConfigurations=new Li(s.layers,s.zoom),this.segments=new Ze,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(s,c,f){this.hasPattern=vf("line",this.layers,c);const _=this.layers[0].layout.get("line-sort-key"),v=!_.isConstant(),w=[];for(const{feature:T,id:I,index:E,sourceLayerIndex:L}of s){const F=this.layers[0]._featureFilter.needGeometry,N=so(T,F);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),N,f))continue;const q=v?_.evaluate(N,{},f):void 0,$={id:I,properties:T.properties,type:T.type,sourceLayerIndex:L,index:E,geometry:F?N.geometry:no(T),patterns:{},sortKey:q};w.push($)}v&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:E,sourceLayerIndex:L}=T;if(this.hasPattern){const F=wf("line",this.layers,T,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(T,I,E,f,{});c.featureIndex.insert(s[E].feature,I,E,L,this.index)}}update(s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,c,this.stateDependentLayers,f)}addFeatures(s,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,ux)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,cx),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,c,f,_,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(s,{}),I=w.get("line-cap"),E=w.get("line-miter-limit"),L=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const F of c)this.addLine(F,s,T,I,E,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,_)}addLine(s,c,f,_,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<s.length-1;le++)this.totalDistance+=s[le].dist(s[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=dx[c.type]==="Polygon";let I=s.length;for(;I>=2&&s[I-1].equals(s[I-2]);)I--;let E=0;for(;E<I-1&&s[E].equals(s[E+1]);)E++;if(I<(T?3:2))return;f==="bevel"&&(v=1.05);const L=this.overscaling<=16?15*qt/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let N,q,$,Y,ne;this.e1=this.e2=-1,T&&(N=s[I-2],ne=s[E].sub(N)._unit()._perp());for(let le=E;le<I;le++){if($=le===I-1?T?s[E+1]:void 0:s[le+1],$&&s[le].equals($))continue;ne&&(Y=ne),N&&(q=N),N=s[le],ne=$?$.sub(N)._unit()._perp():Y,Y=Y||ne;let ve=Y.add(ne);ve.x===0&&ve.y===0||ve._unit();const he=Y.x*ne.x+Y.y*ne.y,_e=ve.x*ne.x+ve.y*ne.y,Fe=_e!==0?1/_e:1/0,Ue=2*Math.sqrt(2-2*_e),ot=_e<fx&&q&&$,gt=Y.x*ne.y-Y.y*ne.x>0;if(ot&&le>E){const Qe=N.dist(q);if(Qe>2*L){const ft=N.sub(N.sub(q)._mult(L/Qe)._round());this.updateDistance(q,ft),this.addCurrentVertex(ft,Y,0,0,F),q=ft}}const rt=q&&$;let st=rt?f:T?"butt":_;if(rt&&st==="round"&&(Fe<w?st="miter":Fe<=2&&(st="fakeround")),st==="miter"&&Fe>v&&(st="bevel"),st==="bevel"&&(Fe>2&&(st="flipbevel"),Fe<v&&(st="miter")),q&&this.updateDistance(q,N),st==="miter")ve._mult(Fe),this.addCurrentVertex(N,ve,0,0,F);else if(st==="flipbevel"){if(Fe>100)ve=ne.mult(-1);else{const Qe=Fe*Y.add(ne).mag()/Y.sub(ne).mag();ve._perp()._mult(Qe*(gt?-1:1))}this.addCurrentVertex(N,ve,0,0,F),this.addCurrentVertex(N,ve.mult(-1),0,0,F)}else if(st==="bevel"||st==="fakeround"){const Qe=-Math.sqrt(Fe*Fe-1),ft=gt?Qe:0,it=gt?0:Qe;if(q&&this.addCurrentVertex(N,Y,ft,it,F),st==="fakeround"){const Xe=Math.round(180*Ue/Math.PI/20);for(let kt=1;kt<Xe;kt++){let yt=kt/Xe;if(yt!==.5){const Ai=yt-.5;yt+=yt*Ai*(yt-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Ai*Ai+(.848013+he*(.215638*he-1.06021)))}const jt=ne.sub(Y)._mult(yt)._add(Y)._unit()._mult(gt?-1:1);this.addHalfVertex(N,jt.x,jt.y,!1,gt,0,F)}}$&&this.addCurrentVertex(N,ne,-ft,-it,F)}else if(st==="butt")this.addCurrentVertex(N,ve,0,0,F);else if(st==="square"){const Qe=q?1:-1;this.addCurrentVertex(N,ve,Qe,Qe,F)}else st==="round"&&(q&&(this.addCurrentVertex(N,Y,0,0,F),this.addCurrentVertex(N,Y,1,1,F,!0)),$&&(this.addCurrentVertex(N,ne,-1,-1,F,!0),this.addCurrentVertex(N,ne,0,0,F)));if(ot&&le<I-1){const Qe=N.dist($);if(Qe>2*L){const ft=N.add($.sub(N)._mult(L/Qe)._round());this.updateDistance(N,ft),this.addCurrentVertex(ft,ne,0,0,F),N=ft}}}}addCurrentVertex(s,c,f,_,v,w=!1){const T=c.y*_-c.x,I=-c.y-c.x*_;this.addHalfVertex(s,c.x+c.y*f,c.y-c.x*f,w,!1,f,v),this.addHalfVertex(s,T,I,w,!0,-_,v),this.distance>$m/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,c,f,_,v,w))}addHalfVertex({x:s,y:c},f,_,v,w,T,I){const E=.5*(this.lineClips?this.scaledDistance*($m-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(v?1:0),(c<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(T===0?0:T<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),I.primitiveLength++),w?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,c){this.distance+=s.dist(c),this.updateScaledDistance()}}let Gm,Xm;dt("LineBucket",Tf,{omit:["layers","patternFeatures"]});var Km={get paint(){return Xm=Xm||new rs({"line-opacity":new Ct(De.paint_line["line-opacity"]),"line-color":new Ct(De.paint_line["line-color"]),"line-translate":new bt(De.paint_line["line-translate"]),"line-translate-anchor":new bt(De.paint_line["line-translate-anchor"]),"line-width":new Ct(De.paint_line["line-width"]),"line-gap-width":new Ct(De.paint_line["line-gap-width"]),"line-offset":new Ct(De.paint_line["line-offset"]),"line-blur":new Ct(De.paint_line["line-blur"]),"line-dasharray":new _c(De.paint_line["line-dasharray"]),"line-pattern":new Qr(De.paint_line["line-pattern"]),"line-gradient":new ba(De.paint_line["line-gradient"])})},get layout(){return Gm=Gm||new rs({"line-cap":new bt(De.layout_line["line-cap"]),"line-join":new Ct(De.layout_line["line-join"]),"line-miter-limit":new bt(De.layout_line["line-miter-limit"]),"line-round-limit":new bt(De.layout_line["line-round-limit"]),"line-sort-key":new Ct(De.layout_line["line-sort-key"])})}};class px extends Ct{possiblyEvaluate(s,c){return c=new Pi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(s,c)}evaluate(s,c,f,_){return c=xe({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(s,c,f,_)}}let Tu;class mx extends Gs{constructor(s){super(s,Km),this.gradientVersion=0,Tu||(Tu=new px(Km.paint.properties["line-width"].specification),Tu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof ko,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,c){super.recalculate(s,c),this.paint._values["line-floorwidth"]=Tu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Tf(s)}queryRadius(s){const c=s,f=Ym(Ec("line-width",this,c),Ec("line-gap-width",this,c)),_=Ec("line-offset",this,c);return f/2+Math.abs(_)+bu(this.paint.get("line-translate"))}queryIntersectsFeature(s,c,f,_,v,w,T){const I=xu(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,T),E=T/2*Ym(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),L=this.paint.get("line-offset").evaluate(c,f);return L&&(_=function(F,N){const q=[];for(let $=0;$<F.length;$++){const Y=F[$],ne=[];for(let le=0;le<Y.length;le++){const ve=Y[le-1],he=Y[le],_e=Y[le+1],Fe=le===0?new C(0,0):he.sub(ve)._unit()._perp(),Ue=le===Y.length-1?new C(0,0):_e.sub(he)._unit()._perp(),ot=Fe._add(Ue)._unit(),gt=ot.x*Ue.x+ot.y*Ue.y;gt!==0&&ot._mult(1/gt),ne.push(ot._mult(N)._add(he))}q.push(ne)}return q}(_,L*T)),function(F,N,q){for(let $=0;$<N.length;$++){const Y=N[$];if(F.length>=3){for(let ne=0;ne<Y.length;ne++)if(gl(F,Y[ne]))return!0}if(_u(F,Y,q))return!0}return!1}(I,_,E)}isTileClipped(){return!0}}function Ym(a,s){return s>0?s+2*a:a}const gx=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_x=on([{name:"a_projected_pos",components:3,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yx=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);on([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jm=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bx=on([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function xx(a,s,c){return a.sections.forEach(f=>{f.text=function(_,v,w){const T=v.layout.get("text-transform").evaluate(w,{});return T==="uppercase"?_=_.toLocaleUpperCase():T==="lowercase"&&(_=_.toLocaleLowerCase()),Jr.applyArabicShaping&&(_=Jr.applyArabicShaping(_)),_}(f.text,s,c)}),a}on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),on([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Nc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var bn=24,Qm=mi,eg=function(a,s,c,f,_){var v,w,T=8*_-f-1,I=(1<<T)-1,E=I>>1,L=-7,F=c?_-1:0,N=c?-1:1,q=a[s+F];for(F+=N,v=q&(1<<-L)-1,q>>=-L,L+=T;L>0;v=256*v+a[s+F],F+=N,L-=8);for(w=v&(1<<-L)-1,v>>=-L,L+=f;L>0;w=256*w+a[s+F],F+=N,L-=8);if(v===0)v=1-E;else{if(v===I)return w?NaN:1/0*(q?-1:1);w+=Math.pow(2,f),v-=E}return(q?-1:1)*w*Math.pow(2,v-f)},tg=function(a,s,c,f,_,v){var w,T,I,E=8*v-_-1,L=(1<<E)-1,F=L>>1,N=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=f?0:v-1,$=f?1:-1,Y=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(T=isNaN(s)?1:0,w=L):(w=Math.floor(Math.log(s)/Math.LN2),s*(I=Math.pow(2,-w))<1&&(w--,I*=2),(s+=w+F>=1?N/I:N*Math.pow(2,1-F))*I>=2&&(w++,I/=2),w+F>=L?(T=0,w=L):w+F>=1?(T=(s*I-1)*Math.pow(2,_),w+=F):(T=s*Math.pow(2,F-1)*Math.pow(2,_),w=0));_>=8;a[c+q]=255&T,q+=$,T/=256,_-=8);for(w=w<<_|T,E+=_;E>0;a[c+q]=255&w,q+=$,w/=256,E-=8);a[c+q-$]|=128*Y};function mi(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}mi.Varint=0,mi.Fixed64=1,mi.Bytes=2,mi.Fixed32=5;var Mf=4294967296,ig=1/Mf,ng=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function oo(a){return a.type===mi.Bytes?a.readVarint()+a.pos:a.pos+1}function xl(a,s,c){return c?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function sg(a,s,c){var f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));c.realloc(f);for(var _=c.pos-1;_>=a;_--)c.buf[_+f]=c.buf[_]}function vx(a,s){for(var c=0;c<a.length;c++)s.writeVarint(a[c])}function wx(a,s){for(var c=0;c<a.length;c++)s.writeSVarint(a[c])}function kx(a,s){for(var c=0;c<a.length;c++)s.writeFloat(a[c])}function Sx(a,s){for(var c=0;c<a.length;c++)s.writeDouble(a[c])}function Cx(a,s){for(var c=0;c<a.length;c++)s.writeBoolean(a[c])}function Tx(a,s){for(var c=0;c<a.length;c++)s.writeFixed32(a[c])}function Mx(a,s){for(var c=0;c<a.length;c++)s.writeSFixed32(a[c])}function Px(a,s){for(var c=0;c<a.length;c++)s.writeFixed64(a[c])}function Ix(a,s){for(var c=0;c<a.length;c++)s.writeSFixed64(a[c])}function Mu(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function vl(a,s,c){a[c]=s,a[c+1]=s>>>8,a[c+2]=s>>>16,a[c+3]=s>>>24}function rg(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}mi.prototype={destroy:function(){this.buf=null},readFields:function(a,s,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),_=f>>3,v=this.pos;this.type=7&f,a(_,s,this),this.pos===v&&this.skip(f)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Mu(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=rg(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Mu(this.buf,this.pos)+Mu(this.buf,this.pos+4)*Mf;return this.pos+=8,a},readSFixed64:function(){var a=Mu(this.buf,this.pos)+rg(this.buf,this.pos+4)*Mf;return this.pos+=8,a},readFloat:function(){var a=eg(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=eg(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,c,f=this.buf;return s=127&(c=f[this.pos++]),c<128?s:(s|=(127&(c=f[this.pos++]))<<7,c<128?s:(s|=(127&(c=f[this.pos++]))<<14,c<128?s:(s|=(127&(c=f[this.pos++]))<<21,c<128?s:function(_,v,w){var T,I,E=w.buf;if(T=(112&(I=E[w.pos++]))>>4,I<128||(T|=(127&(I=E[w.pos++]))<<3,I<128)||(T|=(127&(I=E[w.pos++]))<<10,I<128)||(T|=(127&(I=E[w.pos++]))<<17,I<128)||(T|=(127&(I=E[w.pos++]))<<24,I<128)||(T|=(1&(I=E[w.pos++]))<<31,I<128))return xl(_,T,v);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(c=f[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&ng?function(c,f,_){return ng.decode(c.subarray(f,_))}(this.buf,s,a):function(c,f,_){for(var v="",w=f;w<_;){var T,I,E,L=c[w],F=null,N=L>239?4:L>223?3:L>191?2:1;if(w+N>_)break;N===1?L<128&&(F=L):N===2?(192&(T=c[w+1]))==128&&(F=(31&L)<<6|63&T)<=127&&(F=null):N===3?(I=c[w+2],(192&(T=c[w+1]))==128&&(192&I)==128&&((F=(15&L)<<12|(63&T)<<6|63&I)<=2047||F>=55296&&F<=57343)&&(F=null)):N===4&&(I=c[w+2],E=c[w+3],(192&(T=c[w+1]))==128&&(192&I)==128&&(192&E)==128&&((F=(15&L)<<18|(63&T)<<12|(63&I)<<6|63&E)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,N=1):F>65535&&(F-=65536,v+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),v+=String.fromCharCode(F),w+=N}return v}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==mi.Bytes)return a.push(this.readVarint(s));var c=oo(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==mi.Bytes)return a.push(this.readSVarint());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==mi.Bytes)return a.push(this.readBoolean());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==mi.Bytes)return a.push(this.readFloat());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==mi.Bytes)return a.push(this.readDouble());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==mi.Bytes)return a.push(this.readFixed32());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==mi.Bytes)return a.push(this.readSFixed32());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==mi.Bytes)return a.push(this.readFixed64());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==mi.Bytes)return a.push(this.readSFixed64());var s=oo(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===mi.Varint)for(;this.buf[this.pos++]>127;);else if(s===mi.Bytes)this.pos=this.readVarint()+this.pos;else if(s===mi.Fixed32)this.pos+=4;else{if(s!==mi.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var c=new Uint8Array(s);c.set(this.buf),this.buf=c,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),vl(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),vl(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),vl(this.buf,-1&a,this.pos),vl(this.buf,Math.floor(a*ig),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),vl(this.buf,-1&a,this.pos),vl(this.buf,Math.floor(a*ig),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,c){var f,_;if(s>=0?(f=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(f=~(-s%4294967296))?f=f+1|0:(f=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(v,w,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)}(f,0,c),function(v,w){var T=(7&v)<<4;w.buf[w.pos++]|=T|((v>>>=3)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v)))))}(_,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(f,_,v){for(var w,T,I=0;I<_.length;I++){if((w=_.charCodeAt(I))>55295&&w<57344){if(!T){w>56319||I+1===_.length?(f[v++]=239,f[v++]=191,f[v++]=189):T=w;continue}if(w<56320){f[v++]=239,f[v++]=191,f[v++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(f[v++]=239,f[v++]=191,f[v++]=189,T=null);w<128?f[v++]=w:(w<2048?f[v++]=w>>6|192:(w<65536?f[v++]=w>>12|224:(f[v++]=w>>18|240,f[v++]=w>>12&63|128),f[v++]=w>>6&63|128),f[v++]=63&w|128)}return v}(this.buf,a,this.pos);var c=this.pos-s;c>=128&&sg(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),tg(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),tg(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var c=0;c<s;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,s){this.pos++;var c=this.pos;a(s,this);var f=this.pos-c;f>=128&&sg(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(a,s,c){this.writeTag(a,mi.Bytes),this.writeRawMessage(s,c)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,vx,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,wx,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,Cx,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,kx,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,Sx,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,Tx,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,Mx,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,Px,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,Ix,s)},writeBytesField:function(a,s){this.writeTag(a,mi.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,mi.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,mi.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,mi.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,mi.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,mi.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,mi.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,mi.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,mi.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,mi.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,!!s)}};var Pf=p(Qm);const If=3;function Ax(a,s,c){a===1&&c.readMessage(Ex,s)}function Ex(a,s,c){if(a===3){const{id:f,bitmap:_,width:v,height:w,left:T,top:I,advance:E}=c.readMessage(zx,{});s.push({id:f,bitmap:new Dc({width:v+2*If,height:w+2*If},_),metrics:{width:v,height:w,left:T,top:I,advance:E}})}}function zx(a,s,c){a===1?s.id=c.readVarint():a===2?s.bitmap=c.readBytes():a===3?s.width=c.readVarint():a===4?s.height=c.readVarint():a===5?s.left=c.readSVarint():a===6?s.top=c.readSVarint():a===7&&(s.advance=c.readVarint())}const og=If;function ag(a){let s=0,c=0;for(const w of a)s+=w.w*w.h,c=Math.max(c,w.w);a.sort((w,T)=>T.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}];let _=0,v=0;for(const w of a)for(let T=f.length-1;T>=0;T--){const I=f[T];if(!(w.w>I.w||w.h>I.h)){if(w.x=I.x,w.y=I.y,v=Math.max(v,w.y+w.h),_=Math.max(_,w.x+w.w),w.w===I.w&&w.h===I.h){const E=f.pop();T<f.length&&(f[T]=E)}else w.h===I.h?(I.x+=w.w,I.w-=w.w):w.w===I.w?(I.y+=w.h,I.h-=w.h):(f.push({x:I.x+w.w,y:I.y,w:I.w-w.w,h:w.h}),I.y+=w.h,I.h-=w.h);break}}return{w:_,h:v,fill:s/(_*v)||0}}const Ps=1;class Af{constructor(s,{pixelRatio:c,version:f,stretchX:_,stretchY:v,content:w}){this.paddedRect=s,this.pixelRatio=c,this.stretchX=_,this.stretchY=v,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+Ps,this.paddedRect.y+Ps]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ps,this.paddedRect.y+this.paddedRect.h-Ps]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ps)/this.pixelRatio,(this.paddedRect.h-2*Ps)/this.pixelRatio]}}class lg{constructor(s,c){const f={},_={};this.haveRenderCallbacks=[];const v=[];this.addImages(s,f,v),this.addImages(c,_,v);const{w,h:T}=ag(v),I=new Ys({width:w||1,height:T||1});for(const E in s){const L=s[E],F=f[E].paddedRect;Ys.copy(L.data,I,{x:0,y:0},{x:F.x+Ps,y:F.y+Ps},L.data)}for(const E in c){const L=c[E],F=_[E].paddedRect,N=F.x+Ps,q=F.y+Ps,$=L.data.width,Y=L.data.height;Ys.copy(L.data,I,{x:0,y:0},{x:N,y:q},L.data),Ys.copy(L.data,I,{x:0,y:Y-1},{x:N,y:q-1},{width:$,height:1}),Ys.copy(L.data,I,{x:0,y:0},{x:N,y:q+Y},{width:$,height:1}),Ys.copy(L.data,I,{x:$-1,y:0},{x:N-1,y:q},{width:1,height:Y}),Ys.copy(L.data,I,{x:0,y:0},{x:N+$,y:q},{width:1,height:Y})}this.image=I,this.iconPositions=f,this.patternPositions=_}addImages(s,c,f){for(const _ in s){const v=s[_],w={x:0,y:0,w:v.data.width+2*Ps,h:v.data.height+2*Ps};f.push(w),c[_]=new Af(w,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(s,c){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),c)}patchUpdatedImage(s,c,f){if(!s||!c||s.version===c.version)return;s.version=c.version;const[_,v]=s.tl;f.update(c.data,void 0,{x:_,y:v})}}var qo;dt("ImagePosition",Af),dt("ImageAtlas",lg),u.ah=void 0,(qo=u.ah||(u.ah={}))[qo.none=0]="none",qo[qo.horizontal=1]="horizontal",qo[qo.vertical=2]="vertical",qo[qo.horizontalOnly=3]="horizontalOnly";const Uc=-17;class jc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,c){const f=new jc;return f.scale=s||1,f.fontStack=c,f}static forImage(s){const c=new jc;return c.imageName=s,c}}class wl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,c){const f=new wl;for(let _=0;_<s.sections.length;_++){const v=s.sections[_];v.image?f.addImageSection(v):f.addTextSection(v,c)}return f}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let c="";for(let f=0;f<s.length;f++){const _=s.charCodeAt(f+1)||null,v=s.charCodeAt(f-1)||null;c+=_&&dc(_)&&!Nc[s[f+1]]||v&&dc(v)&&!Nc[s[f-1]]||!Nc[s[f]]?s[f]:Nc[s[f]]}return c}(this.text)}trim(){let s=0;for(let f=0;f<this.text.length&&Iu[this.text.charCodeAt(f)];f++)s++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&Iu[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(s,c),this.sectionIndex=this.sectionIndex.slice(s,c)}substring(s,c){const f=new wl;return f.text=this.text.substring(s,c),f.sectionIndex=this.sectionIndex.slice(s,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,c)=>Math.max(s,this.sections[c].scale),0)}addTextSection(s,c){this.text+=s.text,this.sections.push(jc.forText(s.scale,s.fontStack||c));const f=this.sections.length-1;for(let _=0;_<s.text.length;++_)this.sectionIndex.push(f)}addImageSection(s){const c=s.image?s.image.name:"";if(c.length===0)return void Oe("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(jc.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Oe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pu(a,s,c,f,_,v,w,T,I,E,L,F,N,q,$,Y){const ne=wl.fromFeature(a,_);let le;F===u.ah.vertical&&ne.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:he}=Jr;if(ve&&ne.sections.length===1){le=[];const Ue=ve(ne.toString(),Ef(ne,E,v,s,f,q,$));for(const ot of Ue){const gt=new wl;gt.text=ot,gt.sections=ne.sections;for(let rt=0;rt<ot.length;rt++)gt.sectionIndex.push(0);le.push(gt)}}else if(he){le=[];const Ue=he(ne.text,ne.sectionIndex,Ef(ne,E,v,s,f,q,$));for(const ot of Ue){const gt=new wl;gt.text=ot[0],gt.sectionIndex=ot[1],gt.sections=ne.sections,le.push(gt)}}else le=function(Ue,ot){const gt=[],rt=Ue.text;let st=0;for(const Qe of ot)gt.push(Ue.substring(st,Qe)),st=Qe;return st<rt.length&&gt.push(Ue.substring(st,rt.length)),gt}(ne,Ef(ne,E,v,s,f,q,$));const _e=[],Fe={positionedLines:_e,text:ne.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Ue,ot,gt,rt,st,Qe,ft,it,Xe,kt,yt,jt){let Ai=0,Ri=Uc,xn=0,Os=0;const ls=it==="right"?1:it==="left"?0:.5;let fn=0;for(const vn of st){vn.trim();const wn=vn.getMaxScale(),Kn=(wn-1)*bn,us={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[fn]=us;const Yn=us.positionedGlyphs;let Is=0;if(!vn.length()){Ri+=Qe,++fn;continue}for(let kn=0;kn<vn.length();kn++){const Zt=vn.getSection(kn),Jn=vn.getSectionIndex(kn),Nn=vn.getCharCode(kn);let Sn=0,fr=null,vr=null,wr=null,ao=bn;const pr=!(Xe===u.ah.horizontal||!yt&&!al(Nn)||yt&&(Iu[Nn]||(Ln=Nn,at.Arabic(Ln)||at["Arabic Supplement"](Ln)||at["Arabic Extended-A"](Ln)||at["Arabic Presentation Forms-A"](Ln)||at["Arabic Presentation Forms-B"](Ln))));if(Zt.imageName){const Qs=rt[Zt.imageName];if(!Qs)continue;wr=Zt.imageName,Ue.iconsInText=Ue.iconsInText||!0,vr=Qs.paddedRect;const Es=Qs.displaySize;Zt.scale=Zt.scale*bn/jt,fr={width:Es[0],height:Es[1],left:Ps,top:-og,advance:pr?Es[1]:Es[0]},Sn=Kn+(bn-Es[1]*Zt.scale),ao=fr.advance;const lo=pr?Es[0]*Zt.scale-bn*wn:Es[1]*Zt.scale-bn*wn;lo>0&&lo>Is&&(Is=lo)}else{const Qs=gt[Zt.fontStack],Es=Qs&&Qs[Nn];if(Es&&Es.rect)vr=Es.rect,fr=Es.metrics;else{const lo=ot[Zt.fontStack],$c=lo&&lo[Nn];if(!$c)continue;fr=$c.metrics}Sn=(wn-Zt.scale)*bn}pr?(Ue.verticalizable=!0,Yn.push({glyph:Nn,imageName:wr,x:Ai,y:Ri+Sn,vertical:pr,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:Jn,metrics:fr,rect:vr}),Ai+=ao*Zt.scale+kt):(Yn.push({glyph:Nn,imageName:wr,x:Ai,y:Ri+Sn,vertical:pr,scale:Zt.scale,fontStack:Zt.fontStack,sectionIndex:Jn,metrics:fr,rect:vr}),Ai+=fr.advance*Zt.scale+kt)}Yn.length!==0&&(xn=Math.max(Ai-kt,xn),Rx(Yn,0,Yn.length-1,ls,Is)),Ai=0;const As=Qe*wn+Is;us.lineOffset=Math.max(Is,Kn),Ri+=As,Os=Math.max(As,Os),++fn}var Ln;const Vn=Ri-Uc,{horizontalAlign:cs,verticalAlign:hs}=zf(ft);(function(vn,wn,Kn,us,Yn,Is,As,kn,Zt){const Jn=(wn-Kn)*Yn;let Nn=0;Nn=Is!==As?-kn*us-Uc:(-us*Zt+.5)*As;for(const Sn of vn)for(const fr of Sn.positionedGlyphs)fr.x+=Jn,fr.y+=Nn})(Ue.positionedLines,ls,cs,hs,xn,Os,Qe,Vn,st.length),Ue.top+=-hs*Vn,Ue.bottom=Ue.top+Vn,Ue.left+=-cs*xn,Ue.right=Ue.left+xn}(Fe,s,c,f,le,w,T,I,F,E,N,Y),!function(Ue){for(const ot of Ue)if(ot.positionedGlyphs.length!==0)return!1;return!0}(_e)&&Fe}const Iu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Dx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cg(a,s,c,f,_,v){if(s.imageName){const w=f[s.imageName];return w?w.displaySize[0]*s.scale*bn/v+_:0}{const w=c[s.fontStack],T=w&&w[a];return T?T.metrics.advance*s.scale+_:0}}function hg(a,s,c,f){const _=Math.pow(a-s,2);return f?a<s?_/2:2*_:_+Math.abs(c)*c}function Lx(a,s,c){let f=0;return a===10&&(f-=1e4),c&&(f+=150),a!==40&&a!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function ug(a,s,c,f,_,v){let w=null,T=hg(s,c,_,v);for(const I of f){const E=hg(s-I.x,c,_,v)+I.badness;E<=T&&(w=I,T=E)}return{index:a,x:s,priorBreak:w,badness:T}}function dg(a){return a?dg(a.priorBreak).concat(a.index):[]}function Ef(a,s,c,f,_,v,w){if(v!=="point")return[];if(!a)return[];const T=[],I=function(N,q,$,Y,ne,le){let ve=0;for(let he=0;he<N.length();he++){const _e=N.getSection(he);ve+=cg(N.getCharCode(he),_e,Y,ne,q,le)}return ve/Math.max(1,Math.ceil(ve/$))}(a,s,c,f,_,w),E=a.text.indexOf("​")>=0;let L=0;for(let N=0;N<a.length();N++){const q=a.getSection(N),$=a.getCharCode(N);if(Iu[$]||(L+=cg($,q,f,_,s,w)),N<a.length()-1){const Y=!((F=$)<11904||!(at["Bopomofo Extended"](F)||at.Bopomofo(F)||at["CJK Compatibility Forms"](F)||at["CJK Compatibility Ideographs"](F)||at["CJK Compatibility"](F)||at["CJK Radicals Supplement"](F)||at["CJK Strokes"](F)||at["CJK Symbols and Punctuation"](F)||at["CJK Unified Ideographs Extension A"](F)||at["CJK Unified Ideographs"](F)||at["Enclosed CJK Letters and Months"](F)||at["Halfwidth and Fullwidth Forms"](F)||at.Hiragana(F)||at["Ideographic Description Characters"](F)||at["Kangxi Radicals"](F)||at["Katakana Phonetic Extensions"](F)||at.Katakana(F)||at["Vertical Forms"](F)||at["Yi Radicals"](F)||at["Yi Syllables"](F)));(Dx[$]||Y||q.imageName)&&T.push(ug(N+1,L,I,T,Lx($,a.getCharCode(N+1),Y&&E),!1))}}var F;return dg(ug(a.length(),L,I,T,0,!0))}function zf(a){let s=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function Rx(a,s,c,f,_){if(!f&&!_)return;const v=a[c],w=(a[c].x+v.metrics.advance*v.scale)*f;for(let T=s;T<=c;T++)a[T].x-=w,a[T].y+=_}function Fx(a,s,c){const{horizontalAlign:f,verticalAlign:_}=zf(c),v=s[0]-a.displaySize[0]*f,w=s[1]-a.displaySize[1]*_;return{image:a,top:w,bottom:w+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function fg(a,s,c,f,_,v){const w=a.image;let T;if(w.content){const ne=w.content,le=w.pixelRatio||1;T=[ne[0]/le,ne[1]/le,w.displaySize[0]-ne[2]/le,w.displaySize[1]-ne[3]/le]}const I=s.left*v,E=s.right*v;let L,F,N,q;c==="width"||c==="both"?(q=_[0]+I-f[3],F=_[0]+E+f[1]):(q=_[0]+(I+E-w.displaySize[0])/2,F=q+w.displaySize[0]);const $=s.top*v,Y=s.bottom*v;return c==="height"||c==="both"?(L=_[1]+$-f[0],N=_[1]+Y+f[2]):(L=_[1]+($+Y-w.displaySize[1])/2,N=L+w.displaySize[1]),{image:w,top:L,right:F,bottom:N,left:q,collisionPadding:T}}const qc=255,Fr=128,Ho=qc*Fr;function pg(a,s){const{expression:c}=s;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Pi(a+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=c;let v=0;for(;v<f.length&&f[v]<=a;)v++;v=Math.max(0,v-1);let w=v;for(;w<f.length&&f[w]<a+1;)w++;w=Math.min(f.length-1,w);const T=f[v],I=f[w];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:I,minSize:c.evaluate(new Pi(T)),maxSize:c.evaluate(new Pi(I)),interpolationType:_}}}function Df(a,s,c){let f="never";const _=a.get(s);return _?f=_:a.get(c)&&(f="always"),f}const Bx=jo.VectorTileFeature.types,Ox=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Au(a,s,c,f,_,v,w,T,I,E,L,F,N){const q=T?Math.min(Ho,Math.round(T[0])):0,$=T?Math.min(Ho,Math.round(T[1])):0;a.emplaceBack(s,c,Math.round(32*f),Math.round(32*_),v,w,(q<<1)+(I?1:0),$,16*E,16*L,256*F,256*N)}function Lf(a,s,c){a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c),a.emplaceBack(s.x,s.y,c)}function Vx(a){for(const s of a.sections)if(cu(s.text))return!0;return!1}class Rf{constructor(s){this.layoutVertexArray=new fe,this.indexArray=new Pe,this.programConfigurations=s,this.segments=new Ze,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new oe,this.hasVisibleVertices=!1,this.placedSymbolArray=new r}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,c,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,gx.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,_x.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Ox,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}dt("SymbolBuffers",Rf);class Ff{constructor(s,c,f){this.layoutVertexArray=new s,this.layoutAttributes=c,this.indexArray=new f,this.segments=new Ze,this.collisionVertexArray=new Me}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,yx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}dt("CollisionBuffers",Ff);class kl{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(w=>w.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ff([]),this.placementViewportMatrix=ff([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=pg(this.zoom,c["text-size"]),this.iconSizeData=pg(this.zoom,c["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=Df(f,"text-overlap","text-allow-overlap")!=="never"||Df(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>u.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=s.sourceID}createArrays(){this.text=new Rf(new Li(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new Rf(new Li(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new g,this.lineVertexArray=new x,this.symbolInstances=new m,this.textAnchorOffsets=new P}calculateGlyphDependencies(s,c,f,_,v){for(let w=0;w<s.length;w++)if(c[s.charCodeAt(w)]=!0,(f||_)&&v){const T=Nc[s.charAt(w)];T&&(c[T.charCodeAt(0)]=!0)}}populate(s,c,f){const _=this.layers[0],v=_.layout,w=v.get("text-font"),T=v.get("text-field"),I=v.get("icon-image"),E=(T.value.kind!=="constant"||T.value.value instanceof ks&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),L=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,F=v.get("symbol-sort-key");if(this.features=[],!E&&!L)return;const N=c.iconDependencies,q=c.glyphDependencies,$=c.availableImages,Y=new Pi(this.zoom);for(const{feature:ne,id:le,index:ve,sourceLayerIndex:he}of s){const _e=_._featureFilter.needGeometry,Fe=so(ne,_e);if(!_._featureFilter.filter(Y,Fe,f))continue;let Ue,ot;if(_e||(Fe.geometry=no(ne)),E){const rt=_.getValueAndResolveTokens("text-field",Fe,f,$),st=ks.factory(rt),Qe=this.hasRTLText=this.hasRTLText||Vx(st);(!Qe||Jr.getRTLTextPluginStatus()==="unavailable"||Qe&&Jr.isParsed())&&(Ue=xx(st,_,Fe))}if(L){const rt=_.getValueAndResolveTokens("icon-image",Fe,f,$);ot=rt instanceof Rs?rt:Rs.fromString(rt)}if(!Ue&&!ot)continue;const gt=this.sortFeaturesByKey?F.evaluate(Fe,{},f):void 0;if(this.features.push({id:le,text:Ue,icon:ot,index:ve,sourceLayerIndex:he,geometry:Fe.geometry,properties:ne.properties,type:Bx[ne.type],sortKey:gt}),ot&&(N[ot.name]=!0),Ue){const rt=w.evaluate(Fe,{},f).join(","),st=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Qe of Ue.sections)if(Qe.image)N[Qe.image.name]=!0;else{const ft=_a(Ue.toString()),it=Qe.fontStack||rt,Xe=q[it]=q[it]||{};this.calculateGlyphDependencies(Qe.text,Xe,st,this.allowVerticalPlacement,ft)}}}v.get("symbol-placement")==="line"&&(this.features=function(ne){const le={},ve={},he=[];let _e=0;function Fe(rt){he.push(ne[rt]),_e++}function Ue(rt,st,Qe){const ft=ve[rt];return delete ve[rt],ve[st]=ft,he[ft].geometry[0].pop(),he[ft].geometry[0]=he[ft].geometry[0].concat(Qe[0]),ft}function ot(rt,st,Qe){const ft=le[st];return delete le[st],le[rt]=ft,he[ft].geometry[0].shift(),he[ft].geometry[0]=Qe[0].concat(he[ft].geometry[0]),ft}function gt(rt,st,Qe){const ft=Qe?st[0][st[0].length-1]:st[0][0];return`${rt}:${ft.x}:${ft.y}`}for(let rt=0;rt<ne.length;rt++){const st=ne[rt],Qe=st.geometry,ft=st.text?st.text.toString():null;if(!ft){Fe(rt);continue}const it=gt(ft,Qe),Xe=gt(ft,Qe,!0);if(it in ve&&Xe in le&&ve[it]!==le[Xe]){const kt=ot(it,Xe,Qe),yt=Ue(it,Xe,he[kt].geometry);delete le[it],delete ve[Xe],ve[gt(ft,he[yt].geometry,!0)]=yt,he[kt].geometry=null}else it in ve?Ue(it,Xe,Qe):Xe in le?ot(it,Xe,Qe):(Fe(rt),le[it]=_e-1,ve[Xe]=_e-1)}return he.filter(rt=>rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,le)=>ne.sortKey-le.sortKey)}update(s,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,c){const f=this.lineVertexArray.length;if(s.segment!==void 0){let _=s.dist(c[s.segment+1]),v=s.dist(c[s.segment]);const w={};for(let T=s.segment+1;T<c.length;T++)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:_},T<c.length-1&&(_+=c[T+1].dist(c[T]));for(let T=s.segment||0;T>=0;T--)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:v},T>0&&(v+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const I=w[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,c,f,_,v,w,T,I,E,L,F,N){const q=s.indexArray,$=s.layoutVertexArray,Y=s.segments.prepareSegment(4*c.length,$,q,this.canOverlap?w.sortKey:void 0),ne=this.glyphOffsetArray.length,le=Y.vertexLength,ve=this.allowVerticalPlacement&&T===u.ah.vertical?Math.PI/2:0,he=w.text&&w.text.sections;for(let _e=0;_e<c.length;_e++){const{tl:Fe,tr:Ue,bl:ot,br:gt,tex:rt,pixelOffsetTL:st,pixelOffsetBR:Qe,minFontScaleX:ft,minFontScaleY:it,glyphOffset:Xe,isSDF:kt,sectionIndex:yt}=c[_e],jt=Y.vertexLength,Ai=Xe[1];Au($,I.x,I.y,Fe.x,Ai+Fe.y,rt.x,rt.y,f,kt,st.x,st.y,ft,it),Au($,I.x,I.y,Ue.x,Ai+Ue.y,rt.x+rt.w,rt.y,f,kt,Qe.x,st.y,ft,it),Au($,I.x,I.y,ot.x,Ai+ot.y,rt.x,rt.y+rt.h,f,kt,st.x,Qe.y,ft,it),Au($,I.x,I.y,gt.x,Ai+gt.y,rt.x+rt.w,rt.y+rt.h,f,kt,Qe.x,Qe.y,ft,it),Lf(s.dynamicLayoutVertexArray,I,ve),q.emplaceBack(jt,jt+1,jt+2),q.emplaceBack(jt+1,jt+2,jt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),_e!==c.length-1&&yt===c[_e+1].sectionIndex||s.programConfigurations.populatePaintArrays($.length,w,w.index,{},N,he&&he[yt])}s.placedSymbolArray.emplaceBack(I.x,I.y,ne,this.glyphOffsetArray.length-ne,le,E,L,I.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],T,0,!1,0,F)}_addCollisionDebugVertex(s,c,f,_,v,w){return c.emplaceBack(0,0),s.emplaceBack(f.x,f.y,_,v,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(s,c,f,_,v,w,T){const I=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),E=I.vertexLength,L=v.layoutVertexArray,F=v.collisionVertexArray,N=T.anchorX,q=T.anchorY;this._addCollisionDebugVertex(L,F,w,N,q,new C(s,c)),this._addCollisionDebugVertex(L,F,w,N,q,new C(f,c)),this._addCollisionDebugVertex(L,F,w,N,q,new C(f,_)),this._addCollisionDebugVertex(L,F,w,N,q,new C(s,_)),I.vertexLength+=4;const $=v.indexArray;$.emplaceBack(E,E+1),$.emplaceBack(E+1,E+2),$.emplaceBack(E+2,E+3),$.emplaceBack(E+3,E),I.primitiveLength+=4}addDebugCollisionBoxes(s,c,f,_){for(let v=s;v<c;v++){const w=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,_?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ff(ye,Jm.members,ze),this.iconCollisionBox=new Ff(ye,Jm.members,ze);for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(s,c,f,_,v,w,T,I,E){const L={};for(let F=c;F<f;F++){const N=s.get(F);L.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},L.textFeatureIndex=N.featureIndex;break}for(let F=_;F<v;F++){const N=s.get(F);L.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},L.verticalTextFeatureIndex=N.featureIndex;break}for(let F=w;F<T;F++){const N=s.get(F);L.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},L.iconFeatureIndex=N.featureIndex;break}for(let F=I;F<E;F++){const N=s.get(F);L.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},L.verticalIconFeatureIndex=N.featureIndex;break}return L}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,c){const f=s.placedSymbolArray.get(c),_=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<_;v+=4)s.indexArray.emplaceBack(v,v+1,v+2),s.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(s),f=Math.cos(s),_=[],v=[],w=[];for(let T=0;T<this.symbolInstances.length;++T){w.push(T);const I=this.symbolInstances.get(T);_.push(0|Math.round(c*I.anchorX+f*I.anchorY)),v.push(I.featureIndex)}return w.sort((T,I)=>_[T]-_[I]||v[I]-v[T]),w}addToSortKeyRanges(s,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,v,w)=>{_>=0&&w.indexOf(_)===v&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mg,gg;dt("SymbolBucket",kl,{omit:["layers","collisionBoxArray","features","compareText"]}),kl.MAX_GLYPHS=65535,kl.addDynamicAttributes=Lf;var Bf={get paint(){return gg=gg||new rs({"icon-opacity":new Ct(De.paint_symbol["icon-opacity"]),"icon-color":new Ct(De.paint_symbol["icon-color"]),"icon-halo-color":new Ct(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ct(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ct(De.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(De.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ct(De.paint_symbol["text-opacity"]),"text-color":new Ct(De.paint_symbol["text-color"],{runtimeType:Hi,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Ct(De.paint_symbol["text-halo-color"]),"text-halo-width":new Ct(De.paint_symbol["text-halo-width"]),"text-halo-blur":new Ct(De.paint_symbol["text-halo-blur"]),"text-translate":new bt(De.paint_symbol["text-translate"]),"text-translate-anchor":new bt(De.paint_symbol["text-translate-anchor"])})},get layout(){return mg=mg||new rs({"symbol-placement":new bt(De.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ct(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(De.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(De.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bt(De.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bt(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ct(De.layout_symbol["icon-size"]),"icon-text-fit":new bt(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ct(De.layout_symbol["icon-image"]),"icon-rotate":new Ct(De.layout_symbol["icon-rotate"]),"icon-padding":new Ct(De.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(De.layout_symbol["icon-keep-upright"]),"icon-offset":new Ct(De.layout_symbol["icon-offset"]),"icon-anchor":new Ct(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(De.layout_symbol["text-rotation-alignment"]),"text-field":new Ct(De.layout_symbol["text-field"]),"text-font":new Ct(De.layout_symbol["text-font"]),"text-size":new Ct(De.layout_symbol["text-size"]),"text-max-width":new Ct(De.layout_symbol["text-max-width"]),"text-line-height":new bt(De.layout_symbol["text-line-height"]),"text-letter-spacing":new Ct(De.layout_symbol["text-letter-spacing"]),"text-justify":new Ct(De.layout_symbol["text-justify"]),"text-radial-offset":new Ct(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(De.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ct(De.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ct(De.layout_symbol["text-anchor"]),"text-max-angle":new bt(De.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(De.layout_symbol["text-writing-mode"]),"text-rotate":new Ct(De.layout_symbol["text-rotate"]),"text-padding":new bt(De.layout_symbol["text-padding"]),"text-keep-upright":new bt(De.layout_symbol["text-keep-upright"]),"text-transform":new Ct(De.layout_symbol["text-transform"]),"text-offset":new Ct(De.layout_symbol["text-offset"]),"text-allow-overlap":new bt(De.layout_symbol["text-allow-overlap"]),"text-overlap":new bt(De.layout_symbol["text-overlap"]),"text-ignore-placement":new bt(De.layout_symbol["text-ignore-placement"]),"text-optional":new bt(De.layout_symbol["text-optional"])})}};class _g{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:vs,this.defaultValue=s}evaluate(s){if(s.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(s.formattedSection))return c.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dt("FormatSectionOverride",_g,{omit:["defaultValue"]});class Eu extends Gs{constructor(s){super(s,Bf)}recalculate(s,c){if(super.recalculate(s,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const v of f)_.indexOf(v)<0&&_.push(v);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,c,f,_){const v=this.layout.get(s).evaluate(c,{},f,_),w=this._unevaluatedLayout._values[s];return w.isDataDriven()||vi(w.value)||!v?v:function(T,I){return I.replace(/{([^{}]+)}/g,(E,L)=>T&&L in T?String(T[L]):"")}(c.properties,v)}createBucket(s){return new kl(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Bf.paint.overridableProperties){if(!Eu.hasPaintOverride(this.layout,s))continue;const c=this.paint.get(s),f=new _g(c),_=new fa(f,c.property.specification);let v=null;v=c.value.kind==="constant"||c.value.kind==="source"?new Ao("source",_):new el("composite",_,c.value.zoomStops),this.paint._values[s]=new $s(c.property,v,c.parameters)}}_handleOverridablePaintPropertyUpdate(s,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&Eu.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,c){const f=s.get("text-field"),_=Bf.paint.properties[c];let v=!1;const w=T=>{for(const I of T)if(_.overrides&&_.overrides.hasOverride(I))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof ks)w(f.value.value.sections);else if(f.value.kind==="source"){const T=E=>{v||(E instanceof Wr&&un(E.value)===zn?w(E.value.sections):E instanceof Qa?w(E.sections):E.eachChild(T))},I=f.value;I._styleExpression&&T(I._styleExpression.expression)}return v}}let yg;var Nx={get paint(){return yg=yg||new rs({"background-color":new bt(De.paint_background["background-color"]),"background-pattern":new _c(De.paint_background["background-pattern"]),"background-opacity":new bt(De.paint_background["background-opacity"])})}};class Ux extends Gs{constructor(s){super(s,Nx)}}let bg;var jx={get paint(){return bg=bg||new rs({"raster-opacity":new bt(De.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(De.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(De.paint_raster["raster-saturation"]),"raster-contrast":new bt(De.paint_raster["raster-contrast"]),"raster-resampling":new bt(De.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(De.paint_raster["raster-fade-duration"])})}};class qx extends Gs{constructor(s){super(s,jx)}}class Hx extends Gs{constructor(s){super(s,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Wx{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Of=63710088e-1;class Wo{constructor(s,c){if(isNaN(s)||isNaN(c))throw new Error(`Invalid LngLat object: (${s}, ${c})`);if(this.lng=+s,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wo(Ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const c=Math.PI/180,f=this.lat*c,_=s.lat*c,v=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((s.lng-this.lng)*c);return Of*Math.acos(Math.min(v,1))}static convert(s){if(s instanceof Wo)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Wo(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Wo(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xg=2*Math.PI*Of;function vg(a){return xg*Math.cos(a*Math.PI/180)}function wg(a){return(180+a)/360}function kg(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Sg(a,s){return a/vg(s)}function Vf(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class zu{constructor(s,c,f=0){this.x=+s,this.y=+c,this.z=+f}static fromLngLat(s,c=0){const f=Wo.convert(s);return new zu(wg(f.lng),kg(f.lat),Sg(c,f.lat))}toLngLat(){return new Wo(360*this.x-180,Vf(this.y))}toAltitude(){return this.z*vg(Vf(this.y))}meterInMercatorCoordinateUnits(){return 1/xg*(s=Vf(this.y),1/Math.cos(s*Math.PI/180));var s}}function Cg(a,s,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[a*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}class Nf{constructor(s,c,f){if(s<0||s>25||f<0||f>=Math.pow(2,s)||c<0||c>=Math.pow(2,s))throw new Error(`x=${c}, y=${f}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=c,this.y=f,this.key=Hc(0,s,s,c,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,c,f){const _=(w=this.y,T=this.z,I=Cg(256*(v=this.x),256*(w=Math.pow(2,T)-w-1),T),E=Cg(256*(v+1),256*(w+1),T),I[0]+","+I[1]+","+E[0]+","+E[1]);var v,w,T,I,E;const L=function(F,N,q){let $,Y="";for(let ne=F;ne>0;ne--)$=1<<ne-1,Y+=(N&$?1:0)+(q&$?2:0);return Y}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,_)}isChildOf(s){const c=this.z-s.z;return c>0&&s.x===this.x>>c&&s.y===this.y>>c}getTilePoint(s){const c=Math.pow(2,this.z);return new C((s.x*c-this.x)*qt,(s.y*c-this.y)*qt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tg{constructor(s,c){this.wrap=s,this.canonical=c,this.key=Hc(s,c.z,c.z,c.x,c.y)}}class Js{constructor(s,c,f,_,v){if(s<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${f}`);this.overscaledZ=s,this.wrap=c,this.canonical=new Nf(f,+_,+v),this.key=Hc(c,s,f,_,v)}clone(){return new Js(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-s;return s>this.canonical.z?new Js(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Js(s,this.wrap,s,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(s,c){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?Hc(this.wrap*+c,s,this.canonical.z,this.canonical.x,this.canonical.y):Hc(this.wrap*+c,s,s,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const c=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>c&&s.canonical.y===this.canonical.y>>c}children(s){if(this.overscaledZ>=s)return[new Js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new Js(c,this.wrap,c,f,_),new Js(c,this.wrap,c,f+1,_),new Js(c,this.wrap,c,f,_+1),new Js(c,this.wrap,c,f+1,_+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Js(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new zu(s.x-this.wrap,s.y))}}function Hc(a,s,c,f,_){(a*=2)<0&&(a=-1*a-1);const v=1<<c;return(v*v*a+v*_+f).toString(36)+c.toString(36)+s.toString(36)}dt("CanonicalTileID",Nf),dt("OverscaledTileID",Js,{omit:["posMatrix"]});class Mg{constructor(s,c,f,_=1,v=1,w=1,T=0){if(this.uid=s,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Oe(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const I=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=v,this.blueFactor=w,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<I;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(I,E)]=this.data[this._idx(I-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,I)]=this.data[this._idx(E,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<I;E++)for(let L=0;L<I;L++){const F=this.get(E,L);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(s,c){const f=new Uint8Array(this.data.buffer),_=4*this._idx(s,c);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,c){if(s<-1||s>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(s+1)}unpack(s,c,f){return s*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Ys({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,c,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let _=c*this.dim,v=c*this.dim+this.dim,w=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:_=v-1;break;case 1:v=_+1}switch(f){case-1:w=T-1;break;case 1:T=w+1}const I=-c*this.dim,E=-f*this.dim;for(let L=w;L<T;L++)for(let F=_;F<v;F++)this.data[this._idx(F,L)]=s.data[this._idx(F+I,L+E)]}}dt("DEMData",Mg);class Pg{constructor(s){this._stringToNumber={},this._numberToString=[];for(let c=0;c<s.length;c++){const f=s[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class Ig{constructor(s,c,f,_,v){this.type="Feature",this._vectorTileFeature=s,s._z=c,s._x=f,s._y=_,this.properties=s.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(s[c]=this[c]);return s}}class Ag{constructor(s,c){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new br(qt,16,0),this.grid3D=new br(qt,16,0),this.featureIndexArray=new D,this.promoteId=c}insert(s,c,f,_,v,w){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,v);const I=w?this.grid3D:this.grid;for(let E=0;E<c.length;E++){const L=c[E],F=[1/0,1/0,-1/0,-1/0];for(let N=0;N<L.length;N++){const q=L[N];F[0]=Math.min(F[0],q.x),F[1]=Math.min(F[1],q.y),F[2]=Math.max(F[2],q.x),F[3]=Math.max(F[3],q.y)}F[0]<qt&&F[1]<qt&&F[2]>=0&&F[3]>=0&&I.insert(T,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new jo.VectorTile(new Pf(this.rawTileData)).layers,this.sourceLayerCoder=new Pg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,c,f,_){this.loadVTLayers();const v=s.params||{},w=qt/s.tileSize/s.scale,T=nl(v.filter),I=s.queryGeometry,E=s.queryPadding*w,L=zg(I),F=this.grid.query(L.minX-E,L.minY-E,L.maxX+E,L.maxY+E),N=zg(s.cameraQueryGeometry),q=this.grid3D.query(N.minX-E,N.minY-E,N.maxX+E,N.maxY+E,(ne,le,ve,he)=>function(_e,Fe,Ue,ot,gt){for(const st of _e)if(Fe<=st.x&&Ue<=st.y&&ot>=st.x&&gt>=st.y)return!0;const rt=[new C(Fe,Ue),new C(Fe,gt),new C(ot,gt),new C(ot,Ue)];if(_e.length>2){for(const st of rt)if(gl(_e,st))return!0}for(let st=0;st<_e.length-1;st++)if(kb(_e[st],_e[st+1],rt))return!0;return!1}(s.cameraQueryGeometry,ne-E,le-E,ve+E,he+E));for(const ne of q)F.push(ne);F.sort(Zx);const $={};let Y;for(let ne=0;ne<F.length;ne++){const le=F[ne];if(le===Y)continue;Y=le;const ve=this.featureIndexArray.get(le);let he=null;this.loadMatchingFeature($,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,T,v.layers,v.availableImages,c,f,_,(_e,Fe,Ue)=>(he||(he=no(_e)),Fe.queryIntersectsFeature(I,_e,Ue,he,this.z,s.transform,w,s.pixelPosMatrix)))}return $}loadMatchingFeature(s,c,f,_,v,w,T,I,E,L,F){const N=this.bucketLayerIDs[c];if(w&&!function(ne,le){for(let ve=0;ve<ne.length;ve++)if(le.indexOf(ne[ve])>=0)return!0;return!1}(w,N))return;const q=this.sourceLayerCoder.decode(f),$=this.vtLayers[q].feature(_);if(v.needGeometry){const ne=so($,!0);if(!v.filter(new Pi(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!v.filter(new Pi(this.tileID.overscaledZ),$))return;const Y=this.getId($,q);for(let ne=0;ne<N.length;ne++){const le=N[ne];if(w&&w.indexOf(le)<0)continue;const ve=I[le];if(!ve)continue;let he={};Y&&L&&(he=L.getState(ve.sourceLayer||"_geojsonTileLayer",Y));const _e=xe({},E[le]);_e.paint=Eg(_e.paint,ve.paint,$,he,T),_e.layout=Eg(_e.layout,ve.layout,$,he,T);const Fe=!F||F($,ve,he);if(!Fe)continue;const Ue=new Ig($,this.z,this.x,this.y,Y);Ue.layer=_e;let ot=s[le];ot===void 0&&(ot=s[le]=[]),ot.push({featureIndex:_,feature:Ue,intersectionZ:Fe})}}lookupSymbolFeatures(s,c,f,_,v,w,T,I){const E={};this.loadVTLayers();const L=nl(v);for(const F of s)this.loadMatchingFeature(E,f,_,F,L,w,T,I,c);return E}hasLayer(s){for(const c of this.bucketLayerIDs)for(const f of c)if(s===f)return!0;return!1}getId(s,c){let f=s.id;return this.promoteId&&(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function Eg(a,s,c,f,_){return ke(a,(v,w)=>{const T=s instanceof ya?s.get(w):null;return T&&T.evaluate?T.evaluate(c,f,_):T})}function zg(a){let s=1/0,c=1/0,f=-1/0,_=-1/0;for(const v of a)s=Math.min(s,v.x),c=Math.min(c,v.y),f=Math.max(f,v.x),_=Math.max(_,v.y);return{minX:s,minY:c,maxX:f,maxY:_}}function Zx(a,s){return s-a}function Dg(a,s,c,f,_){const v=[];for(let w=0;w<a.length;w++){const T=a[w];let I;for(let E=0;E<T.length-1;E++){let L=T[E],F=T[E+1];L.x<s&&F.x<s||(L.x<s?L=new C(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<s&&(F=new C(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<c&&F.y<c||(L.y<c?L=new C(L.x+(c-L.y)/(F.y-L.y)*(F.x-L.x),c)._round():F.y<c&&(F=new C(L.x+(c-L.y)/(F.y-L.y)*(F.x-L.x),c)._round()),L.x>=f&&F.x>=f||(L.x>=f?L=new C(f,L.y+(f-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=f&&(F=new C(f,L.y+(f-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=_&&F.y>=_||(L.y>=_?L=new C(L.x+(_-L.y)/(F.y-L.y)*(F.x-L.x),_)._round():F.y>=_&&(F=new C(L.x+(_-L.y)/(F.y-L.y)*(F.x-L.x),_)._round()),I&&L.equals(I[I.length-1])||(I=[L],v.push(I)),I.push(F)))))}}return v}dt("FeatureIndex",Ag,{omit:["rawTileData","sourceLayerCoder"]});class Zo extends C{constructor(s,c,f,_){super(s,c),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new Zo(this.x,this.y,this.angle,this.segment)}}function Lg(a,s,c,f,_){if(s.segment===void 0||c===0)return!0;let v=s,w=s.segment+1,T=0;for(;T>-c/2;){if(w--,w<0)return!1;T-=a[w].dist(v),v=a[w]}T+=a[w].dist(a[w+1]),w++;const I=[];let E=0;for(;T<c/2;){const L=a[w],F=a[w+1];if(!F)return!1;let N=a[w-1].angleTo(L)-L.angleTo(F);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:N}),E+=N;T-I[0].distance>f;)E-=I.shift().angleDelta;if(E>_)return!1;w++,T+=L.dist(F)}return!0}function Rg(a){let s=0;for(let c=0;c<a.length-1;c++)s+=a[c].dist(a[c+1]);return s}function Fg(a,s,c){return a?.6*s*c:0}function Bg(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function $x(a,s,c,f,_,v){const w=Fg(c,_,v),T=Bg(c,f)*v;let I=0;const E=Rg(a)/2;for(let L=0;L<a.length-1;L++){const F=a[L],N=a[L+1],q=F.dist(N);if(I+q>E){const $=(E-I)/q,Y=Cs.number(F.x,N.x,$),ne=Cs.number(F.y,N.y,$),le=new Zo(Y,ne,N.angleTo(F),L);return le._round(),!w||Lg(a,le,T,w,s)?le:void 0}I+=q}}function Gx(a,s,c,f,_,v,w,T,I){const E=Fg(f,v,w),L=Bg(f,_),F=L*w,N=a[0].x===0||a[0].x===I||a[0].y===0||a[0].y===I;return s-F<s/4&&(s=F+s/4),Og(a,N?s/2*T%s:(L/2+2*v)*w*T%s,s,E,c,F,N,!1,I)}function Og(a,s,c,f,_,v,w,T,I){const E=v/2,L=Rg(a);let F=0,N=s-c,q=[];for(let $=0;$<a.length-1;$++){const Y=a[$],ne=a[$+1],le=Y.dist(ne),ve=ne.angleTo(Y);for(;N+c<F+le;){N+=c;const he=(N-F)/le,_e=Cs.number(Y.x,ne.x,he),Fe=Cs.number(Y.y,ne.y,he);if(_e>=0&&_e<I&&Fe>=0&&Fe<I&&N-E>=0&&N+E<=L){const Ue=new Zo(_e,Fe,ve,$);Ue._round(),f&&!Lg(a,Ue,v,f,_)||q.push(Ue)}}F+=le}return T||q.length||w||(q=Og(a,F/2,c,f,_,v,w,!0,I)),q}dt("Anchor",Zo);const Sl=Ps;function Vg(a,s,c,f){const _=[],v=a.image,w=v.pixelRatio,T=v.paddedRect.w-2*Sl,I=v.paddedRect.h-2*Sl,E=a.right-a.left,L=a.bottom-a.top,F=v.stretchX||[[0,T]],N=v.stretchY||[[0,I]],q=(Qe,ft)=>Qe+ft[1]-ft[0],$=F.reduce(q,0),Y=N.reduce(q,0),ne=T-$,le=I-Y;let ve=0,he=$,_e=0,Fe=Y,Ue=0,ot=ne,gt=0,rt=le;if(v.content&&f){const Qe=v.content;ve=Du(F,0,Qe[0]),_e=Du(N,0,Qe[1]),he=Du(F,Qe[0],Qe[2]),Fe=Du(N,Qe[1],Qe[3]),Ue=Qe[0]-ve,gt=Qe[1]-_e,ot=Qe[2]-Qe[0]-he,rt=Qe[3]-Qe[1]-Fe}const st=(Qe,ft,it,Xe)=>{const kt=Lu(Qe.stretch-ve,he,E,a.left),yt=Ru(Qe.fixed-Ue,ot,Qe.stretch,$),jt=Lu(ft.stretch-_e,Fe,L,a.top),Ai=Ru(ft.fixed-gt,rt,ft.stretch,Y),Ri=Lu(it.stretch-ve,he,E,a.left),xn=Ru(it.fixed-Ue,ot,it.stretch,$),Os=Lu(Xe.stretch-_e,Fe,L,a.top),ls=Ru(Xe.fixed-gt,rt,Xe.stretch,Y),fn=new C(kt,jt),Ln=new C(Ri,jt),Vn=new C(Ri,Os),cs=new C(kt,Os),hs=new C(yt/w,Ai/w),vn=new C(xn/w,ls/w),wn=s*Math.PI/180;if(wn){const Yn=Math.sin(wn),Is=Math.cos(wn),As=[Is,-Yn,Yn,Is];fn._matMult(As),Ln._matMult(As),cs._matMult(As),Vn._matMult(As)}const Kn=Qe.stretch+Qe.fixed,us=ft.stretch+ft.fixed;return{tl:fn,tr:Ln,bl:cs,br:Vn,tex:{x:v.paddedRect.x+Sl+Kn,y:v.paddedRect.y+Sl+us,w:it.stretch+it.fixed-Kn,h:Xe.stretch+Xe.fixed-us},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hs,pixelOffsetBR:vn,minFontScaleX:ot/w/E,minFontScaleY:rt/w/L,isSDF:c}};if(f&&(v.stretchX||v.stretchY)){const Qe=Ng(F,ne,$),ft=Ng(N,le,Y);for(let it=0;it<Qe.length-1;it++){const Xe=Qe[it],kt=Qe[it+1];for(let yt=0;yt<ft.length-1;yt++)_.push(st(Xe,ft[yt],kt,ft[yt+1]))}}else _.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return _}function Du(a,s,c){let f=0;for(const _ of a)f+=Math.max(s,Math.min(c,_[1]))-Math.max(s,Math.min(c,_[0]));return f}function Ng(a,s,c){const f=[{fixed:-Sl,stretch:0}];for(const[_,v]of a){const w=f[f.length-1];f.push({fixed:_-w.stretch,stretch:w.stretch}),f.push({fixed:_-w.stretch,stretch:w.stretch+(v-_)})}return f.push({fixed:s+Sl,stretch:c}),f}function Lu(a,s,c,f){return a/s*c+f}function Ru(a,s,c,f){return a-s*c/f}class Fu{constructor(s,c,f,_,v,w,T,I,E,L){if(this.boxStartIndex=s.length,E){let F=w.top,N=w.bottom;const q=w.collisionPadding;q&&(F-=q[1],N+=q[3]);let $=N-F;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let F=w.top*T-I[0],N=w.bottom*T+I[2],q=w.left*T-I[3],$=w.right*T+I[1];const Y=w.collisionPadding;if(Y&&(q-=Y[0]*T,F-=Y[1]*T,$+=Y[2]*T,N+=Y[3]*T),L){const ne=new C(q,F),le=new C($,F),ve=new C(q,N),he=new C($,N),_e=L*Math.PI/180;ne._rotate(_e),le._rotate(_e),ve._rotate(_e),he._rotate(_e),q=Math.min(ne.x,le.x,ve.x,he.x),$=Math.max(ne.x,le.x,ve.x,he.x),F=Math.min(ne.y,le.y,ve.y,he.y),N=Math.max(ne.y,le.y,ve.y,he.y)}s.emplaceBack(c.x,c.y,q,F,$,N,f,_,v)}this.boxEndIndex=s.length}}class Xx{constructor(s=[],c=Kx){if(this.data=s,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:c,compare:f}=this,_=c[s];for(;s>0;){const v=s-1>>1,w=c[v];if(f(_,w)>=0)break;c[s]=w,s=v}c[s]=_}_down(s){const{data:c,compare:f}=this,_=this.length>>1,v=c[s];for(;s<_;){let w=1+(s<<1),T=c[w];const I=w+1;if(I<this.length&&f(c[I],T)<0&&(w=I,T=c[I]),f(T,v)>=0)break;c[s]=T,s=w}c[s]=v}}function Kx(a,s){return a<s?-1:a>s?1:0}function Yx(a,s=1,c=!1){let f=1/0,_=1/0,v=-1/0,w=-1/0;const T=a[0];for(let q=0;q<T.length;q++){const $=T[q];(!q||$.x<f)&&(f=$.x),(!q||$.y<_)&&(_=$.y),(!q||$.x>v)&&(v=$.x),(!q||$.y>w)&&(w=$.y)}const I=Math.min(v-f,w-_);let E=I/2;const L=new Xx([],Jx);if(I===0)return new C(f,_);for(let q=f;q<v;q+=I)for(let $=_;$<w;$+=I)L.push(new Cl(q+E,$+E,E,a));let F=function(q){let $=0,Y=0,ne=0;const le=q[0];for(let ve=0,he=le.length,_e=he-1;ve<he;_e=ve++){const Fe=le[ve],Ue=le[_e],ot=Fe.x*Ue.y-Ue.x*Fe.y;Y+=(Fe.x+Ue.x)*ot,ne+=(Fe.y+Ue.y)*ot,$+=3*ot}return new Cl(Y/$,ne/$,0,q)}(a),N=L.length;for(;L.length;){const q=L.pop();(q.d>F.d||!F.d)&&(F=q,c&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,N)),q.max-F.d<=s||(E=q.h/2,L.push(new Cl(q.p.x-E,q.p.y-E,E,a)),L.push(new Cl(q.p.x+E,q.p.y-E,E,a)),L.push(new Cl(q.p.x-E,q.p.y+E,E,a)),L.push(new Cl(q.p.x+E,q.p.y+E,E,a)),N+=4)}return c&&(console.log(`num probes: ${N}`),console.log(`best distance: ${F.d}`)),F.p}function Jx(a,s){return s.max-a.max}function Cl(a,s,c,f){this.p=new C(a,s),this.h=c,this.d=function(_,v){let w=!1,T=1/0;for(let I=0;I<v.length;I++){const E=v[I];for(let L=0,F=E.length,N=F-1;L<F;N=L++){const q=E[L],$=E[N];q.y>_.y!=$.y>_.y&&_.x<($.x-q.x)*(_.y-q.y)/($.y-q.y)+q.x&&(w=!w),T=Math.min(T,km(_,q,$))}}return(w?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var On;u.ap=void 0,(On=u.ap||(u.ap={}))[On.center=1]="center",On[On.left=2]="left",On[On.right=3]="right",On[On.top=4]="top",On[On.bottom=5]="bottom",On[On["top-left"]=6]="top-left",On[On["top-right"]=7]="top-right",On[On["bottom-left"]=8]="bottom-left",On[On["bottom-right"]=9]="bottom-right";const $o=7,Uf=Number.POSITIVE_INFINITY;function Ug(a,s){return s[1]!==Uf?function(c,f,_){let v=0,w=0;switch(f=Math.abs(f),_=Math.abs(_),c){case"top-right":case"top-left":case"top":w=_-$o;break;case"bottom-right":case"bottom-left":case"bottom":w=-_+$o}switch(c){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,w]}(a,s[0],s[1]):function(c,f){let _=0,v=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(c){case"top-right":case"top-left":v=w-$o;break;case"bottom-right":case"bottom-left":v=-w+$o;break;case"bottom":v=-f+$o;break;case"top":v=f-$o}switch(c){case"top-right":case"bottom-right":_=-w;break;case"top-left":case"bottom-left":_=w;break;case"left":_=f;break;case"right":_=-f}return[_,v]}(a,s[0])}function jg(a,s,c){var f;const _=a.layout,v=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(s,{},c);if(v){const T=v.values,I=[];for(let E=0;E<T.length;E+=2){const L=I[E]=T[E],F=T[E+1].map(N=>N*bn);L.startsWith("top")?F[1]-=$o:L.startsWith("bottom")&&(F[1]+=$o),I[E+1]=F}return new Fn(I)}const w=_.get("text-variable-anchor");if(w){let T;T=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(s,{},c)*bn,Uf]:_.get("text-offset").evaluate(s,{},c).map(E=>E*bn);const I=[];for(const E of w)I.push(E,Ug(E,T));return new Fn(I)}return null}function jf(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qx(a,s,c,f,_,v,w,T,I,E,L){let F=v.textMaxSize.evaluate(s,{});F===void 0&&(F=w);const N=a.layers[0].layout,q=N.get("icon-offset").evaluate(s,{},L),$=Hg(c.horizontal),Y=w/24,ne=a.tilePixelRatio*Y,le=a.tilePixelRatio*F/24,ve=a.tilePixelRatio*T,he=a.tilePixelRatio*N.get("symbol-spacing"),_e=N.get("text-padding")*a.tilePixelRatio,Fe=function(Xe,kt,yt,jt=1){const Ai=Xe.get("icon-padding").evaluate(kt,{},yt),Ri=Ai&&Ai.values;return[Ri[0]*jt,Ri[1]*jt,Ri[2]*jt,Ri[3]*jt]}(N,s,L,a.tilePixelRatio),Ue=N.get("text-max-angle")/180*Math.PI,ot=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",gt=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",rt=N.get("symbol-placement"),st=he/2,Qe=N.get("icon-text-fit");let ft;f&&Qe!=="none"&&(a.allowVerticalPlacement&&c.vertical&&(ft=fg(f,c.vertical,Qe,N.get("icon-text-fit-padding"),q,Y)),$&&(f=fg(f,$,Qe,N.get("icon-text-fit-padding"),q,Y)));const it=(Xe,kt)=>{kt.x<0||kt.x>=qt||kt.y<0||kt.y>=qt||function(yt,jt,Ai,Ri,xn,Os,ls,fn,Ln,Vn,cs,hs,vn,wn,Kn,us,Yn,Is,As,kn,Zt,Jn,Nn,Sn,fr){const vr=yt.addToLineVertexArray(jt,Ai);let wr,ao,pr,Qs,Es=0,lo=0,$c=0,Gg=0,Kf=-1,Yf=-1;const co={};let Xg=Vt("");if(yt.allowVerticalPlacement&&Ri.vertical){const Qn=fn.layout.get("text-rotate").evaluate(Zt,{},Sn)+90;pr=new Fu(Ln,jt,Vn,cs,hs,Ri.vertical,vn,wn,Kn,Qn),ls&&(Qs=new Fu(Ln,jt,Vn,cs,hs,ls,Yn,Is,Kn,Qn))}if(xn){const Qn=fn.layout.get("icon-rotate").evaluate(Zt,{}),er=fn.layout.get("icon-text-fit")!=="none",Ta=Vg(xn,Qn,Nn,er),Sr=ls?Vg(ls,Qn,Nn,er):void 0;ao=new Fu(Ln,jt,Vn,cs,hs,xn,Yn,Is,!1,Qn),Es=4*Ta.length;const Ma=yt.iconSizeData;let Br=null;Ma.kind==="source"?(Br=[Fr*fn.layout.get("icon-size").evaluate(Zt,{})],Br[0]>Ho&&Oe(`${yt.layerIds[0]}: Value for "icon-size" is >= ${qc}. Reduce your "icon-size".`)):Ma.kind==="composite"&&(Br=[Fr*Jn.compositeIconSizes[0].evaluate(Zt,{},Sn),Fr*Jn.compositeIconSizes[1].evaluate(Zt,{},Sn)],(Br[0]>Ho||Br[1]>Ho)&&Oe(`${yt.layerIds[0]}: Value for "icon-size" is >= ${qc}. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,Ta,Br,kn,As,Zt,u.ah.none,jt,vr.lineStartIndex,vr.lineLength,-1,Sn),Kf=yt.icon.placedSymbolArray.length-1,Sr&&(lo=4*Sr.length,yt.addSymbols(yt.icon,Sr,Br,kn,As,Zt,u.ah.vertical,jt,vr.lineStartIndex,vr.lineLength,-1,Sn),Yf=yt.icon.placedSymbolArray.length-1)}const Kg=Object.keys(Ri.horizontal);for(const Qn of Kg){const er=Ri.horizontal[Qn];if(!wr){Xg=Vt(er.text);const Sr=fn.layout.get("text-rotate").evaluate(Zt,{},Sn);wr=new Fu(Ln,jt,Vn,cs,hs,er,vn,wn,Kn,Sr)}const Ta=er.positionedLines.length===1;if($c+=qg(yt,jt,er,Os,fn,Kn,Zt,us,vr,Ri.vertical?u.ah.horizontal:u.ah.horizontalOnly,Ta?Kg:[Qn],co,Kf,Jn,Sn),Ta)break}Ri.vertical&&(Gg+=qg(yt,jt,Ri.vertical,Os,fn,Kn,Zt,us,vr,u.ah.vertical,["vertical"],co,Yf,Jn,Sn));const iv=wr?wr.boxStartIndex:yt.collisionBoxArray.length,nv=wr?wr.boxEndIndex:yt.collisionBoxArray.length,sv=pr?pr.boxStartIndex:yt.collisionBoxArray.length,rv=pr?pr.boxEndIndex:yt.collisionBoxArray.length,ov=ao?ao.boxStartIndex:yt.collisionBoxArray.length,av=ao?ao.boxEndIndex:yt.collisionBoxArray.length,lv=Qs?Qs.boxStartIndex:yt.collisionBoxArray.length,cv=Qs?Qs.boxEndIndex:yt.collisionBoxArray.length;let kr=-1;const Ou=(Qn,er)=>Qn&&Qn.circleDiameter?Math.max(Qn.circleDiameter,er):er;kr=Ou(wr,kr),kr=Ou(pr,kr),kr=Ou(ao,kr),kr=Ou(Qs,kr);const Yg=kr>-1?1:0;Yg&&(kr*=fr/bn),yt.glyphOffsetArray.length>=kl.MAX_GLYPHS&&Oe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,Zt.sortKey);const hv=jg(fn,Zt,Sn),[uv,dv]=function(Qn,er){const Ta=Qn.length,Sr=er==null?void 0:er.values;if((Sr==null?void 0:Sr.length)>0)for(let Ma=0;Ma<Sr.length;Ma+=2){const Br=Sr[Ma+1];Qn.emplaceBack(u.ap[Sr[Ma]],Br[0],Br[1])}return[Ta,Qn.length]}(yt.textAnchorOffsets,hv);yt.symbolInstances.emplaceBack(jt.x,jt.y,co.right>=0?co.right:-1,co.center>=0?co.center:-1,co.left>=0?co.left:-1,co.vertical||-1,Kf,Yf,Xg,iv,nv,sv,rv,ov,av,lv,cv,Vn,$c,Gg,Es,lo,Yg,0,vn,kr,uv,dv)}(a,kt,Xe,c,f,_,ft,a.layers[0],a.collisionBoxArray,s.index,s.sourceLayerIndex,a.index,ne,[_e,_e,_e,_e],ot,I,ve,Fe,gt,q,s,v,E,L,w)};if(rt==="line")for(const Xe of Dg(s.geometry,0,0,qt,qt)){const kt=Gx(Xe,he,Ue,c.vertical||$,f,24,le,a.overscaling,qt);for(const yt of kt)$&&ev(a,$.text,st,yt)||it(Xe,yt)}else if(rt==="line-center"){for(const Xe of s.geometry)if(Xe.length>1){const kt=$x(Xe,Ue,c.vertical||$,f,24,le);kt&&it(Xe,kt)}}else if(s.type==="Polygon")for(const Xe of xf(s.geometry,0)){const kt=Yx(Xe,16);it(Xe[0],new Zo(kt.x,kt.y,0))}else if(s.type==="LineString")for(const Xe of s.geometry)it(Xe,new Zo(Xe[0].x,Xe[0].y,0));else if(s.type==="Point")for(const Xe of s.geometry)for(const kt of Xe)it([kt],new Zo(kt.x,kt.y,0))}function qg(a,s,c,f,_,v,w,T,I,E,L,F,N,q,$){const Y=function(ve,he,_e,Fe,Ue,ot,gt,rt){const st=Fe.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,Qe=[];for(const ft of he.positionedLines)for(const it of ft.positionedGlyphs){if(!it.rect)continue;const Xe=it.rect||{};let kt=og+1,yt=!0,jt=1,Ai=0;const Ri=(Ue||rt)&&it.vertical,xn=it.metrics.advance*it.scale/2;if(rt&&he.verticalizable&&(Ai=ft.lineOffset/2-(it.imageName?-(bn-it.metrics.width*it.scale)/2:(it.scale-1)*bn)),it.imageName){const kn=gt[it.imageName];yt=kn.sdf,jt=kn.pixelRatio,kt=Ps/jt}const Os=Ue?[it.x+xn,it.y]:[0,0];let ls=Ue?[0,0]:[it.x+xn+_e[0],it.y+_e[1]-Ai],fn=[0,0];Ri&&(fn=ls,ls=[0,0]);const Ln=it.metrics.isDoubleResolution?2:1,Vn=(it.metrics.left-kt)*it.scale-xn+ls[0],cs=(-it.metrics.top-kt)*it.scale+ls[1],hs=Vn+Xe.w/Ln*it.scale/jt,vn=cs+Xe.h/Ln*it.scale/jt,wn=new C(Vn,cs),Kn=new C(hs,cs),us=new C(Vn,vn),Yn=new C(hs,vn);if(Ri){const kn=new C(-xn,xn-Uc),Zt=-Math.PI/2,Jn=bn/2-xn,Nn=new C(5-Uc-Jn,-(it.imageName?Jn:0)),Sn=new C(...fn);wn._rotateAround(Zt,kn)._add(Nn)._add(Sn),Kn._rotateAround(Zt,kn)._add(Nn)._add(Sn),us._rotateAround(Zt,kn)._add(Nn)._add(Sn),Yn._rotateAround(Zt,kn)._add(Nn)._add(Sn)}if(st){const kn=Math.sin(st),Zt=Math.cos(st),Jn=[Zt,-kn,kn,Zt];wn._matMult(Jn),Kn._matMult(Jn),us._matMult(Jn),Yn._matMult(Jn)}const Is=new C(0,0),As=new C(0,0);Qe.push({tl:wn,tr:Kn,bl:us,br:Yn,tex:Xe,writingMode:he.writingMode,glyphOffset:Os,sectionIndex:it.sectionIndex,isSDF:yt,pixelOffsetTL:Is,pixelOffsetBR:As,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,c,T,_,v,w,f,a.allowVerticalPlacement),ne=a.textSizeData;let le=null;ne.kind==="source"?(le=[Fr*_.layout.get("text-size").evaluate(w,{})],le[0]>Ho&&Oe(`${a.layerIds[0]}: Value for "text-size" is >= ${qc}. Reduce your "text-size".`)):ne.kind==="composite"&&(le=[Fr*q.compositeTextSizes[0].evaluate(w,{},$),Fr*q.compositeTextSizes[1].evaluate(w,{},$)],(le[0]>Ho||le[1]>Ho)&&Oe(`${a.layerIds[0]}: Value for "text-size" is >= ${qc}. Reduce your "text-size".`)),a.addSymbols(a.text,Y,le,T,v,w,E,s,I.lineStartIndex,I.lineLength,N,$);for(const ve of L)F[ve]=a.text.placedSymbolArray.length-1;return 4*Y.length}function Hg(a){for(const s in a)return a[s];return null}function ev(a,s,c,f){const _=a.compareText;if(s in _){const v=_[s];for(let w=v.length-1;w>=0;w--)if(f.dist(v[w])<c)return!0}else _[s]=[];return _[s].push(f),!1}const Wg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qf{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(s,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const v=Wg[15&f];if(!v)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(s,2,1),[T]=new Uint32Array(s,4,1);return new qf(T,w,v,s)}constructor(s,c=64,f=Float64Array,_){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const v=Wg.indexOf(this.ArrayType),w=2*s*this.ArrayType.BYTES_PER_ELEMENT,T=s*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+T+I,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+w+T+I),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+T+I,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=s)}add(s,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=s,this.coords[this._pos++]=c,f}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Hf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,c,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:w,nodeSize:T}=this,I=[0,v.length-1,0],E=[];for(;I.length;){const L=I.pop()||0,F=I.pop()||0,N=I.pop()||0;if(F-N<=T){for(let ne=N;ne<=F;ne++){const le=w[2*ne],ve=w[2*ne+1];le>=s&&le<=f&&ve>=c&&ve<=_&&E.push(v[ne])}continue}const q=N+F>>1,$=w[2*q],Y=w[2*q+1];$>=s&&$<=f&&Y>=c&&Y<=_&&E.push(v[q]),(L===0?s<=$:c<=Y)&&(I.push(N),I.push(q-1),I.push(1-L)),(L===0?f>=$:_>=Y)&&(I.push(q+1),I.push(F),I.push(1-L))}return E}within(s,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:w}=this,T=[0,_.length-1,0],I=[],E=f*f;for(;T.length;){const L=T.pop()||0,F=T.pop()||0,N=T.pop()||0;if(F-N<=w){for(let ne=N;ne<=F;ne++)$g(v[2*ne],v[2*ne+1],s,c)<=E&&I.push(_[ne]);continue}const q=N+F>>1,$=v[2*q],Y=v[2*q+1];$g($,Y,s,c)<=E&&I.push(_[q]),(L===0?s-f<=$:c-f<=Y)&&(T.push(N),T.push(q-1),T.push(1-L)),(L===0?s+f>=$:c+f>=Y)&&(T.push(q+1),T.push(F),T.push(1-L))}return I}}function Hf(a,s,c,f,_,v){if(_-f<=c)return;const w=f+_>>1;Zg(a,s,w,f,_,v),Hf(a,s,c,f,w-1,1-v),Hf(a,s,c,w+1,_,1-v)}function Zg(a,s,c,f,_,v){for(;_>f;){if(_-f>600){const E=_-f+1,L=c-f+1,F=Math.log(E),N=.5*Math.exp(2*F/3),q=.5*Math.sqrt(F*N*(E-N)/E)*(L-E/2<0?-1:1);Zg(a,s,c,Math.max(f,Math.floor(c-L*N/E+q)),Math.min(_,Math.floor(c+(E-L)*N/E+q)),v)}const w=s[2*c+v];let T=f,I=_;for(Wc(a,s,f,c),s[2*_+v]>w&&Wc(a,s,f,_);T<I;){for(Wc(a,s,T,I),T++,I--;s[2*T+v]<w;)T++;for(;s[2*I+v]>w;)I--}s[2*f+v]===w?Wc(a,s,f,I):(I++,Wc(a,s,I,_)),I<=c&&(f=I+1),c<=I&&(_=I-1)}}function Wc(a,s,c,f){Wf(a,c,f),Wf(s,2*c,2*f),Wf(s,2*c+1,2*f+1)}function Wf(a,s,c){const f=a[s];a[s]=a[c],a[c]=f}function $g(a,s,c,f){const _=a-c,v=s-f;return _*_+v*v}var Zf;u.bd=void 0,(Zf=u.bd||(u.bd={})).create="create",Zf.load="load",Zf.fullLoad="fullLoad";let Bu=null,Zc=[];const $f=1e3/60,Gf="loadTime",Xf="fullLoadTime",tv={mark(a){performance.mark(a)},frame(a){const s=a;Bu!=null&&Zc.push(s-Bu),Bu=s},clearMetrics(){Bu=null,Zc=[],performance.clearMeasures(Gf),performance.clearMeasures(Xf);for(const a in u.bd)performance.clearMarks(u.bd[a])},getPerformanceMetrics(){performance.measure(Gf,u.bd.create,u.bd.load),performance.measure(Xf,u.bd.create,u.bd.fullLoad);const a=performance.getEntriesByName(Gf)[0].duration,s=performance.getEntriesByName(Xf)[0].duration,c=Zc.length,f=1/(Zc.reduce((v,w)=>v+w,0)/c/1e3),_=Zc.filter(v=>v>$f).reduce((v,w)=>v+(w-$f)/$f,0);return{loadTime:a,fullLoadTime:s,fps:f,percentDroppedFrames:_/(c+_)*100,totalFrames:c}}};u.$=Ze,u.A=_l,u.B=function(a){if(Yt==null){const s=a.navigator?a.navigator.userAgent:null;Yt=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Yt},u.C=class{constructor(a,s){this.target=a,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Wx(()=>this.process()),this.subscription=function(c,f,_,v){return c.addEventListener(f,_,!1),{unsubscribe:()=>{c.removeEventListener(f,_,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=Ft(self)?a:window}registerMessageHandler(a,s){this.messageHandlers[a]=s}sendAsync(a,s){return new Promise((c,f)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:c,reject:f},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const T={id:_,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const v=[],w=Object.assign(Object.assign({},a),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Yr(a.data,v)});this.target.postMessage(w,{transfer:v})})}receive(a){const s=a.data,c=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(Ft(self)||s.mustQueue)return this.tasks[c]=s,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,s)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),s=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(a,s)}processTask(a,s){return l(this,void 0,void 0,function*(){if(s.type==="<response>"){const _=this.resolveRejects[a];return delete this.resolveRejects[a],_?void(s.error?_.reject(Bo(s.error)):_.resolve(Bo(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Bo(s.data),f=new AbortController;this.abortControllers[a]=f;try{const _=yield this.messageHandlers[s.type](s.sourceMapId,c,f);this.completeTask(a,null,_)}catch(_){this.completeTask(a,_)}})}completeTask(a,s,c){const f=[];delete this.abortControllers[a];const _={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Yr(s):null,data:Yr(c,f)};this.target.postMessage(_,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=bt,u.E=qs,u.F=function(){var a=new _l(16);return _l!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},u.G=Xi,u.H=function(a,s,c){var f,_,v,w,T,I,E,L,F,N,q,$,Y=c[0],ne=c[1],le=c[2];return s===a?(a[12]=s[0]*Y+s[4]*ne+s[8]*le+s[12],a[13]=s[1]*Y+s[5]*ne+s[9]*le+s[13],a[14]=s[2]*Y+s[6]*ne+s[10]*le+s[14],a[15]=s[3]*Y+s[7]*ne+s[11]*le+s[15]):(_=s[1],v=s[2],w=s[3],T=s[4],I=s[5],E=s[6],L=s[7],F=s[8],N=s[9],q=s[10],$=s[11],a[0]=f=s[0],a[1]=_,a[2]=v,a[3]=w,a[4]=T,a[5]=I,a[6]=E,a[7]=L,a[8]=F,a[9]=N,a[10]=q,a[11]=$,a[12]=f*Y+T*ne+F*le+s[12],a[13]=_*Y+I*ne+N*le+s[13],a[14]=v*Y+E*ne+q*le+s[14],a[15]=w*Y+L*ne+$*le+s[15]),a},u.I=Af,u.J=function(a,s,c){var f=c[0],_=c[1],v=c[2];return a[0]=s[0]*f,a[1]=s[1]*f,a[2]=s[2]*f,a[3]=s[3]*f,a[4]=s[4]*_,a[5]=s[5]*_,a[6]=s[6]*_,a[7]=s[7]*_,a[8]=s[8]*v,a[9]=s[9]*v,a[10]=s[10]*v,a[11]=s[11]*v,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},u.K=Mm,u.L=function(a,s){const c={};for(let f=0;f<s.length;f++){const _=s[f];_ in a&&(c[_]=a[_])}return c},u.M=Wo,u.N=wg,u.O=kg,u.P=C,u.Q=Js,u.R=Ys,u.S=X,u.T=mc,u.U=re,u.V=ji,u.W=qt,u.X=on,u.Y=zu,u.Z=class extends Lr{},u._=l,u.a=Gi,u.a$=function(a,s,c){return a[0]=s[0]*c[0],a[1]=s[1]*c[1],a[2]=s[2]*c[2],a[3]=s[3]*c[3],a},u.a0=Nf,u.a1=Ye,u.a2=a=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(c=>{s.onloadstart=()=>{c(s)};for(const f of a){const _=window.document.createElement("source");Zn(f)||(s.crossOrigin="Anonymous"),_.src=f,s.appendChild(_)}})},u.a3=function(){return pe++},u.a4=pu,u.a5=kl,u.a6=nl,u.a7=so,u.a8=Pi,u.a9=Ig,u.aA=Ve,u.aB=function(a,s){if(!a)return[{command:"setStyle",args:[s]}];let c=[];try{if(!Ut(a.version,s.version))return[{command:"setStyle",args:[s]}];Ut(a.center,s.center)||c.push({command:"setCenter",args:[s.center]}),Ut(a.zoom,s.zoom)||c.push({command:"setZoom",args:[s.zoom]}),Ut(a.bearing,s.bearing)||c.push({command:"setBearing",args:[s.bearing]}),Ut(a.pitch,s.pitch)||c.push({command:"setPitch",args:[s.pitch]}),Ut(a.sprite,s.sprite)||c.push({command:"setSprite",args:[s.sprite]}),Ut(a.glyphs,s.glyphs)||c.push({command:"setGlyphs",args:[s.glyphs]}),Ut(a.transition,s.transition)||c.push({command:"setTransition",args:[s.transition]}),Ut(a.light,s.light)||c.push({command:"setLight",args:[s.light]}),Ut(a.terrain,s.terrain)||c.push({command:"setTerrain",args:[s.terrain]}),Ut(a.sky,s.sky)||c.push({command:"setSky",args:[s.sky]});const f={},_=[];(function(w,T,I,E){let L;for(L in T=T||{},w=w||{})Object.prototype.hasOwnProperty.call(w,L)&&(Object.prototype.hasOwnProperty.call(T,L)||xi(L,I,E));for(L in T)Object.prototype.hasOwnProperty.call(T,L)&&(Object.prototype.hasOwnProperty.call(w,L)?Ut(w[L],T[L])||(w[L].type==="geojson"&&T[L].type==="geojson"&&Mn(w,T,L)?Ki(I,{command:"setGeoJSONSourceData",args:[L,T[L].data]}):is(L,T,I,E)):ts(L,T,I))})(a.sources,s.sources,_,f);const v=[];a.layers&&a.layers.forEach(w=>{"source"in w&&f[w.source]?c.push({command:"removeLayer",args:[w.id]}):v.push(w)}),c=c.concat(_),function(w,T,I){T=T||[];const E=(w=w||[]).map(Ls),L=T.map(Ls),F=w.reduce(Ws,{}),N=T.reduce(Ws,{}),q=E.slice(),$=Object.create(null);let Y,ne,le,ve,he;for(let _e=0,Fe=0;_e<E.length;_e++)Y=E[_e],Object.prototype.hasOwnProperty.call(N,Y)?Fe++:(Ki(I,{command:"removeLayer",args:[Y]}),q.splice(q.indexOf(Y,Fe),1));for(let _e=0,Fe=0;_e<L.length;_e++)Y=L[L.length-1-_e],q[q.length-1-_e]!==Y&&(Object.prototype.hasOwnProperty.call(F,Y)?(Ki(I,{command:"removeLayer",args:[Y]}),q.splice(q.lastIndexOf(Y,q.length-Fe),1)):Fe++,ve=q[q.length-_e],Ki(I,{command:"addLayer",args:[N[Y],ve]}),q.splice(q.length-_e,0,Y),$[Y]=!0);for(let _e=0;_e<L.length;_e++)if(Y=L[_e],ne=F[Y],le=N[Y],!$[Y]&&!Ut(ne,le))if(Ut(ne.source,le.source)&&Ut(ne["source-layer"],le["source-layer"])&&Ut(ne.type,le.type)){for(he in Gn(ne.layout,le.layout,I,Y,null,"setLayoutProperty"),Gn(ne.paint,le.paint,I,Y,null,"setPaintProperty"),Ut(ne.filter,le.filter)||Ki(I,{command:"setFilter",args:[Y,le.filter]}),Ut(ne.minzoom,le.minzoom)&&Ut(ne.maxzoom,le.maxzoom)||Ki(I,{command:"setLayerZoomRange",args:[Y,le.minzoom,le.maxzoom]}),ne)Object.prototype.hasOwnProperty.call(ne,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Gn(ne[he],le[he],I,Y,he.slice(6),"setPaintProperty"):Ut(ne[he],le[he])||Ki(I,{command:"setLayerProperty",args:[Y,he,le[he]]}));for(he in le)Object.prototype.hasOwnProperty.call(le,he)&&!Object.prototype.hasOwnProperty.call(ne,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Gn(ne[he],le[he],I,Y,he.slice(6),"setPaintProperty"):Ut(ne[he],le[he])||Ki(I,{command:"setLayerProperty",args:[Y,he,le[he]]}))}else Ki(I,{command:"removeLayer",args:[Y]}),ve=q[q.lastIndexOf(Y)+1],Ki(I,{command:"addLayer",args:[le,ve]})}(v,s.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[s]}]}return c},u.aC=function(a){const s=[],c=a.id;return c===void 0&&s.push({message:`layers.${c}: missing required property "id"`}),a.render===void 0&&s.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),s},u.aD=function a(s,c){if(Array.isArray(s)){if(!Array.isArray(c)||s.length!==c.length)return!1;for(let f=0;f<s.length;f++)if(!a(s[f],c[f]))return!1;return!0}if(typeof s=="object"&&s!==null&&c!==null){if(typeof c!="object"||Object.keys(s).length!==Object.keys(c).length)return!1;for(const f in s)if(!a(s[f],c[f]))return!1;return!0}return s===c},u.aE=ke,u.aF=Ie,u.aG=class extends wi{constructor(a,s){super(a,s),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},u.aH=Bn,u.aI=class extends wi{constructor(a,s){super(a,s),this.current=to}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let s=1;s<16;s++)if(a[s]!==this.current[s]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},u.aJ=Xs,u.aK=class extends wi{constructor(a,s){super(a,s),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},u.aL=class extends wi{constructor(a,s){super(a,s),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},u.aM=ur,u.aN=function(a,s,c,f,_,v,w){var T=1/(s-c),I=1/(f-_),E=1/(v-w);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*I,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*E,a[11]=0,a[12]=(s+c)*T,a[13]=(_+f)*I,a[14]=(w+v)*E,a[15]=1,a},u.aO=ei,u.aP=Cb,u.aQ=class extends wa{},u.aR=bx,u.aS=class extends Vo{},u.aT=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},u.aU=zm,u.aV=B,u.aW=class extends Cc{},u.aX=Pe,u.aY=function(a,s){return a[0]===s[0]&&a[1]===s[1]&&a[2]===s[2]&&a[3]===s[3]&&a[4]===s[4]&&a[5]===s[5]&&a[6]===s[6]&&a[7]===s[7]&&a[8]===s[8]&&a[9]===s[9]&&a[10]===s[10]&&a[11]===s[11]&&a[12]===s[12]&&a[13]===s[13]&&a[14]===s[14]&&a[15]===s[15]},u.aZ=function(a,s){var c=a[0],f=a[1],_=a[2],v=a[3],w=a[4],T=a[5],I=a[6],E=a[7],L=a[8],F=a[9],N=a[10],q=a[11],$=a[12],Y=a[13],ne=a[14],le=a[15],ve=s[0],he=s[1],_e=s[2],Fe=s[3],Ue=s[4],ot=s[5],gt=s[6],rt=s[7],st=s[8],Qe=s[9],ft=s[10],it=s[11],Xe=s[12],kt=s[13],yt=s[14],jt=s[15];return Math.abs(c-ve)<=as*Math.max(1,Math.abs(c),Math.abs(ve))&&Math.abs(f-he)<=as*Math.max(1,Math.abs(f),Math.abs(he))&&Math.abs(_-_e)<=as*Math.max(1,Math.abs(_),Math.abs(_e))&&Math.abs(v-Fe)<=as*Math.max(1,Math.abs(v),Math.abs(Fe))&&Math.abs(w-Ue)<=as*Math.max(1,Math.abs(w),Math.abs(Ue))&&Math.abs(T-ot)<=as*Math.max(1,Math.abs(T),Math.abs(ot))&&Math.abs(I-gt)<=as*Math.max(1,Math.abs(I),Math.abs(gt))&&Math.abs(E-rt)<=as*Math.max(1,Math.abs(E),Math.abs(rt))&&Math.abs(L-st)<=as*Math.max(1,Math.abs(L),Math.abs(st))&&Math.abs(F-Qe)<=as*Math.max(1,Math.abs(F),Math.abs(Qe))&&Math.abs(N-ft)<=as*Math.max(1,Math.abs(N),Math.abs(ft))&&Math.abs(q-it)<=as*Math.max(1,Math.abs(q),Math.abs(it))&&Math.abs($-Xe)<=as*Math.max(1,Math.abs($),Math.abs(Xe))&&Math.abs(Y-kt)<=as*Math.max(1,Math.abs(Y),Math.abs(kt))&&Math.abs(ne-yt)<=as*Math.max(1,Math.abs(ne),Math.abs(yt))&&Math.abs(le-jt)<=as*Math.max(1,Math.abs(le),Math.abs(jt))},u.a_=function(a,s){return a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[4]=s[4],a[5]=s[5],a[6]=s[6],a[7]=s[7],a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},u.aa=function(a){const s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,_,v)=>{const w=_||v;return s[f]=!w||w.toLowerCase(),""}),s["max-age"]){const c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s},u.ab=function(a,s){const c=[];for(const f in a)f in s||c.push(f);return c},u.ac=de,u.ad=function(a,s,c){var f=Math.sin(c),_=Math.cos(c),v=s[0],w=s[1],T=s[2],I=s[3],E=s[4],L=s[5],F=s[6],N=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=v*_+E*f,a[1]=w*_+L*f,a[2]=T*_+F*f,a[3]=I*_+N*f,a[4]=E*_-v*f,a[5]=L*_-w*f,a[6]=F*_-T*f,a[7]=N*_-I*f,a},u.ae=function(a){var s=new _l(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},u.af=vu,u.ag=function(a,s){let c=0,f=0;if(a.kind==="constant")f=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:_,minZoom:v,maxZoom:w}=a,T=_?de(Xn.interpolationFactor(_,s,v,w),0,1):0;a.kind==="camera"?f=Cs.number(a.minSize,a.maxSize,T):c=T}return{uSizeT:c,uSize:f}},u.ai=function(a,{uSize:s,uSizeT:c},{lowerSize:f,upperSize:_}){return a.kind==="source"?f/Fr:a.kind==="composite"?Cs.number(f/Fr,_/Fr,c):s},u.aj=Lf,u.ak=function(a,s,c,f){const _=s.y-a.y,v=s.x-a.x,w=f.y-c.y,T=f.x-c.x,I=w*v-T*_;if(I===0)return null;const E=(T*(a.y-c.y)-w*(a.x-c.x))/I;return new C(a.x+E*v,a.y+E*_)},u.al=Dg,u.am=ro,u.an=ff,u.ao=bn,u.aq=Df,u.ar=function(a,s){var c=s[0],f=s[1],_=s[2],v=s[3],w=s[4],T=s[5],I=s[6],E=s[7],L=s[8],F=s[9],N=s[10],q=s[11],$=s[12],Y=s[13],ne=s[14],le=s[15],ve=c*T-f*w,he=c*I-_*w,_e=c*E-v*w,Fe=f*I-_*T,Ue=f*E-v*T,ot=_*E-v*I,gt=L*Y-F*$,rt=L*ne-N*$,st=L*le-q*$,Qe=F*ne-N*Y,ft=F*le-q*Y,it=N*le-q*ne,Xe=ve*it-he*ft+_e*Qe+Fe*st-Ue*rt+ot*gt;return Xe?(a[0]=(T*it-I*ft+E*Qe)*(Xe=1/Xe),a[1]=(_*ft-f*it-v*Qe)*Xe,a[2]=(Y*ot-ne*Ue+le*Fe)*Xe,a[3]=(N*Ue-F*ot-q*Fe)*Xe,a[4]=(I*st-w*it-E*rt)*Xe,a[5]=(c*it-_*st+v*rt)*Xe,a[6]=(ne*_e-$*ot-le*he)*Xe,a[7]=(L*ot-N*_e+q*he)*Xe,a[8]=(w*ft-T*st+E*gt)*Xe,a[9]=(f*st-c*ft-v*gt)*Xe,a[10]=($*Ue-Y*_e+le*ve)*Xe,a[11]=(F*_e-L*Ue-q*ve)*Xe,a[12]=(T*rt-w*Qe-I*gt)*Xe,a[13]=(c*Qe-f*rt+_*gt)*Xe,a[14]=(Y*he-$*Fe-ne*ve)*Xe,a[15]=(L*Fe-F*he+N*ve)*Xe,a):null},u.as=jf,u.at=zf,u.au=qf,u.av=function(){const a={},s=De.$version;for(const c in De.$root){const f=De.$root[c];if(f.required){let _=null;_=c==="version"?s:f.type==="array"?[]:{},_!=null&&(a[c]=_)}}return a},u.aw=uc,u.ax=sn,u.ay=function(a){a=a.slice();const s=Object.create(null);for(let c=0;c<a.length;c++)s[a[c].id]=a[c];for(let c=0;c<a.length;c++)"ref"in a[c]&&(a[c]=or(a[c],s[a[c].ref]));return a},u.az=function(a){if(a.type==="custom")return new Hx(a);switch(a.type){case"background":return new Ux(a);case"circle":return new Tb(a);case"fill":return new Zb(a);case"fill-extrusion":return new ax(a);case"heatmap":return new Pb(a);case"hillshade":return new Ab(a);case"line":return new mx(a);case"raster":return new qx(a);case"symbol":return new Eu(a)}},u.b=Qt,u.b0=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},u.b1=Ae,u.b2=Tg,u.b3=Sg,u.b4=function(a,s,c,f,_){var v,w=1/Math.tan(s/2);return a[0]=w/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=w,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,_!=null&&_!==1/0?(a[10]=(_+f)*(v=1/(f-_)),a[14]=2*_*f*v):(a[10]=-1,a[14]=-2*f),a},u.b5=function(a,s,c){var f=Math.sin(c),_=Math.cos(c),v=s[4],w=s[5],T=s[6],I=s[7],E=s[8],L=s[9],F=s[10],N=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=v*_+E*f,a[5]=w*_+L*f,a[6]=T*_+F*f,a[7]=I*_+N*f,a[8]=E*_-v*f,a[9]=L*_-w*f,a[10]=F*_-T*f,a[11]=N*_-I*f,a},u.b6=W,u.b7=ae,u.b8=function(a){return a*Math.PI/180},u.b9=function(a,s){return a[0]=s[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=s[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},u.bA=Jr,u.ba=class extends hl{},u.bb=Of,u.bc=tv,u.be=nt,u.bf=function(a,s){Gi.REGISTERED_PROTOCOLS[a]=s},u.bg=function(a){delete Gi.REGISTERED_PROTOCOLS[a]},u.bh=function(a,s){const c={};for(let _=0;_<a.length;_++){const v=s&&s[a[_].id]||hf(a[_]);s&&(s[a[_].id]=v);let w=c[v];w||(w=c[v]=[]),w.push(a[_])}const f=[];for(const _ in c)f.push(c[_]);return f},u.bi=dt,u.bj=Pg,u.bk=Ag,u.bl=lg,u.bm=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=qt/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const s=a.bucket.layers[0],c=s.layout,f=s._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new Pi(a.bucket.zoom+1),a.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Pi(a.bucket.zoom+1),a.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Pi(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:L}=a.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Pi(E),a.canonical),f["text-size"].possiblyEvaluate(new Pi(L),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:L}=a.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Pi(E),a.canonical),f["icon-size"].possiblyEvaluate(new Pi(L),a.canonical)]}const v=c.get("text-line-height")*bn,w=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),I=c.get("text-size");for(const E of a.bucket.features){const L=c.get("text-font").evaluate(E,{},a.canonical).join(","),F=I.evaluate(E,{},a.canonical),N=_.layoutTextSize.evaluate(E,{},a.canonical),q=_.layoutIconSize.evaluate(E,{},a.canonical),$={horizontal:{},vertical:void 0},Y=E.text;let ne,le=[0,0];if(Y){const _e=Y.toString(),Fe=c.get("text-letter-spacing").evaluate(E,{},a.canonical)*bn,Ue=ol(_e)?Fe:0,ot=c.get("text-anchor").evaluate(E,{},a.canonical),gt=jg(s,E,a.canonical);if(!gt){const it=c.get("text-radial-offset").evaluate(E,{},a.canonical);le=it?Ug(ot,[it*bn,Uf]):c.get("text-offset").evaluate(E,{},a.canonical).map(Xe=>Xe*bn)}let rt=w?"center":c.get("text-justify").evaluate(E,{},a.canonical);const st=c.get("symbol-placement"),Qe=st==="point"?c.get("text-max-width").evaluate(E,{},a.canonical)*bn:0,ft=()=>{a.bucket.allowVerticalPlacement&&_a(_e)&&($.vertical=Pu(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Qe,v,ot,"left",Ue,le,u.ah.vertical,!0,st,N,F))};if(!w&&gt){const it=new Set;if(rt==="auto")for(let kt=0;kt<gt.values.length;kt+=2)it.add(jf(gt.values[kt]));else it.add(rt);let Xe=!1;for(const kt of it)if(!$.horizontal[kt])if(Xe)$.horizontal[kt]=$.horizontal[0];else{const yt=Pu(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Qe,v,"center",kt,Ue,le,u.ah.horizontal,!1,st,N,F);yt&&($.horizontal[kt]=yt,Xe=yt.positionedLines.length===1)}ft()}else{rt==="auto"&&(rt=jf(ot));const it=Pu(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Qe,v,ot,rt,Ue,le,u.ah.horizontal,!1,st,N,F);it&&($.horizontal[rt]=it),ft(),_a(_e)&&w&&T&&($.vertical=Pu(Y,a.glyphMap,a.glyphPositions,a.imagePositions,L,Qe,v,ot,rt,Ue,le,u.ah.vertical,!1,st,N,F))}}let ve=!1;if(E.icon&&E.icon.name){const _e=a.imageMap[E.icon.name];_e&&(ne=Fx(a.imagePositions[E.icon.name],c.get("icon-offset").evaluate(E,{},a.canonical),c.get("icon-anchor").evaluate(E,{},a.canonical)),ve=!!_e.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&Oe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==a.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const he=Hg($.horizontal)||$.vertical;a.bucket.iconsInText=!!he&&he.iconsInText,(he||ne)&&Qx(a.bucket,E,$,ne,a.imageMap,_,N,q,le,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},u.bn=Tf,u.bo=kf,u.bp=Cf,u.bq=jo,u.br=Pf,u.bs=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},u.bt=function(a,s,c,f,_){return l(this,void 0,void 0,function*(){if(re())try{return yield ji(a,s,c,f,_)}catch{}return function(v,w,T,I,E){const L=v.width,F=v.height;di&&ii||(di=new OffscreenCanvas(L,F),ii=di.getContext("2d",{willReadFrequently:!0})),di.width=L,di.height=F,ii.drawImage(v,0,0,L,F);const N=ii.getImageData(w,T,I,E);return ii.clearRect(0,0,L,F),N.data}(a,s,c,f,_)})},u.bu=Mg,u.bv=p,u.bw=y,u.bx=Qm,u.by=_i,u.bz=function(a){return a.message===Ci},u.c=Ti,u.d=a=>l(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(s)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=xe,u.f=a=>new Promise((s,c)=>{const f=new Image;f.onload=()=>{s(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Tn})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(a)],{type:"image/png"});f.src=a.byteLength?URL.createObjectURL(_):Tn}),u.g=qi,u.h=(a,s)=>_n(xe(a,{type:"json"}),s),u.i=Ft,u.j=Fi,u.k=Ds,u.l=(a,s)=>_n(xe(a,{type:"arrayBuffer"}),s),u.m=_n,u.n=function(a){return new Pf(a).readFields(Ax,[])},u.o=Dc,u.p=ag,u.q=rs,u.r=lc,u.s=Zn,u.t=au,u.u=at,u.v=De,u.w=Oe,u.x=Fo,u.y=function([a,s,c]){return s+=90,s*=Math.PI/180,c*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(c),y:a*Math.sin(s)*Math.sin(c),z:a*Math.cos(c)}},u.z=Cs}),o("worker",["./shared"],function(u){class l{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,U){for(const J of V){this._layerConfigs[J.id]=J;const me=this._layers[J.id]=u.az(J);me._featureFilter=u.a6(me.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of U)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const G=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const J of G){const me=J.map(Ee=>this._layers[Ee.id]),ge=me[0];if(ge.visibility==="none")continue;const be=ge.source||"";let ce=this.familiesBySource[be];ce||(ce=this.familiesBySource[be]={});const Se=ge.sourceLayer||"_geojsonTileLayer";let Ne=ce[Se];Ne||(Ne=ce[Se]=[]),Ne.push(me)}}}class p{constructor(V){const U={},G=[];for(const be in V){const ce=V[be],Se=U[be]={};for(const Ne in ce){const Ee=ce[+Ne];if(!Ee||Ee.bitmap.width===0||Ee.bitmap.height===0)continue;const Be={x:0,y:0,w:Ee.bitmap.width+2,h:Ee.bitmap.height+2};G.push(Be),Se[Ne]={rect:Be,metrics:Ee.metrics}}}const{w:J,h:me}=u.p(G),ge=new u.o({width:J||1,height:me||1});for(const be in V){const ce=V[be];for(const Se in ce){const Ne=ce[+Se];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Ee=U[be][Se].rect;u.o.copy(Ne.bitmap,ge,{x:0,y:0},{x:Ee.x+1,y:Ee.y+1},Ne.bitmap)}}this.image=ge,this.positions=U}}u.bi("GlyphAtlas",p);class y{constructor(V){this.tileID=new u.Q(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,U,G,J){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new u.a4;const me=new u.bj(Object.keys(V.layers).sort()),ge=new u.bk(this.tileID,this.promoteId);ge.bucketLayerIDs=[];const be={},ce={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},Se=U.familiesBySource[this.source];for(const Lt in Se){const pi=V.layers[Lt];if(!pi)continue;pi.version===1&&u.w(`Vector tile source "${this.source}" layer "${Lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mi=me.encode(Lt),hn=[];for(let Yi=0;Yi<pi.length;Yi++){const Wi=pi.feature(Yi),Dn=ge.getId(Wi,Lt);hn.push({feature:Wi,id:Dn,index:Yi,sourceLayerIndex:Mi})}for(const Yi of Se[Lt]){const Wi=Yi[0];Wi.source!==this.source&&u.w(`layer.source = ${Wi.source} does not equal this.source = ${this.source}`),Wi.minzoom&&this.zoom<Math.floor(Wi.minzoom)||Wi.maxzoom&&this.zoom>=Wi.maxzoom||Wi.visibility!=="none"&&(k(Yi,this.zoom,G),(be[Wi.id]=Wi.createBucket({index:ge.bucketLayerIDs.length,layers:Yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mi,sourceID:this.source})).populate(hn,ce,this.tileID.canonical),ge.bucketLayerIDs.push(Yi.map(Dn=>Dn.id)))}}const Ne=u.aE(ce.glyphDependencies,Lt=>Object.keys(Lt).map(Number));this.inFlightDependencies.forEach(Lt=>Lt==null?void 0:Lt.abort()),this.inFlightDependencies=[];let Ee=Promise.resolve({});if(Object.keys(Ne).length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),Ee=J.sendAsync({type:"getGlyphs",data:{stacks:Ne,source:this.source,tileID:this.tileID,type:"glyphs"}},Lt)}const Be=Object.keys(ce.iconDependencies);let pt=Promise.resolve({});if(Be.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),pt=J.sendAsync({type:"getImages",data:{icons:Be,source:this.source,tileID:this.tileID,type:"icons"}},Lt)}const wt=Object.keys(ce.patternDependencies);let vt=Promise.resolve({});if(wt.length){const Lt=new AbortController;this.inFlightDependencies.push(Lt),vt=J.sendAsync({type:"getImages",data:{icons:wt,source:this.source,tileID:this.tileID,type:"patterns"}},Lt)}const[Nt,Mt,ci]=yield Promise.all([Ee,pt,vt]),ni=new p(Nt),fi=new u.bl(Mt,ci);for(const Lt in be){const pi=be[Lt];pi instanceof u.a5?(k(pi.layers,this.zoom,G),u.bm({bucket:pi,glyphMap:Nt,glyphPositions:ni.positions,imageMap:Mt,imagePositions:fi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):pi.hasPattern&&(pi instanceof u.bn||pi instanceof u.bo||pi instanceof u.bp)&&(k(pi.layers,this.zoom,G),pi.addFeatures(ce,this.tileID.canonical,fi.patternPositions))}return this.status="done",{buckets:Object.values(be).filter(Lt=>!Lt.isEmpty()),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ni.image,imageAtlas:fi,glyphMap:this.returnDependencies?Nt:null,iconMap:this.returnDependencies?Mt:null,glyphPositions:this.returnDependencies?ni.positions:null}})}}function k(Q,V,U){const G=new u.a8(V);for(const J of Q)J.recalculate(G,U)}class C{constructor(V,U,G){this.actor=V,this.layerIndex=U,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,U){return u._(this,void 0,void 0,function*(){const G=yield u.l(V.request,U);try{return{vectorTile:new u.bq.VectorTile(new u.br(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch(J){const me=new Uint8Array(G.data);let ge=`Unable to parse the tile at ${V.request.url}, `;throw ge+=me[0]===31&&me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${J.messge}`,new Error(ge)}})}loadTile(V){return u._(this,void 0,void 0,function*(){const U=V.uid,G=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.bs(V.request),J=new y(V);this.loading[U]=J;const me=new AbortController;J.abort=me;try{const ge=yield this.loadVectorTile(V,me);if(delete this.loading[U],!ge)return null;const be=ge.rawData,ce={};ge.expires&&(ce.expires=ge.expires),ge.cacheControl&&(ce.cacheControl=ge.cacheControl);const Se={};if(G){const Ee=G.finish();Ee&&(Se.resourceTiming=JSON.parse(JSON.stringify(Ee)))}J.vectorTile=ge.vectorTile;const Ne=J.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[U]=J,this.fetching[U]={rawTileData:be,cacheControl:ce,resourceTiming:Se};try{const Ee=yield Ne;return u.e({rawTileData:be.slice(0)},Ee,ce,Se)}finally{delete this.fetching[U]}}catch(ge){throw delete this.loading[U],J.status="done",this.loaded[U]=J,ge}})}reloadTile(V){return u._(this,void 0,void 0,function*(){const U=V.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const G=this.loaded[U];if(G.showCollisionBoxes=V.showCollisionBoxes,G.status==="parsing"){const J=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor);let me;if(this.fetching[U]){const{rawTileData:ge,cacheControl:be,resourceTiming:ce}=this.fetching[U];delete this.fetching[U],me=u.e({rawTileData:ge.slice(0)},J,be,ce)}else me=J;return me}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(V){return u._(this,void 0,void 0,function*(){const U=this.loading,G=V.uid;U&&U[G]&&U[G].abort&&(U[G].abort.abort(),delete U[G])})}removeTile(V){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class S{constructor(){this.loaded={}}loadTile(V){return u._(this,void 0,void 0,function*(){const{uid:U,encoding:G,rawImageData:J,redFactor:me,greenFactor:ge,blueFactor:be,baseShift:ce}=V,Se=J.width+2,Ne=J.height+2,Ee=u.b(J)?new u.R({width:Se,height:Ne},yield u.bt(J,-1,-1,Se,Ne)):J,Be=new u.bu(U,Ee,G,me,ge,be,ce);return this.loaded=this.loaded||{},this.loaded[U]=Be,Be})}removeTile(V){const U=this.loaded,G=V.uid;U&&U[G]&&delete U[G]}}function z(Q,V){if(Q.length!==0){R(Q[0],V);for(var U=1;U<Q.length;U++)R(Q[U],!V)}}function R(Q,V){for(var U=0,G=0,J=0,me=Q.length,ge=me-1;J<me;ge=J++){var be=(Q[J][0]-Q[ge][0])*(Q[ge][1]+Q[J][1]),ce=U+be;G+=Math.abs(U)>=Math.abs(be)?U-ce+be:be-ce+U,U=ce}U+G>=0!=!!V&&Q.reverse()}var j=u.bv(function Q(V,U){var G,J=V&&V.type;if(J==="FeatureCollection")for(G=0;G<V.features.length;G++)Q(V.features[G],U);else if(J==="GeometryCollection")for(G=0;G<V.geometries.length;G++)Q(V.geometries[G],U);else if(J==="Feature")Q(V.geometry,U);else if(J==="Polygon")z(V.coordinates,U);else if(J==="MultiPolygon")for(G=0;G<V.coordinates.length;G++)z(V.coordinates[G],U);return V});const H=u.bq.VectorTileFeature.prototype.toGeoJSON;var X={exports:{}},re=u.bw,W=u.bq.VectorTileFeature,ae=de;function de(Q,V){this.options=V||{},this.features=Q,this.length=Q.length}function Ae(Q,V){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=V||4096}de.prototype.feature=function(Q){return new Ae(this.features[Q],this.options.extent)},Ae.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var V=0;V<Q.length;V++){for(var U=Q[V],G=[],J=0;J<U.length;J++)G.push(new re(U[J][0],U[J][1]));this.geometry.push(G)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,V=1/0,U=-1/0,G=1/0,J=-1/0,me=0;me<Q.length;me++)for(var ge=Q[me],be=0;be<ge.length;be++){var ce=ge[be];V=Math.min(V,ce.x),U=Math.max(U,ce.x),G=Math.min(G,ce.y),J=Math.max(J,ce.y)}return[V,G,U,J]},Ae.prototype.toGeoJSON=W.prototype.toGeoJSON;var xe=u.bx,pe=ae;function ke(Q){var V=new xe;return function(U,G){for(var J in U.layers)G.writeMessage(3,Ie,U.layers[J])}(Q,V),V.finish()}function Ie(Q,V){var U;V.writeVarintField(15,Q.version||1),V.writeStringField(1,Q.name||""),V.writeVarintField(5,Q.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<Q.length;U++)G.feature=Q.feature(U),V.writeMessage(2,Ve,G);var J=G.keys;for(U=0;U<J.length;U++)V.writeStringField(3,J[U]);var me=G.values;for(U=0;U<me.length;U++)V.writeMessage(4,Ft,me[U])}function Ve(Q,V){var U=Q.feature;U.id!==void 0&&V.writeVarintField(1,U.id),V.writeMessage(2,We,Q),V.writeVarintField(3,U.type),V.writeMessage(4,mt,U)}function We(Q,V){var U=Q.feature,G=Q.keys,J=Q.values,me=Q.keycache,ge=Q.valuecache;for(var be in U.properties){var ce=U.properties[be],Se=me[be];if(ce!==null){Se===void 0&&(G.push(be),me[be]=Se=G.length-1),V.writeVarint(Se);var Ne=typeof ce;Ne!=="string"&&Ne!=="boolean"&&Ne!=="number"&&(ce=JSON.stringify(ce));var Ee=Ne+":"+ce,Be=ge[Ee];Be===void 0&&(J.push(ce),ge[Ee]=Be=J.length-1),V.writeVarint(Be)}}}function Oe(Q,V){return(V<<3)+(7&Q)}function It(Q){return Q<<1^Q>>31}function mt(Q,V){for(var U=Q.loadGeometry(),G=Q.type,J=0,me=0,ge=U.length,be=0;be<ge;be++){var ce=U[be],Se=1;G===1&&(Se=ce.length),V.writeVarint(Oe(1,Se));for(var Ne=G===3?ce.length-1:ce.length,Ee=0;Ee<Ne;Ee++){Ee===1&&G!==1&&V.writeVarint(Oe(2,Ne-1));var Be=ce[Ee].x-J,pt=ce[Ee].y-me;V.writeVarint(It(Be)),V.writeVarint(It(pt)),J+=Be,me+=pt}G===3&&V.writeVarint(Oe(7,1))}}function Ft(Q,V){var U=typeof Q;U==="string"?V.writeStringField(1,Q):U==="boolean"?V.writeBooleanField(7,Q):U==="number"&&(Q%1!=0?V.writeDoubleField(3,Q):Q<0?V.writeSVarintField(6,Q):V.writeVarintField(5,Q))}X.exports=ke,X.exports.fromVectorTileJs=ke,X.exports.fromGeojsonVt=function(Q,V){V=V||{};var U={};for(var G in Q)U[G]=new pe(Q[G].features,V),U[G].name=G,U[G].version=V.version,U[G].extent=V.extent;return ke({layers:U})},X.exports.GeoJSONWrapper=pe;var Yt=u.bv(X.exports);const Qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Tn=Math.fround||(ji=new Float32Array(1),Q=>(ji[0]=+Q,ji[0]));var ji;const di=3,ii=5,Ci=6;class Ti{constructor(V){this.options=Object.assign(Object.create(Qt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:U,minZoom:G,maxZoom:J}=this.options;U&&console.time("total time");const me=`prepare ${V.length} points`;U&&console.time(me),this.points=V;const ge=[];for(let ce=0;ce<V.length;ce++){const Se=V[ce];if(!Se.geometry)continue;const[Ne,Ee]=Se.geometry.coordinates,Be=Tn(Xi(Ne)),pt=Tn(nt(Ee));ge.push(Be,pt,1/0,ce,-1,1),this.options.reduce&&ge.push(0)}let be=this.trees[J+1]=this._createTree(ge);U&&console.timeEnd(me);for(let ce=J;ce>=G;ce--){const Se=+Date.now();be=this.trees[ce]=this._createTree(this._cluster(be,ce)),U&&console.log("z%d: %d clusters in %dms",ce,be.numItems,+Date.now()-Se)}return U&&console.timeEnd("total time"),this}getClusters(V,U){let G=((V[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,V[1]));let me=V[2]===180?180:((V[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)G=-180,me=180;else if(G>me){const Ee=this.getClusters([G,J,180,ge],U),Be=this.getClusters([-180,J,me,ge],U);return Ee.concat(Be)}const be=this.trees[this._limitZoom(U)],ce=be.range(Xi(G),nt(ge),Xi(me),nt(J)),Se=be.data,Ne=[];for(const Ee of ce){const Be=this.stride*Ee;Ne.push(Se[Be+ii]>1?Gi(Se,Be,this.clusterProps):this.points[Se[Be+di]])}return Ne}getChildren(V){const U=this._getOriginId(V),G=this._getOriginZoom(V),J="No cluster with the specified id.",me=this.trees[G];if(!me)throw new Error(J);const ge=me.data;if(U*this.stride>=ge.length)throw new Error(J);const be=this.options.radius/(this.options.extent*Math.pow(2,G-1)),ce=me.within(ge[U*this.stride],ge[U*this.stride+1],be),Se=[];for(const Ne of ce){const Ee=Ne*this.stride;ge[Ee+4]===V&&Se.push(ge[Ee+ii]>1?Gi(ge,Ee,this.clusterProps):this.points[ge[Ee+di]])}if(Se.length===0)throw new Error(J);return Se}getLeaves(V,U,G){const J=[];return this._appendLeaves(J,V,U=U||10,G=G||0,0),J}getTile(V,U,G){const J=this.trees[this._limitZoom(V)],me=Math.pow(2,V),{extent:ge,radius:be}=this.options,ce=be/ge,Se=(G-ce)/me,Ne=(G+1+ce)/me,Ee={features:[]};return this._addTileFeatures(J.range((U-ce)/me,Se,(U+1+ce)/me,Ne),J.data,U,G,me,Ee),U===0&&this._addTileFeatures(J.range(1-ce/me,Se,1,Ne),J.data,me,G,me,Ee),U===me-1&&this._addTileFeatures(J.range(0,Se,ce/me,Ne),J.data,-1,G,me,Ee),Ee.features.length?Ee:null}getClusterExpansionZoom(V){let U=this._getOriginZoom(V)-1;for(;U<=this.options.maxZoom;){const G=this.getChildren(V);if(U++,G.length!==1)break;V=G[0].properties.cluster_id}return U}_appendLeaves(V,U,G,J,me){const ge=this.getChildren(U);for(const be of ge){const ce=be.properties;if(ce&&ce.cluster?me+ce.point_count<=J?me+=ce.point_count:me=this._appendLeaves(V,ce.cluster_id,G,J,me):me<J?me++:V.push(be),V.length===G)break}return me}_createTree(V){const U=new u.au(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<V.length;G+=this.stride)U.add(V[G],V[G+1]);return U.finish(),U.data=V,U}_addTileFeatures(V,U,G,J,me,ge){for(const be of V){const ce=be*this.stride,Se=U[ce+ii]>1;let Ne,Ee,Be;if(Se)Ne=qi(U,ce,this.clusterProps),Ee=U[ce],Be=U[ce+1];else{const vt=this.points[U[ce+di]];Ne=vt.properties;const[Nt,Mt]=vt.geometry.coordinates;Ee=Xi(Nt),Be=nt(Mt)}const pt={type:1,geometry:[[Math.round(this.options.extent*(Ee*me-G)),Math.round(this.options.extent*(Be*me-J))]],tags:Ne};let wt;wt=Se||this.options.generateId?U[ce+di]:this.points[U[ce+di]].id,wt!==void 0&&(pt.id=wt),ge.features.push(pt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,U){const{radius:G,extent:J,reduce:me,minPoints:ge}=this.options,be=G/(J*Math.pow(2,U)),ce=V.data,Se=[],Ne=this.stride;for(let Ee=0;Ee<ce.length;Ee+=Ne){if(ce[Ee+2]<=U)continue;ce[Ee+2]=U;const Be=ce[Ee],pt=ce[Ee+1],wt=V.within(ce[Ee],ce[Ee+1],be),vt=ce[Ee+ii];let Nt=vt;for(const Mt of wt){const ci=Mt*Ne;ce[ci+2]>U&&(Nt+=ce[ci+ii])}if(Nt>vt&&Nt>=ge){let Mt,ci=Be*vt,ni=pt*vt,fi=-1;const Lt=((Ee/Ne|0)<<5)+(U+1)+this.points.length;for(const pi of wt){const Mi=pi*Ne;if(ce[Mi+2]<=U)continue;ce[Mi+2]=U;const hn=ce[Mi+ii];ci+=ce[Mi]*hn,ni+=ce[Mi+1]*hn,ce[Mi+4]=Lt,me&&(Mt||(Mt=this._map(ce,Ee,!0),fi=this.clusterProps.length,this.clusterProps.push(Mt)),me(Mt,this._map(ce,Mi)))}ce[Ee+4]=Lt,Se.push(ci/Nt,ni/Nt,1/0,Lt,-1,Nt),me&&Se.push(fi)}else{for(let Mt=0;Mt<Ne;Mt++)Se.push(ce[Ee+Mt]);if(Nt>1)for(const Mt of wt){const ci=Mt*Ne;if(!(ce[ci+2]<=U)){ce[ci+2]=U;for(let ni=0;ni<Ne;ni++)Se.push(ce[ci+ni])}}}}return Se}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,U,G){if(V[U+ii]>1){const ge=this.clusterProps[V[U+Ci]];return G?Object.assign({},ge):ge}const J=this.points[V[U+di]].properties,me=this.options.map(J);return G&&me===J?Object.assign({},me):me}}function Gi(Q,V,U){return{type:"Feature",id:Q[V+di],properties:qi(Q,V,U),geometry:{type:"Point",coordinates:[(G=Q[V],360*(G-.5)),sn(Q[V+1])]}};var G}function qi(Q,V,U){const G=Q[V+ii],J=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,me=Q[V+Ci],ge=me===-1?{}:Object.assign({},U[me]);return Object.assign(ge,{cluster:!0,cluster_id:Q[V+di],point_count:G,point_count_abbreviated:J})}function Xi(Q){return Q/360+.5}function nt(Q){const V=Math.sin(Q*Math.PI/180),U=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return U<0?0:U>1?1:U}function sn(Q){const V=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function _n(Q,V,U,G){for(var J,me=G,ge=U-V>>1,be=U-V,ce=Q[V],Se=Q[V+1],Ne=Q[U],Ee=Q[U+1],Be=V+3;Be<U;Be+=3){var pt=Zn(Q[Be],Q[Be+1],ce,Se,Ne,Ee);if(pt>me)J=Be,me=pt;else if(pt===me){var wt=Math.abs(Be-ge);wt<be&&(J=Be,be=wt)}}me>G&&(J-V>3&&_n(Q,V,J,G),Q[J+2]=me,U-J>3&&_n(Q,J,U,G))}function Zn(Q,V,U,G,J,me){var ge=J-U,be=me-G;if(ge!==0||be!==0){var ce=((Q-U)*ge+(V-G)*be)/(ge*ge+be*be);ce>1?(U=J,G=me):ce>0&&(U+=ge*ce,G+=be*ce)}return(ge=Q-U)*ge+(be=V-G)*be}function En(Q,V,U,G){var J={id:Q===void 0?null:Q,type:V,geometry:U,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var ge=me.geometry,be=me.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")$n(me,ge);else if(be==="Polygon"||be==="MultiLineString")for(var ce=0;ce<ge.length;ce++)$n(me,ge[ce]);else if(be==="MultiPolygon")for(ce=0;ce<ge.length;ce++)for(var Se=0;Se<ge[ce].length;Se++)$n(me,ge[ce][Se])}(J),J}function $n(Q,V){for(var U=0;U<V.length;U+=3)Q.minX=Math.min(Q.minX,V[U]),Q.minY=Math.min(Q.minY,V[U+1]),Q.maxX=Math.max(Q.maxX,V[U]),Q.maxY=Math.max(Q.maxY,V[U+1])}function Ds(Q,V,U,G){if(V.geometry){var J=V.geometry.coordinates,me=V.geometry.type,ge=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),be=[],ce=V.id;if(U.promoteId?ce=V.properties[U.promoteId]:U.generateId&&(ce=G||0),me==="Point")Fi(J,be);else if(me==="MultiPoint")for(var Se=0;Se<J.length;Se++)Fi(J[Se],be);else if(me==="LineString")qs(J,be,ge,!1);else if(me==="MultiLineString"){if(U.lineMetrics){for(Se=0;Se<J.length;Se++)qs(J[Se],be=[],ge,!1),Q.push(En(ce,"LineString",be,V.properties));return}De(J,be,ge,!1)}else if(me==="Polygon")De(J,be,ge,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(Se=0;Se<V.geometry.geometries.length;Se++)Ds(Q,{id:ce,geometry:V.geometry.geometries[Se],properties:V.properties},U,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<J.length;Se++){var Ne=[];De(J[Se],Ne,ge,!0),be.push(Ne)}}Q.push(En(ce,me,be,V.properties))}}function Fi(Q,V){V.push(Hs(Q[0])),V.push(or(Q[1])),V.push(0)}function qs(Q,V,U,G){for(var J,me,ge=0,be=0;be<Q.length;be++){var ce=Hs(Q[be][0]),Se=or(Q[be][1]);V.push(ce),V.push(Se),V.push(0),be>0&&(ge+=G?(J*Se-ce*me)/2:Math.sqrt(Math.pow(ce-J,2)+Math.pow(Se-me,2))),J=ce,me=Se}var Ne=V.length-3;V[2]=1,_n(V,0,Ne,U),V[Ne+2]=1,V.size=Math.abs(ge),V.start=0,V.end=V.size}function De(Q,V,U,G){for(var J=0;J<Q.length;J++){var me=[];qs(Q[J],me,U,G),V.push(me)}}function Hs(Q){return Q/360+.5}function or(Q){var V=Math.sin(Q*Math.PI/180),U=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return U<0?0:U>1?1:U}function Ut(Q,V,U,G,J,me,ge,be){if(G/=V,me>=(U/=V)&&ge<G)return Q;if(ge<U||me>=G)return null;for(var ce=[],Se=0;Se<Q.length;Se++){var Ne=Q[Se],Ee=Ne.geometry,Be=Ne.type,pt=J===0?Ne.minX:Ne.minY,wt=J===0?Ne.maxX:Ne.maxY;if(pt>=U&&wt<G)ce.push(Ne);else if(!(wt<U||pt>=G)){var vt=[];if(Be==="Point"||Be==="MultiPoint")Ki(Ee,vt,U,G,J);else if(Be==="LineString")ts(Ee,vt,U,G,J,!1,be.lineMetrics);else if(Be==="MultiLineString")is(Ee,vt,U,G,J,!1);else if(Be==="Polygon")is(Ee,vt,U,G,J,!0);else if(Be==="MultiPolygon")for(var Nt=0;Nt<Ee.length;Nt++){var Mt=[];is(Ee[Nt],Mt,U,G,J,!0),Mt.length&&vt.push(Mt)}if(vt.length){if(be.lineMetrics&&Be==="LineString"){for(Nt=0;Nt<vt.length;Nt++)ce.push(En(Ne.id,Be,vt[Nt],Ne.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(vt.length===1?(Be="LineString",vt=vt[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=vt.length===3?"Point":"MultiPoint"),ce.push(En(Ne.id,Be,vt,Ne.tags))}}}return ce.length?ce:null}function Ki(Q,V,U,G,J){for(var me=0;me<Q.length;me+=3){var ge=Q[me+J];ge>=U&&ge<=G&&(V.push(Q[me]),V.push(Q[me+1]),V.push(Q[me+2]))}}function ts(Q,V,U,G,J,me,ge){for(var be,ce,Se=xi(Q),Ne=J===0?Gn:Ls,Ee=Q.start,Be=0;Be<Q.length-3;Be+=3){var pt=Q[Be],wt=Q[Be+1],vt=Q[Be+2],Nt=Q[Be+3],Mt=Q[Be+4],ci=J===0?pt:wt,ni=J===0?Nt:Mt,fi=!1;ge&&(be=Math.sqrt(Math.pow(pt-Nt,2)+Math.pow(wt-Mt,2))),ci<U?ni>U&&(ce=Ne(Se,pt,wt,Nt,Mt,U),ge&&(Se.start=Ee+be*ce)):ci>G?ni<G&&(ce=Ne(Se,pt,wt,Nt,Mt,G),ge&&(Se.start=Ee+be*ce)):Mn(Se,pt,wt,vt),ni<U&&ci>=U&&(ce=Ne(Se,pt,wt,Nt,Mt,U),fi=!0),ni>G&&ci<=G&&(ce=Ne(Se,pt,wt,Nt,Mt,G),fi=!0),!me&&fi&&(ge&&(Se.end=Ee+be*ce),V.push(Se),Se=xi(Q)),ge&&(Ee+=be)}var Lt=Q.length-3;pt=Q[Lt],wt=Q[Lt+1],vt=Q[Lt+2],(ci=J===0?pt:wt)>=U&&ci<=G&&Mn(Se,pt,wt,vt),Lt=Se.length-3,me&&Lt>=3&&(Se[Lt]!==Se[0]||Se[Lt+1]!==Se[1])&&Mn(Se,Se[0],Se[1],Se[2]),Se.length&&V.push(Se)}function xi(Q){var V=[];return V.size=Q.size,V.start=Q.start,V.end=Q.end,V}function is(Q,V,U,G,J,me){for(var ge=0;ge<Q.length;ge++)ts(Q[ge],V,U,G,J,me,!1)}function Mn(Q,V,U,G){Q.push(V),Q.push(U),Q.push(G)}function Gn(Q,V,U,G,J,me){var ge=(me-V)/(G-V);return Q.push(me),Q.push(U+(J-U)*ge),Q.push(1),ge}function Ls(Q,V,U,G,J,me){var ge=(me-U)/(J-U);return Q.push(V+(G-V)*ge),Q.push(me),Q.push(1),ge}function Ws(Q,V){for(var U=[],G=0;G<Q.length;G++){var J,me=Q[G],ge=me.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")J=Ye(me.geometry,V);else if(ge==="MultiLineString"||ge==="Polygon"){J=[];for(var be=0;be<me.geometry.length;be++)J.push(Ye(me.geometry[be],V))}else if(ge==="MultiPolygon")for(J=[],be=0;be<me.geometry.length;be++){for(var ce=[],Se=0;Se<me.geometry[be].length;Se++)ce.push(Ye(me.geometry[be][Se],V));J.push(ce)}U.push(En(me.id,ge,J,me.tags))}return U}function Ye(Q,V){var U=[];U.size=Q.size,Q.start!==void 0&&(U.start=Q.start,U.end=Q.end);for(var G=0;G<Q.length;G+=3)U.push(Q[G]+V,Q[G+1],Q[G+2]);return U}function yn(Q,V){if(Q.transformed)return Q;var U,G,J,me=1<<Q.z,ge=Q.x,be=Q.y;for(U=0;U<Q.features.length;U++){var ce=Q.features[U],Se=ce.geometry,Ne=ce.type;if(ce.geometry=[],Ne===1)for(G=0;G<Se.length;G+=2)ce.geometry.push(ln(Se[G],Se[G+1],V,me,ge,be));else for(G=0;G<Se.length;G++){var Ee=[];for(J=0;J<Se[G].length;J+=2)Ee.push(ln(Se[G][J],Se[G][J+1],V,me,ge,be));ce.geometry.push(Ee)}}return Q.transformed=!0,Q}function ln(Q,V,U,G,J,me){return[Math.round(U*(Q*G-J)),Math.round(U*(V*G-me))]}function xs(Q,V,U,G,J){for(var me=V===J.maxZoom?0:J.tolerance/((1<<V)*J.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:G,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<Q.length;be++){ge.numFeatures++,vs(ge,Q[be],me,J);var ce=Q[be].minX,Se=Q[be].minY,Ne=Q[be].maxX,Ee=Q[be].maxY;ce<ge.minX&&(ge.minX=ce),Se<ge.minY&&(ge.minY=Se),Ne>ge.maxX&&(ge.maxX=Ne),Ee>ge.maxY&&(ge.maxY=Ee)}return ge}function vs(Q,V,U,G){var J=V.geometry,me=V.type,ge=[];if(me==="Point"||me==="MultiPoint")for(var be=0;be<J.length;be+=3)ge.push(J[be]),ge.push(J[be+1]),Q.numPoints++,Q.numSimplified++;else if(me==="LineString")Ke(ge,J,Q,U,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(be=0;be<J.length;be++)Ke(ge,J[be],Q,U,me==="Polygon",be===0);else if(me==="MultiPolygon")for(var ce=0;ce<J.length;ce++){var Se=J[ce];for(be=0;be<Se.length;be++)Ke(ge,Se[be],Q,U,!0,be===0)}if(ge.length){var Ne=V.tags||null;if(me==="LineString"&&G.lineMetrics){for(var Ee in Ne={},V.tags)Ne[Ee]=V.tags[Ee];Ne.mapbox_clip_start=J.start/J.size,Ne.mapbox_clip_end=J.end/J.size}var Be={geometry:ge,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:Ne};V.id!==null&&(Be.id=V.id),Q.features.push(Be)}}function Ke(Q,V,U,G,J,me){var ge=G*G;if(G>0&&V.size<(J?ge:G))U.numPoints+=V.length/3;else{for(var be=[],ce=0;ce<V.length;ce+=3)(G===0||V[ce+2]>ge)&&(U.numSimplified++,be.push(V[ce]),be.push(V[ce+1])),U.numPoints++;J&&function(Se,Ne){for(var Ee=0,Be=0,pt=Se.length,wt=pt-2;Be<pt;wt=Be,Be+=2)Ee+=(Se[Be]-Se[wt])*(Se[Be+1]+Se[wt+1]);if(Ee>0===Ne)for(Be=0,pt=Se.length;Be<pt/2;Be+=2){var vt=Se[Be],Nt=Se[Be+1];Se[Be]=Se[pt-2-Be],Se[Be+1]=Se[pt-1-Be],Se[pt-2-Be]=vt,Se[pt-1-Be]=Nt}}(be,me),Q.push(be)}}function At(Q,V){var U=(V=this.options=function(J,me){for(var ge in me)J[ge]=me[ge];return J}(Object.create(this.options),V)).debug;if(U&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var G=function(J,me){var ge=[];if(J.type==="FeatureCollection")for(var be=0;be<J.features.length;be++)Ds(ge,J.features[be],me,be);else Ds(ge,J.type==="Feature"?J:{geometry:J},me);return ge}(Q,V);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(J,me){var ge=me.buffer/me.extent,be=J,ce=Ut(J,1,-1-ge,ge,0,-1,2,me),Se=Ut(J,1,1-ge,2+ge,0,-1,2,me);return(ce||Se)&&(be=Ut(J,1,-ge,1+ge,0,-1,2,me)||[],ce&&(be=Ws(ce,1).concat(be)),Se&&(be=be.concat(Ws(Se,-1)))),be}(G,V),G.length&&this.splitTile(G,0,0,0),U&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Et(Q,V,U){return 32*((1<<Q)*U+V)+Q}function Hi(Q,V){return V?Q.properties[V]:Q.id}function cn(Q,V){if(Q==null)return!0;if(Q.type==="Feature")return Hi(Q,V)!=null;if(Q.type==="FeatureCollection"){const U=new Set;for(const G of Q.features){const J=Hi(G,V);if(J==null||U.has(J))return!1;U.add(J)}return!0}return!1}function Dt(Q,V){const U=new Map;if(Q!=null)if(Q.type==="Feature")U.set(Hi(Q,V),Q);else for(const G of Q.features)U.set(Hi(G,V),G);return U}At.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},At.prototype.splitTile=function(Q,V,U,G,J,me,ge){for(var be=[Q,V,U,G],ce=this.options,Se=ce.debug;be.length;){G=be.pop(),U=be.pop(),V=be.pop(),Q=be.pop();var Ne=1<<V,Ee=Et(V,U,G),Be=this.tiles[Ee];if(!Be&&(Se>1&&console.time("creation"),Be=this.tiles[Ee]=xs(Q,V,U,G,ce),this.tileCoords.push({z:V,x:U,y:G}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,U,G,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var pt="z"+V;this.stats[pt]=(this.stats[pt]||0)+1,this.total++}if(Be.source=Q,J){if(V===ce.maxZoom||V===J)continue;var wt=1<<J-V;if(U!==Math.floor(me/wt)||G!==Math.floor(ge/wt))continue}else if(V===ce.indexMaxZoom||Be.numPoints<=ce.indexMaxPoints)continue;if(Be.source=null,Q.length!==0){Se>1&&console.time("clipping");var vt,Nt,Mt,ci,ni,fi,Lt=.5*ce.buffer/ce.extent,pi=.5-Lt,Mi=.5+Lt,hn=1+Lt;vt=Nt=Mt=ci=null,ni=Ut(Q,Ne,U-Lt,U+Mi,0,Be.minX,Be.maxX,ce),fi=Ut(Q,Ne,U+pi,U+hn,0,Be.minX,Be.maxX,ce),Q=null,ni&&(vt=Ut(ni,Ne,G-Lt,G+Mi,1,Be.minY,Be.maxY,ce),Nt=Ut(ni,Ne,G+pi,G+hn,1,Be.minY,Be.maxY,ce),ni=null),fi&&(Mt=Ut(fi,Ne,G-Lt,G+Mi,1,Be.minY,Be.maxY,ce),ci=Ut(fi,Ne,G+pi,G+hn,1,Be.minY,Be.maxY,ce),fi=null),Se>1&&console.timeEnd("clipping"),be.push(vt||[],V+1,2*U,2*G),be.push(Nt||[],V+1,2*U,2*G+1),be.push(Mt||[],V+1,2*U+1,2*G),be.push(ci||[],V+1,2*U+1,2*G+1)}}},At.prototype.getTile=function(Q,V,U){var G=this.options,J=G.extent,me=G.debug;if(Q<0||Q>24)return null;var ge=1<<Q,be=Et(Q,V=(V%ge+ge)%ge,U);if(this.tiles[be])return yn(this.tiles[be],J);me>1&&console.log("drilling down to z%d-%d-%d",Q,V,U);for(var ce,Se=Q,Ne=V,Ee=U;!ce&&Se>0;)Se--,Ne=Math.floor(Ne/2),Ee=Math.floor(Ee/2),ce=this.tiles[Et(Se,Ne,Ee)];return ce&&ce.source?(me>1&&console.log("found parent tile z%d-%d-%d",Se,Ne,Ee),me>1&&console.time("drilling down"),this.splitTile(ce.source,Se,Ne,Ee,Q,V,U),me>1&&console.timeEnd("drilling down"),this.tiles[be]?yn(this.tiles[be],J):null):null};class ns extends C{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,U){return u._(this,void 0,void 0,function*(){const G=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const J=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!J)return null;const me=new class{constructor(be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=be.length,this._features=be}feature(be){return new class{constructor(ce){this._feature=ce,this.extent=u.W,this.type=ce.type,this.properties=ce.tags,"id"in ce&&!isNaN(ce.id)&&(this.id=parseInt(ce.id,10))}loadGeometry(){if(this._feature.type===1){const ce=[];for(const Se of this._feature.geometry)ce.push([new u.P(Se[0],Se[1])]);return ce}{const ce=[];for(const Se of this._feature.geometry){const Ne=[];for(const Ee of Se)Ne.push(new u.P(Ee[0],Ee[1]));ce.push(Ne)}return ce}}toGeoJSON(ce,Se,Ne){return H.call(this,ce,Se,Ne)}}(this._features[be])}}(J.features);let ge=Yt(me);return ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),{vectorTile:me,rawData:ge.buffer}})}loadData(V){return u._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();const G=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.bs(V.request);this._pendingRequest=new AbortController;try{let J=yield this.loadGeoJSON(V,this._pendingRequest);if(delete this._pendingRequest,typeof J!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(j(J,!0),V.filter){const ge=u.by(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));J={type:"FeatureCollection",features:J.features.filter(ce=>ge.value.evaluate({zoom:0},ce))}}this._geoJSONIndex=V.cluster?new Ti(function({superclusterOptions:ge,clusterProperties:be}){if(!be||!ge)return ge;const ce={},Se={},Ne={accumulated:null,zoom:0},Ee={properties:null},Be=Object.keys(be);for(const pt of Be){const[wt,vt]=be[pt],Nt=u.by(vt),Mt=u.by(typeof wt=="string"?[wt,["accumulated"],["get",pt]]:wt);ce[pt]=Nt.value,Se[pt]=Mt.value}return ge.map=pt=>{Ee.properties=pt;const wt={};for(const vt of Be)wt[vt]=ce[vt].evaluate(Ne,Ee);return wt},ge.reduce=(pt,wt)=>{Ee.properties=wt;for(const vt of Be)Ne.accumulated=pt[vt],pt[vt]=Se[vt].evaluate(Ne,Ee)},ge}(V)).load(J.features):function(ge,be){return new At(ge,be)}(J,V.geojsonVtOptions),this.loaded={};const me={};if(G){const ge=G.finish();ge&&(me.resourceTiming={},me.resourceTiming[V.source]=JSON.parse(JSON.stringify(ge)))}return me}catch(J){if(delete this._pendingRequest,u.bz(J))return{abandoned:!0};throw J}})}reloadTile(V){const U=this.loaded;return U&&U[V.uid]?super.reloadTile(V):this.loadTile(V)}loadGeoJSON(V,U){return u._(this,void 0,void 0,function*(){const{promoteId:G}=V;if(V.request){const J=yield u.h(V.request,U);return this._dataUpdateable=cn(J.data,G)?Dt(J.data,G):void 0,J.data}if(typeof V.data=="string")try{const J=JSON.parse(V.data);return this._dataUpdateable=cn(J,G)?Dt(J,G):void 0,J}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return function(J,me,ge){var be,ce,Se,Ne;if(me.removeAll&&J.clear(),me.remove)for(const Ee of me.remove)J.delete(Ee);if(me.add)for(const Ee of me.add){const Be=Hi(Ee,ge);Be!=null&&J.set(Be,Ee)}if(me.update)for(const Ee of me.update){let Be=J.get(Ee.id);if(Be==null)continue;const pt=!Ee.removeAllProperties&&(((be=Ee.removeProperties)===null||be===void 0?void 0:be.length)>0||((ce=Ee.addOrUpdateProperties)===null||ce===void 0?void 0:ce.length)>0);if((Ee.newGeometry||Ee.removeAllProperties||pt)&&(Be=Object.assign({},Be),J.set(Ee.id,Be),pt&&(Be.properties=Object.assign({},Be.properties))),Ee.newGeometry&&(Be.geometry=Ee.newGeometry),Ee.removeAllProperties)Be.properties={};else if(((Se=Ee.removeProperties)===null||Se===void 0?void 0:Se.length)>0)for(const wt of Ee.removeProperties)Object.prototype.hasOwnProperty.call(Be.properties,wt)&&delete Be.properties[wt];if(((Ne=Ee.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const{key:wt,value:vt}of Ee.addOrUpdateProperties)Be.properties[wt]=vt}}(this._dataUpdateable,V.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class zn{constructor(V){this.self=V,this.actor=new u.C(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,G)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=G},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=U=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(U)},this.actor.registerMessageHandler("loadDEMTile",(U,G)=>this._getDEMWorkerSource(U,G.source).loadTile(G)),this.actor.registerMessageHandler("removeDEMTile",(U,G)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,G.source).removeTile(G)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(U,G)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(U,G.type,G.source).getClusterExpansionZoom(G)})),this.actor.registerMessageHandler("getClusterChildren",(U,G)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(U,G.type,G.source).getClusterChildren(G)})),this.actor.registerMessageHandler("getClusterLeaves",(U,G)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(U,G.type,G.source).getClusterLeaves(G)})),this.actor.registerMessageHandler("loadData",(U,G)=>this._getWorkerSource(U,G.type,G.source).loadData(G)),this.actor.registerMessageHandler("loadTile",(U,G)=>this._getWorkerSource(U,G.type,G.source).loadTile(G)),this.actor.registerMessageHandler("reloadTile",(U,G)=>this._getWorkerSource(U,G.type,G.source).reloadTile(G)),this.actor.registerMessageHandler("abortTile",(U,G)=>this._getWorkerSource(U,G.type,G.source).abortTile(G)),this.actor.registerMessageHandler("removeTile",(U,G)=>this._getWorkerSource(U,G.type,G.source).removeTile(G)),this.actor.registerMessageHandler("removeSource",(U,G)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][G.type]||!this.workerSources[U][G.type][G.source])return;const J=this.workerSources[U][G.type][G.source];delete this.workerSources[U][G.type][G.source],J.removeSource!==void 0&&J.removeSource(G)})),this.actor.registerMessageHandler("removeMap",U=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("setReferrer",(U,G)=>u._(this,void 0,void 0,function*(){this.referrer=G})),this.actor.registerMessageHandler("syncRTLPluginState",(U,G)=>this._syncRTLPluginState(U,G)),this.actor.registerMessageHandler("importScript",(U,G)=>u._(this,void 0,void 0,function*(){this.self.importScripts(G)})),this.actor.registerMessageHandler("setImages",(U,G)=>this._setImages(U,G)),this.actor.registerMessageHandler("updateLayers",(U,G)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(G.layers,G.removedIds)})),this.actor.registerMessageHandler("setLayers",(U,G)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(G)}))}_setImages(V,U){return u._(this,void 0,void 0,function*(){this.availableImages[V]=U;for(const G in this.workerSources[V]){const J=this.workerSources[V][G];for(const me in J)J[me].availableImages=U}})}_syncRTLPluginState(V,U){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(U.pluginStatus!=="loading")return u.bA.setState(U),U;const G=U.pluginURL;if(this.self.importScripts(G),u.bA.isParsed()){const J={pluginStatus:"loaded",pluginURL:G};return u.bA.setState(J),J}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${G}`)})}_getAvailableImages(V){let U=this.availableImages[V];return U||(U=[]),U}_getLayerIndex(V){let U=this.layerIndexes[V];return U||(U=this.layerIndexes[V]=new l),U}_getWorkerSource(V,U,G){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][U]||(this.workerSources[V][U]={}),!this.workerSources[V][U][G]){const J={sendAsync:(me,ge)=>(me.targetMapId=V,this.actor.sendAsync(me,ge))};switch(U){case"vector":this.workerSources[V][U][G]=new C(J,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][U][G]=new ns(J,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][U][G]=new this.externalWorkerSourceTypes[U](J,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][U][G]}_getDEMWorkerSource(V,U){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][U]||(this.demWorkerSources[V][U]=new S),this.demWorkerSources[V][U]}}return u.i(self)&&(self.worker=new zn(self)),zn}),o("index",["exports","./shared"],function(u,l){var p="4.1.2";let y,k;const C={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:b=>new Promise((r,d)=>{const m=requestAnimationFrame(r);b.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),d(l.c())})}),getImageData(b,r=0){return this.getImageCanvasContext(b).getImageData(-r,-r,b.width+2*r,b.height+2*r)},getImageCanvasContext(b){const r=window.document.createElement("canvas"),d=r.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return r.width=b.width,r.height=b.height,d.drawImage(b,0,0,b.width,b.height),d},resolveURL:b=>(y||(y=document.createElement("a")),y.href=b,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class S{static testProp(r){if(!S.docStyle)return r[0];for(let d=0;d<r.length;d++)if(r[d]in S.docStyle)return r[d];return r[0]}static create(r,d,m){const g=window.document.createElement(r);return d!==void 0&&(g.className=d),m&&m.appendChild(g),g}static createNS(r,d){return window.document.createElementNS(r,d)}static disableDrag(){S.docStyle&&S.selectProp&&(S.userSelect=S.docStyle[S.selectProp],S.docStyle[S.selectProp]="none")}static enableDrag(){S.docStyle&&S.selectProp&&(S.docStyle[S.selectProp]=S.userSelect)}static setTransform(r,d){r.style[S.transformProp]=d}static addEventListener(r,d,m,g={}){r.addEventListener(d,m,"passive"in g?g:g.capture)}static removeEventListener(r,d,m,g={}){r.removeEventListener(d,m,"passive"in g?g:g.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",S.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",S.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",S.suppressClickInternal,!0)},0)}static getScale(r){const d=r.getBoundingClientRect();return{x:d.width/r.offsetWidth||1,y:d.height/r.offsetHeight||1,boundingClientRect:d}}static getPoint(r,d,m){const g=d.boundingClientRect;return new l.P((m.clientX-g.left)/d.x-r.clientLeft,(m.clientY-g.top)/d.y-r.clientTop)}static mousePos(r,d){const m=S.getScale(r);return S.getPoint(r,m,d)}static touchPos(r,d){const m=[],g=S.getScale(r);for(let x=0;x<d.length;x++)m.push(S.getPoint(r,g,d[x]));return m}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}S.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,S.selectProp=S.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),S.transformProp=S.testProp(["transform","WebkitTransform"]);const z={supported:!1,testSupport:function(b){!H&&j&&(X?re(b):R=b)}};let R,j,H=!1,X=!1;function re(b){const r=b.createTexture();b.bindTexture(b.TEXTURE_2D,r);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,j),b.isContextLost())return;z.supported=!0}catch{}b.deleteTexture(r),H=!0}var W,ae;typeof document<"u"&&(j=document.createElement("img"),j.onload=function(){R&&re(R),R=null,X=!0},j.onerror=function(){H=!0,R=null},j.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(b){let r,d,m,g;b.resetRequestQueue=()=>{r=[],d=0,m=0,g={}},b.addThrottleControl=A=>{const D=m++;return g[D]=A,D},b.removeThrottleControl=A=>{delete g[A],M()},b.getImage=(A,D,B=!0)=>new Promise((O,Z)=>{z.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),l.e(A,{type:"image"}),r.push({abortController:D,requestParameters:A,supportImageRefresh:B,state:"queued",onError:te=>{Z(te)},onSuccess:te=>{O(te)}}),M()});const x=A=>l._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:D,supportImageRefresh:B,onError:O,onSuccess:Z,abortController:te}=A,ee=B===!1&&!l.i(self)&&!l.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((fe,Te)=>fe&&Te==="accept",!0));d++;const se=ee?P(D,te):l.m(D,te);try{const fe=yield se;delete A.abortController,A.state="completed",fe.data instanceof HTMLImageElement||l.b(fe.data)?Z(fe):fe.data&&Z({data:yield(K=fe.data,typeof createImageBitmap=="function"?l.d(K):l.f(K)),cacheControl:fe.cacheControl,expires:fe.expires})}catch(fe){delete A.abortController,O(fe)}finally{d--,M()}var K}),M=()=>{const A=(()=>{for(const D of Object.keys(g))if(g[D]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=d;D<A&&r.length>0;D++){const B=r.shift();B.abortController.signal.aborted?D--:x(B)}},P=(A,D)=>new Promise((B,O)=>{const Z=new Image,te=A.url,ee=A.credentials;ee&&ee==="include"?Z.crossOrigin="use-credentials":(ee&&ee==="same-origin"||!l.s(te))&&(Z.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{Z.src="",O(l.c())}),Z.fetchPriority="high",Z.onload=()=>{Z.onerror=Z.onload=null,B({data:Z})},Z.onerror=()=>{Z.onerror=Z.onload=null,D.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Z.src=te})}(W||(W={})),W.resetRequestQueue(),function(b){b.Glyphs="Glyphs",b.Image="Image",b.Source="Source",b.SpriteImage="SpriteImage",b.SpriteJSON="SpriteJSON",b.Style="Style",b.Tile="Tile",b.Unknown="Unknown"}(ae||(ae={}));class de{constructor(r){this._transformRequestFn=r}transformRequest(r,d){return this._transformRequestFn&&this._transformRequestFn(r,d)||{url:r}}normalizeSpriteURL(r,d,m){const g=function(x){const M=x.match(Ae);if(!M)throw new Error(`Unable to parse URL "${x}"`);return{protocol:M[1],authority:M[2],path:M[3]||"/",params:M[4]?M[4].split("&"):[]}}(r);return g.path+=`${d}${m}`,function(x){const M=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${M}`}(g)}setTransformRequest(r){this._transformRequestFn=r}}const Ae=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xe(b){var r=new l.A(3);return r[0]=b[0],r[1]=b[1],r[2]=b[2],r}var pe,ke=function(b,r,d){return b[0]=r[0]-d[0],b[1]=r[1]-d[1],b[2]=r[2]-d[2],b};pe=new l.A(3),l.A!=Float32Array&&(pe[0]=0,pe[1]=0,pe[2]=0);var Ie=function(b){var r=b[0],d=b[1];return r*r+d*d};function Ve(b){const r=[];if(typeof b=="string")r.push({id:"default",url:b});else if(b&&b.length>0){const d=[];for(const{id:m,url:g}of b){const x=`${m}${g}`;d.indexOf(x)===-1&&(d.push(x),r.push({id:m,url:g}))}}return r}(function(){var b=new l.A(2);l.A!=Float32Array&&(b[0]=0,b[1]=0)})();class We{constructor(r,d,m,g){this.context=r,this.format=m,this.texture=r.gl.createTexture(),this.update(d,g)}update(r,d,m){const{width:g,height:x}=r,M=!(this.size&&this.size[0]===g&&this.size[1]===x||m),{context:P}=this,{gl:A}=P;if(this.useMipmap=!!(d&&d.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!d||d.premultiply!==!1)),M)this.size=[g,x],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||l.b(r)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,r):A.texImage2D(A.TEXTURE_2D,0,this.format,g,x,0,this.format,A.UNSIGNED_BYTE,r.data);else{const{x:D,y:B}=m||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||l.b(r)?A.texSubImage2D(A.TEXTURE_2D,0,D,B,A.RGBA,A.UNSIGNED_BYTE,r):A.texSubImage2D(A.TEXTURE_2D,0,D,B,g,x,A.RGBA,A.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(r,d,m){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),m!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=x.LINEAR),r!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,r),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,m||r),this.filter=r),d!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,d),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function Oe(b){const{userImage:r}=b;return!!(r&&r.render&&r.render())&&(b.data.replace(new Uint8Array(r.data.buffer)),!0)}class It extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:d,promiseResolve:m}of this.requestors)m(this._getImagesForIds(d));this.requestors=[]}}getImage(r){const d=this.images[r];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new l.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(r,d){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,d)&&(this.images[r]=d)}_validate(r,d){let m=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,d){if(!r)return!0;let m=0;for(const g of r){if(g[0]<m||g[1]<g[0]||d<g[1])return!1;m=g[1]}return!0}_validateContent(r,d){if(!r)return!0;if(r.length!==4)return!1;const m=d.spriteData,g=m&&m.width||d.data.width,x=m&&m.height||d.data.height;return!(r[0]<0||g<r[0]||r[1]<0||x<r[1]||r[2]<0||g<r[2]||r[3]<0||x<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,d,m=!0){const g=this.getImage(r);if(m&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[r]=d,this.updatedImages[r]=!0}removeImage(r){const d=this.images[r];delete this.images[r],delete this.patterns[r],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((d,m)=>{let g=!0;if(!this.isLoaded())for(const x of r)this.images[x]||(g=!1);this.isLoaded()||g?d(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:d})})}_getImagesForIds(r){const d={};for(const m of r){let g=this.getImage(m);g||(this.fire(new l.k("styleimagemissing",{id:m})),g=this.getImage(m)),g?d[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:r,height:d}=this.atlasImage;return{width:r,height:d}}getPattern(r){const d=this.patterns[r],m=this.getImage(r);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new l.I(g,m);this.patterns[r]={bin:g,position:x}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const d=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new We(r,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const x in this.patterns)r.push(this.patterns[x].bin);const{w:d,h:m}=l.p(r),g=this.atlasImage;g.resize({width:d||1,height:m||1});for(const x in this.patterns){const{bin:M}=this.patterns[x],P=M.x+1,A=M.y+1,D=this.getImage(x).data,B=D.width,O=D.height;l.R.copy(D,g,{x:0,y:0},{x:P,y:A},{width:B,height:O}),l.R.copy(D,g,{x:0,y:O-1},{x:P,y:A-1},{width:B,height:1}),l.R.copy(D,g,{x:0,y:0},{x:P,y:A+O},{width:B,height:1}),l.R.copy(D,g,{x:B-1,y:0},{x:P-1,y:A},{width:1,height:O}),l.R.copy(D,g,{x:0,y:0},{x:P+B,y:A},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const d of r){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||l.w(`Image with ID: "${d}" was not found`),Oe(m)&&this.updateImage(d,m)}}}const mt=1e20;function Ft(b,r,d,m,g,x,M,P,A){for(let D=r;D<r+m;D++)Yt(b,d*x+D,x,g,M,P,A);for(let D=d;D<d+g;D++)Yt(b,D*x+r,1,m,M,P,A)}function Yt(b,r,d,m,g,x,M){x[0]=0,M[0]=-mt,M[1]=mt,g[0]=b[r];for(let P=1,A=0,D=0;P<m;P++){g[P]=b[r+P*d];const B=P*P;do{const O=x[A];D=(g[P]-g[O]+B-O*O)/(P-O)/2}while(D<=M[A]&&--A>-1);A++,x[A]=P,M[A]=D,M[A+1]=mt}for(let P=0,A=0;P<m;P++){for(;M[A+1]<P;)A++;const D=x[A],B=P-D;b[r+P*d]=g[D]+B*B}}class Qt{constructor(r,d){this.requestManager=r,this.localIdeographFontFamily=d,this.entries={}}setURL(r){this.url=r}getGlyphs(r){return l._(this,void 0,void 0,function*(){const d=[];for(const x in r)for(const M of r[x])d.push(this._getAndCacheGlyphsPromise(x,M));const m=yield Promise.all(d),g={};for(const{stack:x,id:M,glyph:P}of m)g[x]||(g[x]={}),g[x][M]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return g})}_getAndCacheGlyphsPromise(r,d){return l._(this,void 0,void 0,function*(){let m=this.entries[r];m||(m=this.entries[r]={glyphs:{},requests:{},ranges:{}});let g=m.glyphs[d];if(g!==void 0)return{stack:r,id:d,glyph:g};if(g=this._tinySDF(m,r,d),g)return m.glyphs[d]=g,{stack:r,id:d,glyph:g};const x=Math.floor(d/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[x])return{stack:r,id:d,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[x]){const P=Qt.loadGlyphRange(r,x,this.url,this.requestManager);m.requests[x]=P}const M=yield m.requests[x];for(const P in M)this._doesCharSupportLocalGlyph(+P)||(m.glyphs[+P]=M[+P]);return m.ranges[x]=!0,{stack:r,id:d,glyph:M[d]||null}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](r)||l.u["Hangul Syllables"](r)||l.u.Hiragana(r)||l.u.Katakana(r))}_tinySDF(r,d,m){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(m))return;let x=r.tinySDF;if(!x){let P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),x=r.tinySDF=new Qt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:P})}const M=x.draw(String.fromCharCode(m));return{id:m,bitmap:new l.o({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qt.loadGlyphRange=function(b,r,d,m){return l._(this,void 0,void 0,function*(){const g=256*r,x=g+255,M=m.transformRequest(d.replace("{fontstack}",b).replace("{range}",`${g}-${x}`),ae.Glyphs),P=yield l.l(M,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${r}, ${g}-${x}`);const A={};for(const D of l.n(P.data))A[D.id]=D;return A})},Qt.TinySDF=class{constructor({fontSize:b=24,buffer:r=3,radius:d=8,cutoff:m=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:M="normal"}={}){this.buffer=r,this.cutoff=m,this.radius=d;const P=this.size=b+4*r,A=this._createCanvas(P),D=this.ctx=A.getContext("2d",{willReadFrequently:!0});D.font=`${M} ${x} ${b}px ${g}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(b){const r=document.createElement("canvas");return r.width=r.height=b,r}draw(b){const{width:r,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(b),M=Math.ceil(d),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),A=Math.min(this.size-this.buffer,M+Math.ceil(m)),D=P+2*this.buffer,B=A+2*this.buffer,O=Math.max(D*B,0),Z=new Uint8ClampedArray(O),te={data:Z,width:D,height:B,glyphWidth:P,glyphHeight:A,glyphTop:M,glyphLeft:0,glyphAdvance:r};if(P===0||A===0)return te;const{ctx:ee,buffer:se,gridInner:K,gridOuter:fe}=this;ee.clearRect(se,se,P,A),ee.fillText(b,se,se+M);const Te=ee.getImageData(se,se,P,A);fe.fill(mt,0,O),K.fill(0,0,O);for(let oe=0;oe<A;oe++)for(let ye=0;ye<P;ye++){const Me=Te.data[4*(oe*P+ye)+3]/255;if(Me===0)continue;const Pe=(oe+se)*D+ye+se;if(Me===1)fe[Pe]=0,K[Pe]=mt;else{const ze=.5-Me;fe[Pe]=ze>0?ze*ze:0,K[Pe]=ze<0?ze*ze:0}}Ft(fe,0,0,D,B,D,this.f,this.v,this.z),Ft(K,se,se,P,A,D,this.f,this.v,this.z);for(let oe=0;oe<O;oe++){const ye=Math.sqrt(fe[oe])-Math.sqrt(K[oe]);Z[oe]=Math.round(255-255*(ye/this.radius+this.cutoff))}return te}};class Tn{constructor(){this.specification=l.v.light.position}possiblyEvaluate(r,d){return l.y(r.expression.evaluate(d))}interpolate(r,d,m){return{x:l.z.number(r.x,d.x,m),y:l.z.number(r.y,d.y,m),z:l.z.number(r.z,d.z,m)}}}let ji;class di extends l.E{constructor(r){super(),ji=ji||new l.q({anchor:new l.D(l.v.light.anchor),position:new Tn,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(ji),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,d={}){if(!this._validate(l.r,r,d))for(const m in r){const g=r[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,d,m){return(!m||m.validate!==!1)&&l.t(this,r.call(l.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class ii{constructor(r,d){this.width=r,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,d){const m=r.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(r,d)),this.dashEntry[m]}getDashRanges(r,d,m){const g=[];let x=r.length%2==1?-r[r.length-1]*m:0,M=r[0]*m,P=!0;g.push({left:x,right:M,isDash:P,zeroLength:r[0]===0});let A=r[0];for(let D=1;D<r.length;D++){P=!P;const B=r[D];x=A*m,A+=B,M=A*m,g.push({left:x,right:M,isDash:P,zeroLength:B===0})}return g}addRoundDash(r,d,m){const g=d/2;for(let x=-m;x<=m;x++){const M=this.width*(this.nextRow+m+x);let P=0,A=r[P];for(let D=0;D<this.width;D++){D/A.right>1&&(A=r[++P]);const B=Math.abs(D-A.left),O=Math.abs(D-A.right),Z=Math.min(B,O);let te;const ee=x/m*(g+1);if(A.isDash){const se=g-Math.abs(ee);te=Math.sqrt(Z*Z+se*se)}else te=g-Math.sqrt(Z*Z+ee*ee);this.data[M+D]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(r){for(let P=r.length-1;P>=0;--P){const A=r[P],D=r[P+1];A.zeroLength?r.splice(P,1):D&&D.isDash===A.isDash&&(D.left=A.left,r.splice(P,1))}const d=r[0],m=r[r.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const g=this.width*this.nextRow;let x=0,M=r[x];for(let P=0;P<this.width;P++){P/M.right>1&&(M=r[++x]);const A=Math.abs(P-M.left),D=Math.abs(P-M.right),B=Math.min(A,D);this.data[g+P]=Math.max(0,Math.min(255,(M.isDash?B:-B)+128))}}addDash(r,d){const m=d?7:0,g=2*m+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let x=0;for(let P=0;P<r.length;P++)x+=r[P];if(x!==0){const P=this.width/x,A=this.getDashRanges(r,this.width,P);d?this.addRoundDash(A,P,m):this.addRegularDash(A)}const M={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:x};return this.nextRow+=g,this.dirty=!0,M}bind(r){const d=r.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Ci="maplibre_preloaded_worker_pool";class Ti{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Ti.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ci]}numActive(){return Object.keys(this.active).length}}const Gi=Math.floor(C.hardwareConcurrency/2);let qi,Xi;function nt(){return qi||(qi=new Ti),qi}Ti.workerCount=l.B(globalThis)?Math.max(Math.min(Gi,3),1):1;class sn{constructor(r,d){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let g=0;g<m.length;g++){const x=new l.C(m[g],d);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,d){const m=[];for(const g of this.actors)m.push(g.sendAsync({type:r,data:d}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,d){for(const m of this.actors)m.registerMessageHandler(r,d)}}function _n(){return Xi||(Xi=new sn(nt(),l.G),Xi.registerMessageHandler("getResource",(b,r,d)=>l.m(r,d))),Xi}function Zn(b,r){const d=l.F();return l.H(d,d,[1,1,0]),l.J(d,d,[.5*b.width,.5*b.height,1]),l.K(d,d,b.calculatePosMatrix(r.toUnwrapped()))}function En(b,r,d,m,g,x){const M=function(O,Z,te){if(O)for(const ee of O){const se=Z[ee];if(se&&se.source===te&&se.type==="fill-extrusion")return!0}else for(const ee in Z){const se=Z[ee];if(se.source===te&&se.type==="fill-extrusion")return!0}return!1}(g&&g.layers,r,b.id),P=x.maxPitchScaleFactor(),A=b.tilesIn(m,P,M);A.sort($n);const D=[];for(const O of A)D.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(r,d,b._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,g,x,P,Zn(b.transform,O.tileID))});const B=function(O){const Z={},te={};for(const ee of O){const se=ee.queryResults,K=ee.wrappedTileID,fe=te[K]=te[K]||{};for(const Te in se){const oe=se[Te],ye=fe[Te]=fe[Te]||{},Me=Z[Te]=Z[Te]||[];for(const Pe of oe)ye[Pe.featureIndex]||(ye[Pe.featureIndex]=!0,Me.push(Pe))}}return Z}(D);for(const O in B)B[O].forEach(Z=>{const te=Z.feature,ee=b.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=ee});return B}function $n(b,r){const d=b.tileID,m=r.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}function Ds(b,r,d){return l._(this,void 0,void 0,function*(){let m=b;if(b.url?m=(yield l.h(r.transformRequest(b.url,ae.Source),d)).data:yield C.frameAsync(d),!m)return null;const g=l.L(l.e(m,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(g.vectorLayerIds=m.vector_layers.map(x=>x.id)),g})}class Fi{constructor(r,d){r&&(d?this.setSouthWest(r).setNorthEast(d):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof l.M?new l.M(r.lng,r.lat):l.M.convert(r),this}setSouthWest(r){return this._sw=r instanceof l.M?new l.M(r.lng,r.lat):l.M.convert(r),this}extend(r){const d=this._sw,m=this._ne;let g,x;if(r instanceof l.M)g=r,x=r;else{if(!(r instanceof Fi))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Fi.convert(r)):this.extend(l.M.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(l.M.convert(r)):this;if(g=r._sw,x=r._ne,!g||!x)return this}return d||m?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),m.lng=Math.max(x.lng,m.lng),m.lat=Math.max(x.lat,m.lat)):(this._sw=new l.M(g.lng,g.lat),this._ne=new l.M(x.lng,x.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:d,lat:m}=l.M.convert(r);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&g}static convert(r){return r instanceof Fi?r:r&&new Fi(r)}static fromLngLat(r,d=0){const m=360*d/40075017,g=m/Math.cos(Math.PI/180*r.lat);return new Fi(new l.M(r.lng-g,r.lat-m),new l.M(r.lng+g,r.lat+m))}}class qs{constructor(r,d,m){this.bounds=Fi.convert(this.validateBounds(r)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const d=Math.pow(2,r.z),m=Math.floor(l.N(this.bounds.getWest())*d),g=Math.floor(l.O(this.bounds.getNorth())*d),x=Math.ceil(l.N(this.bounds.getEast())*d),M=Math.ceil(l.O(this.bounds.getSouth())*d);return r.x>=m&&r.x<x&&r.y>=g&&r.y<M}}class De extends l.E{constructor(r,d,m,g){if(super(),this.id=r,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ds(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(l.e(this,r),r.bounds&&(this.tileBounds=new qs(r.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new l.j(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(r){return l._(this,void 0,void 0,function*(){const d=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,ae.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let g="reloadTile";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((x,M)=>{r.reloadPromise={resolve:x,reject:M}})}else r.actor=this.dispatcher.getActor(),g="loadTile";r.abortController=new AbortController;try{const x=yield r.actor.sendAsync({type:g,data:m},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,x)}catch(x){if(delete r.abortController,r.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(r,null)}})}_afterTileLoadWorkerResponse(r,d){if(d&&d.resourceTiming&&(r.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&r.setExpiryData(d),r.loadVectorData(d,this.map.painter),r.reloadPromise){const m=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(m.resolve).catch(m.reject)}}abortTile(r){return l._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"abortTile",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return l._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"removeTile",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Hs extends l.E{constructor(r,d,m,g){super(),this.id=r,this.dispatcher=m,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.L(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ds(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(l.e(this,r),r.bounds&&(this.tileBounds=new qs(r.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new l.j(r))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return l.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return l._(this,void 0,void 0,function*(){const d=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const m=yield W.getImage(this.map._requestManager.transformRequest(d,ae.Tile),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&r.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const g=this.map.painter.context,x=g.gl,M=m.data;r.texture=this.map.painter.getTileTexture(M.width),r.texture?r.texture.update(M,{useMipmap:!0}):(r.texture=new We(g,M,x.RGBA,{useMipmap:!0}),r.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),r.state="loaded"}}catch(m){if(delete r.abortController,r.aborted)r.state="unloaded";else if(m)throw r.state="errored",m}})}abortTile(r){return l._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return l._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class or extends Hs{constructor(r,d,m,g){super(r,d,m,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(r){return l._(this,void 0,void 0,function*(){const d=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,ae.Tile);r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const g=yield W.getImage(m,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(g&&g.data){const x=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&r.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const M=l.b(x)&&l.S()?x:yield this.readImageNow(x),P={type:this.type,uid:r.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const A=yield r.actor.sendAsync({type:"loadDEMTile",data:P});r.dem=A,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(g){if(delete r.abortController,r.aborted)r.state="unloaded";else if(g)throw r.state="errored",g}})}readImageNow(r){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const d=r.width+2,m=r.height+2;try{return new l.R({width:d,height:m},yield l.V(r,-1,-1,d,m))}catch{}}return C.getImageData(r,1)})}_getNeighboringTiles(r){const d=r.canonical,m=Math.pow(2,d.z),g=(d.x-1+m)%m,x=d.x===0?r.wrap-1:r.wrap,M=(d.x+1+m)%m,P=d.x+1===m?r.wrap+1:r.wrap,A={};return A[new l.Q(r.overscaledZ,x,d.z,g,d.y).key]={backfilled:!1},A[new l.Q(r.overscaledZ,P,d.z,M,d.y).key]={backfilled:!1},d.y>0&&(A[new l.Q(r.overscaledZ,x,d.z,g,d.y-1).key]={backfilled:!1},A[new l.Q(r.overscaledZ,r.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},A[new l.Q(r.overscaledZ,P,d.z,M,d.y-1).key]={backfilled:!1}),d.y+1<m&&(A[new l.Q(r.overscaledZ,x,d.z,g,d.y+1).key]={backfilled:!1},A[new l.Q(r.overscaledZ,r.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},A[new l.Q(r.overscaledZ,P,d.z,M,d.y+1).key]={backfilled:!1}),A}unloadTile(r){return l._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:r.uid,source:this.id}}))})}}class Ut extends l.E{constructor(r,d,m,g){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(g),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const x=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*x,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*x,extent:l.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.W,radius:(d.clusterRadius||50)*x,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,d,m){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:r,limit:d,offset:m}})}_updateWorkerData(r){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);r?d.dataDiff=r:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(C.resolveURL(this._data),ae.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;m.resourceTiming&&m.resourceTiming[this.id]&&(g=m.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(x,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(r){return l._(this,void 0,void 0,function*(){const d=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const m={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.abortController=new AbortController;const g=yield this.actor.sendAsync({type:d,data:m},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(g,this.map.painter,d==="reloadTile")})}abortTile(r){return l._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return l._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ki=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ts extends l.E{constructor(r,d,m,g){super(),this.id=r,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}load(r){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield W.getImage(this.map._requestManager.transformRequest(this.url,ae.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,r&&(this.coordinates=r),this._finishLoading())}catch(d){this._request=null,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const d=r.map(l.Y.fromLngLat);this.tileID=function(g){let x=1/0,M=1/0,P=-1/0,A=-1/0;for(const Z of g)x=Math.min(x,Z.x),M=Math.min(M,Z.y),P=Math.max(P,Z.x),A=Math.max(A,Z.y);const D=Math.max(P-x,A-M),B=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),O=Math.pow(2,B);return new l.a0(B,Math.floor((x+P)/2*O),Math.floor((M+A)/2*O))}(d),this.minzoom=this.maxzoom=this.tileID.z;const m=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,l.W,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,l.W),this._boundsArray.emplaceBack(m[2].x,m[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,d=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,Ki.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new We(r,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class xi extends ts{constructor(r,d,m,g){super(r,d,m,g),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const d of r.urls)this.urls.push(this.map._requestManager.transformRequest(d,ae.Source).url);try{const d=yield l.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const d=this.video.seekable;r<d.start(0)||r>d.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,d=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,Ki.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new We(r,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class is extends ts{constructor(r,d,m,g){super(r,d,m,g),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(M=>typeof M!="number"))||this.fire(new l.j(new l.a1(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${r}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${r}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Ki.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new We(d,this.canvas,m.RGBA,{premultiply:!0});let g=!1;for(const x in this.tiles){const M=this.tiles[x];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Mn={},Gn=b=>{switch(b){case"geojson":return Ut;case"image":return ts;case"raster":return Hs;case"raster-dem":return or;case"vector":return De;case"video":return xi;case"canvas":return is}return Mn[b]},Ls="RTLPluginLoaded";class Ws extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_n()}_syncState(r){return this.status=r,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:r,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return l._(this,arguments,void 0,function*(d,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=C.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Ls))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ye=null;function yn(){return Ye||(Ye=new Ws),Ye}class ln{constructor(r,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=l.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const d=r+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(g,x){const M={};if(!x)return M;for(const P of g){const A=P.layerIds.map(D=>x.getLayer(D)).filter(Boolean);if(A.length!==0){P.layers=A,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(D=>A.filter(B=>B.id===D)[0]));for(const D of A)M[D.id]=P}}return M}(r.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a5){if(this.hasSymbolBuckets=!0,!m)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a5&&x.hasRTLText){this.hasRTLText=!0,yn().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(x))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(r)}const d=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new We(r,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new We(r,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,d,m,g,x,M,P,A,D,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:x,scale:M,tileSize:this.tileSize,pixelPosMatrix:B,transform:A,params:P,queryPadding:this.queryPadding*D},r,d,m):{}}querySourceFeatures(r,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const g=m.loadVTLayers(),x=d&&d.sourceLayer?d.sourceLayer:"",M=g._geojsonTileLayer||g[x];if(!M)return;const P=l.a6(d&&d.filter),{z:A,x:D,y:B}=this.tileID.canonical,O={z:A,x:D,y:B};for(let Z=0;Z<M.length;Z++){const te=M.feature(Z);if(P.needGeometry){const K=l.a7(te,!0);if(!P.filter(new l.a8(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!P.filter(new l.a8(this.tileID.overscaledZ),te))continue;const ee=m.getId(te,x),se=new l.a9(te,A,D,B,ee);se.tile=O,r.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const d=this.expirationTime;if(r.cacheControl){const m=l.aa(r.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const m=Date.now();let g=!1;if(this.expirationTime>m)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const x=this.expirationTime-d;x?this.expirationTime=m+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const x=this.buckets[g],M=x.layers[0].sourceLayer||"_geojsonTileLayer",P=m[M],A=r[M];if(!P||!A||Object.keys(A).length===0)continue;x.update(A,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=d&&d.style&&d.style.getLayer(g);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<C.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=C.now()+r}setDependencies(r,d){const m={};for(const g of d)m[g]=!0;this.dependencies[r]=m}hasDependency(r,d){for(const m of r){const g=this.dependencies[m];if(g){for(const x of d)if(g[x])return!0}}return!1}}class xs{constructor(r,d){this.max=r,this.onRemove=d,this.reset()}reset(){for(const r in this.data)for(const d of this.data[r])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(r,d,m){const g=r.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const x={value:d,timeout:void 0};if(m!==void 0&&(x.timeout=setTimeout(()=>{this.remove(r,x)},m)),this.data[g].push(x),this.order.push(g),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const d=this.data[r].shift();return d.timeout&&clearTimeout(d.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),d.value}getByKey(r){const d=this.data[r];return d?d[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,d){if(!this.has(r))return this;const m=r.wrapped().key,g=d===void 0?0:this.data[m].indexOf(d),x=this.data[m][g];return this.data[m].splice(g,1),x.timeout&&clearTimeout(x.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(x.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(r){const d=[];for(const m in this.data)for(const g of this.data[m])r(g.value)||d.push(g);for(const m of d)this.remove(m.value.tileID,m)}}class vs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,d,m){const g=String(d);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][g]=this.stateChanges[r][g]||{},l.e(this.stateChanges[r][g],m),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==g&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][g]===null){this.deletedStates[r][g]={};for(const x in this.state[r][g])m[x]||(this.deletedStates[r][g][x]=null)}else for(const x in m)this.deletedStates[r]&&this.deletedStates[r][g]&&this.deletedStates[r][g][x]===null&&delete this.deletedStates[r][g][x]}removeFeatureState(r,d,m){if(this.deletedStates[r]===null)return;const g=String(d);if(this.deletedStates[r]=this.deletedStates[r]||{},m&&d!==void 0)this.deletedStates[r][g]!==null&&(this.deletedStates[r][g]=this.deletedStates[r][g]||{},this.deletedStates[r][g][m]=null);else if(d!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][g])for(m in this.deletedStates[r][g]={},this.stateChanges[r][g])this.deletedStates[r][g][m]=null;else this.deletedStates[r][g]=null;else this.deletedStates[r]=null}getState(r,d){const m=String(d),g=l.e({},(this.state[r]||{})[m],(this.stateChanges[r]||{})[m]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const x=this.deletedStates[r][d];if(x===null)return{};for(const M in x)delete g[M]}return g}initializeTileState(r,d){r.setFeatureState(this.state,d)}coalesceChanges(r,d){const m={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const M in this.stateChanges[g])this.state[g][M]||(this.state[g][M]={}),l.e(this.state[g][M],this.stateChanges[g][M]),x[M]=this.state[g][M];m[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(this.deletedStates[g]===null)for(const M in this.state[g])x[M]={},this.state[g][M]={};else for(const M in this.deletedStates[g]){if(this.deletedStates[g][M]===null)this.state[g][M]={};else for(const P of Object.keys(this.deletedStates[g][M]))delete this.state[g][M][P];x[M]=this.state[g][M]}m[g]=m[g]||{},l.e(m[g],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const g in r)r[g].setFeatureState(m,d)}}class Ke extends l.E{constructor(r,d,m){super(),this.id=r,this.dispatcher=m,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,x,M,P)=>{const A=new(Gn(x.type))(g,x,M,P);if(A.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${A.id}`);return A})(r,d,m,this),this._tiles={},this._cache=new xs(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new vs,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const d=this._tiles[r];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,d,m){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,d,m)}catch(g){r.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new l.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(r),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(At).map(r=>r.key)}getRenderableIds(r){const d=[];for(const m in this._tiles)this._isIdRenderable(m,r)&&d.push(this._tiles[m]);return r?d.sort((m,g)=>{const x=m.tileID,M=g.tileID,P=new l.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),A=new l.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-M.overscaledZ||A.y-P.y||A.x-P.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(At).map(m=>m.key)}hasRenderableParent(r){const d=this.findLoadedParent(r,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(r,d){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(d||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,d){return l._(this,void 0,void 0,function*(){const m=this._tiles[r];m&&(m.state!=="loading"&&(m.state=d),yield this._loadTile(m,r,d))})}_tileLoaded(r,d,m){r.timeAdded=C.now(),m==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(d,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const x=d[g];if(r.neighboringTiles&&r.neighboringTiles[x]){const M=this.getTileByID(x);m(r,M),m(M,r)}}function m(g,x){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let M=x.tileID.canonical.x-g.tileID.canonical.x;const P=x.tileID.canonical.y-g.tileID.canonical.y,A=Math.pow(2,g.tileID.canonical.z),D=x.tileID.key;M===0&&P===0||Math.abs(P)>1||(Math.abs(M)>1&&(Math.abs(M+A)===1?M+=A:Math.abs(M-A)===1&&(M-=A)),x.dem&&g.dem&&(g.dem.backfillBorder(x.dem,M,P),g.neighboringTiles&&g.neighboringTiles[D]&&(g.neighboringTiles[D].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,d,m,g){for(const x in this._tiles){let M=this._tiles[x];if(g[x]||!M.hasData()||M.tileID.overscaledZ<=d||M.tileID.overscaledZ>m)continue;let P=M.tileID;for(;M&&M.tileID.overscaledZ>d+1;){const D=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[D.key],M&&M.hasData()&&(P=D)}let A=P;for(;A.overscaledZ>d;)if(A=A.scaledTo(A.overscaledZ-1),r[A.key]){g[P.key]=P;break}}}findLoadedParent(r,d){if(r.key in this._loadedParentTiles){const m=this._loadedParentTiles[r.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=r.overscaledZ-1;m>=d;m--){const g=r.scaledTo(m),x=this._getLoadedTile(g);if(x)return x}}_getLoadedTile(r){const d=this._tiles[r.key];return d&&d.hasData()?d:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const d=Math.ceil(r.width/this._source.tileSize)+1,m=Math.ceil(r.height/this._source.tileSize)+1,g=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(r){const d=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,d){const m={};for(const g in this._tiles){const x=this._tiles[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+d),m[x.tileID.key]=x}this._tiles=m;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(r,d){if(this.transform=r,this.terrain=d,!this._sourceLoaded||this._paused)return;let m;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new l.Q(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y)):(m=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(m=m.filter(B=>this._source.hasTile(B)))):m=[];const g=r.coveringZoomLevel(this._source),x=Math.max(g-Ke.maxOverzooming,this._source.minzoom),M=Math.max(g+Ke.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const B={};for(const O of m)if(O.canonical.z>this._source.minzoom){const Z=O.scaledTo(O.canonical.z-1);B[Z.key]=Z;const te=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));B[te.key]=te}m=m.concat(Object.values(B))}const P=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(m,g);if(Et(this._source.type)){const B={},O={},Z=Object.keys(A),te=C.now();for(const ee of Z){const se=A[ee],K=this._tiles[ee];if(!K||K.fadeEndTime!==0&&K.fadeEndTime<=te)continue;const fe=this.findLoadedParent(se,x);fe&&(this._addTile(fe.tileID),B[fe.tileID.key]=fe.tileID),O[ee]=se}this._retainLoadedChildren(O,g,M,A);for(const ee in B)A[ee]||(this._coveredTiles[ee]=!0,A[ee]=B[ee]);if(d){const ee={},se={};for(const K of m)this._tiles[K.key].hasData()?ee[K.key]=K:se[K.key]=K;for(const K in se){const fe=se[K].children(this._source.maxzoom);this._tiles[fe[0].key]&&this._tiles[fe[1].key]&&this._tiles[fe[2].key]&&this._tiles[fe[3].key]&&(ee[fe[0].key]=A[fe[0].key]=fe[0],ee[fe[1].key]=A[fe[1].key]=fe[1],ee[fe[2].key]=A[fe[2].key]=fe[2],ee[fe[3].key]=A[fe[3].key]=fe[3],delete se[K])}for(const K in se){const fe=this.findLoadedParent(se[K],this._source.minzoom);if(fe){ee[fe.tileID.key]=A[fe.tileID.key]=fe.tileID;for(const Te in ee)ee[Te].isChildOf(fe.tileID)&&delete ee[Te]}}for(const K in this._tiles)ee[K]||(this._coveredTiles[K]=!0)}}for(const B in A)this._tiles[B].clearFadeHold();const D=l.ab(this._tiles,A);for(const B of D){const O=this._tiles[B];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(B)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,d){const m={},g={},x=Math.max(d-Ke.maxOverzooming,this._source.minzoom),M=Math.max(d+Ke.maxUnderzooming,this._source.minzoom),P={};for(const A of r){const D=this._addTile(A);m[A.key]=A,D.hasData()||d<this._source.maxzoom&&(P[A.key]=A)}this._retainLoadedChildren(P,d,M,m);for(const A of r){let D=this._tiles[A.key];if(D.hasData())continue;if(d+1>this._source.maxzoom){const O=A.children(this._source.maxzoom)[0],Z=this.getTile(O);if(Z&&Z.hasData()){m[O.key]=O;continue}}else{const O=A.children(this._source.maxzoom);if(m[O[0].key]&&m[O[1].key]&&m[O[2].key]&&m[O[3].key])continue}let B=D.wasRequested();for(let O=A.overscaledZ-1;O>=x;--O){const Z=A.scaledTo(O);if(g[Z.key])break;if(g[Z.key]=!0,D=this.getTile(Z),!D&&B&&(D=this._addTile(Z)),D){const te=D.hasData();if((B||te)&&(m[Z.key]=Z),B=D.wasRequested(),te)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const d=[];let m,g=this._tiles[r].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){m=this._loadedParentTiles[g.key];break}d.push(g.key);const x=g.scaledTo(g.overscaledZ-1);if(m=this._getLoadedTile(x),m)break;g=x}for(const x of d)this._loadedParentTiles[x]=m}}_addTile(r){let d=this._tiles[r.key];if(d)return d;d=this._cache.getAndRemove(r),d&&(this._setTileReloadTimer(r.key,d),d.tileID=r,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,d)));const m=d;return d||(d=new ln(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(d,r.key,d.state)),d.uses++,this._tiles[r.key]=d,m||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(r,d){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const m=d.getExpiryTimeout();m&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},m))}_removeTile(r){const d=this._tiles[r];d&&(d.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,d,m){const g=[],x=this.transform;if(!x)return g;const M=m?x.getCameraQueryGeometry(r):r,P=r.map(ee=>x.pointCoordinate(ee,this.terrain)),A=M.map(ee=>x.pointCoordinate(ee,this.terrain)),D=this.getIds();let B=1/0,O=1/0,Z=-1/0,te=-1/0;for(const ee of A)B=Math.min(B,ee.x),O=Math.min(O,ee.y),Z=Math.max(Z,ee.x),te=Math.max(te,ee.y);for(let ee=0;ee<D.length;ee++){const se=this._tiles[D[ee]];if(se.holdingForFade())continue;const K=se.tileID,fe=Math.pow(2,x.zoom-se.tileID.overscaledZ),Te=d*se.queryPadding*l.W/se.tileSize/fe,oe=[K.getTilePoint(new l.Y(B,O)),K.getTilePoint(new l.Y(Z,te))];if(oe[0].x-Te<l.W&&oe[0].y-Te<l.W&&oe[1].x+Te>=0&&oe[1].y+Te>=0){const ye=P.map(Pe=>K.getTilePoint(Pe)),Me=A.map(Pe=>K.getTilePoint(Pe));g.push({tile:se,tileID:K,queryGeometry:ye,cameraQueryGeometry:Me,scale:fe})}}return g}getVisibleCoordinates(r){const d=this.getRenderableIds(r).map(m=>this._tiles[m].tileID);for(const m of d)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Et(this._source.type)){const r=C.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=r)return!0}return!1}setFeatureState(r,d,m){this._state.updateState(r=r||"_geojsonTileLayer",d,m)}removeFeatureState(r,d,m){this._state.removeFeatureState(r=r||"_geojsonTileLayer",d,m)}getFeatureState(r,d){return this._state.getState(r=r||"_geojsonTileLayer",d)}setDependencies(r,d,m){const g=this._tiles[r];g&&g.setDependencies(d,m)}reloadTilesForDependencies(r,d){for(const m in this._tiles)this._tiles[m].hasDependency(r,d)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(r,d))}}function At(b,r){const d=Math.abs(2*b.wrap)-+(b.wrap<0),m=Math.abs(2*r.wrap)-+(r.wrap<0);return b.overscaledZ-r.overscaledZ||m-d||r.canonical.y-b.canonical.y||r.canonical.x-b.canonical.x}function Et(b){return b==="raster"||b==="image"||b==="video"}Ke.maxOverzooming=10,Ke.maxUnderzooming=3;class Hi{constructor(r,d){this.reset(r,d)}reset(r,d){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=l.ac(r,0,1);let d=1,m=this._distances[d];const g=r*this.paddedLength+this.padding;for(;m<g&&d<this._distances.length;)m=this._distances[++d];const x=d-1,M=this._distances[x],P=m-M,A=P>0?(g-M)/P:0;return this.points[x].mult(1-A).add(this.points[d].mult(A))}}function cn(b,r){let d=!0;return b==="always"||b!=="never"&&r!=="never"||(d=!1),d}class Dt{constructor(r,d,m){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(d/m);for(let M=0;M<this.xCellCount*this.yCellCount;M++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=d,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,d,m,g,x){this._forEachCell(d,m,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(r,d,m,g){this._forEachCell(d-g,m-g,d+g,m+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(d),this.circles.push(m),this.circles.push(g)}_insertBoxCell(r,d,m,g,x,M){this.boxCells[x].push(M)}_insertCircleCell(r,d,m,g,x,M){this.circleCells[x].push(M)}_query(r,d,m,g,x,M,P){if(m<0||r>this.width||g<0||d>this.height)return[];const A=[];if(r<=0&&d<=0&&this.width<=m&&this.height<=g){if(x)return[{key:null,x1:r,y1:d,x2:m,y2:g}];for(let D=0;D<this.boxKeys.length;D++)A.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const B=this.circles[3*D],O=this.circles[3*D+1],Z=this.circles[3*D+2];A.push({key:this.circleKeys[D],x1:B-Z,y1:O-Z,x2:B+Z,y2:O+Z})}}else this._forEachCell(r,d,m,g,this._queryCell,A,{hitTest:x,overlapMode:M,seenUids:{box:{},circle:{}}},P);return A}query(r,d,m,g){return this._query(r,d,m,g,!1,null)}hitTest(r,d,m,g,x,M){return this._query(r,d,m,g,!0,x,M).length>0}hitTestCircle(r,d,m,g,x){const M=r-m,P=r+m,A=d-m,D=d+m;if(P<0||M>this.width||D<0||A>this.height)return!1;const B=[];return this._forEachCell(M,A,P,D,this._queryCellCircle,B,{hitTest:!0,overlapMode:g,circle:{x:r,y:d,radius:m},seenUids:{box:{},circle:{}}},x),B.length>0}_queryCell(r,d,m,g,x,M,P,A){const{seenUids:D,hitTest:B,overlapMode:O}=P,Z=this.boxCells[x];if(Z!==null){const ee=this.bboxes;for(const se of Z)if(!D.box[se]){D.box[se]=!0;const K=4*se,fe=this.boxKeys[se];if(r<=ee[K+2]&&d<=ee[K+3]&&m>=ee[K+0]&&g>=ee[K+1]&&(!A||A(fe))&&(!B||!cn(O,fe.overlapMode))&&(M.push({key:fe,x1:ee[K],y1:ee[K+1],x2:ee[K+2],y2:ee[K+3]}),B))return!0}}const te=this.circleCells[x];if(te!==null){const ee=this.circles;for(const se of te)if(!D.circle[se]){D.circle[se]=!0;const K=3*se,fe=this.circleKeys[se];if(this._circleAndRectCollide(ee[K],ee[K+1],ee[K+2],r,d,m,g)&&(!A||A(fe))&&(!B||!cn(O,fe.overlapMode))){const Te=ee[K],oe=ee[K+1],ye=ee[K+2];if(M.push({key:fe,x1:Te-ye,y1:oe-ye,x2:Te+ye,y2:oe+ye}),B)return!0}}}return!1}_queryCellCircle(r,d,m,g,x,M,P,A){const{circle:D,seenUids:B,overlapMode:O}=P,Z=this.boxCells[x];if(Z!==null){const ee=this.bboxes;for(const se of Z)if(!B.box[se]){B.box[se]=!0;const K=4*se,fe=this.boxKeys[se];if(this._circleAndRectCollide(D.x,D.y,D.radius,ee[K+0],ee[K+1],ee[K+2],ee[K+3])&&(!A||A(fe))&&!cn(O,fe.overlapMode))return M.push(!0),!0}}const te=this.circleCells[x];if(te!==null){const ee=this.circles;for(const se of te)if(!B.circle[se]){B.circle[se]=!0;const K=3*se,fe=this.circleKeys[se];if(this._circlesCollide(ee[K],ee[K+1],ee[K+2],D.x,D.y,D.radius)&&(!A||A(fe))&&!cn(O,fe.overlapMode))return M.push(!0),!0}}}_forEachCell(r,d,m,g,x,M,P,A){const D=this._convertToXCellCoord(r),B=this._convertToYCellCoord(d),O=this._convertToXCellCoord(m),Z=this._convertToYCellCoord(g);for(let te=D;te<=O;te++)for(let ee=B;ee<=Z;ee++)if(x.call(this,r,d,m,g,this.xCellCount*ee+te,M,P,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,d,m,g,x,M){const P=g-r,A=x-d,D=m+M;return D*D>P*P+A*A}_circleAndRectCollide(r,d,m,g,x,M,P){const A=(M-g)/2,D=Math.abs(r-(g+A));if(D>A+m)return!1;const B=(P-x)/2,O=Math.abs(d-(x+B));if(O>B+m)return!1;if(D<=A||O<=B)return!0;const Z=D-A,te=O-B;return Z*Z+te*te<=m*m}}function ns(b,r,d,m,g){const x=l.F();return r?(l.J(x,x,[1/g,1/g,1]),d||l.ad(x,x,m.angle)):l.K(x,m.labelPlaneMatrix,b),x}function zn(b,r,d,m,g){if(r){const x=l.ae(b);return l.J(x,x,[g,g,1]),d||l.ad(x,x,-m.angle),x}return m.glCoordMatrix}function Q(b,r,d){let m;d?(m=[b.x,b.y,d(b.x,b.y),1],l.af(m,m,r)):(m=[b.x,b.y,0,1],wt(m,m,r));const g=m[3];return{point:new l.P(m[0]/g,m[1]/g),signedDistanceFromCamera:g}}function V(b,r){return .5+b/r*.5}function U(b,r){const d=b[0]/b[3],m=b[1]/b[3];return d>=-r[0]&&d<=r[0]&&m>=-r[1]&&m<=r[1]}function G(b,r,d,m,g,x,M,P,A,D){const B=m?b.textSizeData:b.iconSizeData,O=l.ag(B,d.transform.zoom),Z=[256/d.width*2+1,256/d.height*2+1],te=m?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;te.clear();const ee=b.lineVertexArray,se=m?b.text.placedSymbolArray:b.icon.placedSymbolArray,K=d.transform.width/d.transform.height;let fe=!1;for(let Te=0;Te<se.length;Te++){const oe=se.get(Te);if(oe.hidden||oe.writingMode===l.ah.vertical&&!fe){pt(oe.numGlyphs,te);continue}let ye;if(fe=!1,D?(ye=[oe.anchorX,oe.anchorY,D(oe.anchorX,oe.anchorY),1],l.af(ye,ye,r)):(ye=[oe.anchorX,oe.anchorY,0,1],wt(ye,ye,r)),!U(ye,Z)){pt(oe.numGlyphs,te);continue}const Me=V(d.transform.cameraToCenterDistance,ye[3]),Pe=l.ai(B,O,oe),ze=M?Pe/Me:Pe*Me,$e=new l.P(oe.anchorX,oe.anchorY),He=Q($e,g,D).point,Ze={projections:{},offsets:{}},ut=ge(oe,ze,!1,P,r,g,x,b.glyphOffsetArray,ee,te,He,$e,Ze,K,A,D);fe=ut.useVertical,(ut.notEnoughRoom||fe||ut.needsFlipping&&ge(oe,ze,!0,P,r,g,x,b.glyphOffsetArray,ee,te,He,$e,Ze,K,A,D).notEnoughRoom)&&pt(oe.numGlyphs,te)}m?b.text.dynamicLayoutVertexBuffer.updateData(te):b.icon.dynamicLayoutVertexBuffer.updateData(te)}function J(b,r,d,m,g,x,M,P,A,D,B,O,Z){const te=P.glyphStartIndex+P.numGlyphs,ee=P.lineStartIndex,se=P.lineStartIndex+P.lineLength,K=r.getoffsetX(P.glyphStartIndex),fe=r.getoffsetX(te-1),Te=Ee(b*K,d,m,g,x,M,P.segment,ee,se,A,D,B,O,Z);if(!Te)return null;const oe=Ee(b*fe,d,m,g,x,M,P.segment,ee,se,A,D,B,O,Z);return oe?{first:Te,last:oe}:null}function me(b,r,d,m){return b===l.ah.horizontal&&Math.abs(d.y-r.y)>Math.abs(d.x-r.x)*m?{useVertical:!0}:(b===l.ah.vertical?r.y<d.y:r.x>d.x)?{needsFlipping:!0}:null}function ge(b,r,d,m,g,x,M,P,A,D,B,O,Z,te,ee,se){const K=r/24,fe=b.lineOffsetX*K,Te=b.lineOffsetY*K;let oe;if(b.numGlyphs>1){const ye=b.glyphStartIndex+b.numGlyphs,Me=b.lineStartIndex,Pe=b.lineStartIndex+b.lineLength,ze=J(K,P,fe,Te,d,B,O,b,A,x,Z,ee,se);if(!ze)return{notEnoughRoom:!0};const $e=Q(ze.first.point,M,se).point,He=Q(ze.last.point,M,se).point;if(m&&!d){const Ze=me(b.writingMode,$e,He,te);if(Ze)return Ze}oe=[ze.first];for(let Ze=b.glyphStartIndex+1;Ze<ye-1;Ze++)oe.push(Ee(K*P.getoffsetX(Ze),fe,Te,d,B,O,b.segment,Me,Pe,A,x,Z,ee,se));oe.push(ze.last)}else{if(m&&!d){const Me=Q(O,g,se).point,Pe=b.lineStartIndex+b.segment+1,ze=new l.P(A.getx(Pe),A.gety(Pe)),$e=Q(ze,g,se),He=$e.signedDistanceFromCamera>0?$e.point:be(O,ze,Me,1,g,se),Ze=me(b.writingMode,Me,He,te);if(Ze)return Ze}const ye=Ee(K*P.getoffsetX(b.glyphStartIndex),fe,Te,d,B,O,b.segment,b.lineStartIndex,b.lineStartIndex+b.lineLength,A,x,Z,ee,se);if(!ye)return{notEnoughRoom:!0};oe=[ye]}for(const ye of oe)l.aj(D,ye.point,ye.angle);return{}}function be(b,r,d,m,g,x){const M=Q(b.add(b.sub(r)._unit()),g,x).point,P=d.sub(M);return d.add(P._mult(m/P.mag()))}function ce(b,r){const{projectionCache:d,lineVertexArray:m,labelPlaneMatrix:g,tileAnchorPoint:x,distanceFromAnchor:M,getElevation:P,previousVertex:A,direction:D,absOffsetX:B}=r;if(d.projections[b])return d.projections[b];const O=new l.P(m.getx(b),m.gety(b)),Z=Q(O,g,P);if(Z.signedDistanceFromCamera>0)return d.projections[b]=Z.point,Z.point;const te=b-D;return be(M===0?x:new l.P(m.getx(te),m.gety(te)),O,A,B-M+1,g,P)}function Se(b,r,d){return b._unit()._perp()._mult(r*d)}function Ne(b,r,d,m,g,x,M,P){const{projectionCache:A,direction:D}=P;if(A.offsets[b])return A.offsets[b];const B=d.add(r);if(b+D<m||b+D>=g)return A.offsets[b]=B,B;const O=ce(b+D,P),Z=Se(O.sub(d),M,D),te=d.add(Z),ee=O.add(Z);return A.offsets[b]=l.ak(x,B,te,ee)||B,A.offsets[b]}function Ee(b,r,d,m,g,x,M,P,A,D,B,O,Z,te){const ee=m?b-r:b+r;let se=ee>0?1:-1,K=0;m&&(se*=-1,K=Math.PI),se<0&&(K+=Math.PI);let fe,Te,oe=se>0?P+M:P+M+1,ye=g,Me=g,Pe=0,ze=0;const $e=Math.abs(ee),He=[];let Ze;for(;Pe+ze<=$e;){if(oe+=se,oe<P||oe>=A)return null;Pe+=ze,Me=ye,Te=fe;const tt={projectionCache:O,lineVertexArray:D,labelPlaneMatrix:B,tileAnchorPoint:x,distanceFromAnchor:Pe,getElevation:te,previousVertex:Me,direction:se,absOffsetX:$e};if(ye=ce(oe,tt),d===0)He.push(Me),Ze=ye.sub(Me);else{let Pt;const Bt=ye.sub(Me);Pt=Bt.mag()===0?Se(ce(oe+se,tt).sub(ye),d,se):Se(Bt,d,se),Te||(Te=Me.add(Pt)),fe=Ne(oe,Pt,ye,P,A,Te,d,tt),He.push(Te),Ze=fe.sub(Te)}ze=Ze.mag()}const ut=Ze._mult(($e-Pe)/ze)._add(Te||Me),Rt=K+Math.atan2(ye.y-Me.y,ye.x-Me.x);return He.push(ut),{point:ut,angle:Z?Rt:0,path:He}}const Be=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pt(b,r){for(let d=0;d<b;d++){const m=r.length;r.resize(m+4),r.float32.set(Be,3*m)}}function wt(b,r,d){const m=r[0],g=r[1];return b[0]=d[0]*m+d[4]*g+d[12],b[1]=d[1]*m+d[5]*g+d[13],b[3]=d[3]*m+d[7]*g+d[15],b}const vt=100;class Nt{constructor(r,d=new Dt(r.width+200,r.height+200,25),m=new Dt(r.width+200,r.height+200,25)){this.transform=r,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+vt,this.screenBottomBoundary=r.height+vt,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,d,m,g,x,M){const P=this.projectAndGetPerspectiveRatio(g,r.anchorPointX,r.anchorPointY,M),A=m*P.perspectiveRatio,D=r.x1*A+P.point.x,B=r.y1*A+P.point.y,O=r.x2*A+P.point.x,Z=r.y2*A+P.point.y;return!this.isInsideGrid(D,B,O,Z)||d!=="always"&&this.grid.hitTest(D,B,O,Z,d,x)||P.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[D,B,O,Z],offscreen:this.isOffscreen(D,B,O,Z)}}placeCollisionCircles(r,d,m,g,x,M,P,A,D,B,O,Z,te,ee){const se=[],K=new l.P(d.anchorX,d.anchorY),fe=Q(K,M,ee),Te=V(this.transform.cameraToCenterDistance,fe.signedDistanceFromCamera),oe=(B?x/Te:x*Te)/l.ao,ye=Q(K,P,ee).point,Me=J(oe,g,d.lineOffsetX*oe,d.lineOffsetY*oe,!1,ye,K,d,m,P,{projections:{},offsets:{}},!1,ee);let Pe=!1,ze=!1,$e=!0;if(Me){const He=.5*Z*Te+te,Ze=new l.P(-100,-100),ut=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Rt=new Hi,tt=Me.first,Pt=Me.last;let Bt=[];for(let Ot=tt.path.length-1;Ot>=1;Ot--)Bt.push(tt.path[Ot]);for(let Ot=1;Ot<Pt.path.length;Ot++)Bt.push(Pt.path[Ot]);const Wt=2.5*He;if(A){const Ot=Bt.map(Vt=>Q(Vt,A,ee));Bt=Ot.some(Vt=>Vt.signedDistanceFromCamera<=0)?[]:Ot.map(Vt=>Vt.point)}let zt=[];if(Bt.length>0){const Ot=Bt[0].clone(),Vt=Bt[0].clone();for(let Bi=1;Bi<Bt.length;Bi++)Ot.x=Math.min(Ot.x,Bt[Bi].x),Ot.y=Math.min(Ot.y,Bt[Bi].y),Vt.x=Math.max(Vt.x,Bt[Bi].x),Vt.y=Math.max(Vt.y,Bt[Bi].y);zt=Ot.x>=Ze.x&&Vt.x<=ut.x&&Ot.y>=Ze.y&&Vt.y<=ut.y?[Bt]:Vt.x<Ze.x||Ot.x>ut.x||Vt.y<Ze.y||Ot.y>ut.y?[]:l.al([Bt],Ze.x,Ze.y,ut.x,ut.y)}for(const Ot of zt){Rt.reset(Ot,.25*He);let Vt=0;Vt=Rt.length<=.5*He?1:Math.ceil(Rt.paddedLength/Wt)+1;for(let Bi=0;Bi<Vt;Bi++){const yi=Bi/Math.max(Vt-1,1),os=Rt.lerp(yi),dn=os.x+vt,wi=os.y+vt;se.push(dn,wi,He,0);const Bn=dn-He,Xs=wi-He,ur=dn+He,to=wi+He;if($e=$e&&this.isOffscreen(Bn,Xs,ur,to),ze=ze||this.isInsideGrid(Bn,Xs,ur,to),r!=="always"&&this.grid.hitTestCircle(dn,wi,He,r,O)&&(Pe=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Pe}}}}return{circles:!D&&Pe||!ze||Te<this.perspectiveRatioCutoff?[]:se,offscreen:$e,collisionDetected:Pe}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let m=1/0,g=1/0,x=-1/0,M=-1/0;for(const B of r){const O=new l.P(B.x+vt,B.y+vt);m=Math.min(m,O.x),g=Math.min(g,O.y),x=Math.max(x,O.x),M=Math.max(M,O.y),d.push(O)}const P=this.grid.query(m,g,x,M).concat(this.ignoredGrid.query(m,g,x,M)),A={},D={};for(const B of P){const O=B.key;if(A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]={}),A[O.bucketInstanceId][O.featureIndex])continue;const Z=[new l.P(B.x1,B.y1),new l.P(B.x2,B.y1),new l.P(B.x2,B.y2),new l.P(B.x1,B.y2)];l.am(d,Z)&&(A[O.bucketInstanceId][O.featureIndex]=!0,D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]=[]),D[O.bucketInstanceId].push(O.featureIndex))}return D}insertCollisionBox(r,d,m,g,x,M){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:M,overlapMode:d},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,d,m,g,x,M){const P=m?this.ignoredGrid:this.grid,A={bucketInstanceId:g,featureIndex:x,collisionGroupID:M,overlapMode:d};for(let D=0;D<r.length;D+=4)P.insertCircle(A,r[D],r[D+1],r[D+2])}projectAndGetPerspectiveRatio(r,d,m,g){let x;return g?(x=[d,m,g(d,m),1],l.af(x,x,r)):(x=[d,m,0,1],wt(x,x,r)),{point:new l.P((x[0]/x[3]+1)/2*this.transform.width+vt,(-x[1]/x[3]+1)/2*this.transform.height+vt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(r,d,m,g){return m<vt||r>=this.screenRightBoundary||g<vt||d>this.screenBottomBoundary}isInsideGrid(r,d,m,g){return m>=0&&r<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const r=l.an([]);return l.H(r,r,[-100,-100,0]),r}}function Mt(b,r,d){return r*(l.W/(b.tileSize*Math.pow(2,d-b.tileID.overscaledZ)))}class ci{constructor(r,d,m,g){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?d:-d))):g&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ni{constructor(r,d,m,g,x){this.text=new ci(r?r.text:null,d,m,x),this.icon=new ci(r?r.icon:null,d,g,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fi{constructor(r,d,m){this.text=r,this.icon=d,this.skipFade=m}}class Lt{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class pi{constructor(r,d,m,g,x){this.bucketInstanceId=r,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=g,this.tileID=x}}class Mi{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const d=++this.maxGroupID;this.collisionGroups[r]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[r]}}function hn(b,r,d,m,g){const{horizontalAlign:x,verticalAlign:M}=l.at(b);return new l.P(-(x-.5)*r+m[0]*g,-(M-.5)*d+m[1]*g)}function Yi(b,r,d,m,g,x){const{x1:M,x2:P,y1:A,y2:D,anchorPointX:B,anchorPointY:O}=b,Z=new l.P(r,d);return m&&Z._rotate(g?x:-x),{x1:M+Z.x,y1:A+Z.y,x2:P+Z.x,y2:D+Z.y,anchorPointX:B,anchorPointY:O}}class Wi{constructor(r,d,m,g,x){this.transform=r.clone(),this.terrain=d,this.collisionIndex=new Nt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Mi(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,d,m,g){const x=m.getBucket(d),M=m.latestFeatureIndex;if(!x||!M||d.id!==x.layerIds[0])return;const P=m.collisionBoxArray,A=x.layers[0].layout,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),B=m.tileSize/l.W,O=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),Z=A.get("text-pitch-alignment")==="map",te=A.get("text-rotation-alignment")==="map",ee=Mt(m,1,this.transform.zoom),se=ns(O,Z,te,this.transform,ee);let K=null;if(Z){const Te=zn(O,Z,te,this.transform,ee);K=l.K([],this.transform.labelPlaneMatrix,Te)}this.retainedQueryData[x.bucketInstanceId]=new pi(x.bucketInstanceId,M,x.sourceLayerIndex,x.index,m.tileID);const fe={bucket:x,layout:A,posMatrix:O,textLabelPlaneMatrix:se,labelToScreenMatrix:K,scale:D,textPixelRatio:B,holdingForFade:m.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:l.ag(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const Te of x.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:ye,symbolInstanceEnd:Me}=Te;r.push({sortKey:oe,symbolInstanceStart:ye,symbolInstanceEnd:Me,parameters:fe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(r,d,m,g,x,M,P,A,D,B,O,Z,te,ee,se,K){const fe=l.ap[r.textAnchor],Te=[r.textOffset0,r.textOffset1],oe=hn(fe,m,g,Te,x),ye=this.collisionIndex.placeCollisionBox(Yi(d,oe.x,oe.y,M,P,this.transform.angle),O,A,D,B.predicate,K);if((!se||this.collisionIndex.placeCollisionBox(Yi(se,oe.x,oe.y,M,P,this.transform.angle),O,A,D,B.predicate,K).box.length!==0)&&ye.box.length>0){let Me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Me=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:Te,width:m,height:g,anchor:fe,textBoxScale:x,prevAnchor:Me},this.markUsedJustification(te,fe,Z,ee),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ee,Z),this.placedOrientations[Z.crossTileID]=ee),{shift:oe,placedGlyphBoxes:ye}}}placeLayerBucketPart(r,d,m){const{bucket:g,layout:x,posMatrix:M,textLabelPlaneMatrix:P,labelToScreenMatrix:A,textPixelRatio:D,holdingForFade:B,collisionBoxArray:O,partiallyEvaluatedTextSize:Z,collisionGroup:te}=r.parameters,ee=x.get("text-optional"),se=x.get("icon-optional"),K=l.aq(x,"text-overlap","text-allow-overlap"),fe=K==="always",Te=l.aq(x,"icon-overlap","icon-allow-overlap"),oe=Te==="always",ye=x.get("text-rotation-alignment")==="map",Me=x.get("text-pitch-alignment")==="map",Pe=x.get("icon-text-fit")!=="none",ze=x.get("symbol-z-order")==="viewport-y",$e=fe&&(oe||!g.hasIconData()||se),He=oe&&(fe||!g.hasTextData()||ee);!g.collisionArrays&&O&&g.deserializeCollisionBoxes(O);const Ze=this.retainedQueryData[g.bucketInstanceId].tileID,ut=this.terrain?(tt,Pt)=>this.terrain.getElevation(Ze,tt,Pt):null,Rt=(tt,Pt)=>{var Bt,Wt;if(d[tt.crossTileID])return;if(B)return void(this.placements[tt.crossTileID]=new fi(!1,!1,!1));let zt=!1,Ot=!1,Vt=!0,Bi=null,yi={box:null,offscreen:null},os={box:null,offscreen:null},dn=null,wi=null,Bn=null,Xs=0,ur=0,to=0;Pt.textFeatureIndex?Xs=Pt.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Xs=tt.featureIndex),Pt.verticalTextFeatureIndex&&(ur=Pt.verticalTextFeatureIndex);const io=Pt.textBox;if(io){const $i=Li=>{let In=l.ah.horizontal;if(g.allowVerticalPlacement&&!Li&&this.prevPlacement){const Ms=this.prevPlacement.placedOrientations[tt.crossTileID];Ms&&(this.placedOrientations[tt.crossTileID]=Ms,In=Ms,this.markUsedOrientation(g,In,tt))}return In},Ii=(Li,In)=>{if(g.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&Pt.verticalTextBox){for(const Ms of g.writingModes)if(Ms===l.ah.vertical?(yi=In(),os=yi):yi=Li(),yi&&yi.box&&yi.box.length)break}else yi=Li()},en=tt.textAnchorOffsetStartIndex,Uo=tt.textAnchorOffsetEndIndex;if(Uo===en){const Li=(In,Ms)=>{const qt=this.collisionIndex.placeCollisionBox(In,K,D,M,te.predicate,ut);return qt&&qt.box&&qt.box.length&&(this.markUsedOrientation(g,Ms,tt),this.placedOrientations[tt.crossTileID]=Ms),qt};Ii(()=>Li(io,l.ah.horizontal),()=>{const In=Pt.verticalTextBox;return g.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&In?Li(In,l.ah.vertical):{box:null,offscreen:null}}),$i(yi&&yi.box&&yi.box.length)}else{let Li=l.ap[(Wt=(Bt=this.prevPlacement)===null||Bt===void 0?void 0:Bt.variableOffsets[tt.crossTileID])===null||Wt===void 0?void 0:Wt.anchor];const In=(qt,Pc,mu)=>{const no=qt.x2-qt.x1,so=qt.y2-qt.y1,ml=tt.textBoxScale,Ic=Pe&&Te==="never"?Pc:null;let ro={box:[],offscreen:!1},gu=K==="never"?1:2,Ac="never";Li&&gu++;for(let _u=0;_u<gu;_u++){for(let ka=en;ka<Uo;ka++){const yu=g.textAnchorOffsets.get(ka);if(Li&&yu.textAnchor!==Li)continue;const Sa=this.attemptAnchorPlacement(yu,qt,no,so,ml,ye,Me,D,M,te,Ac,tt,g,mu,Ic,ut);if(Sa&&(ro=Sa.placedGlyphBoxes,ro&&ro.box&&ro.box.length))return zt=!0,Bi=Sa.shift,ro}Li?Li=null:Ac=K}return ro};Ii(()=>In(io,Pt.iconBox,l.ah.horizontal),()=>{const qt=Pt.verticalTextBox;return g.allowVerticalPlacement&&!(yi&&yi.box&&yi.box.length)&&tt.numVerticalGlyphVertices>0&&qt?In(qt,Pt.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),yi&&(zt=yi.box,Vt=yi.offscreen);const Ms=$i(yi&&yi.box);if(!zt&&this.prevPlacement){const qt=this.prevPlacement.variableOffsets[tt.crossTileID];qt&&(this.variableOffsets[tt.crossTileID]=qt,this.markUsedJustification(g,qt.anchor,tt,Ms))}}}if(dn=yi,zt=dn&&dn.box&&dn.box.length>0,Vt=dn&&dn.offscreen,tt.useRuntimeCollisionCircles){const $i=g.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Ii=l.ai(g.textSizeData,Z,$i),en=x.get("text-padding");wi=this.collisionIndex.placeCollisionCircles(K,$i,g.lineVertexArray,g.glyphOffsetArray,Ii,M,P,A,m,Me,te.predicate,tt.collisionCircleDiameter,en,ut),wi.circles.length&&wi.collisionDetected&&!m&&l.w("Collisions detected, but collision boxes are not shown"),zt=fe||wi.circles.length>0&&!wi.collisionDetected,Vt=Vt&&wi.offscreen}if(Pt.iconFeatureIndex&&(to=Pt.iconFeatureIndex),Pt.iconBox){const $i=Ii=>{const en=Pe&&Bi?Yi(Ii,Bi.x,Bi.y,ye,Me,this.transform.angle):Ii;return this.collisionIndex.placeCollisionBox(en,Te,D,M,te.predicate,ut)};os&&os.box&&os.box.length&&Pt.verticalIconBox?(Bn=$i(Pt.verticalIconBox),Ot=Bn.box.length>0):(Bn=$i(Pt.iconBox),Ot=Bn.box.length>0),Vt=Vt&&Bn.offscreen}const dr=ee||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,Ks=se||tt.numIconVertices===0;if(dr||Ks?Ks?dr||(Ot=Ot&&zt):zt=Ot&&zt:Ot=zt=Ot&&zt,zt&&dn&&dn.box&&this.collisionIndex.insertCollisionBox(dn.box,K,x.get("text-ignore-placement"),g.bucketInstanceId,os&&os.box&&ur?ur:Xs,te.ID),Ot&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,Te,x.get("icon-ignore-placement"),g.bucketInstanceId,to,te.ID),wi&&(zt&&this.collisionIndex.insertCollisionCircles(wi.circles,K,x.get("text-ignore-placement"),g.bucketInstanceId,Xs,te.ID),m)){const $i=g.bucketInstanceId;let Ii=this.collisionCircleArrays[$i];Ii===void 0&&(Ii=this.collisionCircleArrays[$i]=new Lt);for(let en=0;en<wi.circles.length;en+=4)Ii.circles.push(wi.circles[en+0]),Ii.circles.push(wi.circles[en+1]),Ii.circles.push(wi.circles[en+2]),Ii.circles.push(wi.collisionDetected?1:0)}if(tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new fi(zt||$e,Ot||He,Vt||g.justReloaded),d[tt.crossTileID]=!0};if(ze){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=g.getSortedSymbolIndexes(this.transform.angle);for(let Pt=tt.length-1;Pt>=0;--Pt){const Bt=tt[Pt];Rt(g.symbolInstances.get(Bt),g.collisionArrays[Bt])}}else for(let tt=r.symbolInstanceStart;tt<r.symbolInstanceEnd;tt++)Rt(g.symbolInstances.get(tt),g.collisionArrays[tt]);if(m&&g.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[g.bucketInstanceId];l.ar(tt.invProjMatrix,M),tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(r,d,m,g){let x;x=g===l.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.as(d)];const M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const P of M)P>=0&&(r.text.placedSymbolArray.get(P).crossTileID=x>=0&&P!==x?0:m.crossTileID)}markUsedOrientation(r,d,m){const g=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,x=d===l.ah.vertical?d:0,M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const P of M)r.text.placedSymbolArray.get(P).placedOrientation=g;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(r):1,x=d?d.opacities:{},M=d?d.variableOffsets:{},P=d?d.placedOrientations:{};for(const A in this.placements){const D=this.placements[A],B=x[A];B?(this.opacities[A]=new ni(B,g,D.text,D.icon),m=m||D.text!==B.text.placed||D.icon!==B.icon.placed):(this.opacities[A]=new ni(null,g,D.text,D.icon,D.skipFade),m=m||D.text||D.icon)}for(const A in x){const D=x[A];if(!this.opacities[A]){const B=new ni(D,g,!1,!1);B.isHidden()||(this.opacities[A]=B,m=m||D.text.placed||D.icon.placed)}}for(const A in M)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=M[A]);for(const A in P)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=P[A]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:r)}updateLayerOpacities(r,d){const m={};for(const g of d){const x=g.getBucket(r);x&&g.latestFeatureIndex&&r.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,g.collisionBoxArray)}}updateBucketOpacities(r,d,m){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const g=r.layers[0],x=g.layout,M=new ni(null,0,!1,!1,!0),P=x.get("text-allow-overlap"),A=x.get("icon-allow-overlap"),D=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=x.get("text-rotation-alignment")==="map",O=x.get("text-pitch-alignment")==="map",Z=x.get("icon-text-fit")!=="none",te=new ni(null,0,P&&(A||!r.hasIconData()||x.get("icon-optional")),A&&(P||!r.hasTextData()||x.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const ee=(se,K,fe)=>{for(let Te=0;Te<K/4;Te++)se.opacityVertexArray.emplaceBack(fe);se.hasVisibleVertices=se.hasVisibleVertices||fe!==Fn};for(let se=0;se<r.symbolInstances.length;se++){const K=r.symbolInstances.get(se),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:Te,crossTileID:oe}=K;let ye=this.opacities[oe];d[oe]?ye=M:ye||(ye=te,this.opacities[oe]=ye),d[oe]=!0;const Me=K.numIconVertices>0,Pe=this.placedOrientations[K.crossTileID],ze=Pe===l.ah.vertical,$e=Pe===l.ah.horizontal||Pe===l.ah.horizontalOnly;if(fe>0||Te>0){const He=zh(ye.text);ee(r.text,fe,ze?Fn:He),ee(r.text,Te,$e?Fn:He);const Ze=ye.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(tt=>{tt>=0&&(r.text.placedSymbolArray.get(tt).hidden=Ze||ze?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=Ze||$e?1:0);const ut=this.variableOffsets[K.crossTileID];ut&&this.markUsedJustification(r,ut.anchor,K,Pe);const Rt=this.placedOrientations[K.crossTileID];Rt&&(this.markUsedJustification(r,"left",K,Rt),this.markUsedOrientation(r,Rt,K))}if(Me){const He=zh(ye.icon),Ze=!(Z&&K.verticalPlacedIconSymbolIndex&&ze);K.placedIconSymbolIndex>=0&&(ee(r.icon,K.numIconVertices,Ze?He:Fn),r.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=ye.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(ee(r.icon,K.numVerticalIconVertices,Ze?Fn:He),r.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const He=r.collisionArrays[se];if(He){let Ze=new l.P(0,0);if(He.textBox||He.verticalTextBox){let Rt=!0;if(D){const tt=this.variableOffsets[oe];tt?(Ze=hn(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),B&&Ze._rotate(O?this.transform.angle:-this.transform.angle)):Rt=!1}He.textBox&&Dn(r.textCollisionBox.collisionVertexArray,ye.text.placed,!Rt||ze,Ze.x,Ze.y),He.verticalTextBox&&Dn(r.textCollisionBox.collisionVertexArray,ye.text.placed,!Rt||$e,Ze.x,Ze.y)}const ut=!!(!$e&&He.verticalIconBox);He.iconBox&&Dn(r.iconCollisionBox.collisionVertexArray,ye.icon.placed,ut,Z?Ze.x:0,Z?Ze.y:0),He.verticalIconBox&&Dn(r.iconCollisionBox.collisionVertexArray,ye.icon.placed,!ut,Z?Ze.x:0,Z?Ze.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=se.invProjMatrix,r.placementViewportMatrix=se.viewportMatrix,r.collisionCircleArray=se.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function Dn(b,r,d,m,g){b.emplaceBack(r?1:0,d?1:0,m||0,g||0),b.emplaceBack(r?1:0,d?1:0,m||0,g||0),b.emplaceBack(r?1:0,d?1:0,m||0,g||0),b.emplaceBack(r?1:0,d?1:0,m||0,g||0)}const sa=Math.pow(2,25),ra=Math.pow(2,24),ei=Math.pow(2,17),ws=Math.pow(2,16),Hr=Math.pow(2,9),ks=Math.pow(2,8),Ss=Math.pow(2,1);function zh(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const r=b.placed?1:0,d=Math.floor(127*b.opacity);return d*sa+r*ra+d*ei+r*ws+d*Hr+r*ks+d*Ss+r}const Fn=0;class Rs{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,d,m,g,x){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(d.getBucketParts(M,g,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((P,A)=>P.sortKey-A.sortKey));this._currentPartIndex<M.length;)if(d.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,x())return!0;return!1}}class Dh{constructor(r,d,m,g,x,M,P,A){this.placement=new Wi(r,d,M,P,A),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,d,m){const g=C.now(),x=()=>!this._forceFullPlacement&&C.now()-g>2;for(;this._currentPlacementIndex>=0;){const M=d[r[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=P)&&(!M.maxzoom||M.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Rs(M)),this._inProgressLayer.continuePlacement(m[M.source],this.placement,this._showCollisionBoxes,M,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Er=512/l.W/2;class un{constructor(r,d,m){this.tileID=r,this.bucketInstanceId=m,this._symbolsByKey={};const g=new Map;for(let x=0;x<d.length;x++){const M=d.get(x),P=M.key,A=g.get(P);A?A.push(M):g.set(P,[M])}for(const[x,M]of g){const P={positions:M.map(A=>({x:Math.floor(A.anchorX*Er),y:Math.floor(A.anchorY*Er)})),crossTileIDs:M.map(A=>A.crossTileID)};if(P.positions.length>128){const A=new l.au(P.positions.length,16,Uint16Array);for(const{x:D,y:B}of P.positions)A.add(D,B);A.finish(),delete P.positions,P.index=A}this._symbolsByKey[x]=P}}getScaledCoordinates(r,d){const{x:m,y:g,z:x}=this.tileID.canonical,{x:M,y:P,z:A}=d.canonical,D=Er/Math.pow(2,A-x),B=(P*l.W+r.anchorY)*D,O=g*l.W*Er;return{x:Math.floor((M*l.W+r.anchorX)*D-m*l.W*Er),y:Math.floor(B-O)}}findMatches(r,d,m){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let x=0;x<r.length;x++){const M=r.get(x);if(M.crossTileID)continue;const P=this._symbolsByKey[M.key];if(!P)continue;const A=this.getScaledCoordinates(M,d);if(P.index){const D=P.index.range(A.x-g,A.y-g,A.x+g,A.y+g).sort();for(const B of D){const O=P.crossTileIDs[B];if(!m[O]){m[O]=!0,M.crossTileID=O;break}}}else if(P.positions)for(let D=0;D<P.positions.length;D++){const B=P.positions[D],O=P.crossTileIDs[D];if(Math.abs(B.x-A.x)<=g&&Math.abs(B.y-A.y)<=g&&!m[O]){m[O]=!0,M.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class oa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const d=Math.round((r-this.lng)/360);if(d!==0)for(const m in this.indexes){const g=this.indexes[m],x={};for(const M in g){const P=g[M];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),x[P.tileID.key]=P}this.indexes[m]=x}this.lng=r}addBucket(r,d,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<d.symbolInstances.length;x++)d.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const g=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const M=this.indexes[x];if(Number(x)>r.overscaledZ)for(const P in M){const A=M[P];A.tileID.isChildOf(r)&&A.findMatches(d.symbolInstances,r,g)}else{const P=M[r.scaledTo(Number(x)).key];P&&P.findMatches(d.symbolInstances,r,g)}}for(let x=0;x<d.symbolInstances.length;x++){const M=d.symbolInstances.get(x);M.crossTileID||(M.crossTileID=m.generate(),g[M.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new un(r,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(r,d){for(const m of d.getCrossTileIDsLists())for(const g of m)delete this.usedCrossTileIDs[r][g]}removeStaleBuckets(r){let d=!1;for(const m in this.indexes){const g=this.indexes[m];for(const x in g)r[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,g[x]),delete g[x],d=!0)}return d}}class Ji{constructor(){this.layerIndexes={},this.crossTileIDs=new oa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,d,m){let g=this.layerIndexes[r.id];g===void 0&&(g=this.layerIndexes[r.id]=new Wr);let x=!1;const M={};g.handleWrapJump(m);for(const P of d){const A=P.getBucket(r);A&&r.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(P.tileID,A,this.crossTileIDs)&&(x=!0),M[A.bucketInstanceId]=!0)}return g.removeStaleBuckets(M)&&(x=!0),x}pruneUnusedLayers(r){const d={};r.forEach(m=>{d[m]=!0});for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}const Zr=(b,r)=>l.t(b,r&&r.filter(d=>d.identifier!=="source.canvas")),Zs=l.av();class ja extends l.E{constructor(r,d={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const g=this.sourceCaches[m].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[m].reload()}},this.map=r,this.dispatcher=new sn(nt(),r._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(m,g)=>this.getGlyphs(m,g)),this.dispatcher.registerMessageHandler("getImages",(m,g)=>this.getImages(m,g)),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new Qt(r._requestManager,d.localIdeographFontFamily),this.lineAtlas=new ii(256,512),this.crossTileSymbolIndex=new Ji,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.ax()),yn().on(Ls,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.sourceCaches[m.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const M in this._layers){const P=this._layers[M];P.source===x.id&&this._validateLayer(P)}})}loadURL(r,d={},m){this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(r,ae.Style);this._loadStyleRequest=new AbortController,l.h(g,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,d,m)}).catch(x=>{this._loadStyleRequest=null,x&&this.fire(new l.j(x))})}loadJSON(r,d={},m){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(r,d,m)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Zs,{validate:!1})}_load(r,d,m){var g;const x=d.transformStyle?d.transformStyle(m,r):r;if(!d.validate||!Zr(this,l.x(x))){this._loaded=!0,this.stylesheet=x;for(const M in x.sources)this.addSource(M,x.sources[M],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new di(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const r=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",r),this._order=r.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of r){const m=l.az(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(r,d=!1,m=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(x,M,P,A){return l._(this,void 0,void 0,function*(){const D=Ve(x),B=P>1?"@2x":"",O={},Z={};for(const{id:te,url:ee}of D){const se=M.transformRequest(M.normalizeSpriteURL(ee,B,".json"),ae.SpriteJSON);O[te]=l.h(se,A);const K=M.transformRequest(M.normalizeSpriteURL(ee,B,".png"),ae.SpriteImage);Z[te]=W.getImage(K,A)}return yield Promise.all([...Object.values(O),...Object.values(Z)]),function(te,ee){return l._(this,void 0,void 0,function*(){const se={};for(const K in te){se[K]={};const fe=C.getImageCanvasContext((yield ee[K]).data),Te=(yield te[K]).data;for(const oe in Te){const{width:ye,height:Me,x:Pe,y:ze,sdf:$e,pixelRatio:He,stretchX:Ze,stretchY:ut,content:Rt}=Te[oe];se[K][oe]={data:null,pixelRatio:He,sdf:$e,stretchX:Ze,stretchY:ut,content:Rt,spriteData:{width:ye,height:Me,x:Pe,y:ze,context:fe}}}}return se})}(O,Z)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(x=>{if(this._spriteRequest=null,x)for(const M in x){this._spritesImagesIds[M]=[];const P=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(A=>!(A in x)):[];for(const A of P)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in x[M]){const D=M==="default"?A:`${M}:${A}`;this._spritesImagesIds[M].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,x[M][A],!1):this.imageManager.addImage(D,x[M][A]),d&&(this._changedImages[D]=!0)}}}).catch(x=>{this._spriteRequest=null,g=x,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),m&&m(g)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(r){const d=this.sourceCaches[r.source];if(!d)return;const m=r.sourceLayer;if(!m)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(m)===-1)&&this.fire(new l.j(new Error(`Source layer "${m}" does not exist on source "${g.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const d=this._serializedAllLayers();if(!r||r.length===0)return Object.values(d);const m=[];for(const g of r)d[g]&&m.push(d[g]);return m}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const g=this._layers[m];g.type!=="custom"&&(r[m]=g.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const d=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(g.length||x.length)&&this._updateWorkerLayers(g,x);for(const M in this._updatedSources){const P=this._updatedSources[M];if(P==="reload")this._reloadSource(M);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const m={};for(const g in this.sourceCaches){const x=this.sourceCaches[g];m[g]=x.used,x.used=!1}for(const g of this._order){const x=this._layers[g];x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const g in m){const x=this.sourceCaches[g];m[g]!==x.used&&x.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(r),this.z=r.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(r),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,d={}){var m;this._checkLoaded();const g=this.serialize();if(r=d.transformStyle?d.transformStyle(g,r):r,((m=d.validate)===null||m===void 0||m)&&Zr(this,l.x(r)))return!1;(r=l.aA(r)).layers=l.ay(r.layers);const x=l.aB(g,r),M=this._getOperationsToPerform(x);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const P of M.operations)P();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const d=[],m=[];for(const g of r)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":d.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":d.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":d.push(()=>{});break;default:m.push(g.command)}return{operations:d,unimplemented:m}}addImage(r,d){if(this.getImage(r))return this.fire(new l.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,d),this._afterImageUpdated(r)}updateImage(r,d){this.imageManager.updateImage(r,d)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new l.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,d,m={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.x.source,`sources.${r}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[r]=new Ke(r,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:r})),g.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===r)return this.fire(new l.j(new Error(`Source "${r}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,d){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const m=this.sourceCaches[r].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,d,m={}){this._checkLoaded();const g=r.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let x;if(r.type==="custom"){if(Zr(this,l.aC(r)))return;x=l.az(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(g,r.source),r=l.aA(r),r=l.e(r,{source:g})),this._validate(l.x.layer,`layers.${g}`,r,{arrayIndex:-1},m))return;x=l.az(r),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}})}const M=d?this._order.indexOf(d):this._order.length;if(d&&M===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(M,0,g),this._layerOrderChanged=!0,this._layers[g]=x,this._removedLayers[g]&&x.source&&x.type!=="custom"){const P=this._removedLayers[g];delete this._removedLayers[g],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(r,d){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new l.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===d)return;const m=this._order.indexOf(r);this._order.splice(m,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${r}" before non-existing layer "${d}".`))):(this._order.splice(g,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const d=this._layers[r];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${r}".`)));d.setEventedParent(null);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=d,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],d.onRemove&&d.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,d,m){this._checkLoaded();const g=this.getLayer(r);g?g.minzoom===d&&g.maxzoom===m||(d!=null&&(g.minzoom=d),m!=null&&(g.maxzoom=m),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,d,m={}){this._checkLoaded();const g=this.getLayer(r);if(g){if(!l.aD(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.x.filter,`layers.${g.id}.filter`,d,null,m)||(g.filter=l.aA(d),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return l.aA(this.getLayer(r).filter)}setLayoutProperty(r,d,m,g={}){this._checkLoaded();const x=this.getLayer(r);x?l.aD(x.getLayoutProperty(d),m)||(x.setLayoutProperty(d,m,g),this._updateLayer(x)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,d){const m=this.getLayer(r);if(m)return m.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,d,m,g={}){this._checkLoaded();const x=this.getLayer(r);x?l.aD(x.getPaintProperty(d),m)||(x.setPaintProperty(d,m,g)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,d){return this.getLayer(r).getPaintProperty(d)}setFeatureState(r,d){this._checkLoaded();const m=r.source,g=r.sourceLayer,x=this.sourceCaches[m];if(x===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const M=x.getSource().type;M==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||g?(r.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),x.setFeatureState(g,r.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,d){this._checkLoaded();const m=r.source,g=this.sourceCaches[m];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const x=g.getSource().type,M=x==="vector"?r.sourceLayer:void 0;x!=="vector"||M?d&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(M,r.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const d=r.source,m=r.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||m?(r.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(m,r.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=l.aE(this.sourceCaches,x=>x.serialize()),d=this._serializeByIds(this._order),m=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:r,layers:d,terrain:m},x=>x!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const d=M=>this._layers[M].type==="fill-extrusion",m={},g=[];for(let M=this._order.length-1;M>=0;M--){const P=this._order[M];if(d(P)){m[P]=M;for(const A of r){const D=A[P];if(D)for(const B of D)g.push(B)}}}g.sort((M,P)=>P.intersectionZ-M.intersectionZ);const x=[];for(let M=this._order.length-1;M>=0;M--){const P=this._order[M];if(d(P))for(let A=g.length-1;A>=0;A--){const D=g[A].feature;if(m[D.layer.id]<M)break;x.push(D),g.pop()}else for(const A of r){const D=A[P];if(D)for(const B of D)x.push(B.feature)}}return x}queryRenderedFeatures(r,d,m){d&&d.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const A=this._layers[P];if(!A)return this.fire(new l.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];g[A.source]=!0}}const x=[];d.availableImages=this._availableImages;const M=this._serializedAllLayers();for(const P in this.sourceCaches)d.layers&&!g[P]||x.push(En(this.sourceCaches[P],this._layers,M,r,d,m));return this.placement&&x.push(function(P,A,D,B,O,Z,te){const ee={},se=Z.queryRenderedSymbols(B),K=[];for(const fe of Object.keys(se).map(Number))K.push(te[fe]);K.sort($n);for(const fe of K){const Te=fe.featureIndex.lookupSymbolFeatures(se[fe.bucketInstanceId],A,fe.bucketIndex,fe.sourceLayerIndex,O.filter,O.layers,O.availableImages,P);for(const oe in Te){const ye=ee[oe]=ee[oe]||[],Me=Te[oe];Me.sort((Pe,ze)=>{const $e=fe.featureSortOrder;if($e){const He=$e.indexOf(Pe.featureIndex);return $e.indexOf(ze.featureIndex)-He}return ze.featureIndex-Pe.featureIndex});for(const Pe of Me)ye.push(Pe)}}for(const fe in ee)ee[fe].forEach(Te=>{const oe=Te.feature,ye=D[P[fe].source].getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ye});return ee}(this._layers,M,this.sourceCaches,r,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(r,d){d&&d.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[r];return m?function(g,x){const M=g.getRenderableIds().map(D=>g.getTileByID(D)),P=[],A={};for(let D=0;D<M.length;D++){const B=M[D],O=B.tileID.canonical.key;A[O]||(A[O]=!0,B.querySourceFeatures(P,x))}return P}(m,d):[]}getLight(){return this.light.getLight()}setLight(r,d={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const M in r)if(!l.aD(r[M],m[M])){g=!0;break}if(!g)return;const x={now:C.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,d),this.light.updateTransitions(x)}_validate(r,d,m,g,x={}){return(!x||x.validate!==!1)&&Zr(this,r.call(l.x,l.e({key:d,style:this.serialize(),value:m,styleSpec:l.v},g)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yn().off(Ls,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const d in this.sourceCaches)this.sourceCaches[d].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,d,m,g,x=!1){let M=!1,P=!1;const A={};for(const D of this._order){const B=this._layers[D];if(B.type!=="symbol")continue;if(!A[B.source]){const Z=this.sourceCaches[B.source];A[B.source]=Z.getRenderableIds(!0).map(te=>Z.getTileByID(te)).sort((te,ee)=>ee.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ee.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(B,A[B.source],r.center.lng);M=M||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(C.now(),r.zoom))&&(this.pauseablePlacement=new Dh(r,this.map.terrain,this._order,x,d,m,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(C.now()),P=!0),M&&this.pauseablePlacement.placement.setStale()),P||M)for(const D of this._order){const B=this._layers[D];B.type==="symbol"&&this.placement.updateLayerOpacities(B,A[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(C.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,d){return l._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,d.icons),m})}getGlyphs(r,d){return l._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(d.stacks),g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,d={}){this._checkLoaded(),r&&this._validate(l.x.glyphs,"glyphs",r,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,d,m={},g){this._checkLoaded();const x=[{id:r,url:d}],M=[...Ve(this.stylesheet.sprite),...x];this._validate(l.x.sprite,"sprite",M,null,m)||(this.stylesheet.sprite=M,this._loadSprite(x,!0,g))}removeSprite(r){this._checkLoaded();const d=Ve(this.stylesheet.sprite);if(d.find(m=>m.id===r)){if(this._spritesImagesIds[r])for(const m of this._spritesImagesIds[r])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex(m=>m.id===r),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Ve(this.stylesheet.sprite)}setSprite(r,d={},m){this._checkLoaded(),r&&this._validate(l.x.sprite,"sprite",r,null,d)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,m):(this._unloadSprite(),m&&m(null)))}}var ar=l.X([{name:"a_pos",type:"Int16",components:2}]),Ul="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const wo={prelude:hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ul),terrainDepth:hi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ul),terrainCoords:hi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ul)};function hi(b,r){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute ([\w]+) ([\w]+)/g),g=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=x?x.concat(g):g,P={};return{fragmentSource:b=b.replace(d,(A,D,B,O,Z)=>(P[Z]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
varying ${B} ${O} ${Z};
#else
uniform ${B} ${O} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${B} ${O} ${Z} = u_${Z};
#endif
`)),vertexSource:r=r.replace(d,(A,D,B,O,Z)=>{const te=O==="float"?"vec2":"vec4",ee=Z.match(/color/)?"color":te;return P[Z]?D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${B} ${te} a_${Z};
varying ${B} ${O} ${Z};
#else
uniform ${B} ${O} u_${Z};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${B} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${ee}(a_${Z}, u_${Z}_t);
#else
    ${B} ${O} ${Z} = u_${Z};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${B} ${te} a_${Z};
#else
uniform ${B} ${O} u_${Z};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${B} ${O} ${Z} = a_${Z};
#else
    ${B} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${B} ${O} ${Z} = unpack_mix_${ee}(a_${Z}, u_${Z}_t);
#else
    ${B} ${O} ${Z} = u_${Z};
#endif
`}),staticAttributes:m,staticUniforms:M}}class qa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,d,m,g,x,M,P,A,D){this.context=r;let B=this.boundPaintVertexBuffers.length!==g.length;for(let O=0;!B&&O<g.length;O++)this.boundPaintVertexBuffers[O]!==g[O]&&(B=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||B||this.boundIndexBuffer!==x||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==D?this.freshBind(d,m,g,x,M,P,A,D):(r.bindVertexArray.set(this.vao),P&&P.bind(),x&&x.dynamicDraw&&x.bind(),A&&A.bind(),D&&D.bind())}freshBind(r,d,m,g,x,M,P,A){const D=r.numAttributes,B=this.context,O=B.gl;this.vao&&this.destroy(),this.vao=B.createVertexArray(),B.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=A,d.enableAttributes(O,r);for(const Z of m)Z.enableAttributes(O,r);M&&M.enableAttributes(O,r),P&&P.enableAttributes(O,r),A&&A.enableAttributes(O,r),d.bind(),d.setVertexAttribPointers(O,r,x);for(const Z of m)Z.bind(),Z.setVertexAttribPointers(O,r,x);M&&(M.bind(),M.setVertexAttribPointers(O,r,x)),g&&g.bind(),P&&(P.bind(),P.setVertexAttribPointers(O,r,x)),A&&(A.bind(),A.setVertexAttribPointers(O,r,x)),B.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function lr(b){const r=[];for(let d=0;d<b.length;d++){if(b[d]===null)continue;const m=b[d].split(" ");r.push(m.pop())}return r}class jl{constructor(r,d,m,g,x,M){const P=r.gl;this.program=P.createProgram();const A=lr(d.staticAttributes),D=m?m.getBinderAttributes():[],B=A.concat(D),O=wo.prelude.staticUniforms?lr(wo.prelude.staticUniforms):[],Z=d.staticUniforms?lr(d.staticUniforms):[],te=m?m.getBinderUniforms():[],ee=O.concat(Z).concat(te),se=[];for(const Pe of ee)se.indexOf(Pe)<0&&se.push(Pe);const K=m?m.defines():[];x&&K.push("#define OVERDRAW_INSPECTOR;"),M&&K.push("#define TERRAIN3D;");const fe=K.concat(wo.prelude.fragmentSource,d.fragmentSource).join(`
`),Te=K.concat(wo.prelude.vertexSource,d.vertexSource).join(`
`),oe=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(oe,fe),P.compileShader(oe),!P.getShaderParameter(oe,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(oe)}`);P.attachShader(this.program,oe);const ye=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(ye,Te),P.compileShader(ye),!P.getShaderParameter(ye,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(ye)}`);P.attachShader(this.program,ye),this.attributes={};const Me={};this.numAttributes=B.length;for(let Pe=0;Pe<this.numAttributes;Pe++)B[Pe]&&(P.bindAttribLocation(this.program,Pe,B[Pe]),this.attributes[B[Pe]]=Pe);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(ye),P.deleteShader(oe);for(let Pe=0;Pe<se.length;Pe++){const ze=se[Pe];if(ze&&!Me[ze]){const $e=P.getUniformLocation(this.program,ze);$e&&(Me[ze]=$e)}}this.fixedUniforms=g(r,Me),this.terrainUniforms=((Pe,ze)=>({u_depth:new l.aG(Pe,ze.u_depth),u_terrain:new l.aG(Pe,ze.u_terrain),u_terrain_dim:new l.aH(Pe,ze.u_terrain_dim),u_terrain_matrix:new l.aI(Pe,ze.u_terrain_matrix),u_terrain_unpack:new l.aJ(Pe,ze.u_terrain_unpack),u_terrain_exaggeration:new l.aH(Pe,ze.u_terrain_exaggeration)}))(r,Me),this.binderUniforms=m?m.getUniforms(r,Me):[]}draw(r,d,m,g,x,M,P,A,D,B,O,Z,te,ee,se,K,fe,Te){const oe=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(g),r.setColorMode(x),r.setCullFace(M),A){r.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,A.depthTexture),r.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,A.texture);for(const Me in this.terrainUniforms)this.terrainUniforms[Me].set(A[Me])}for(const Me in this.fixedUniforms)this.fixedUniforms[Me].set(P[Me]);se&&se.setUniforms(r,this.binderUniforms,te,{zoom:ee});let ye=0;switch(d){case oe.LINES:ye=2;break;case oe.TRIANGLES:ye=3;break;case oe.LINE_STRIP:ye=1}for(const Me of Z.get()){const Pe=Me.vaos||(Me.vaos={});(Pe[D]||(Pe[D]=new qa)).bind(r,this,B,se?se.getPaintVertexBuffers():[],O,Me.vertexOffset,K,fe,Te),oe.drawElements(d,Me.primitiveLength*ye,oe.UNSIGNED_SHORT,Me.primitiveOffset*ye*2)}}}function aa(b,r,d){const m=1/Mt(d,1,r.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),x=d.tileSize*Math.pow(2,r.transform.tileZoom)/g,M=x*(d.tileID.canonical.x+d.tileID.wrap*g),P=x*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[M>>16,P>>16],u_pixel_coord_lower:[65535&M,65535&P]}}const Lh=(b,r,d,m)=>{const g=r.style.light,x=g.properties.get("position"),M=[x.x,x.y,x.z],P=function(){var D=new l.A(9);return l.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();g.properties.get("anchor")==="viewport"&&function(D,B){var O=Math.sin(B),Z=Math.cos(B);D[0]=Z,D[1]=O,D[2]=0,D[3]=-O,D[4]=Z,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(P,-r.transform.angle),function(D,B,O){var Z=B[0],te=B[1],ee=B[2];D[0]=Z*O[0]+te*O[3]+ee*O[6],D[1]=Z*O[1]+te*O[4]+ee*O[7],D[2]=Z*O[2]+te*O[5]+ee*O[8]}(M,M,P);const A=g.properties.get("color");return{u_matrix:b,u_lightpos:M,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+d,u_opacity:m}},Xd=(b,r,d,m,g,x,M)=>l.e(Lh(b,r,d,m),aa(x,r,M),{u_height_factor:-Math.pow(2,g.overscaledZ)/M.tileSize/8}),Ha=b=>({u_matrix:b}),Rh=(b,r,d,m)=>l.e(Ha(b),aa(d,r,m)),Fh=(b,r)=>({u_matrix:b,u_world:r}),Kd=(b,r,d,m,g)=>l.e(Rh(b,r,d,m),{u_world:g}),Bh=(b,r,d,m)=>{const g=b.transform;let x,M;if(m.paint.get("circle-pitch-alignment")==="map"){const P=Mt(d,1,g.zoom);x=!0,M=[P,P]}else x=!1,M=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(r.posMatrix,d,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:M}},Yd=(b,r,d)=>{const m=Mt(d,1,r.zoom),g=Math.pow(2,r.zoom-d.tileID.overscaledZ),x=d.tileID.overscaleFactor();return{u_matrix:b,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[r.pixelsToGLUnits[0]/(m*g),r.pixelsToGLUnits[1]/(m*g)],u_overscale_factor:x}},Wa=(b,r,d=1)=>({u_matrix:b,u_color:r,u_overlay:0,u_overlay_scale:d}),ql=b=>({u_matrix:b}),Oh=(b,r,d,m)=>({u_matrix:b,u_extrude_scale:Mt(r,1,d),u_intensity:m});function Vh(b,r){const d=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new l.Y(0,m/d).toLngLat().lat,new l.Y(0,(m+1)/d).toLngLat().lat]}const Za=(b,r,d,m)=>{const g=b.transform;return{u_matrix:ca(b,r,d,m),u_ratio:1/Mt(r,1,g.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},$r=(b,r,d,m,g)=>l.e(Za(b,r,d,g),{u_image:0,u_image_height:m}),$a=(b,r,d,m,g)=>{const x=b.transform,M=la(r,x);return{u_matrix:ca(b,r,d,g),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Mt(r,1,x.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[M,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Fs=(b,r,d,m,g,x)=>{const M=b.lineAtlas,P=la(r,b.transform),A=d.layout.get("line-cap")==="round",D=M.getDash(m.from,A),B=M.getDash(m.to,A),O=D.width*g.fromScale,Z=B.width*g.toScale;return l.e(Za(b,r,d,x),{u_patternscale_a:[P/O,-D.height/2],u_patternscale_b:[P/Z,-B.height/2],u_sdfgamma:M.width/(256*Math.min(O,Z)*b.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:B.y,u_mix:g.t})};function la(b,r){return 1/Mt(b,1,r.tileZoom)}function ca(b,r,d,m){return b.translatePosMatrix(m?m.posMatrix:r.tileID.posMatrix,r,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const ha=(b,r,d,m,g)=>{return{u_matrix:b,u_tl_parent:r,u_scale_parent:d,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(M=g.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(x=g.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Ga(g.paint.get("raster-hue-rotate"))};var x,M};function Ga(b){b*=Math.PI/180;const r=Math.sin(b),d=Math.cos(b);return[(2*d+1)/3,(-Math.sqrt(3)*r-d+1)/3,(Math.sqrt(3)*r-d+1)/3]}const ua=(b,r,d,m,g,x,M,P,A,D)=>{const B=g.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:B.width/B.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:M,u_coord_matrix:P,u_is_text:+A,u_pitch_with_map:+m,u_texsize:D,u_texture:0}},ko=(b,r,d,m,g,x,M,P,A,D,B)=>{const O=g.transform;return l.e(ua(b,r,d,m,g,x,M,P,A,D),{u_gamma_scale:m?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+B})},Jd=(b,r,d,m,g,x,M,P,A,D)=>l.e(ko(b,r,d,m,g,x,M,P,!0,A,!0),{u_texsize_icon:D,u_texture_icon:1}),Qd=(b,r,d)=>({u_matrix:b,u_opacity:r,u_color:d}),Nh=(b,r,d,m,g,x)=>l.e(function(M,P,A,D){const B=A.imageManager.getPattern(M.from.toString()),O=A.imageManager.getPattern(M.to.toString()),{width:Z,height:te}=A.imageManager.getPixelSize(),ee=Math.pow(2,D.tileID.overscaledZ),se=D.tileSize*Math.pow(2,A.transform.tileZoom)/ee,K=se*(D.tileID.canonical.x+D.tileID.wrap*ee),fe=se*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[Z,te],u_mix:P.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/Mt(D,1,A.transform.tileZoom),u_pixel_coord_upper:[K>>16,fe>>16],u_pixel_coord_lower:[65535&K,65535&fe]}}(m,x,d,g),{u_matrix:b,u_opacity:r}),ef={fillExtrusion:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_lightpos:new l.aK(b,r.u_lightpos),u_lightintensity:new l.aH(b,r.u_lightintensity),u_lightcolor:new l.aK(b,r.u_lightcolor),u_vertical_gradient:new l.aH(b,r.u_vertical_gradient),u_opacity:new l.aH(b,r.u_opacity)}),fillExtrusionPattern:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_lightpos:new l.aK(b,r.u_lightpos),u_lightintensity:new l.aH(b,r.u_lightintensity),u_lightcolor:new l.aK(b,r.u_lightcolor),u_vertical_gradient:new l.aH(b,r.u_vertical_gradient),u_height_factor:new l.aH(b,r.u_height_factor),u_image:new l.aG(b,r.u_image),u_texsize:new l.aL(b,r.u_texsize),u_pixel_coord_upper:new l.aL(b,r.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,r.u_pixel_coord_lower),u_scale:new l.aK(b,r.u_scale),u_fade:new l.aH(b,r.u_fade),u_opacity:new l.aH(b,r.u_opacity)}),fill:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix)}),fillPattern:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_image:new l.aG(b,r.u_image),u_texsize:new l.aL(b,r.u_texsize),u_pixel_coord_upper:new l.aL(b,r.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,r.u_pixel_coord_lower),u_scale:new l.aK(b,r.u_scale),u_fade:new l.aH(b,r.u_fade)}),fillOutline:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_world:new l.aL(b,r.u_world)}),fillOutlinePattern:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_world:new l.aL(b,r.u_world),u_image:new l.aG(b,r.u_image),u_texsize:new l.aL(b,r.u_texsize),u_pixel_coord_upper:new l.aL(b,r.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,r.u_pixel_coord_lower),u_scale:new l.aK(b,r.u_scale),u_fade:new l.aH(b,r.u_fade)}),circle:(b,r)=>({u_camera_to_center_distance:new l.aH(b,r.u_camera_to_center_distance),u_scale_with_map:new l.aG(b,r.u_scale_with_map),u_pitch_with_map:new l.aG(b,r.u_pitch_with_map),u_extrude_scale:new l.aL(b,r.u_extrude_scale),u_device_pixel_ratio:new l.aH(b,r.u_device_pixel_ratio),u_matrix:new l.aI(b,r.u_matrix)}),collisionBox:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_camera_to_center_distance:new l.aH(b,r.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(b,r.u_pixels_to_tile_units),u_extrude_scale:new l.aL(b,r.u_extrude_scale),u_overscale_factor:new l.aH(b,r.u_overscale_factor)}),collisionCircle:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_inv_matrix:new l.aI(b,r.u_inv_matrix),u_camera_to_center_distance:new l.aH(b,r.u_camera_to_center_distance),u_viewport_size:new l.aL(b,r.u_viewport_size)}),debug:(b,r)=>({u_color:new l.aM(b,r.u_color),u_matrix:new l.aI(b,r.u_matrix),u_overlay:new l.aG(b,r.u_overlay),u_overlay_scale:new l.aH(b,r.u_overlay_scale)}),clippingMask:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix)}),heatmap:(b,r)=>({u_extrude_scale:new l.aH(b,r.u_extrude_scale),u_intensity:new l.aH(b,r.u_intensity),u_matrix:new l.aI(b,r.u_matrix)}),heatmapTexture:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_world:new l.aL(b,r.u_world),u_image:new l.aG(b,r.u_image),u_color_ramp:new l.aG(b,r.u_color_ramp),u_opacity:new l.aH(b,r.u_opacity)}),hillshade:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_image:new l.aG(b,r.u_image),u_latrange:new l.aL(b,r.u_latrange),u_light:new l.aL(b,r.u_light),u_shadow:new l.aM(b,r.u_shadow),u_highlight:new l.aM(b,r.u_highlight),u_accent:new l.aM(b,r.u_accent)}),hillshadePrepare:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_image:new l.aG(b,r.u_image),u_dimension:new l.aL(b,r.u_dimension),u_zoom:new l.aH(b,r.u_zoom),u_unpack:new l.aJ(b,r.u_unpack)}),line:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_ratio:new l.aH(b,r.u_ratio),u_device_pixel_ratio:new l.aH(b,r.u_device_pixel_ratio),u_units_to_pixels:new l.aL(b,r.u_units_to_pixels)}),lineGradient:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_ratio:new l.aH(b,r.u_ratio),u_device_pixel_ratio:new l.aH(b,r.u_device_pixel_ratio),u_units_to_pixels:new l.aL(b,r.u_units_to_pixels),u_image:new l.aG(b,r.u_image),u_image_height:new l.aH(b,r.u_image_height)}),linePattern:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_texsize:new l.aL(b,r.u_texsize),u_ratio:new l.aH(b,r.u_ratio),u_device_pixel_ratio:new l.aH(b,r.u_device_pixel_ratio),u_image:new l.aG(b,r.u_image),u_units_to_pixels:new l.aL(b,r.u_units_to_pixels),u_scale:new l.aK(b,r.u_scale),u_fade:new l.aH(b,r.u_fade)}),lineSDF:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_ratio:new l.aH(b,r.u_ratio),u_device_pixel_ratio:new l.aH(b,r.u_device_pixel_ratio),u_units_to_pixels:new l.aL(b,r.u_units_to_pixels),u_patternscale_a:new l.aL(b,r.u_patternscale_a),u_patternscale_b:new l.aL(b,r.u_patternscale_b),u_sdfgamma:new l.aH(b,r.u_sdfgamma),u_image:new l.aG(b,r.u_image),u_tex_y_a:new l.aH(b,r.u_tex_y_a),u_tex_y_b:new l.aH(b,r.u_tex_y_b),u_mix:new l.aH(b,r.u_mix)}),raster:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_tl_parent:new l.aL(b,r.u_tl_parent),u_scale_parent:new l.aH(b,r.u_scale_parent),u_buffer_scale:new l.aH(b,r.u_buffer_scale),u_fade_t:new l.aH(b,r.u_fade_t),u_opacity:new l.aH(b,r.u_opacity),u_image0:new l.aG(b,r.u_image0),u_image1:new l.aG(b,r.u_image1),u_brightness_low:new l.aH(b,r.u_brightness_low),u_brightness_high:new l.aH(b,r.u_brightness_high),u_saturation_factor:new l.aH(b,r.u_saturation_factor),u_contrast_factor:new l.aH(b,r.u_contrast_factor),u_spin_weights:new l.aK(b,r.u_spin_weights)}),symbolIcon:(b,r)=>({u_is_size_zoom_constant:new l.aG(b,r.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(b,r.u_is_size_feature_constant),u_size_t:new l.aH(b,r.u_size_t),u_size:new l.aH(b,r.u_size),u_camera_to_center_distance:new l.aH(b,r.u_camera_to_center_distance),u_pitch:new l.aH(b,r.u_pitch),u_rotate_symbol:new l.aG(b,r.u_rotate_symbol),u_aspect_ratio:new l.aH(b,r.u_aspect_ratio),u_fade_change:new l.aH(b,r.u_fade_change),u_matrix:new l.aI(b,r.u_matrix),u_label_plane_matrix:new l.aI(b,r.u_label_plane_matrix),u_coord_matrix:new l.aI(b,r.u_coord_matrix),u_is_text:new l.aG(b,r.u_is_text),u_pitch_with_map:new l.aG(b,r.u_pitch_with_map),u_texsize:new l.aL(b,r.u_texsize),u_texture:new l.aG(b,r.u_texture)}),symbolSDF:(b,r)=>({u_is_size_zoom_constant:new l.aG(b,r.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(b,r.u_is_size_feature_constant),u_size_t:new l.aH(b,r.u_size_t),u_size:new l.aH(b,r.u_size),u_camera_to_center_distance:new l.aH(b,r.u_camera_to_center_distance),u_pitch:new l.aH(b,r.u_pitch),u_rotate_symbol:new l.aG(b,r.u_rotate_symbol),u_aspect_ratio:new l.aH(b,r.u_aspect_ratio),u_fade_change:new l.aH(b,r.u_fade_change),u_matrix:new l.aI(b,r.u_matrix),u_label_plane_matrix:new l.aI(b,r.u_label_plane_matrix),u_coord_matrix:new l.aI(b,r.u_coord_matrix),u_is_text:new l.aG(b,r.u_is_text),u_pitch_with_map:new l.aG(b,r.u_pitch_with_map),u_texsize:new l.aL(b,r.u_texsize),u_texture:new l.aG(b,r.u_texture),u_gamma_scale:new l.aH(b,r.u_gamma_scale),u_device_pixel_ratio:new l.aH(b,r.u_device_pixel_ratio),u_is_halo:new l.aG(b,r.u_is_halo)}),symbolTextAndIcon:(b,r)=>({u_is_size_zoom_constant:new l.aG(b,r.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(b,r.u_is_size_feature_constant),u_size_t:new l.aH(b,r.u_size_t),u_size:new l.aH(b,r.u_size),u_camera_to_center_distance:new l.aH(b,r.u_camera_to_center_distance),u_pitch:new l.aH(b,r.u_pitch),u_rotate_symbol:new l.aG(b,r.u_rotate_symbol),u_aspect_ratio:new l.aH(b,r.u_aspect_ratio),u_fade_change:new l.aH(b,r.u_fade_change),u_matrix:new l.aI(b,r.u_matrix),u_label_plane_matrix:new l.aI(b,r.u_label_plane_matrix),u_coord_matrix:new l.aI(b,r.u_coord_matrix),u_is_text:new l.aG(b,r.u_is_text),u_pitch_with_map:new l.aG(b,r.u_pitch_with_map),u_texsize:new l.aL(b,r.u_texsize),u_texsize_icon:new l.aL(b,r.u_texsize_icon),u_texture:new l.aG(b,r.u_texture),u_texture_icon:new l.aG(b,r.u_texture_icon),u_gamma_scale:new l.aH(b,r.u_gamma_scale),u_device_pixel_ratio:new l.aH(b,r.u_device_pixel_ratio),u_is_halo:new l.aG(b,r.u_is_halo)}),background:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_opacity:new l.aH(b,r.u_opacity),u_color:new l.aM(b,r.u_color)}),backgroundPattern:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_opacity:new l.aH(b,r.u_opacity),u_image:new l.aG(b,r.u_image),u_pattern_tl_a:new l.aL(b,r.u_pattern_tl_a),u_pattern_br_a:new l.aL(b,r.u_pattern_br_a),u_pattern_tl_b:new l.aL(b,r.u_pattern_tl_b),u_pattern_br_b:new l.aL(b,r.u_pattern_br_b),u_texsize:new l.aL(b,r.u_texsize),u_mix:new l.aH(b,r.u_mix),u_pattern_size_a:new l.aL(b,r.u_pattern_size_a),u_pattern_size_b:new l.aL(b,r.u_pattern_size_b),u_scale_a:new l.aH(b,r.u_scale_a),u_scale_b:new l.aH(b,r.u_scale_b),u_pixel_coord_upper:new l.aL(b,r.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,r.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(b,r.u_tile_units_to_pixels)}),terrain:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_texture:new l.aG(b,r.u_texture),u_ele_delta:new l.aH(b,r.u_ele_delta)}),terrainDepth:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_ele_delta:new l.aH(b,r.u_ele_delta)}),terrainCoords:(b,r)=>({u_matrix:new l.aI(b,r.u_matrix),u_texture:new l.aG(b,r.u_texture),u_terrain_coords_id:new l.aH(b,r.u_terrain_coords_id),u_ele_delta:new l.aH(b,r.u_ele_delta)})};class Gr{constructor(r,d,m){this.context=r;const g=r.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cs{constructor(r,d,m,g){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),r.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,d){for(let m=0;m<this.attributes.length;m++){const g=d.attributes[this.attributes[m].name];g!==void 0&&r.enableVertexAttribArray(g)}}setVertexAttribPointers(r,d,m){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],M=d.attributes[x.name];M!==void 0&&r.vertexAttribPointer(M,x.components,r[Xa[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xn=new WeakMap;function So(b){var r;if(Xn.has(b))return Xn.get(b);{const d=(r=b.getParameter(b.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return Xn.set(b,d),d}}class ti{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ka extends ti{getDefault(){return l.aO.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Hl extends ti{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Wl extends ti{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Ya extends ti{getDefault(){return[!0,!0,!0,!0]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Zl extends ti{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class $l extends ti{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Ja extends ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const d=this.current;(r.func!==d.func||r.ref!==d.ref||r.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Uh extends ti{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class jh extends ti{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=r,this.dirty=!1}}class Co extends ti{getDefault(){return[0,1]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class tf extends ti{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=r,this.dirty=!1}}class nf extends ti{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class sf extends ti{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.BLEND):d.disable(d.BLEND),this.current=r,this.dirty=!1}}class rf extends ti{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class of extends ti{getDefault(){return l.aO.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class af extends ti{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Gl extends ti{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=r,this.dirty=!1}}class Qa extends ti{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Xl extends ti{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Kl extends ti{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class To extends ti{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class qh extends ti{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Hh extends ti{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Yl extends ti{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Xr extends ti{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Wh extends ti{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Mo extends ti{getDefault(){return null}set(r){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Po extends ti{getDefault(){return null}set(r){var d;if(r===this.current&&!this.dirty)return;const m=this.gl;So(m)?m.bindVertexArray(r):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Zh extends ti{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Jl extends ti{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class si extends ti{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Io extends ti{constructor(r,d){super(r),this.context=r,this.parent=d}getDefault(){return null}}class lf extends Io{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class $h extends Io{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class da extends Io{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class cf{constructor(r,d,m,g,x){this.context=r,this.width=d,this.height=m;const M=r.gl,P=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new lf(r,P),g)this.depthAttachment=x?new da(r,P):new $h(r,P);else if(x)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,d=this.colorAttachment.get();if(d&&r.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class rn{constructor(r,d,m){this.blendFunction=r,this.blendColor=d,this.mask=m}}rn.Replace=[1,0],rn.disabled=new rn(rn.Replace,l.aO.transparent,[!1,!1,!1,!1]),rn.unblended=new rn(rn.Replace,l.aO.transparent,[!0,!0,!0,!0]),rn.alphaBlended=new rn([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Gh{constructor(r){var d,m;if(this.gl=r,this.clearColor=new Ka(this),this.clearDepth=new Hl(this),this.clearStencil=new Wl(this),this.colorMask=new Ya(this),this.depthMask=new Zl(this),this.stencilMask=new $l(this),this.stencilFunc=new Ja(this),this.stencilOp=new Uh(this),this.stencilTest=new jh(this),this.depthRange=new Co(this),this.depthTest=new tf(this),this.depthFunc=new nf(this),this.blend=new sf(this),this.blendFunc=new rf(this),this.blendColor=new of(this),this.blendEquation=new af(this),this.cullFace=new Gl(this),this.cullFaceSide=new Qa(this),this.frontFace=new Xl(this),this.program=new Kl(this),this.activeTexture=new To(this),this.viewport=new qh(this),this.bindFramebuffer=new Hh(this),this.bindRenderbuffer=new Yl(this),this.bindTexture=new Xr(this),this.bindVertexBuffer=new Wh(this),this.bindElementBuffer=new Mo(this),this.bindVertexArray=new Po(this),this.pixelStoreUnpack=new Zh(this),this.pixelStoreUnpackPremultiplyAlpha=new Jl(this),this.pixelStoreUnpackFlipY=new si(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),So(r)){this.HALF_FLOAT=r.HALF_FLOAT;const g=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=r.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(m=r.RGB16F)!==null&&m!==void 0?m:g==null?void 0:g.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const g=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,d){return new Gr(this,r,d)}createVertexBuffer(r,d,m){return new Cs(this,r,d,m)}createRenderbuffer(r,d,m){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,r,d,m),this.bindRenderbuffer.set(null),x}createFramebuffer(r,d,m,g){return new cf(this,r,d,m,g)}clear({color:r,depth:d,stencil:m}){const g=this.gl;let x=0;r&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),m!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),g.clear(x)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){l.aD(r.blendFunction,rn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return So(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var d;return So(this.gl)?this.gl.deleteVertexArray(r):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class Jt{constructor(r,d,m){this.func=r,this.mask=d,this.range=m}}Jt.ReadOnly=!1,Jt.ReadWrite=!0,Jt.disabled=new Jt(519,Jt.ReadOnly,[0,1]);const fa=7680;class vi{constructor(r,d,m,g,x,M){this.test=r,this.ref=d,this.mask=m,this.fail=g,this.depthFail=x,this.pass=M}}vi.disabled=new vi({func:519,mask:0},0,0,fa,fa,fa);class _i{constructor(r,d,m){this.enable=r,this.mode=d,this.frontFace=m}}let Ao;function el(b,r,d,m,g,x,M){const P=b.context,A=P.gl,D=b.useProgram("collisionBox"),B=[];let O=0,Z=0;for(let oe=0;oe<m.length;oe++){const ye=m[oe],Me=r.getTile(ye),Pe=Me.getBucket(d);if(!Pe)continue;let ze=ye.posMatrix;g[0]===0&&g[1]===0||(ze=b.translatePosMatrix(ye.posMatrix,Me,g,x));const $e=M?Pe.textCollisionBox:Pe.iconCollisionBox,He=Pe.collisionCircleArray;if(He.length>0){const Ze=l.F(),ut=ze;l.aP(Ze,Pe.placementInvProjMatrix,b.transform.glCoordMatrix),l.aP(Ze,Ze,Pe.placementViewportMatrix),B.push({circleArray:He,circleOffset:Z,transform:ut,invTransform:Ze,coord:ye}),O+=He.length/4,Z=O}$e&&D.draw(P,A.LINES,Jt.disabled,vi.disabled,b.colorModeForRenderPass(),_i.disabled,Yd(ze,b.transform,Me),b.style.map.terrain&&b.style.map.terrain.getTerrainData(ye),d.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,b.transform.zoom,null,null,$e.collisionVertexBuffer)}if(!M||!B.length)return;const te=b.useProgram("collisionCircle"),ee=new l.aQ;ee.resize(4*O),ee._trim();let se=0;for(const oe of B)for(let ye=0;ye<oe.circleArray.length/4;ye++){const Me=4*ye,Pe=oe.circleArray[Me+0],ze=oe.circleArray[Me+1],$e=oe.circleArray[Me+2],He=oe.circleArray[Me+3];ee.emplace(se++,Pe,ze,$e,He,0),ee.emplace(se++,Pe,ze,$e,He,1),ee.emplace(se++,Pe,ze,$e,He,2),ee.emplace(se++,Pe,ze,$e,He,3)}(!Ao||Ao.length<2*O)&&(Ao=function(oe){const ye=2*oe,Me=new l.aS;Me.resize(ye),Me._trim();for(let Pe=0;Pe<ye;Pe++){const ze=6*Pe;Me.uint16[ze+0]=4*Pe+0,Me.uint16[ze+1]=4*Pe+1,Me.uint16[ze+2]=4*Pe+2,Me.uint16[ze+3]=4*Pe+2,Me.uint16[ze+4]=4*Pe+3,Me.uint16[ze+5]=4*Pe+0}return Me}(O));const K=P.createIndexBuffer(Ao,!0),fe=P.createVertexBuffer(ee,l.aR.members,!0);for(const oe of B){const ye={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(Te=b.transform).cameraToCenterDistance,u_viewport_size:[Te.width,Te.height]};te.draw(P,A.TRIANGLES,Jt.disabled,vi.disabled,b.colorModeForRenderPass(),_i.disabled,ye,b.style.map.terrain&&b.style.map.terrain.getTerrainData(oe.coord),d.id,fe,K,l.$.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,b.transform.zoom,null,null,null)}var Te;fe.destroy(),K.destroy()}_i.disabled=new _i(!1,1029,2305),_i.backCCW=new _i(!0,1029,2305);const Xh=l.an(new Float32Array(16));function tl(b,r,d,m,g,x){const{horizontalAlign:M,verticalAlign:P}=l.at(b);return new l.P((-(M-.5)*r/g+m[0])*x,(-(P-.5)*d/g+m[1])*x)}function il(b,r,d,m,g,x,M,P,A,D,B){const O=b.text.placedSymbolArray,Z=b.text.dynamicLayoutVertexArray,te=b.icon.dynamicLayoutVertexArray,ee={};Z.clear();for(let se=0;se<O.length;se++){const K=O.get(se),fe=K.hidden||!K.crossTileID||b.allowVerticalPlacement&&!K.placedOrientation?null:m[K.crossTileID];if(fe){const Te=new l.P(K.anchorX,K.anchorY),oe=Q(Te,d?M:x,B),ye=V(g.cameraToCenterDistance,oe.signedDistanceFromCamera);let Me=l.ai(b.textSizeData,A,K)*ye/l.ao;d&&(Me*=b.tilePixelRatio/P);const{width:Pe,height:ze,anchor:$e,textOffset:He,textBoxScale:Ze}=fe,ut=tl($e,Pe,ze,He,Ze,Me),Rt=d?Q(Te.add(ut),x,B).point:oe.point.add(r?ut.rotate(-g.angle):ut),tt=b.allowVerticalPlacement&&K.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Pt=0;Pt<K.numGlyphs;Pt++)l.aj(Z,Rt,tt);D&&K.associatedIconIndex>=0&&(ee[K.associatedIconIndex]={shiftedAnchor:Rt,angle:tt})}else pt(K.numGlyphs,Z)}if(D){te.clear();const se=b.icon.placedSymbolArray;for(let K=0;K<se.length;K++){const fe=se.get(K);if(fe.hidden)pt(fe.numGlyphs,te);else{const Te=ee[K];if(Te)for(let oe=0;oe<fe.numGlyphs;oe++)l.aj(te,Te.shiftedAnchor,Te.angle);else pt(fe.numGlyphs,te)}}b.icon.dynamicLayoutVertexBuffer.updateData(te)}b.text.dynamicLayoutVertexBuffer.updateData(Z)}function Ql(b,r,d){return d.iconsInText&&r?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function Kh(b,r,d,m,g,x,M,P,A,D,B,O){const Z=b.context,te=Z.gl,ee=b.transform,se=P==="map",K=A==="map",fe=P!=="viewport"&&d.layout.get("symbol-placement")!=="point",Te=se&&!K&&!fe,oe=!d.layout.get("symbol-sort-key").isConstant();let ye=!1;const Me=b.depthModeForSublayer(0,Jt.ReadOnly),Pe=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[];for(const $e of m){const He=r.getTile($e),Ze=He.getBucket(d);if(!Ze)continue;const ut=g?Ze.text:Ze.icon;if(!ut||!ut.segments.get().length||!ut.hasVisibleVertices)continue;const Rt=ut.programConfigurations.get(d.id),tt=g||Ze.sdfIcons,Pt=g?Ze.textSizeData:Ze.iconSizeData,Bt=K||ee.pitch!==0,Wt=b.useProgram(Ql(tt,g,Ze),Rt),zt=l.ag(Pt,ee.zoom),Ot=b.style.map.terrain&&b.style.map.terrain.getTerrainData($e);let Vt,Bi,yi,os,dn=[0,0],wi=null;if(g)Bi=He.glyphAtlasTexture,yi=te.LINEAR,Vt=He.glyphAtlasTexture.size,Ze.iconsInText&&(dn=He.imageAtlasTexture.size,wi=He.imageAtlasTexture,os=Bt||b.options.rotating||b.options.zooming||Pt.kind==="composite"||Pt.kind==="camera"?te.LINEAR:te.NEAREST);else{const Li=d.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;Bi=He.imageAtlasTexture,yi=tt||b.options.rotating||b.options.zooming||Li||Bt?te.LINEAR:te.NEAREST,Vt=He.imageAtlasTexture.size}const Bn=Mt(He,1,b.transform.zoom),Xs=ns($e.posMatrix,K,se,b.transform,Bn),ur=zn($e.posMatrix,K,se,b.transform,Bn),to=Pe&&Ze.hasTextData(),io=d.layout.get("icon-text-fit")!=="none"&&to&&Ze.hasIconData();if(fe){const Li=b.style.map.terrain?(Ms,qt)=>b.style.map.terrain.getElevation($e,Ms,qt):null,In=d.layout.get("text-rotation-alignment")==="map";G(Ze,$e.posMatrix,b,g,Xs,ur,K,D,In,Li)}const dr=b.translatePosMatrix($e.posMatrix,He,x,M),Ks=fe||g&&Pe||io?Xh:Xs,$i=b.translatePosMatrix(ur,He,x,M,!0),Ii=tt&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let en;en=tt?Ze.iconsInText?Jd(Pt.kind,zt,Te,K,b,dr,Ks,$i,Vt,dn):ko(Pt.kind,zt,Te,K,b,dr,Ks,$i,g,Vt,!0):ua(Pt.kind,zt,Te,K,b,dr,Ks,$i,g,Vt);const Uo={program:Wt,buffers:ut,uniformValues:en,atlasTexture:Bi,atlasTextureIcon:wi,atlasInterpolation:yi,atlasInterpolationIcon:os,isSDF:tt,hasHalo:Ii};if(oe&&Ze.canOverlap){ye=!0;const Li=ut.segments.get();for(const In of Li)ze.push({segments:new l.$([In]),sortKey:In.sortKey,state:Uo,terrainData:Ot})}else ze.push({segments:ut.segments,sortKey:0,state:Uo,terrainData:Ot})}ye&&ze.sort(($e,He)=>$e.sortKey-He.sortKey);for(const $e of ze){const He=$e.state;if(Z.activeTexture.set(te.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,te.CLAMP_TO_EDGE),He.atlasTextureIcon&&(Z.activeTexture.set(te.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),He.isSDF){const Ze=He.uniformValues;He.hasHalo&&(Ze.u_is_halo=1,nl(He.buffers,$e.segments,d,b,He.program,Me,B,O,Ze,$e.terrainData)),Ze.u_is_halo=0}nl(He.buffers,$e.segments,d,b,He.program,Me,B,O,He.uniformValues,$e.terrainData)}}function nl(b,r,d,m,g,x,M,P,A,D){const B=m.context;g.draw(B,B.gl.TRIANGLES,x,M,P,_i.disabled,A,D,d.id,b.layoutVertexBuffer,b.indexBuffer,r,d.paint,m.transform.zoom,b.programConfigurations.get(d.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Yh(b,r,d,m,g){if(!d||!m||!m.imageAtlas)return;const x=m.imageAtlas.patternPositions;let M=x[d.to.toString()],P=x[d.from.toString()];if(!M&&P&&(M=P),!P&&M&&(P=M),!M||!P){const A=g.getPaintProperty(r);M=x[A],P=x[A]}M&&P&&b.setConstantPatternPositions(M,P)}function ec(b,r,d,m,g,x,M){const P=b.context.gl,A="fill-pattern",D=d.paint.get(A),B=D&&D.constantOr(1),O=d.getCrossfadeParameters();let Z,te,ee,se,K;M?(te=B&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=P.LINES):(te=B?"fillPattern":"fill",Z=P.TRIANGLES);const fe=D.constantOr(null);for(const Te of m){const oe=r.getTile(Te);if(B&&!oe.patternsLoaded())continue;const ye=oe.getBucket(d);if(!ye)continue;const Me=ye.programConfigurations.get(d.id),Pe=b.useProgram(te,Me),ze=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Te);B&&(b.context.activeTexture.set(P.TEXTURE0),oe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Me.updatePaintBuffers(O)),Yh(Me,A,fe,oe,d);const $e=ze?Te:null,He=b.translatePosMatrix($e?$e.posMatrix:Te.posMatrix,oe,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(M){se=ye.indexBuffer2,K=ye.segments2;const Ze=[P.drawingBufferWidth,P.drawingBufferHeight];ee=te==="fillOutlinePattern"&&B?Kd(He,b,O,oe,Ze):Fh(He,Ze)}else se=ye.indexBuffer,K=ye.segments,ee=B?Rh(He,b,O,oe):Ha(He);Pe.draw(b.context,Z,g,b.stencilModeForClipping(Te),x,_i.disabled,ee,ze,d.id,ye.layoutVertexBuffer,se,K,d.paint,b.transform.zoom,Me)}}function Eo(b,r,d,m,g,x,M){const P=b.context,A=P.gl,D="fill-extrusion-pattern",B=d.paint.get(D),O=B.constantOr(1),Z=d.getCrossfadeParameters(),te=d.paint.get("fill-extrusion-opacity"),ee=B.constantOr(null);for(const se of m){const K=r.getTile(se),fe=K.getBucket(d);if(!fe)continue;const Te=b.style.map.terrain&&b.style.map.terrain.getTerrainData(se),oe=fe.programConfigurations.get(d.id),ye=b.useProgram(O?"fillExtrusionPattern":"fillExtrusion",oe);O&&(b.context.activeTexture.set(A.TEXTURE0),K.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),oe.updatePaintBuffers(Z)),Yh(oe,D,ee,K,d);const Me=b.translatePosMatrix(se.posMatrix,K,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Pe=d.paint.get("fill-extrusion-vertical-gradient"),ze=O?Xd(Me,b,Pe,te,se,Z,K):Lh(Me,b,Pe,te);ye.draw(P,P.gl.TRIANGLES,g,x,M,_i.backCCW,ze,Te,d.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,d.paint,b.transform.zoom,oe,b.style.map.terrain&&fe.centroidVertexBuffer)}}function tc(b,r,d,m,g,x,M){const P=b.context,A=P.gl,D=d.fbo;if(!D)return;const B=b.useProgram("hillshade"),O=b.style.map.terrain&&b.style.map.terrain.getTerrainData(r);P.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,D.colorAttachment.get()),B.draw(P,A.TRIANGLES,g,x,M,_i.disabled,((Z,te,ee,se)=>{const K=ee.paint.get("hillshade-shadow-color"),fe=ee.paint.get("hillshade-highlight-color"),Te=ee.paint.get("hillshade-accent-color");let oe=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=Z.transform.angle);const ye=!Z.options.moving;return{u_matrix:se?se.posMatrix:Z.transform.calculatePosMatrix(te.tileID.toUnwrapped(),ye),u_image:0,u_latrange:Vh(0,te.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),oe],u_shadow:K,u_highlight:fe,u_accent:Te}})(b,d,m,O?r:null),O,m.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function Jh(b,r,d,m,g,x){const M=b.context,P=M.gl,A=r.dem;if(A&&A.data){const D=A.dim,B=A.stride,O=A.getPixels();if(M.activeTexture.set(P.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||b.getTileTexture(B),r.demTexture){const te=r.demTexture;te.update(O,{premultiply:!1}),te.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else r.demTexture=new We(M,O,P.RGBA,{premultiply:!1}),r.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);M.activeTexture.set(P.TEXTURE0);let Z=r.fbo;if(!Z){const te=new We(M,{width:D,height:D,data:null},P.RGBA);te.bind(P.LINEAR,P.CLAMP_TO_EDGE),Z=r.fbo=M.createFramebuffer(D,D,!0,!1),Z.colorAttachment.set(te.texture)}M.bindFramebuffer.set(Z.framebuffer),M.viewport.set([0,0,D,D]),b.useProgram("hillshadePrepare").draw(M,P.TRIANGLES,m,g,x,_i.disabled,((te,ee)=>{const se=ee.stride,K=l.F();return l.aN(K,0,l.W,-l.W,0,0,1),l.H(K,K,[0,-l.W,0]),{u_matrix:K,u_image:1,u_dimension:[se,se],u_zoom:te.overscaledZ,u_unpack:ee.getUnpackVector()}})(r.tileID,A),null,d.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function Qh(b,r,d,m,g,x){const M=m.paint.get("raster-fade-duration");if(!x&&M>0){const P=C.now(),A=(P-b.timeAdded)/M,D=r?(P-r.timeAdded)/M:-1,B=d.getSource(),O=g.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),Z=!r||Math.abs(r.tileID.overscaledZ-O)>Math.abs(b.tileID.overscaledZ-O),te=Z&&b.refreshedUponExpiration?1:l.ac(Z?A:1-D,0,1);return b.refreshedUponExpiration&&A>=1&&(b.refreshedUponExpiration=!1),r?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const sl=new l.aO(1,0,0,1),ic=new l.aO(0,1,0,1),hf=new l.aO(0,0,1,1),eu=new l.aO(1,0,1,1),Qi=new l.aO(0,1,1,1);function zr(b,r,d,m){zo(b,0,r+d/2,b.transform.width,d,m)}function Ts(b,r,d,m){zo(b,r-d/2,0,d,b.transform.height,m)}function zo(b,r,d,m,g,x){const M=b.context,P=M.gl;P.enable(P.SCISSOR_TEST),P.scissor(r*b.pixelRatio,d*b.pixelRatio,m*b.pixelRatio,g*b.pixelRatio),M.clear({color:x}),P.disable(P.SCISSOR_TEST)}function nc(b,r,d){const m=b.context,g=m.gl,x=d.posMatrix,M=b.useProgram("debug"),P=Jt.disabled,A=vi.disabled,D=b.colorModeForRenderPass(),B="$debug",O=b.style.map.terrain&&b.style.map.terrain.getTerrainData(d);m.activeTexture.set(g.TEXTURE0);const Z=r.getTileByID(d.key).latestRawTileData,te=Math.floor((Z&&Z.byteLength||0)/1024),ee=r.getTile(d).tileSize,se=512/Math.min(ee,512)*(d.overscaledZ/b.transform.zoom)*.5;let K=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(K+=` => ${d.overscaledZ}`),function(fe,Te){fe.initDebugOverlayCanvas();const oe=fe.debugOverlayCanvas,ye=fe.context.gl,Me=fe.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,oe.width,oe.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText(Te,5,5),Me.strokeText(Te,5,5),fe.debugOverlayTexture.update(oe),fe.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(b,`${K} ${te}kB`),M.draw(m,g.TRIANGLES,P,A,rn.alphaBlended,_i.disabled,Wa(x,l.aO.transparent,se),null,B,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),M.draw(m,g.LINE_STRIP,P,A,D,_i.disabled,Wa(x,l.aO.red),O,B,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function sc(b,r,d){const m=b.context,g=m.gl,x=b.colorModeForRenderPass(),M=new Jt(g.LEQUAL,Jt.ReadWrite,b.depthRangeFor3D),P=b.useProgram("terrain"),A=r.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,b.width,b.height]);for(const D of d){const B=b.renderToTexture.getTexture(D),O=r.getTerrainData(D.tileID);m.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,B.texture);const Z={u_matrix:b.transform.calculatePosMatrix(D.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(b.transform.zoom)};P.draw(m,g.TRIANGLES,M,vi.disabled,x,_i.backCCW,Z,O,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class Do{constructor(r,d){this.context=new Gh(r),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ke.maxUnderzooming+Ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ji}resize(r,d,m){if(this.width=Math.floor(r*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const r=this.context,d=new l.aV;d.emplaceBack(0,0),d.emplaceBack(l.W,0),d.emplaceBack(0,l.W),d.emplaceBack(l.W,l.W),this.tileExtentBuffer=r.createVertexBuffer(d,ar.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const m=new l.aV;m.emplaceBack(0,0),m.emplaceBack(l.W,0),m.emplaceBack(0,l.W),m.emplaceBack(l.W,l.W),this.debugBuffer=r.createVertexBuffer(m,ar.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const g=new l.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(l.W,0,l.W,0),g.emplaceBack(0,l.W,0,l.W),g.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=r.createVertexBuffer(g,Ki.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const x=new l.aV;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(x,ar.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const M=new l.aW;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(M);const P=new l.aX;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(P);const A=this.context.gl;this.stencilClearMode=new vi({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const r=this.context,d=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=l.F();l.aN(m,0,this.width,this.height,0,0,1),l.J(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,d.TRIANGLES,Jt.disabled,this.stencilClearMode,rn.disabled,_i.disabled,ql(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,d){if(this.currentStencilSource===r.source||!r.isTileClipped()||!d||!d.length)return;this.currentStencilSource=r.source;const m=this.context,g=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(rn.disabled),m.setDepthMode(Jt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of d){const P=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M);x.draw(m,g.TRIANGLES,Jt.disabled,new vi({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),rn.disabled,_i.disabled,ql(M.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,d=this.context.gl;return new vi({func:d.NOTEQUAL,mask:255},r,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(r){const d=this.context.gl;return new vi({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(r){const d=this.context.gl,m=r.sort((M,P)=>P.overscaledZ-M.overscaledZ),g=m[m.length-1].overscaledZ,x=m[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const M={};for(let P=0;P<x;P++)M[P+g]=new vi({func:d.GEQUAL,mask:255},P+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=x,[M,m]}return[{[g]:vi.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new rn([r.CONSTANT_COLOR,r.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?rn.unblended:rn.alphaBlended}depthModeForSublayer(r,d,m){if(!this.opaquePassEnabledForLayer())return Jt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Jt(m||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,d){this.style=r,this.options=d,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(C.now()),this.imageManager.beginFrame();const m=this.style._order,g=this.style.sourceCaches,x={},M={},P={};for(const A in g){const D=g[A];D.used&&D.prepare(this.context),x[A]=D.getVisibleCoordinates(),M[A]=x[A].slice().reverse(),P[A]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<m.length;A++)if(this.style._layers[m[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of m){const D=this.style._layers[A];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const B=M[D.source];(D.type==="custom"||B.length)&&this.renderLayer(this,g[D.source],D,B)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[m[this.currentLayer]],D=g[A.source],B=x[A.source];this._renderTileClippingMasks(A,B),this.renderLayer(this,D,A,B)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const A=this.style._layers[m[this.currentLayer]],D=g[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const B=(A.type==="symbol"?P:M)[A.source];this._renderTileClippingMasks(A,x[A.source]),this.renderLayer(this,D,A,B)}if(this.options.showTileBoundaries){const A=function(D,B){let O=null;const Z=Object.values(D._layers).flatMap(K=>K.source&&!K.isHidden(B)?[D.sourceCaches[K.source]]:[]),te=Z.filter(K=>K.getSource().type==="vector"),ee=Z.filter(K=>K.getSource().type!=="vector"),se=K=>{(!O||O.getSource().maxzoom<K.getSource().maxzoom)&&(O=K)};return te.forEach(K=>se(K)),O||ee.forEach(K=>se(K)),O}(this.style,this.transform.zoom);A&&function(D,B,O){for(let Z=0;Z<O.length;Z++)nc(D,B,O[Z])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const D=A.transform.padding;zr(A,A.transform.height-(D.top||0),3,sl),zr(A,D.bottom||0,3,ic),Ts(A,D.left||0,3,hf),Ts(A,A.transform.width-(D.right||0),3,eu);const B=A.transform.centerPoint;(function(O,Z,te,ee){zo(O,Z-1,te-10,2,20,ee),zo(O,Z-10,te-1,20,2,ee)})(A,B.x,A.transform.height-B.y,Qi)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,m=this.transform.projMatrix;let g=this.terrainFacilitator.dirty;g||(g=r?!l.aY(d,m):!l.aZ(d,m)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(l.a_(d,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(x,M){const P=x.context,A=P.gl,D=rn.unblended,B=new Jt(A.LEQUAL,Jt.ReadWrite,[0,1]),O=M.getTerrainMesh(),Z=M.sourceCache.getRenderableTiles(),te=x.useProgram("terrainDepth");P.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),P.clear({color:l.aO.transparent,depth:1});for(const ee of Z){const se=M.getTerrainData(ee.tileID),K={u_matrix:x.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_ele_delta:M.getMeshFrameDelta(x.transform.zoom)};te.draw(P,A.TRIANGLES,B,vi.disabled,D,_i.backCCW,K,se,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain),function(x,M){const P=x.context,A=P.gl,D=rn.unblended,B=new Jt(A.LEQUAL,Jt.ReadWrite,[0,1]),O=M.getTerrainMesh(),Z=M.getCoordsTexture(),te=M.sourceCache.getRenderableTiles(),ee=x.useProgram("terrainCoords");P.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),P.clear({color:l.aO.transparent,depth:1}),M.coordsIndex=[];for(const se of te){const K=M.getTerrainData(se.tileID);P.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Z.texture);const fe={u_matrix:x.transform.calculatePosMatrix(se.tileID.toUnwrapped()),u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(x.transform.zoom)};ee.draw(P,A.TRIANGLES,B,vi.disabled,D,_i.backCCW,fe,K,"terrain",O.vertexBuffer,O.indexBuffer,O.segments),M.coordsIndex.push(se.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain))}renderLayer(r,d,m,g){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(g||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(x,M,P,A,D){if(x.renderPass!=="translucent")return;const B=vi.disabled,O=x.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Z,te,ee,se,K,fe,Te){const oe=te.transform,ye=K==="map",Me=fe==="map";for(const Pe of Z){const ze=se.getTile(Pe),$e=ze.getBucket(ee);if(!$e||!$e.text||!$e.text.segments.get().length)continue;const He=l.ag($e.textSizeData,oe.zoom),Ze=Mt(ze,1,te.transform.zoom),ut=ns(Pe.posMatrix,Me,ye,te.transform,Ze),Rt=ee.layout.get("icon-text-fit")!=="none"&&$e.hasIconData();if(He){const tt=Math.pow(2,oe.zoom-ze.tileID.overscaledZ);il($e,ye,Me,Te,oe,ut,Pe.posMatrix,tt,He,Rt,te.style.map.terrain?(Pt,Bt)=>te.style.map.terrain.getElevation(Pe,Pt,Bt):null)}}}(A,x,P,M,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),D),P.paint.get("icon-opacity").constantOr(1)!==0&&Kh(x,M,P,A,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),B,O),P.paint.get("text-opacity").constantOr(1)!==0&&Kh(x,M,P,A,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),B,O),M.map.showCollisionBoxes&&(el(x,M,P,A,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),!0),el(x,M,P,A,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),!1))})(r,d,m,g,this.style.placement.variableOffsets);break;case"circle":(function(x,M,P,A){if(x.renderPass!=="translucent")return;const D=P.paint.get("circle-opacity"),B=P.paint.get("circle-stroke-width"),O=P.paint.get("circle-stroke-opacity"),Z=!P.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(B.constantOr(1)===0||O.constantOr(1)===0))return;const te=x.context,ee=te.gl,se=x.depthModeForSublayer(0,Jt.ReadOnly),K=vi.disabled,fe=x.colorModeForRenderPass(),Te=[];for(let oe=0;oe<A.length;oe++){const ye=A[oe],Me=M.getTile(ye),Pe=Me.getBucket(P);if(!Pe)continue;const ze=Pe.programConfigurations.get(P.id),$e=x.useProgram("circle",ze),He=Pe.layoutVertexBuffer,Ze=Pe.indexBuffer,ut=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ye),Rt={programConfiguration:ze,program:$e,layoutVertexBuffer:He,indexBuffer:Ze,uniformValues:Bh(x,ye,Me,P),terrainData:ut};if(Z){const tt=Pe.segments.get();for(const Pt of tt)Te.push({segments:new l.$([Pt]),sortKey:Pt.sortKey,state:Rt})}else Te.push({segments:Pe.segments,sortKey:0,state:Rt})}Z&&Te.sort((oe,ye)=>oe.sortKey-ye.sortKey);for(const oe of Te){const{programConfiguration:ye,program:Me,layoutVertexBuffer:Pe,indexBuffer:ze,uniformValues:$e,terrainData:He}=oe.state;Me.draw(te,ee.TRIANGLES,se,K,fe,_i.disabled,$e,He,P.id,Pe,ze,oe.segments,P.paint,x.transform.zoom,ye)}})(r,d,m,g);break;case"heatmap":(function(x,M,P,A){if(P.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const D=x.context,B=D.gl,O=vi.disabled,Z=new rn([B.ONE,B.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(te,ee,se){const K=te.gl;te.activeTexture.set(K.TEXTURE1),te.viewport.set([0,0,ee.width/4,ee.height/4]);let fe=se.heatmapFbo;if(fe)K.bindTexture(K.TEXTURE_2D,fe.colorAttachment.get()),te.bindFramebuffer.set(fe.framebuffer);else{const Te=K.createTexture();K.bindTexture(K.TEXTURE_2D,Te),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),fe=se.heatmapFbo=te.createFramebuffer(ee.width/4,ee.height/4,!1,!1),function(oe,ye,Me,Pe){var ze,$e;const He=oe.gl,Ze=(ze=oe.HALF_FLOAT)!==null&&ze!==void 0?ze:He.UNSIGNED_BYTE,ut=($e=oe.RGBA16F)!==null&&$e!==void 0?$e:He.RGBA;He.texImage2D(He.TEXTURE_2D,0,ut,ye.width/4,ye.height/4,0,He.RGBA,Ze,null),Pe.colorAttachment.set(Me)}(te,ee,Te,fe)}})(D,x,P),D.clear({color:l.aO.transparent});for(let te=0;te<A.length;te++){const ee=A[te];if(M.hasRenderableParent(ee))continue;const se=M.getTile(ee),K=se.getBucket(P);if(!K)continue;const fe=K.programConfigurations.get(P.id),Te=x.useProgram("heatmap",fe),{zoom:oe}=x.transform;Te.draw(D,B.TRIANGLES,Jt.disabled,O,Z,_i.disabled,Oh(ee.posMatrix,se,oe,P.paint.get("heatmap-intensity")),null,P.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,P.paint,x.transform.zoom,fe)}D.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(D,B){const O=D.context,Z=O.gl,te=B.heatmapFbo;if(!te)return;O.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,te.colorAttachment.get()),O.activeTexture.set(Z.TEXTURE1);let ee=B.colorRampTexture;ee||(ee=B.colorRampTexture=new We(O,B.colorRamp,Z.RGBA)),ee.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),D.useProgram("heatmapTexture").draw(O,Z.TRIANGLES,Jt.disabled,vi.disabled,D.colorModeForRenderPass(),_i.disabled,((se,K,fe,Te)=>{const oe=l.F();l.aN(oe,0,se.width,se.height,0,0,1);const ye=se.context.gl;return{u_matrix:oe,u_world:[ye.drawingBufferWidth,ye.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}})(D,B),null,B.id,D.viewportBuffer,D.quadTriangleIndexBuffer,D.viewportSegments,B.paint,D.transform.zoom)}(x,P))})(r,d,m,g);break;case"line":(function(x,M,P,A){if(x.renderPass!=="translucent")return;const D=P.paint.get("line-opacity"),B=P.paint.get("line-width");if(D.constantOr(1)===0||B.constantOr(1)===0)return;const O=x.depthModeForSublayer(0,Jt.ReadOnly),Z=x.colorModeForRenderPass(),te=P.paint.get("line-dasharray"),ee=P.paint.get("line-pattern"),se=ee.constantOr(1),K=P.paint.get("line-gradient"),fe=P.getCrossfadeParameters(),Te=se?"linePattern":te?"lineSDF":K?"lineGradient":"line",oe=x.context,ye=oe.gl;let Me=!0;for(const Pe of A){const ze=M.getTile(Pe);if(se&&!ze.patternsLoaded())continue;const $e=ze.getBucket(P);if(!$e)continue;const He=$e.programConfigurations.get(P.id),Ze=x.context.program.get(),ut=x.useProgram(Te,He),Rt=Me||ut.program!==Ze,tt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Pe),Pt=ee.constantOr(null);if(Pt&&ze.imageAtlas){const zt=ze.imageAtlas,Ot=zt.patternPositions[Pt.to.toString()],Vt=zt.patternPositions[Pt.from.toString()];Ot&&Vt&&He.setConstantPatternPositions(Ot,Vt)}const Bt=tt?Pe:null,Wt=se?$a(x,ze,P,fe,Bt):te?Fs(x,ze,P,te,fe,Bt):K?$r(x,ze,P,$e.lineClipsArray.length,Bt):Za(x,ze,P,Bt);if(se)oe.activeTexture.set(ye.TEXTURE0),ze.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),He.updatePaintBuffers(fe);else if(te&&(Rt||x.lineAtlas.dirty))oe.activeTexture.set(ye.TEXTURE0),x.lineAtlas.bind(oe);else if(K){const zt=$e.gradients[P.id];let Ot=zt.texture;if(P.gradientVersion!==zt.version){let Vt=256;if(P.stepInterpolant){const Bi=M.getSource().maxzoom,yi=Pe.canonical.z===Bi?Math.ceil(1<<x.transform.maxZoom-Pe.canonical.z):1;Vt=l.ac(l.aT($e.maxLineLength/l.W*1024*yi),256,oe.maxTextureSize)}zt.gradient=l.aU({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:Vt,image:zt.gradient||void 0,clips:$e.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new We(oe,zt.gradient,ye.RGBA),zt.version=P.gradientVersion,Ot=zt.texture}oe.activeTexture.set(ye.TEXTURE0),Ot.bind(P.stepInterpolant?ye.NEAREST:ye.LINEAR,ye.CLAMP_TO_EDGE)}ut.draw(oe,ye.TRIANGLES,O,x.stencilModeForClipping(Pe),Z,_i.disabled,Wt,tt,P.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,P.paint,x.transform.zoom,He,$e.layoutVertexBuffer2),Me=!1}})(r,d,m,g);break;case"fill":(function(x,M,P,A){const D=P.paint.get("fill-color"),B=P.paint.get("fill-opacity");if(B.constantOr(1)===0)return;const O=x.colorModeForRenderPass(),Z=P.paint.get("fill-pattern"),te=x.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&D.constantOr(l.aO.transparent).a===1&&B.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===te){const ee=x.depthModeForSublayer(1,x.renderPass==="opaque"?Jt.ReadWrite:Jt.ReadOnly);ec(x,M,P,A,ee,O,!1)}if(x.renderPass==="translucent"&&P.paint.get("fill-antialias")){const ee=x.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Jt.ReadOnly);ec(x,M,P,A,ee,O,!0)}})(r,d,m,g);break;case"fill-extrusion":(function(x,M,P,A){const D=P.paint.get("fill-extrusion-opacity");if(D!==0&&x.renderPass==="translucent"){const B=new Jt(x.context.gl.LEQUAL,Jt.ReadWrite,x.depthRangeFor3D);if(D!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Eo(x,M,P,A,B,vi.disabled,rn.disabled),Eo(x,M,P,A,B,x.stencilModeFor3D(),x.colorModeForRenderPass());else{const O=x.colorModeForRenderPass();Eo(x,M,P,A,B,vi.disabled,O)}}})(r,d,m,g);break;case"hillshade":(function(x,M,P,A){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const D=x.context,B=x.depthModeForSublayer(0,Jt.ReadOnly),O=x.colorModeForRenderPass(),[Z,te]=x.renderPass==="translucent"?x.stencilConfigForOverlap(A):[{},A];for(const ee of te){const se=M.getTile(ee);se.needsHillshadePrepare!==void 0&&se.needsHillshadePrepare&&x.renderPass==="offscreen"?Jh(x,se,P,B,vi.disabled,O):x.renderPass==="translucent"&&tc(x,ee,se,P,B,Z[ee.overscaledZ],O)}D.viewport.set([0,0,x.width,x.height])})(r,d,m,g);break;case"raster":(function(x,M,P,A){if(x.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!A.length)return;const D=x.context,B=D.gl,O=M.getSource(),Z=x.useProgram("raster"),te=x.colorModeForRenderPass(),[ee,se]=O instanceof ts?[{},A]:x.stencilConfigForOverlap(A),K=se[se.length-1].overscaledZ,fe=!x.options.moving;for(const Te of se){const oe=x.depthModeForSublayer(Te.overscaledZ-K,P.paint.get("raster-opacity")===1?Jt.ReadWrite:Jt.ReadOnly,B.LESS),ye=M.getTile(Te);ye.registerFadeDuration(P.paint.get("raster-fade-duration"));const Me=M.findLoadedParent(Te,0),Pe=Qh(ye,Me,M,P,x.transform,x.style.map.terrain);let ze,$e;const He=P.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;D.activeTexture.set(B.TEXTURE0),ye.texture.bind(He,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(B.TEXTURE1),Me?(Me.texture.bind(He,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),ze=Math.pow(2,Me.tileID.overscaledZ-ye.tileID.overscaledZ),$e=[ye.tileID.canonical.x*ze%1,ye.tileID.canonical.y*ze%1]):ye.texture.bind(He,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const Ze=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Te),ut=Ze?Te:null,Rt=ut?ut.posMatrix:x.transform.calculatePosMatrix(Te.toUnwrapped(),fe),tt=ha(Rt,$e||[0,0],ze||1,Pe,P);O instanceof ts?Z.draw(D,B.TRIANGLES,oe,vi.disabled,te,_i.disabled,tt,Ze,P.id,O.boundsBuffer,x.quadTriangleIndexBuffer,O.boundsSegments):Z.draw(D,B.TRIANGLES,oe,ee[Te.overscaledZ],te,_i.disabled,tt,Ze,P.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}})(r,d,m,g);break;case"background":(function(x,M,P,A){const D=P.paint.get("background-color"),B=P.paint.get("background-opacity");if(B===0)return;const O=x.context,Z=O.gl,te=x.transform,ee=te.tileSize,se=P.paint.get("background-pattern");if(x.isPatternMissing(se))return;const K=!se&&D.a===1&&B===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==K)return;const fe=vi.disabled,Te=x.depthModeForSublayer(0,K==="opaque"?Jt.ReadWrite:Jt.ReadOnly),oe=x.colorModeForRenderPass(),ye=x.useProgram(se?"backgroundPattern":"background"),Me=A||te.coveringTiles({tileSize:ee,terrain:x.style.map.terrain});se&&(O.activeTexture.set(Z.TEXTURE0),x.imageManager.bind(x.context));const Pe=P.getCrossfadeParameters();for(const ze of Me){const $e=A?ze.posMatrix:x.transform.calculatePosMatrix(ze.toUnwrapped()),He=se?Nh($e,B,x,se,{tileID:ze,tileSize:ee},Pe):Qd($e,B,D),Ze=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ze);ye.draw(O,Z.TRIANGLES,Te,fe,oe,_i.disabled,He,Ze,P.id,x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}})(r,0,m,g);break;case"custom":(function(x,M,P){const A=x.context,D=P.implementation;if(x.renderPass==="offscreen"){const B=D.prerender;B&&(x.setCustomLayerDefaults(),A.setColorMode(x.colorModeForRenderPass()),B.call(D,A.gl,x.transform.customLayerMatrix()),A.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),A.setColorMode(x.colorModeForRenderPass()),A.setStencilMode(vi.disabled);const B=D.renderingMode==="3d"?new Jt(x.context.gl.LEQUAL,Jt.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,Jt.ReadOnly);A.setDepthMode(B),D.render(A.gl,x.transform.customLayerMatrix()),A.setDirty(),x.setBaseState(),A.bindFramebuffer.set(null)}})(r,0,m)}}translatePosMatrix(r,d,m,g,x){if(!m[0]&&!m[1])return r;const M=x?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(M){const D=Math.sin(M),B=Math.cos(M);m=[m[0]*B-m[1]*D,m[0]*D+m[1]*B]}const P=[x?m[0]:Mt(d,m[0],this.transform.zoom),x?m[1]:Mt(d,m[1],this.transform.zoom),0],A=new Float32Array(16);return l.H(A,r,P),A}saveTileTexture(r){const d=this._tileTextures[r.size[0]];d?d.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const d=this._tileTextures[r];return d&&d.length>0?d.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const d=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!d||!m}useProgram(r,d){this.cache=this.cache||{};const m=r+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new jl(this.context,wo[r],d,ef[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new We(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:d}=this.context.gl;return this.width!==r||this.height!==d}}class Kr{constructor(r,d){this.points=r,this.planes=d}static fromInvProjectionMatrix(r,d,m){const g=Math.pow(2,m),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const A=1/(P=l.af([],P,r))[3]/d*g;return l.a$(P,P,[A,A,1/P[3],A])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const A=function(Z,te){var ee=te[0],se=te[1],K=te[2],fe=ee*ee+se*se+K*K;return fe>0&&(fe=1/Math.sqrt(fe)),Z[0]=te[0]*fe,Z[1]=te[1]*fe,Z[2]=te[2]*fe,Z}([],function(Z,te,ee){var se=te[0],K=te[1],fe=te[2],Te=ee[0],oe=ee[1],ye=ee[2];return Z[0]=K*ye-fe*oe,Z[1]=fe*Te-se*ye,Z[2]=se*oe-K*Te,Z}([],ke([],x[P[0]],x[P[1]]),ke([],x[P[2]],x[P[1]]))),D=-((B=A)[0]*(O=x[P[1]])[0]+B[1]*O[1]+B[2]*O[2]);var B,O;return A.concat(D)});return new Kr(x,M)}}class Lo{constructor(r,d){this.min=r,this.max=d,this.center=function(m,g,x){return m[0]=.5*g[0],m[1]=.5*g[1],m[2]=.5*g[2],m}([],function(m,g,x){return m[0]=g[0]+x[0],m[1]=g[1]+x[1],m[2]=g[2]+x[2],m}([],this.min,this.max))}quadrant(r){const d=[r%2==0,r<2],m=xe(this.min),g=xe(this.max);for(let x=0;x<d.length;x++)m[x]=d[x]?this.min[x]:this.center[x],g[x]=d[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new Lo(m,g)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let g=0;g<r.planes.length;g++){const x=r.planes[g];let M=0;for(let P=0;P<d.length;P++)l.b0(x,d[P])>=0&&M++;if(M===0)return 0;M!==d.length&&(m=!1)}if(m)return 2;for(let g=0;g<3;g++){let x=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let P=0;P<r.points.length;P++){const A=r.points[P][g]-this.min[g];x=Math.min(x,A),M=Math.max(M,A)}if(M<0||x>this.max[g]-this.min[g])return 0}return 1}}class pa{constructor(r=0,d=0,m=0,g=0){if(isNaN(r)||r<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=d,this.left=m,this.right=g}interpolate(r,d,m){return d.top!=null&&r.top!=null&&(this.top=l.z.number(r.top,d.top,m)),d.bottom!=null&&r.bottom!=null&&(this.bottom=l.z.number(r.bottom,d.bottom,m)),d.left!=null&&r.left!=null&&(this.left=l.z.number(r.left,d.left,m)),d.right!=null&&r.right!=null&&(this.right=l.z.number(r.right,d.right,m)),this}getCenter(r,d){const m=l.ac((this.left+r-this.right)/2,0,r),g=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(m,g)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new pa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const rc=85.051129;class rl{constructor(r,d,m,g,x){this.tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=r||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pa,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const r=new rl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this.minElevationForCurrentTile=r.minElevationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const d=-l.b1(r,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var m=new l.A(4);return l.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,g,x){var M=g[0],P=g[1],A=g[2],D=g[3],B=Math.sin(x),O=Math.cos(x);m[0]=M*O+A*B,m[1]=P*O+D*B,m[2]=M*-B+A*O,m[3]=P*-B+D*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const d=l.ac(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const d=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,d,m){this._unmodified=!1,this._edgeInsets.interpolate(r,d,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const d=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(r){const d=[new l.b2(0,r)];if(this._renderWorldCopies){const m=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),x=this.pointCoordinate(new l.P(this.width,this.height)),M=this.pointCoordinate(new l.P(0,this.height)),P=Math.floor(Math.min(m.x,g.x,x.x,M.x)),A=Math.floor(Math.max(m.x,g.x,x.x,M.x)),D=1;for(let B=P-D;B<=A+D;B++)B!==0&&d.push(new l.b2(B,r))}return d}coveringTiles(r){var d,m;let g=this.coveringZoomLevel(r);const x=g;if(r.minzoom!==void 0&&g<r.minzoom)return[];r.maxzoom!==void 0&&g>r.maxzoom&&(g=r.maxzoom);const M=this.pointCoordinate(this.getCameraPoint()),P=l.Y.fromLngLat(this.center),A=Math.pow(2,g),D=[A*M.x,A*M.y,0],B=[A*P.x,A*P.y,0],O=Kr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let Z=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Z=g);const te=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,ee=oe=>({aabb:new Lo([oe*A,0,0],[(oe+1)*A,A,0]),zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),se=[],K=[],fe=g,Te=r.reparseOverscaled?x:g;if(this._renderWorldCopies)for(let oe=1;oe<=3;oe++)se.push(ee(-oe)),se.push(ee(oe));for(se.push(ee(0));se.length>0;){const oe=se.pop(),ye=oe.x,Me=oe.y;let Pe=oe.fullyVisible;if(!Pe){const ut=oe.aabb.intersects(O);if(ut===0)continue;Pe=ut===2}const ze=r.terrain?D:B,$e=oe.aabb.distanceX(ze),He=oe.aabb.distanceY(ze),Ze=Math.max(Math.abs($e),Math.abs(He));if(oe.zoom===fe||Ze>te+(1<<fe-oe.zoom)-2&&oe.zoom>=Z){const ut=fe-oe.zoom,Rt=D[0]-.5-(ye<<ut),tt=D[1]-.5-(Me<<ut);K.push({tileID:new l.Q(oe.zoom===fe?Te:oe.zoom,oe.wrap,oe.zoom,ye,Me),distanceSq:Ie([B[0]-.5-ye,B[1]-.5-Me]),tileDistanceToCamera:Math.sqrt(Rt*Rt+tt*tt)})}else for(let ut=0;ut<4;ut++){const Rt=(ye<<1)+ut%2,tt=(Me<<1)+(ut>>1),Pt=oe.zoom+1;let Bt=oe.aabb.quadrant(ut);if(r.terrain){const Wt=new l.Q(Pt,oe.wrap,Pt,Rt,tt),zt=r.terrain.getMinMaxElevation(Wt),Ot=(d=zt.minElevation)!==null&&d!==void 0?d:this.elevation,Vt=(m=zt.maxElevation)!==null&&m!==void 0?m:this.elevation;Bt=new Lo([Bt.min[0],Bt.min[1],Ot],[Bt.max[0],Bt.max[1],Vt])}se.push({aabb:Bt,zoom:Pt,x:Rt,y:tt,wrap:oe.wrap,fullyVisible:Pe})}}return K.sort((oe,ye)=>oe.distanceSq-ye.distanceSq).map(oe=>oe.tileID)}resize(r,d){this.width=r,this.height=d,this.pixelsToGLUnits=[2/r,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const d=l.ac(r.lat,-85.051129,rc);return new l.P(l.N(r.lng)*this.worldSize,l.O(d)*this.worldSize)}unproject(r){return new l.Y(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const d=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,r),x=r.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-x))return;const M=m+d-x,P=Math.cos(this._pitch)*this.cameraToCenterDistance/M/l.b3(1,g.lat),A=this.scaleZoom(P/this.tileSize);this._elevation=x,this._center=g,this.zoom=A}setLocationAtPoint(r,d){const m=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(r),M=new l.Y(x.x-(m.x-g.x),x.y-(m.y-g.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,d){return d?this.coordinatePoint(this.locationCoordinate(r),d.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,d){return this.coordinateLocation(this.pointCoordinate(r,d))}locationCoordinate(r){return l.Y.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,d){if(d){const Z=d.pointCoordinate(r);if(Z!=null)return Z}const m=[r.x,r.y,0,1],g=[r.x,r.y,1,1];l.af(m,m,this.pixelMatrixInverse),l.af(g,g,this.pixelMatrixInverse);const x=m[3],M=g[3],P=m[1]/x,A=g[1]/M,D=m[2]/x,B=g[2]/M,O=D===B?0:(0-D)/(B-D);return new l.Y(l.z.number(m[0]/x,g[0]/M,O)/this.worldSize,l.z.number(P,A,O)/this.worldSize)}coordinatePoint(r,d=0,m=this.pixelMatrix){const g=[r.x*this.worldSize,r.y*this.worldSize,d,1];return l.af(g,g,m),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new Fi().extend(this.pointLocation(new l.P(0,r))).extend(this.pointLocation(new l.P(this.width,r))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Fi([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,rc])}calculatePosMatrix(r,d=!1){const m=r.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[m])return g[m];const x=r.canonical,M=this.worldSize/this.zoomScale(x.z),P=x.x+Math.pow(2,x.z)*r.wrap,A=l.an(new Float64Array(16));return l.H(A,A,[P*M,x.y*M,0]),l.J(A,A,[M/l.W,M/l.W,1]),l.K(A,d?this.alignedProjMatrix:this.projMatrix,A),g[m]=new Float32Array(A),g[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(r,d){d=l.ac(+d,this.minZoom,this.maxZoom);const m={center:new l.M(r.lng,r.lat),zoom:d};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const oe=179.9999999999;g=[-oe,oe]}const x=this.tileSize*this.zoomScale(m.zoom);let M=0,P=x,A=0,D=x,B=0,O=0;const{x:Z,y:te}=this.size;if(this.latRange){const oe=this.latRange;M=l.O(oe[1])*x,P=l.O(oe[0])*x,P-M<te&&(B=te/(P-M))}g&&(A=l.b1(l.N(g[0])*x,0,x),D=l.b1(l.N(g[1])*x,0,x),D<A&&(D+=x),D-A<Z&&(O=Z/(D-A)));const{x:ee,y:se}=this.project.call({worldSize:x},r);let K,fe;const Te=Math.max(O||0,B||0);if(Te){const oe=new l.P(O?(D+A)/2:ee,B?(P+M)/2:se);return m.center=this.unproject.call({worldSize:x},oe).wrap(),m.zoom+=this.scaleZoom(Te),m}if(this.latRange){const oe=te/2;se-oe<M&&(fe=M+oe),se+oe>P&&(fe=P-oe)}if(g){const oe=(A+D)/2;let ye=ee;this._renderWorldCopies&&(ye=l.b1(ee,oe-x/2,oe+x/2));const Me=Z/2;ye-Me<A&&(K=A+Me),ye+Me>D&&(K=D-Me)}if(K!==void 0||fe!==void 0){const oe=new l.P(K??ee,fe??se);m.center=this.unproject.call({worldSize:x},oe).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:d,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=m,this._unmodified=r,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,d=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let g=l.an(new Float64Array(16));l.J(g,g,[this.width/2,-this.height/2,1]),l.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.an(new Float64Array(16)),l.J(g,g,[1,-1,1]),l.H(g,g,[-1,-1,0]),l.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const x=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),M=Math.min(this.elevation,this.minElevationForCurrentTile),P=x-M*this._pixelPerMeter/Math.cos(this._pitch),A=M<0?P:x,D=Math.PI/2+this._pitch,B=this._fov*(.5+r.y/this.height),O=Math.sin(B)*A/Math.sin(l.ac(Math.PI-D-B,.01,Math.PI-.01)),Z=this.getHorizon(),te=2*Math.atan(Z/this.cameraToCenterDistance)*(.5+r.y/(2*Z)),ee=Math.sin(te)*A/Math.sin(l.ac(Math.PI-D-te,.01,Math.PI-.01)),se=Math.min(O,ee),K=1.01*(Math.cos(Math.PI/2-this._pitch)*se+A),fe=this.height/50;g=new Float64Array(16),l.b4(g,this._fov,this.width/this.height,fe,K),g[8]=2*-r.x/this.width,g[9]=2*r.y/this.height,l.J(g,g,[1,-1,1]),l.H(g,g,[0,0,-this.cameraToCenterDistance]),l.b5(g,g,this._pitch),l.ad(g,g,this.angle),l.H(g,g,[-d,-m,0]),this.mercatorMatrix=l.J([],g,[this.worldSize,this.worldSize,this.worldSize]),l.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,g),l.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.ar([],g),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,g);const Te=this.width%2/2,oe=this.height%2/2,ye=Math.cos(this.angle),Me=Math.sin(this.angle),Pe=d-Math.round(d)+ye*Te+Me*oe,ze=m-Math.round(m)+ye*oe+Me*Te,$e=new Float64Array(g);if(l.H($e,$e,[Pe>.5?Pe-1:Pe,ze>.5?ze-1:ze,0]),this.alignedProjMatrix=$e,g=l.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new l.P(0,0)),d=[r.x*this.worldSize,r.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,r))}getCameraQueryGeometry(r){const d=this.getCameraPoint();if(r.length===1)return[r[0],d];{let m=d.x,g=d.y,x=d.x,M=d.y;for(const P of r)m=Math.min(m,P.x),g=Math.min(g,P.y),x=Math.max(x,P.x),M=Math.max(M,P.y);return[new l.P(m,g),new l.P(x,g),new l.P(x,M),new l.P(m,M),new l.P(m,g)]}}lngLatToCameraDepth(r,d){const m=this.locationCoordinate(r),g=[m.x*this.worldSize,m.y*this.worldSize,d,1];return l.af(g,g,this.projMatrix),g[2]/g[3]}}function oc(b,r){let d,m=!1,g=null,x=null;const M=()=>{g=null,m&&(b.apply(x,d),g=setTimeout(M,r),m=!1)};return(...P)=>(m=!0,x=this,d=P,g||M(),g)}class ac{constructor(r){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(m=g)}),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=oc(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),M=Math.round(d.lng*x)/x,P=Math.round(d.lat*x)/x,A=this._map.getBearing(),D=this._map.getPitch();let B="";if(B+=r?`/${M}/${P}/${m}`:`${m}/${P}/${M}`,(A||D)&&(B+="/"+Math.round(10*A)/10),D&&(B+=`/${Math.round(D)}`),this._hashName){const O=this._hashName;let Z=!1;const te=window.location.hash.slice(1).split("&").map(ee=>{const se=ee.split("=")[0];return se===O?(Z=!0,`${se}=${B}`):ee}).filter(ee=>ee);return Z||te.push(`${O}=${B}`),`#${te.join("&")}`}return`#${B}`}}const cr={linearity:.3,easing:l.b6(0,0,.3,1)},tu=l.e({deceleration:2500,maxSpeed:1400},cr),iu=l.e({deceleration:20,maxSpeed:1400},cr),nu=l.e({deceleration:1e3,maxSpeed:360},cr),su=l.e({deceleration:1e3,maxSpeed:90},cr);class ru{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:C.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,d=C.now();for(;r.length>0&&d-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)d.zoom+=x.zoomDelta||0,d.bearing+=x.bearingDelta||0,d.pitch+=x.pitchDelta||0,x.panDelta&&d.pan._add(x.panDelta),x.around&&(d.around=x.around),x.pinchAround&&(d.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const x=ga(d.pan.mag(),m,l.e({},tu,r||{}));g.offset=d.pan.mult(x.amount/d.pan.mag()),g.center=this._map.transform.center,ma(g,x)}if(d.zoom){const x=ga(d.zoom,m,iu);g.zoom=this._map.transform.zoom+x.amount,ma(g,x)}if(d.bearing){const x=ga(d.bearing,m,nu);g.bearing=this._map.transform.bearing+l.ac(x.amount,-179,179),ma(g,x)}if(d.pitch){const x=ga(d.pitch,m,su);g.pitch=this._map.transform.pitch+x.amount,ma(g,x)}if(g.zoom||g.bearing){const x=d.pinchAround===void 0?d.around:d.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function ma(b,r){(!b.duration||b.duration<r.duration)&&(b.duration=r.duration,b.easing=r.easing)}function ga(b,r,d){const{maxSpeed:m,linearity:g,deceleration:x}=d,M=l.ac(b*g/(r/1e3),-m,m),P=Math.abs(M)/(x*g);return{easing:d.easing,duration:1e3*P,amount:M*(P/2)}}class Pn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,m,g={}){const x=S.mousePos(d.getCanvas(),m),M=d.unproject(x);super(r,l.e({point:x,lngLat:M,originalEvent:m},g)),this._defaultPrevented=!1,this.target=d}}class Ro extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,m){const g=r==="touchend"?m.changedTouches:m.touches,x=S.touchPos(d.getCanvasContainer(),g),M=x.map(A=>d.unproject(A)),P=x.reduce((A,D,B,O)=>A.add(D.div(O.length)),new l.P(0,0));super(r,{points:x,point:P,lngLats:M,lngLat:d.unproject(P),originalEvent:m}),this._defaultPrevented=!1}}class Bs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class hr{constructor(r,d){this._map=r,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Bs(r.type,this._map,r))}mousedown(r,d){return this._mousedownPos=d,this._firePreventable(new Pn(r.type,this._map,r))}mouseup(r){this._map.fire(new Pn(r.type,this._map,r))}click(r,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Pn(r.type,this._map,r))}dblclick(r){return this._firePreventable(new Pn(r.type,this._map,r))}mouseover(r){this._map.fire(new Pn(r.type,this._map,r))}mouseout(r){this._map.fire(new Pn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ro(r.type,this._map,r))}touchmove(r){this._map.fire(new Ro(r.type,this._map,r))}touchend(r){this._map.fire(new Ro(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ro(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ou{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Pn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new Pn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ss{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(l.P.convert(r),this._map.terrain)}}class Fo{constructor(r,d){this._map=r,this._tr=new ss(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,d){this.isEnabled()&&r.shiftKey&&r.button===0&&(S.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(r,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=m,this._box||(this._box=S.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const x=Math.min(g.x,m.x),M=Math.max(g.x,m.x),P=Math.min(g.y,m.y),A=Math.max(g.y,m.y);S.setTransform(this._box,`translate(${x}px,${P}px)`),this._box.style.width=M-x+"px",this._box.style.height=A-P+"px"}mouseupWindow(r,d){if(!this._active||r.button!==0)return;const m=this._startPos,g=d;if(this.reset(),S.suppressClick(),m.x!==g.x||m.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(m,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(S.remove(this._box),this._box=null),S.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,d){return this._map.fire(new l.k(r,{originalEvent:d}))}}function lc(b,r){if(b.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${r.length}`);const d={};for(let m=0;m<b.length;m++)d[b[m].identifier]=r[m];return d}class uf{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(g){const x=new l.P(0,0);for(const M of g)x._add(M);return x.div(g.length)}(d),this.touches=lc(m,d)))}touchmove(r,d,m){if(this.aborted||!this.centroid)return;const g=lc(m,d);for(const x in this.touches){const M=g[x];(!M||M.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,d,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class cc{constructor(r){this.singleTap=new uf(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,d,m){this.singleTap.touchstart(r,d,m)}touchmove(r,d,m){this.singleTap.touchmove(r,d,m)}touchend(r,d,m){const g=this.singleTap.touchend(r,d,m);if(g){const x=r.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(g)<30;if(x&&M||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class au{constructor(r){this._tr=new ss(r),this._zoomIn=new cc({numTouches:1,numTaps:2}),this._zoomOut=new cc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,d,m){this._zoomIn.touchstart(r,d,m),this._zoomOut.touchstart(r,d,m)}touchmove(r,d,m){this._zoomIn.touchmove(r,d,m),this._zoomOut.touchmove(r,d,m)}touchend(r,d,m){const g=this._zoomIn.touchend(r,d,m),x=this._zoomOut.touchend(r,d,m),M=this._tr;return g?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(g)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class br{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const d=this._moveFunction(...r);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(r,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const g=d.length?d[0]:d;return!this._moved&&g.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(m,g))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&S.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Dr={0:1,2:2};class dt{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const d=S.mouseButton(r);this._eventButton=d}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(d,m){const g=Dr[m];return d.buttons===void 0||(d.buttons&g)!==g}(r,this._eventButton)}isValidEndEvent(r){return S.mouseButton(r)===this._eventButton}}class hc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const Yr=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=function(r){r.preventDefault()}},Bo=({enable:b,clickTolerance:r,bearingDegreesPerPixelMoved:d=.8})=>{const m=new dt({checkCorrectEvent:g=>S.mouseButton(g)===0&&g.ctrlKey||S.mouseButton(g)===2});return new br({clickTolerance:r,move:(g,x)=>({bearingDelta:(x.x-g.x)*d}),moveStateManager:m,enable:b,assignEvents:Yr})},uc=({enable:b,clickTolerance:r,pitchDegreesPerPixelMoved:d=-.5})=>{const m=new dt({checkCorrectEvent:g=>S.mouseButton(g)===0&&g.ctrlKey||S.mouseButton(g)===2});return new br({clickTolerance:r,move:(g,x)=>({pitchDelta:(x.y-g.y)*d}),moveStateManager:m,enable:b,assignEvents:Yr})};class at{constructor(r,d){this._clickTolerance=r.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(r,d,m){return this._calculateTransform(r,d,m)}touchmove(r,d,m){if(this._active&&!(m.length<this.minTouchs()))return r.preventDefault(),this._calculateTransform(r,d,m)}touchend(r,d,m){this._calculateTransform(r,d,m),this._active&&m.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,d,m){m.length>0&&(this._active=!0);const g=lc(m,d),x=new l.P(0,0),M=new l.P(0,0);let P=0;for(const D in g){const B=g[D],O=this._touches[D];O&&(x._add(B),M._add(B.sub(O)),P++,g[D]=B)}if(this._touches=g,P<this.minTouchs()||!M.mag())return;const A=M.div(P);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(P),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _a{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(r,d,m){if(!this._firstTwoTouches)return;r.preventDefault();const[g,x]=this._firstTwoTouches,M=ol(m,d,g),P=ol(m,d,x);if(!M||!P)return;const A=this._aroundCenter?null:M.add(P).div(2);return this._move([M,P],A,r)}touchend(r,d,m){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,M=ol(m,d,g),P=ol(m,d,x);M&&P||(this._active&&S.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ol(b,r,d){for(let m=0;m<b.length;m++)if(b[m].identifier===d)return r[m]}function lu(b,r){return Math.log(b/r)/Math.LN2}class al extends _a{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,d){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(lu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lu(this._distance,m),pinchAround:d}}}function dc(b,r){return 180*b.angleWith(r)/Math.PI}class fc extends _a{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,d,m){const g=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dc(this._vector,g),pinchAround:d}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const d=25/(Math.PI*this._minDiameter)*360,m=dc(r,this._startVector);return Math.abs(m)<d}}function pc(b){return Math.abs(b.y)>Math.abs(b.x)}class cu extends _a{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,d,m){super.touchstart(r,d,m),this._currentTouchCount=m.length}_start(r){this._lastPoints=r,pc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,d,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=r[0].sub(this._lastPoints[0]),x=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,x,m.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(r,d,m){if(this._valid!==void 0)return this._valid;const g=r.mag()>=2,x=d.mag()>=2;if(!g&&!x)return;if(!g||!x)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const M=r.y>0==d.y>0;return pc(r)&&pc(d)&&M}}const Jr={panStep:100,bearingStep:15,pitchStep:10};class Pi{constructor(r){this._tr=new ss(r);const d=Jr;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let d=0,m=0,g=0,x=0,M=0;switch(r.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?g=1:(r.preventDefault(),M=-1);break;case 40:r.shiftKey?g=-1:(r.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(m=0,g=0),{cameraAnimation:P=>{const A=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:ll,zoom:d?Math.round(A.zoom)+d*(r.shiftKey?2:1):A.zoom,bearing:A.bearing+m*this._bearingStep,pitch:A.pitch+g*this._pitchStep,offset:[-x*this._panStep,-M*this._panStep],center:A.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ll(b){return b*(2-b)}const cl=4.000244140625;class mc{constructor(r,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=r,this._tr=new ss(r),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!r[this._map.cooperativeGestures._bypassKey])return;let d=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=C.now(),g=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%cl==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),r.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=r,this._delta-=d,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=S.mousePos(this._map.getCanvas(),r),m=this._tr;this._around=d.y>m.transform.height/2-m.transform.getHorizon()?l.M.convert(this._aroundCenter?m.center:m.unproject(d)):l.M.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>cl?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&A!==0&&(A=1/A);const D=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(D*A))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,m=this._startZoom,g=this._easing;let x,M=!1;if(this._type==="wheel"&&m&&g){const P=Math.min((C.now()-this._lastWheelEventTime)/200,1),A=g(P);x=l.z.number(m,d,A),P<1?this._frameId||(this._frameId=!0):M=!0}else x=d,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:x-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let d=l.b7;if(this._prevEase){const m=this._prevEase,g=(C.now()-m.start)/m.duration,x=m.easing(g+.01)-m.easing(g),M=.27/Math.sqrt(x*x+1e-4)*.01,P=Math.sqrt(.0729-M*M);d=l.b6(M,P,.25,1)}return this._prevEase={start:C.now(),duration:r,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class gc{constructor(r,d){this._clickZoom=r,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hu{constructor(r){this._tr=new ss(r),this.reset()}reset(){this._active=!1}dblclick(r,d){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class df{constructor(){this._tap=new cc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,d,m){if(!this._swipePoint)if(this._tapTime){const g=d[0],x=r.timeStamp-this._tapTime<500,M=this._tapPoint.dist(g)<30;x&&M?m.length>0&&(this._swipePoint=g,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(r,d,m)}touchmove(r,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const g=d[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,d,m)}touchend(r,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const g=this._tap.touchend(r,d,m);g&&(this._tapTime=r.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $s{constructor(r,d,m){this._el=r,this._mousePan=d,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ya{constructor(r,d,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=d,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bt{constructor(r,d,m,g){this._el=r,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ct{constructor(r,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=S.create("div","maplibregl-cooperative-gesture-screen",r);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=d,this._container.appendChild(g);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=m,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(S.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(r){this._onCooperativeGesture(r.touches.length===1)}wheel(r){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!r[this._bypassKey])}_onCooperativeGesture(r){this._enabled&&r&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Qr=b=>b.zoom||b.drag||b.pitch||b.rotate;class _c extends l.k{}function ba(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class rs{constructor(r,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,x)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=g.type==="renderFrame"?void 0:g,P={needsRenderFrame:!1},A={},D={},B=g.touches,O=B?this._getMapTouches(B):void 0,Z=O?S.touchPos(this._map.getCanvas(),O):S.mousePos(this._map.getCanvas(),g);for(const{handlerName:se,handler:K,allowed:fe}of this._handlers){if(!K.isEnabled())continue;let Te;this._blockedByActive(D,fe,se)?K.reset():K[x||g.type]&&(Te=K[x||g.type](g,Z,O),this.mergeHandlerResult(P,A,Te,se,M),Te&&Te.needsRenderFrame&&this._triggerRenderFrame()),(Te||K.isActive())&&(D[se]=K)}const te={};for(const se in this._previousActiveHandlers)D[se]||(te[se]=M);this._previousActiveHandlers=D,(Object.keys(te).length||ba(P))&&(this._changes.push([P,A,te]),this._triggerRenderFrame()),(Object.keys(D).length||ba(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=P;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ru(r),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,M]of this._listeners)S.addEventListener(g,x,g===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[r,d,m]of this._listeners)S.removeEventListener(r,d,r===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new hr(d,r));const g=d.boxZoom=new Fo(d,r);this._add("boxZoom",g),r.interactive&&r.boxZoom&&g.enable();const x=d.cooperativeGestures=new Ct(d,r.cooperativeGestures);this._add("cooperativeGestures",x),r.cooperativeGestures&&x.enable();const M=new au(d),P=new hu(d);d.doubleClickZoom=new gc(P,M),this._add("tapZoom",M),this._add("clickZoom",P),r.interactive&&r.doubleClickZoom&&d.doubleClickZoom.enable();const A=new df;this._add("tapDragZoom",A);const D=d.touchPitch=new cu(d);this._add("touchPitch",D),r.interactive&&r.touchPitch&&d.touchPitch.enable(r.touchPitch);const B=Bo(r),O=uc(r);d.dragRotate=new ya(r,B,O),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]),r.interactive&&r.dragRotate&&d.dragRotate.enable();const Z=(({enable:Te,clickTolerance:oe})=>{const ye=new dt({checkCorrectEvent:Me=>S.mouseButton(Me)===0&&!Me.ctrlKey});return new br({clickTolerance:oe,move:(Me,Pe)=>({around:Pe,panDelta:Pe.sub(Me)}),activateOnStart:!0,moveStateManager:ye,enable:Te,assignEvents:Yr})})(r),te=new at(r,d);d.dragPan=new $s(m,Z,te),this._add("mousePan",Z),this._add("touchPan",te,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&d.dragPan.enable(r.dragPan);const ee=new fc,se=new al;d.touchZoomRotate=new bt(m,se,ee,A),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&d.touchZoomRotate.enable(r.touchZoomRotate);const K=d.scrollZoom=new mc(d,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),r.interactive&&r.scrollZoom&&d.scrollZoom.enable(r.scrollZoom);const fe=d.keyboard=new Pi(d);this._add("keyboard",fe),r.interactive&&r.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new ou(d))}_add(r,d,m){this._handlers.push({handlerName:r,handler:d,allowed:m}),this._handlersById[r]=d}stop(r){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qr(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,d,m){for(const g in r)if(g!==m&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(r){const d=[];for(const m of r)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(r,d,m,g,x){if(!m)return;l.e(r,m);const M={handlerName:g,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(d.zoom=M),m.panDelta!==void 0&&(d.drag=M),m.pitchDelta!==void 0&&(d.pitch=M),m.bearingDelta!==void 0&&(d.rotate=M)}_applyChanges(){const r={},d={},m={};for(const[g,x,M]of this._changes)g.panDelta&&(r.panDelta=(r.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(r.around=g.around),g.pinchAround!==void 0&&(r.pinchAround=g.pinchAround),g.noInertia&&(r.noInertia=g.noInertia),l.e(d,x),l.e(m,M);this._updateMapTransform(r,d,m),this._changes=[]}_updateMapTransform(r,d,m){const g=this._map,x=g._getTransformForUpdate(),M=g.terrain;if(!(ba(r)||M&&this._terrainMovement))return this._fireEvents(d,m,!0);let{panDelta:P,zoomDelta:A,bearingDelta:D,pitchDelta:B,around:O,pinchAround:Z}=r;Z!==void 0&&(O=Z),g._stop(!0),O=O||g.transform.centerPoint;const te=x.pointLocation(P?O.sub(P):O);D&&(x.bearing+=D),B&&(x.pitch+=B),A&&(x.zoom+=A),M?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?x.center=x.pointLocation(x.centerPoint.sub(P)):x.setLocationAtPoint(te,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,x.setLocationAtPoint(te,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,x.recalculateZoom(g.terrain)})):x.setLocationAtPoint(te,O),g._applyUpdatedTransform(x),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(d,m,!0)}_fireEvents(r,d,m){const g=Qr(this._eventsInProgress),x=Qr(r),M={};for(const B in r){const{originalEvent:O}=r[B];this._eventsInProgress[B]||(M[`${B}start`]=O),this._eventsInProgress[B]=r[B]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const B in M)this._fireEvent(B,M[B]);x&&this._fireEvent("move",x.originalEvent);for(const B in r){const{originalEvent:O}=r[B];this._fireEvent(B,O)}const P={};let A;for(const B in this._eventsInProgress){const{handlerName:O,originalEvent:Z}=this._eventsInProgress[B];this._handlersById[O].isActive()||(delete this._eventsInProgress[B],A=d[O]||Z,P[`${B}end`]=A)}for(const B in P)this._fireEvent(B,P[B]);const D=Qr(this._eventsInProgress);if(m&&(g||x)&&!D){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!B||!B.essential&&C.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:A})),O(this._map.getBearing())&&this._map.resetNorth()):(O(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(r,d){this._map.fire(new l.k(r,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new _c("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class uu extends l.E{constructor(r,d){super(),this._renderFrameCallback=()=>{const m=Math.min((C.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(r,d){return this.jumpTo({center:r},d)}panBy(r,d,m){return r=l.P.convert(r).mult(-1),this.panTo(this.transform.center,l.e({offset:r},d),m)}panTo(r,d,m){return this.easeTo(l.e({center:r},d),m)}getZoom(){return this.transform.zoom}setZoom(r,d){return this.jumpTo({zoom:r},d),this}zoomTo(r,d,m){return this.easeTo(l.e({zoom:r},d),m)}zoomIn(r,d){return this.zoomTo(this.getZoom()+1,r,d),this}zoomOut(r,d){return this.zoomTo(this.getZoom()-1,r,d),this}getBearing(){return this.transform.bearing}setBearing(r,d){return this.jumpTo({bearing:r},d),this}getPadding(){return this.transform.padding}setPadding(r,d){return this.jumpTo({padding:r},d),this}rotateTo(r,d,m){return this.easeTo(l.e({bearing:r},d),m)}resetNorth(r,d){return this.rotateTo(0,l.e({duration:1e3},r),d),this}resetNorthPitch(r,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},r),d),this}snapToNorth(r,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,d):this}getPitch(){return this.transform.pitch}setPitch(r,d){return this.jumpTo({pitch:r},d),this}cameraForBounds(r,d){r=Fi.convert(r);const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,d)}_cameraForBoxAndBearing(r,d,m,g){const x={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const ut=g.padding;g.padding={top:ut,bottom:ut,right:ut,left:ut}}g.padding=l.e(x,g.padding);const M=this.transform,P=M.padding,A=new Fi(r,d),D=M.project(A.getNorthWest()),B=M.project(A.getNorthEast()),O=M.project(A.getSouthEast()),Z=M.project(A.getSouthWest()),te=l.b8(-m),ee=D.rotate(te),se=B.rotate(te),K=O.rotate(te),fe=Z.rotate(te),Te=new l.P(Math.max(ee.x,se.x,fe.x,K.x),Math.max(ee.y,se.y,fe.y,K.y)),oe=new l.P(Math.min(ee.x,se.x,fe.x,K.x),Math.min(ee.y,se.y,fe.y,K.y)),ye=Te.sub(oe),Me=(M.width-(P.left+P.right+g.padding.left+g.padding.right))/ye.x,Pe=(M.height-(P.top+P.bottom+g.padding.top+g.padding.bottom))/ye.y;if(Pe<0||Me<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ze=Math.min(M.scaleZoom(M.scale*Math.min(Me,Pe)),g.maxZoom),$e=l.P.convert(g.offset),He=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(l.b8(m)),Ze=$e.add(He).mult(M.scale/M.zoomScale(ze));return{center:M.unproject(D.add(O).div(2).sub(Ze)),zoom:ze,bearing:m}}fitBounds(r,d,m){return this._fitInternal(this.cameraForBounds(r,d),d,m)}fitScreenCoordinates(r,d,m,g,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(r)),this.transform.pointLocation(l.P.convert(d)),m,g),g,x)}_fitInternal(r,d,m){return r?(delete(d=l.e(r,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(r,d){this.stop();const m=this._getTransformForUpdate();let g=!1,x=!1,M=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(g=!0,m.zoom=+r.zoom),r.center!==void 0&&(m.center=l.M.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(x=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(M=!0,m.pitch=+r.pitch),r.padding==null||m.isPaddingEqual(r.padding)||(m.padding=r.padding),this._applyUpdatedTransform(m),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),g&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),x&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),M&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(r,d,m,g=0){const x=l.Y.fromLngLat(r,d),M=l.Y.fromLngLat(m,g),P=M.x-x.x,A=M.y-x.y,D=M.z-x.z,B=Math.hypot(P,A,D);if(B===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(P,A),Z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/B/this.transform.tileSize),te=180*Math.atan2(P,-A)/Math.PI;let ee=180*Math.acos(O/B)/Math.PI;return ee=D<0?90-ee:90+ee,{center:M.toLngLat(),zoom:Z,pitch:ee,bearing:te}}easeTo(r,d){var m;this._stop(!1,r.easeId),((r=l.e({offset:[0,0],duration:500,easing:l.b7},r)).animate===!1||!r.essential&&C.prefersReducedMotion)&&(r.duration=0);const g=this._getTransformForUpdate(),x=this.getZoom(),M=this.getBearing(),P=this.getPitch(),A=this.getPadding(),D="bearing"in r?this._normalizeBearing(r.bearing,M):M,B="pitch"in r?+r.pitch:P,O="padding"in r?r.padding:g.padding,Z=l.P.convert(r.offset);let te=g.centerPoint.add(Z);const ee=g.pointLocation(te),{center:se,zoom:K}=g.getConstrained(l.M.convert(r.center||ee),(m=r.zoom)!==null&&m!==void 0?m:x);this._normalizeCenter(se);const fe=g.project(ee),Te=g.project(se).sub(fe),oe=g.zoomScale(K-x);let ye,Me;r.around&&(ye=l.M.convert(r.around),Me=g.locationPoint(ye));const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==x,this._rotating=this._rotating||M!==D,this._pitching=this._pitching||B!==P,this._padding=!g.isPaddingEqual(O),this._easeId=r.easeId,this._prepareEase(d,r.noMoveStart,Pe),this.terrain&&this._prepareElevation(se),this._ease(ze=>{if(this._zooming&&(g.zoom=l.z.number(x,K,ze)),this._rotating&&(g.bearing=l.z.number(M,D,ze)),this._pitching&&(g.pitch=l.z.number(P,B,ze)),this._padding&&(g.interpolatePadding(A,O,ze),te=g.centerPoint.add(Z)),this.terrain&&!r.freezeElevation&&this._updateElevation(ze),ye)g.setLocationAtPoint(ye,Me);else{const $e=g.zoomScale(g.zoom-x),He=K>x?Math.min(2,oe):Math.max(.5,oe),Ze=Math.pow(He,1-ze),ut=g.unproject(fe.add(Te.mult(ze*Ze)).mult($e));g.setLocationAtPoint(g.renderWorldCopies?ut.wrap():ut,te)}this._applyUpdatedTransform(g),this._fireMoveEvents(d)},ze=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,ze)},r),this}_prepareEase(r,d,m={}){this._moving=!0,d||m.moving||this.fire(new l.k("movestart",r)),this._zooming&&!m.zooming&&this.fire(new l.k("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new l.k("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new l.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(m-(d-(m*r+this._elevationStart))/(1-r)),this._elevationTarget=d}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const d=r.clone(),{center:m,zoom:g,pitch:x,bearing:M,elevation:P}=this.transformCameraUpdate(d);m&&(d.center=m),g!==void 0&&(d.zoom=g),x!==void 0&&(d.pitch=x),M!==void 0&&(d.bearing=M),P!==void 0&&(d.elevation=P),this.transform.apply(d)}_fireMoveEvents(r){this.fire(new l.k("move",r)),this._zooming&&this.fire(new l.k("zoom",r)),this._rotating&&this.fire(new l.k("rotate",r)),this._pitching&&this.fire(new l.k("pitch",r))}_afterEase(r,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,g=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.k("zoomend",r)),g&&this.fire(new l.k("rotateend",r)),x&&this.fire(new l.k("pitchend",r)),this.fire(new l.k("moveend",r))}flyTo(r,d){var m;if(!r.essential&&C.prefersReducedMotion){const Wt=l.L(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Wt,d)}this.stop(),r=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},r);const g=this._getTransformForUpdate(),x=this.getZoom(),M=this.getBearing(),P=this.getPitch(),A=this.getPadding(),D="bearing"in r?this._normalizeBearing(r.bearing,M):M,B="pitch"in r?+r.pitch:P,O="padding"in r?r.padding:g.padding,Z=l.P.convert(r.offset);let te=g.centerPoint.add(Z);const ee=g.pointLocation(te),{center:se,zoom:K}=g.getConstrained(l.M.convert(r.center||ee),(m=r.zoom)!==null&&m!==void 0?m:x);this._normalizeCenter(se);const fe=g.zoomScale(K-x),Te=g.project(ee),oe=g.project(se).sub(Te);let ye=r.curve;const Me=Math.max(g.width,g.height),Pe=Me/fe,ze=oe.mag();if("minZoom"in r){const Wt=l.ac(Math.min(r.minZoom,x,K),g.minZoom,g.maxZoom),zt=Me/g.zoomScale(Wt-x);ye=Math.sqrt(zt/ze*2)}const $e=ye*ye;function He(Wt){const zt=(Pe*Pe-Me*Me+(Wt?-1:1)*$e*$e*ze*ze)/(2*(Wt?Pe:Me)*$e*ze);return Math.log(Math.sqrt(zt*zt+1)-zt)}function Ze(Wt){return(Math.exp(Wt)-Math.exp(-Wt))/2}function ut(Wt){return(Math.exp(Wt)+Math.exp(-Wt))/2}const Rt=He(!1);let tt=function(Wt){return ut(Rt)/ut(Rt+ye*Wt)},Pt=function(Wt){return Me*((ut(Rt)*(Ze(zt=Rt+ye*Wt)/ut(zt))-Ze(Rt))/$e)/ze;var zt},Bt=(He(!0)-Rt)/ye;if(Math.abs(ze)<1e-6||!isFinite(Bt)){if(Math.abs(Me-Pe)<1e-6)return this.easeTo(r,d);const Wt=Pe<Me?-1:1;Bt=Math.abs(Math.log(Pe/Me))/ye,Pt=function(){return 0},tt=function(zt){return Math.exp(Wt*ye*zt)}}return r.duration="duration"in r?+r.duration:1e3*Bt/("screenSpeed"in r?+r.screenSpeed/ye:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=M!==D,this._pitching=B!==P,this._padding=!g.isPaddingEqual(O),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(se),this._ease(Wt=>{const zt=Wt*Bt,Ot=1/tt(zt);g.zoom=Wt===1?K:x+g.scaleZoom(Ot),this._rotating&&(g.bearing=l.z.number(M,D,Wt)),this._pitching&&(g.pitch=l.z.number(P,B,Wt)),this._padding&&(g.interpolatePadding(A,O,Wt),te=g.centerPoint.add(Z)),this.terrain&&!r.freezeElevation&&this._updateElevation(Wt);const Vt=Wt===1?se:g.unproject(Te.add(oe.mult(Pt(zt))).mult(Ot));g.setLocationAtPoint(g.renderWorldCopies?Vt.wrap():Vt,te),this._applyUpdatedTransform(g),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,d,m){m.animate===!1||m.duration===0?(r(1),d()):(this._easeStart=C.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,d){r=l.b1(r,-180,180);const m=Math.abs(r-d);return Math.abs(r-360-d)<m&&(r-=360),Math.abs(r+360-d)<m&&(r+=360),r}_normalizeCenter(r){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const m=r.lng-d.center.lng;r.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}const Gs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class du{constructor(r=Gs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=S.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=S.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=S.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){S.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,d){const m=this._map._getUIString(`AttributionControl.${d}`);r.title=m,r.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const x=d[g];if(x.used||x.usedForTerrain){const M=x.getSource();M.attribution&&r.indexOf(M.attribution)<0&&r.push(M.attribution)}}r=r.filter(g=>String(g).trim()),r.sort((g,x)=>g.length-x.length),r=r.filter((g,x)=>{for(let M=x+1;M<r.length;M++)if(r[M].indexOf(g)>=0)return!1;return!0});const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Oo{constructor(r={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=S.create("div","maplibregl-ctrl");const d=S.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){S.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Zi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const d=++this._id;return this._queue.push({callback:r,id:d,cancelled:!1}),d}remove(r){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const g of m)if(g.id===r)return void(g.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var on=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class fu extends l.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,d){this.sourceCache.update(r,d),this._renderableTilesKeys=[];const m={};for(const g of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))m[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aN(g.posMatrix,0,l.W,0,l.W,0,1),this._tiles[g.key]=new ln(g,this.tileSize));for(const g in this._tiles)m[g]||delete this._tiles[g]}freeRtt(r){for(const d in this._tiles){const m=this._tiles[d];(!r||m.tileID.equals(r)||m.tileID.isChildOf(r)||r.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const d={};for(const m of this._renderableTilesKeys){const g=this._tiles[m].tileID;if(g.canonical.equals(r.canonical)){const x=r.clone();x.posMatrix=new Float64Array(16),l.aN(x.posMatrix,0,l.W,0,l.W,0,1),d[m]=x}else if(g.canonical.isChildOf(r.canonical)){const x=r.clone();x.posMatrix=new Float64Array(16);const M=g.canonical.z-r.canonical.z,P=g.canonical.x-(g.canonical.x>>M<<M),A=g.canonical.y-(g.canonical.y>>M<<M),D=l.W>>M;l.aN(x.posMatrix,0,D,0,D,0,1),l.H(x.posMatrix,x.posMatrix,[-P*D,-A*D,0]),d[m]=x}else if(r.canonical.isChildOf(g.canonical)){const x=r.clone();x.posMatrix=new Float64Array(16);const M=r.canonical.z-g.canonical.z,P=r.canonical.x-(r.canonical.x>>M<<M),A=r.canonical.y-(r.canonical.y>>M<<M),D=l.W>>M;l.aN(x.posMatrix,0,l.W,0,l.W,0,1),l.H(x.posMatrix,x.posMatrix,[P*D,A*D,0]),l.J(x.posMatrix,x.posMatrix,[1/2**M,1/2**M,0]),d[m]=x}}return d}getSourceTile(r,d){const m=this.sourceCache._source;let g=r.overscaledZ-this.deltaZoom;if(g>m.maxzoom&&(g=m.maxzoom),g<m.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(g).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!x||!x.dem)&&d)for(;g>=m.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(r.scaledTo(g--).key);return x}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=r)}}class xa{constructor(r,d,m){this.painter=r,this.sourceCache=new fu(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,d,m,g=l.W){var x;if(!(d>=0&&d<g&&m>=0&&m<g))return 0;const M=this.getTerrainData(r),P=(x=M.tile)===null||x===void 0?void 0:x.dem;if(!P)return 0;const A=function(ee,se,K){var fe=se[0],Te=se[1];return ee[0]=K[0]*fe+K[4]*Te+K[12],ee[1]=K[1]*fe+K[5]*Te+K[13],ee}([],[d/g*l.W,m/g*l.W],M.u_terrain_matrix),D=[A[0]*P.dim,A[1]*P.dim],B=Math.floor(D[0]),O=Math.floor(D[1]),Z=D[0]-B,te=D[1]-O;return P.get(B,O)*(1-Z)*(1-te)+P.get(B+1,O)*Z*(1-te)+P.get(B,O+1)*(1-Z)*te+P.get(B+1,O+1)*Z*te}getElevationForLngLatZoom(r,d){const{tileID:m,mercatorX:g,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(r,d);return this.getElevation(m,g%l.W,x%l.W,l.W)}getElevation(r,d,m,g=l.W){return this.getDEMElevation(r,d,m,g)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const g=this.painter.context,x=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new We(g,x,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new We(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(r,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new We(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+r.key;if(m&&!this._demMatrixCache[m]){const g=this.sourceCache.sourceCache._source.maxzoom;let x=r.canonical.z-d.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=g?x=r.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=r.canonical.x-(r.canonical.x>>x<<x),P=r.canonical.y-(r.canonical.y>>x<<x),A=l.b9(new Float64Array(16),[1/(l.W<<x),1/(l.W<<x),0]);l.H(A,A,[M*l.W,P*l.W,0]),this._demMatrixCache[r.key]={matrix:A,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(r){const d=this.painter,m=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new We(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new We(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,g))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,M=0;x<this._coordsTextureSize;x++)for(let P=0;P<this._coordsTextureSize;P++,M+=4)d[M+0]=255&P,d[M+1]=255&x,d[M+2]=P>>8<<4|x>>8,d[M+3]=0;const m=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new We(r,m,r.gl.RGBA,{premultiply:!1});return g.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),m=this.painter.context,g=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const x=d[0]+(d[2]>>4<<8),M=d[1]+((15&d[2])<<8),P=this.coordsIndex[255-d[3]],A=P&&this.sourceCache.getTileByID(P);if(!A)return null;const D=this._coordsTextureSize,B=(1<<A.tileID.canonical.z)*D;return new l.Y((A.tileID.canonical.x*D+x)/B+A.tileID.wrap,(A.tileID.canonical.y*D+M)/B,this.getElevation(A.tileID,x,M,D))}depthAtPoint(r){const d=new Uint8Array(4),m=this.painter.context,g=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,d=new l.ba,m=new l.aX,g=this.meshSize,x=l.W/g,M=g*g;for(let O=0;O<=g;O++)for(let Z=0;Z<=g;Z++)d.emplaceBack(Z*x,O*x,0);for(let O=0;O<M;O+=g+1)for(let Z=0;Z<g;Z++)m.emplaceBack(Z+O,g+Z+O+1,g+Z+O+2),m.emplaceBack(Z+O,g+Z+O+2,Z+O+1);const P=d.length,A=P+2*(g+1);for(const O of[0,1])for(let Z=0;Z<=g;Z++)for(const te of[0,1])d.emplaceBack(Z*x,O*l.W,te);for(let O=0;O<2*g;O+=2)m.emplaceBack(A+O,A+O+1,A+O+3),m.emplaceBack(A+O,A+O+3,A+O+2),m.emplaceBack(P+O,P+O+3,P+O+1),m.emplaceBack(P+O,P+O+2,P+O+3);const D=d.length,B=D+2*(g+1);for(const O of[0,1])for(let Z=0;Z<=g;Z++)for(const te of[0,1])d.emplaceBack(O*l.W,Z*x,te);for(let O=0;O<2*g;O+=2)m.emplaceBack(D+O,D+O+1,D+O+3),m.emplaceBack(D+O,D+O+3,D+O+2),m.emplaceBack(B+O,B+O+3,B+O+1),m.emplaceBack(B+O,B+O+2,B+O+3);return this._mesh={indexBuffer:r.createIndexBuffer(m),vertexBuffer:r.createVertexBuffer(d,on.members),segments:l.$.simpleSegment(0,0,d.length,m.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*l.bb/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,d){var m;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(r,d);return(m=this.getMinMaxElevation(g).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(r){const d=this.getTerrainData(r).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(r,d){const m=l.Y.fromLngLat(r.wrap()),g=(1<<d)*l.W,x=m.x*g,M=m.y*g,P=Math.floor(x/l.W),A=Math.floor(M/l.W);return{tileID:new l.Q(d,0,d,P,A),mercatorX:x,mercatorY:M}}}class hl{constructor(r,d,m){this._context=r,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new We(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:r,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>r.id!==d),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Lr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class yc{constructor(r,d){this.painter=r,this.terrain=d,this.pool=new hl(r.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(m=>!r._layers[m].isHidden(d)),this._coordsDescendingInv={};for(const m in r.sourceCaches){this._coordsDescendingInv[m]={};const g=r.sourceCaches[m].getVisibleCoordinates();for(const x of g){const M=this.terrain.sourceCache.getTerrainCoords(x);for(const P in M)this._coordsDescendingInv[m][P]||(this._coordsDescendingInv[m][P]=[]),this._coordsDescendingInv[m][P].push(M[P])}}this._coordsDescendingInvStr={};for(const m of r._order){const g=r._layers[m],x=g.source;if(Lr[g.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const M in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][M]=this._coordsDescendingInv[x][M].map(P=>P.key).sort().join()}}for(const m of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[g][m.tileID.key];x&&x!==m.rttCoords[g]&&(m.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const d=r.type,m=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Lr[d]&&(this._prevType&&Lr[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(r.id),!g))return!0;if(Lr[this._prevType]||Lr[d]&&g){this._prevType=d;const x=this._stacks.length-1,M=this._stacks[x]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(sc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[x]){const D=this.pool.getObjectForId(P.rtt[x].id);if(D.stamp===P.rtt[x].stamp){this.pool.useObject(D);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),P.rtt[x]={id:A.id,stamp:A.stamp},m.context.bindFramebuffer.set(A.fbo.framebuffer),m.context.clear({color:l.aO.transparent,stencil:0}),m.currentStencilSource=void 0;for(let D=0;D<M.length;D++){const B=m.style._layers[M[D]],O=B.source?this._coordsDescendingInv[B.source][P.tileID.key]:[P.tileID];m.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),m._renderTileClippingMasks(B,O),m.renderLayer(m,m.style.sourceCaches[B.source],B,O),B.source&&(P.rttCoords[B.source]=this._coordsDescendingInvStr[B.source][P.tileID.key])}}return sc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Lr[d]}return!1}}const bc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},va=p,xc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Gs,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ul=b=>{b.touchstart=b.dragStart,b.touchmoveWindow=b.dragMove,b.touchend=b.dragEnd},vc={showCompass:!0,showZoom:!0,visualizePitch:!1};class wc{constructor(r,d,m=!1){this.mousedown=M=>{this.startMouse(l.e({},M,{ctrlKey:!0,preventDefault:()=>M.preventDefault()}),S.mousePos(this.element,M)),S.addEventListener(window,"mousemove",this.mousemove),S.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=M=>{this.moveMouse(M,S.mousePos(this.element,M))},this.mouseup=M=>{this.mouseRotate.dragEnd(M),this.mousePitch&&this.mousePitch.dragEnd(M),this.offTemp()},this.touchstart=M=>{M.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=S.touchPos(this.element,M.targetTouches)[0],this.startTouch(M,this._startPos),S.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.addEventListener(window,"touchend",this.touchend))},this.touchmove=M=>{M.targetTouches.length!==1?this.reset():(this._lastPos=S.touchPos(this.element,M.targetTouches)[0],this.moveTouch(M,this._lastPos))},this.touchend=M=>{M.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=r.dragRotate._mouseRotate.getClickTolerance(),x=r.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Bo({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:M,clickTolerance:P,bearingDegreesPerPixelMoved:A=.8})=>{const D=new hc;return new br({clickTolerance:P,move:(B,O)=>({bearingDelta:(O.x-B.x)*A}),moveStateManager:D,enable:M,assignEvents:ul})})({clickTolerance:g,enable:!0}),this.map=r,m&&(this.mousePitch=uc({clickTolerance:x,enable:!0}),this.touchPitch=(({enable:M,clickTolerance:P,pitchDegreesPerPixelMoved:A=-.5})=>{const D=new hc;return new br({clickTolerance:P,move:(B,O)=>({pitchDelta:(O.y-B.y)*A}),moveStateManager:D,enable:M,assignEvents:ul})})({clickTolerance:x,enable:!0})),S.addEventListener(d,"mousedown",this.mousedown),S.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),S.addEventListener(d,"touchcancel",this.reset)}startMouse(r,d){this.mouseRotate.dragStart(r,d),this.mousePitch&&this.mousePitch.dragStart(r,d),S.disableDrag()}startTouch(r,d){this.touchRotate.dragStart(r,d),this.touchPitch&&this.touchPitch.dragStart(r,d),S.disableDrag()}moveMouse(r,d){const m=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(r,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.mousePitch){const{pitchDelta:x}=this.mousePitch.dragMove(r,d)||{};x&&m.setPitch(m.getPitch()+x)}}moveTouch(r,d){const m=this.map,{bearingDelta:g}=this.touchRotate.dragMove(r,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.touchPitch){const{pitchDelta:x}=this.touchPitch.dragMove(r,d)||{};x&&m.setPitch(m.getPitch()+x)}}off(){const r=this.element;S.removeEventListener(r,"mousedown",this.mousedown),S.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),S.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.removeEventListener(window,"touchend",this.touchend),S.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){S.enableDrag(),S.removeEventListener(window,"mousemove",this.mousemove),S.removeEventListener(window,"mouseup",this.mouseup),S.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.removeEventListener(window,"touchend",this.touchend)}}let xr;function dl(b,r,d){const m=new l.M(b.lng,b.lat);if(b=new l.M(b.lng,b.lat),r){const g=new l.M(b.lng-360,b.lat),x=new l.M(b.lng+360,b.lat),M=d.locationPoint(b).distSqr(r);d.locationPoint(g).distSqr(r)<M?b=g:d.locationPoint(x).distSqr(r)<M&&(b=x)}for(;Math.abs(b.lng-d.center.lng)>180;){const g=d.locationPoint(b);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;b.lng>d.center.lng?b.lng-=360:b.lng+=360}return b.lng!==m.lng&&d.locationPoint(b).y>d.height/2-d.getHorizon()?b:m}const wa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fl(b,r,d){const m=b.classList;for(const g in wa)m.remove(`maplibregl-${d}-anchor-${g}`);m.add(`maplibregl-${d}-anchor-${r}`)}class Vo extends l.E{constructor(r){if(super(),this._onKeyPress=d=>{const m=d.code,g=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,g=this._element;this._popup&&(m===g||g.contains(m))&&this.togglePopup()},this._update=d=>{var m;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?dl(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let M="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?M="rotateX(0deg)":this._pitchAlignment==="map"&&(M=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),S.setTransform(this._element,`${wa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${M} ${x}`),C.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=l.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=S.create("div"),this._element.setAttribute("aria-label","Map marker");const d=S.createNS("http://www.w3.org/2000/svg","svg"),m=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${m}`);const x=S.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const M=S.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const P=S.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const fe of A){const Te=S.createNS("http://www.w3.org/2000/svg","ellipse");Te.setAttributeNS(null,"opacity","0.04"),Te.setAttributeNS(null,"cx","10.5"),Te.setAttributeNS(null,"cy","5.80029008"),Te.setAttributeNS(null,"rx",fe.rx),Te.setAttributeNS(null,"ry",fe.ry),P.appendChild(Te)}const D=S.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const B=S.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(B);const O=S.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const Z=S.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(Z);const te=S.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ee=S.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=S.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const K=S.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),ee.appendChild(se),ee.appendChild(K),M.appendChild(P),M.appendChild(D),M.appendChild(O),M.appendChild(te),M.appendChild(ee),d.appendChild(M),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),fl(this._element,this._anchor,"marker"),r&&r.className)for(const d of r.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),S.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=l.M.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const g=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var d,m;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,x=g.terrain.depthAtPoint(this._pos),M=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,M)-x<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/g.transform._pixelPerMeter,A=Math.sin(g.getPitch()*Math.PI/180)*P,D=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),B=g.transform.lngLatToCameraDepth(this._lngLat,M+A)-D>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&B&&this._popup.remove(),this._element.style.opacity=B?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=l.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,d){return r===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const kc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let No=0,Rr=!1;const Sc={maxWidth:100,unit:"metric"};function pl(b,r,d){const m=d&&d.maxWidth||100,g=b._container.clientHeight/2,x=b.unproject([0,g]),M=b.unproject([m,g]),P=x.distanceTo(M);if(d&&d.unit==="imperial"){const A=3.2808*P;A>5280?eo(r,m,A/5280,b._getUIString("ScaleControl.Miles")):eo(r,m,A,b._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?eo(r,m,P/1852,b._getUIString("ScaleControl.NauticalMiles")):P>=1e3?eo(r,m,P/1e3,b._getUIString("ScaleControl.Kilometers")):eo(r,m,P,b._getUIString("ScaleControl.Meters"))}function eo(b,r,d,m){const g=function(x){const M=Math.pow(10,`${Math.floor(x)}`.length-1);let P=x/M;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(A){const D=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*D)/D}(P),M*P}(d);b.style.width=r*(g/d)+"px",b.innerHTML=`${g}&nbsp;${m}`}const Cc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Tc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mc(b){if(b){if(typeof b=="number"){const r=Math.round(Math.abs(b)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,b),"top-left":new l.P(r,r),"top-right":new l.P(-r,r),bottom:new l.P(0,-b),"bottom-left":new l.P(r,-r),"bottom-right":new l.P(-r,-r),left:new l.P(b,0),right:new l.P(-b,0)}}if(b instanceof l.P||Array.isArray(b)){const r=l.P.convert(b);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:l.P.convert(b.center||[0,0]),top:l.P.convert(b.top||[0,0]),"top-left":l.P.convert(b["top-left"]||[0,0]),"top-right":l.P.convert(b["top-right"]||[0,0]),bottom:l.P.convert(b.bottom||[0,0]),"bottom-left":l.P.convert(b["bottom-left"]||[0,0]),"bottom-right":l.P.convert(b["bottom-right"]||[0,0]),left:l.P.convert(b.left||[0,0]),right:l.P.convert(b.right||[0,0])}}return Mc(new l.P(0,0))}const pu=p;u.AJAXError=l.be,u.Evented=l.E,u.LngLat=l.M,u.MercatorCoordinate=l.Y,u.Point=l.P,u.addProtocol=l.bf,u.config=l.a,u.removeProtocol=l.bg,u.AttributionControl=du,u.BoxZoomHandler=Fo,u.CanvasSource=is,u.CooperativeGesturesHandler=Ct,u.DoubleClickZoomHandler=gc,u.DragPanHandler=$s,u.DragRotateHandler=ya,u.EdgeInsets=pa,u.FullscreenControl=class extends l.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var r;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=d==null?void 0:d.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){S.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=S.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);S.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Ut,u.GeolocateControl=class extends l.E{constructor(b){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const d=new l.M(r.coords.longitude,r.coords.latitude),m=r.coords.accuracy,g=this._map.getBearing(),x=l.e({bearing:g},this.options.fitBoundsOptions),M=Fi.fromLngLat(d,m);this._map.fitBounds(M,x,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const d=new l.M(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&Rr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=S.create("button","maplibregl-ctrl-geolocate",this._container),S.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=S.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Vo({element:this._dotElement}),this._circleElement=S.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},kc,b)}onAdd(b){return this._map=b,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(r=!1){if(xr!==void 0&&!r)return xr;if(window.navigator.permissions===void 0)return xr=!!window.navigator.geolocation,xr;try{xr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{xr=!!window.navigator.geolocation}return xr})}().then(r=>this._setupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),S.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,No=0,Rr=!1}_isOutOfMapMaxBounds(b){const r=this._map.getMaxBounds(),d=b.coords;return r&&(d.longitude<r.getWest()||d.longitude>r.getEast()||d.latitude<r.getSouth()||d.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),r=b.getSouthEast(),d=b.getNorthEast(),m=r.distanceTo(d),g=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":No--,Rr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),No++,No>1?(b={maximumAge:6e5,timeout:0},Rr=!0):(b=this.options.positionOptions,Rr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=ac,u.ImageSource=ts,u.KeyboardHandler=Pi,u.LngLatBounds=Fi,u.LogoControl=Oo,u.Map=class extends uu{constructor(b){if(l.bc.mark(l.bd.create),(b=l.e({},xc,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rl(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),{bearingSnap:b.bearingSnap}),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._maxTileCacheZoomLevels=b.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new Zi,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},bc,b.locale),this._clickTolerance=b.clickTolerance,this._overridePixelRatio=b.pixelRatio,this._maxCanvasSize=b.maxCanvasSize,this.transformCameraUpdate=b.transformCameraUpdate,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new de(b.transformRequest),typeof b.container=="string"){if(this._container=document.getElementById(b.container),!this._container)throw new Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const d=oc(m=>{this._trackResize&&!this._removed&&this.resize(m)._update()},50);this._resizeObserver=new ResizeObserver(m=>{r?d(m):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new rs(this,b),this._hash=b.hash&&new ac(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,l.e({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,this._validateStyle=b.validateStyle,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new du(typeof b.attributionControl=="boolean"?void 0:b.attributionControl)),b.maplibreLogo&&this.addControl(new Oo,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new l.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new l.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new l.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(b,r){if(r===void 0&&(r=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=b.onAdd(this);this._controls.push(b);const m=this._controlPositions[r];return r.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(b);return r>-1&&this._controls.splice(r,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}calculateCameraOptionsFromTo(b,r,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,r,d,m)}resize(b){var r;const d=this._containerDimensions(),m=d[0],g=d[1],x=this._getClampedPixelRatio(m,g);if(this._resizeCanvas(m,g,x),this.painter.resize(m,g,x),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const A=this._getClampedPixelRatio(m,g);this._resizeCanvas(m,g,A),this.painter.resize(m,g,A)}this.transform.resize(m,g),(r=this._requestedCameraState)===null||r===void 0||r.resize(m,g);const M=!this._moving;return M&&(this.stop(),this.fire(new l.k("movestart",b)).fire(new l.k("move",b))),this.fire(new l.k("resize",b)),M&&this.fire(new l.k("moveend",b)),this}_getClampedPixelRatio(b,r){const{0:d,1:m}=this._maxCanvasSize,g=this.getPixelRatio(),x=b*g,M=r*g;return Math.min(x>d?d/x:1,M>m?m/M:1)*g}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(Fi.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(l.M.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.pointLocation(l.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,r,d){if(b==="mouseenter"||b==="mouseover"){let m=!1;return{layer:r,listener:d,delegates:{mousemove:x=>{const M=this.getLayer(r)?this.queryRenderedFeatures(x.point,{layers:[r]}):[];M.length?m||(m=!0,d.call(this,new Pn(b,this,x.originalEvent,{features:M}))):m=!1},mouseout:()=>{m=!1}}}}if(b==="mouseleave"||b==="mouseout"){let m=!1;return{layer:r,listener:d,delegates:{mousemove:M=>{(this.getLayer(r)?this.queryRenderedFeatures(M.point,{layers:[r]}):[]).length?m=!0:m&&(m=!1,d.call(this,new Pn(b,this,M.originalEvent)))},mouseout:M=>{m&&(m=!1,d.call(this,new Pn(b,this,M.originalEvent)))}}}}{const m=g=>{const x=this.getLayer(r)?this.queryRenderedFeatures(g.point,{layers:[r]}):[];x.length&&(g.features=x,d.call(this,g),delete g.features)};return{layer:r,listener:d,delegates:{[b]:m}}}}on(b,r,d){if(d===void 0)return super.on(b,r);const m=this._createDelegatedListener(b,r,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(m);for(const g in m.delegates)this.on(g,m.delegates[g]);return this}once(b,r,d){if(d===void 0)return super.once(b,r);const m=this._createDelegatedListener(b,r,d);for(const g in m.delegates)this.once(g,m.delegates[g]);return this}off(b,r,d){return d===void 0?super.off(b,r):(this._delegatedListeners&&this._delegatedListeners[b]&&(m=>{const g=this._delegatedListeners[b];for(let x=0;x<g.length;x++){const M=g[x];if(M.layer===r&&M.listener===d){for(const P in M.delegates)this.off(P,M.delegates[P]);return g.splice(x,1),this}}})(),this)}queryRenderedFeatures(b,r){if(!this.style)return[];let d;const m=b instanceof l.P||Array.isArray(b),g=m?b:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(m?{}:b)||{},g instanceof l.P||typeof g[0]=="number")d=[l.P.convert(g)];else{const x=l.P.convert(g[0]),M=l.P.convert(g[1]);d=[x,new l.P(M.x,x.y),M,new l.P(x.x,M.y),x]}return this.style.queryRenderedFeatures(d,r,this.transform)}querySourceFeatures(b,r){return this.style.querySourceFeatures(b,r)}setStyle(b,r){return(r=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(b,r))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const r=this._locale[b];if(r==null)throw new Error(`Missing UI string '${b}'`);return r}_updateStyle(b,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(b,r));const d=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new ja(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,r,d):this.style.loadJSON(b,r,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ja(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,r){if(typeof b=="string"){const d=this._requestManager.transformRequest(b,ae.Style);l.h(d,new AbortController).then(m=>{this._updateDiff(m.data,r)}).catch(m=>{m&&this.fire(new l.j(m))})}else typeof b=="object"&&this._updateDiff(b,r)}_updateDiff(b,r){try{this.style.setState(b,r)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(b,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(b,r){return this._lazyInitEmptyStyle(),this.style.addSource(b,r),this._update(!0)}isSourceLoaded(b){const r=this.style&&this.style.sourceCaches[b];if(r!==void 0)return r.loaded();this.fire(new l.j(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const r=this.style.sourceCaches[b.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&r.reload();for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===b.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new xa(this.painter,r,b),this.painter.renderToTexture=new yc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==b.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:b})),this}getTerrain(){var b,r;return(r=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const r in b){const d=b[r]._tiles;for(const m in d){const g=d[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,r,d={}){const{pixelRatio:m=1,sdf:g=!1,stretchX:x,stretchY:M,content:P}=d;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||l.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:D,data:B}=r,O=r;return this.style.addImage(b,{data:new l.R({width:A,height:D},new Uint8Array(B)),pixelRatio:m,stretchX:x,stretchY:M,content:P,sdf:g,version:0,userImage:O}),O.onAdd&&O.onAdd(this,b),this}}{const{width:A,height:D,data:B}=C.getImageData(r);this.style.addImage(b,{data:new l.R({width:A,height:D},B),pixelRatio:m,stretchX:x,stretchY:M,content:P,sdf:g,version:0})}}updateImage(b,r){const d=this.style.getImage(b);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof HTMLImageElement||l.b(r)?C.getImageData(r):r,{width:g,height:x,data:M}=m;if(g===void 0||x===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||x!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(r instanceof HTMLImageElement||l.b(r));return d.data.replace(M,P),this.style.updateImage(b,d),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return W.getImage(this._requestManager.transformRequest(b,ae.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,r){return this._lazyInitEmptyStyle(),this.style.addLayer(b,r),this._update(!0)}moveLayer(b,r){return this.style.moveLayer(b,r),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,r,d){return this.style.setLayerZoomRange(b,r,d),this._update(!0)}setFilter(b,r,d={}){return this.style.setFilter(b,r,d),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,r,d,m={}){return this.style.setPaintProperty(b,r,d,m),this._update(!0)}getPaintProperty(b,r){return this.style.getPaintProperty(b,r)}setLayoutProperty(b,r,d,m={}){return this.style.setLayoutProperty(b,r,d,m),this._update(!0)}getLayoutProperty(b,r){return this.style.getLayoutProperty(b,r)}setGlyphs(b,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,r,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,r,d,m=>{m||this._update(!0)}),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,r,d=>{d||this._update(!0)}),this}setLight(b,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(b,r){return this.style.setFeatureState(b,r),this._update()}removeFeatureState(b,r){return this.style.removeFeatureState(b,r),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,r=0;return this._container&&(b=this._container.clientWidth||400,r=this._container.clientHeight||300),[b,r]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const r=this._canvasContainer=S.create("div","maplibregl-canvas-container",b);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=S.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const g=this._controlContainer=S.create("div","maplibregl-control-container",b),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{x[M]=S.create("div",`maplibregl-ctrl-${M} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,r,d){this._canvas.width=Math.floor(d*b),this._canvas.height=Math.floor(d*r),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const b={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{r={requestedAttributes:b},m&&(r.statusMessage=m.statusMessage,r.type=m.type)},{once:!0});const d=this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b);if(!d){const m="Failed to initialize WebGL";throw r?(r.message=m,new Error(JSON.stringify(r))):new Error(m)}this.painter=new Do(d,this.transform),z.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,x=C.now();this.style.zoomHistory.update(g,x);const M=new l.a8(g,{now:x,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=M.crossFadingFactor();P===1&&P===this._crossFadingFactor||(d=!0,this._crossFadingFactor=P),this.style.update(M)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),S.remove(this._canvasContainer),S.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(b=>{l.bc.frame(b),this._frameRequest=null,this._render(b)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return va}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Pn,u.MapTouchEvent=Ro,u.MapWheelEvent=Bs,u.Marker=Vo,u.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const r=this._map.getZoom(),d=r===this._map.getMaxZoom(),m=r===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);r.title=m,r.setAttribute("aria-label",m)},this.options=l.e({},vc,b),this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),S.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),S.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=S.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){S.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,r){const d=S.create("button",b,this._container);return d.type="button",d.addEventListener("click",r),d}},u.Popup=class extends l.E{constructor(b){super(),this.remove=()=>(this._content&&S.remove(this._content),this._container&&(S.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=S.create("div","maplibregl-popup",this._map.getContainer()),this._tip=S.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?dl(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!r)return;const m=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const x=Mc(this.options.offset);if(!g){const P=this._container.offsetWidth,A=this._container.offsetHeight;let D;D=m.y+x.bottom.y<A?["top"]:m.y>this._map.transform.height-A?["bottom"]:[],m.x<P/2?D.push("left"):m.x>this._map.transform.width-P/2&&D.push("right"),g=D.length===0?"bottom":D.join("-")}let M=m.add(x[g]);this.options.subpixelPositioning||(M=M.round()),S.setTransform(this._container,`${wa[g]} translate(${M.x}px,${M.y}px)`),fl(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Cc),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=l.M.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const r=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=b;m=d.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=S.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){this._container&&this._container.classList.add(b)}removeClassName(b){this._container&&this._container.classList.remove(b)}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=S.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(Tc);b&&b.focus()}},u.RasterDEMTileSource=or,u.RasterTileSource=Hs,u.ScaleControl=class{constructor(b){this._onMove=()=>{pl(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,pl(this._map,this._container,this.options)},this.options=l.e({},Sc,b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){S.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=mc,u.Style=ja,u.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=S.create("button","maplibregl-ctrl-terrain",this._container),S.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){S.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=cu,u.TwoFingersTouchRotateHandler=fc,u.TwoFingersTouchZoomHandler=al,u.TwoFingersTouchZoomRotateHandler=bt,u.VectorTileSource=De,u.VideoSource=xi,u.addSourceType=(b,r)=>l._(void 0,void 0,void 0,function*(){if(Gn(b))throw new Error(`A source type called "${b}" already exists.`);((d,m)=>{Mn[d]=m})(b,r)}),u.clearPrewarmedResources=function(){const b=qi;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(Ci),qi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return yn().getRTLTextPluginStatus()},u.getVersion=function(){return pu},u.getWorkerCount=function(){return Ti.workerCount},u.getWorkerUrl=function(){return l.a.WORKER_URL},u.importScriptInWorkers=function(b){return _n().broadcast("importScript",b)},u.prewarm=function(){nt().acquire(Ci)},u.setMaxParallelImageRequests=function(b){l.a.MAX_PARALLEL_IMAGE_REQUESTS=b},u.setRTLTextPlugin=function(b,r){return yn().setRTLTextPlugin(b,r)},u.setWorkerCount=function(b){Ti.workerCount=b},u.setWorkerUrl=function(b){l.a.WORKER_URL=b}});var h=t;return h})})(U0);var rd=U0.exports;const Vv=Fv(rd);function Nv(n){let e,t,i;return{c(){e=et("link"),t=xt(),i=et("div"),ie(e,"href","./maplibre-gl.css"),ie(e,"rel","stylesheet"),ie(i,"class","map relative top-0 left-0 h-full w-full"),ie(i,"id","map")},m(o,h){ue(document.head,e),qe(o,t,h),qe(o,i,h),n[5](i)},p:St,i:St,o:St,d(o){je(e),o&&je(t),o&&je(i),n[5](null)}}}function Uv(n,e,t){let{map:i=void 0}=e,{mapProperties:o=void 0}=e,{interactive:h=!0}=e,{autorecovery:u=!1}=e,l,p;function y(){var H,X,re,W;const{lon:C,lat:S}=((H=o==null?void 0:o.location)==null?void 0:H.data)??{lon:0,lat:0},z=(re=(X=o==null?void 0:o.rasterLayer)==null?void 0:X.data)==null?void 0:re.properties;let R;if((z==null?void 0:z.type)==="vector")R=(z==null?void 0:z.style)??(z==null?void 0:z.url)??Jg.defaultBackgroundLayer.properties.url;else{const ae=Jg.defaultBackgroundLayer.properties;R=ae.style??ae.url}console.log("Initiating mapLIbremap with style",R);const j={container:l,style:R,zoom:((W=o==null?void 0:o.zoom)==null?void 0:W.data)??1,center:{lng:C,lat:S},maxZoom:24,interactive:!0,attributionControl:!1};p=new rd.Map(j),window.requestAnimationFrame(()=>{p.resize()}),p.on("load",function(){p.resize();const ae=p.getCanvas();ae.addEventListener("webglcontextlost",de=>{console.warn("A MapLibreMap lost their context. Recovery is",u,de);try{p==null||p.remove()}catch(Ae){console.debug("Could not remove map due to",Ae)}u&&requestAnimationFrame(()=>{console.warn("Attempting map recovery"),p=new rd.Map(j),y()})}),h?(D0(ae,gs.t.general.visualFeedback.navigation),ae.role="application",ae.tabIndex=0):(ae.tabIndex=-1,p.getContainer().tabIndex=-1)}),i.set(p)}Td(()=>y()),rr(async()=>{await Ni.waitFor(100),requestAnimationFrame(()=>{try{p==null||p.remove(),console.log("Removed map"),t(1,i=null)}catch{console.error("Could not destroy map")}})});function k(C){xo[C?"unshift":"push"](()=>{l=C,t(0,l)})}return n.$$set=C=>{"map"in C&&t(1,i=C.map),"mapProperties"in C&&t(2,o=C.mapProperties),"interactive"in C&&t(3,h=C.interactive),"autorecovery"in C&&t(4,u=C.autorecovery)},[l,i,o,h,u,k]}class q0 extends Gt{constructor(e){super(),Xt(this,e,Uv,Nv,Kt,{map:1,mapProperties:2,interactive:3,autorecovery:4})}}function jv(n,e){if(n.match(/^[a-z]+:\/\//i))return n;if(n.match(/^\/\//))return window.location.protocol+n;if(n.match(/^[a-z]+:/i))return n;const t=document.implementation.createHTMLDocument(),i=t.createElement("base"),o=t.createElement("a");return t.head.appendChild(i),t.body.appendChild(o),e&&(i.href=e),o.href=n,o.href}const qv=(()=>{let n=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(n+=1,`u${e()}${n}`)})();function bo(n){const e=[];for(let t=0,i=n.length;t<i;t++)e.push(n[t]);return e}function od(n,e){const i=(n.ownerDocument.defaultView||window).getComputedStyle(n).getPropertyValue(e);return i?parseFloat(i.replace("px","")):0}function Hv(n){const e=od(n,"border-left-width"),t=od(n,"border-right-width");return n.clientWidth+e+t}function Wv(n){const e=od(n,"border-top-width"),t=od(n,"border-bottom-width");return n.clientHeight+e+t}function Zv(n,e={}){const t=e.width||Hv(n),i=e.height||Wv(n);return{width:t,height:i}}function bp(n){return new Promise((e,t)=>{const i=new Image;i.decode=()=>e(i),i.onload=()=>e(i),i.onerror=t,i.crossOrigin="anonymous",i.decoding="async",i.src=n})}async function $v(n){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(n)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function Gv(n,e,t){const i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg"),h=document.createElementNS(i,"foreignObject");return o.setAttribute("width",`${e}`),o.setAttribute("height",`${t}`),o.setAttribute("viewBox",`0 0 ${e} ${t}`),h.setAttribute("width","100%"),h.setAttribute("height","100%"),h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("externalResourcesRequired","true"),o.appendChild(h),h.appendChild(n),$v(o)}const js=(n,e)=>{if(n instanceof e)return!0;const t=Object.getPrototypeOf(n);return t===null?!1:t.constructor.name===e.name||js(t,e)};function Xv(n){const e=n.getPropertyValue("content");return`${n.cssText} content: '${e.replace(/'|"/g,"")}';`}function Kv(n){return bo(n).map(e=>{const t=n.getPropertyValue(e),i=n.getPropertyPriority(e);return`${e}: ${t}${i?" !important":""};`}).join(" ")}function Yv(n,e,t){const i=`.${n}:${e}`,o=t.cssText?Xv(t):Kv(t);return document.createTextNode(`${i}{${o}}`)}function e_(n,e,t){const i=window.getComputedStyle(n,t),o=i.getPropertyValue("content");if(o===""||o==="none")return;const h=qv();try{e.className=`${e.className} ${h}`}catch{return}const u=document.createElement("style");u.appendChild(Yv(h,t,i)),e.appendChild(u)}function Jv(n,e){e_(n,e,":before"),e_(n,e,":after")}const t_="application/font-woff",i_="image/jpeg",Qv={woff:t_,woff2:t_,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:i_,jpeg:i_,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function ew(n){const e=/\.([^./]*?)$/g.exec(n);return e?e[1]:""}function $p(n){const e=ew(n).toLowerCase();return Qv[e]||""}function tw(n){return n.split(/,/)[1]}function xp(n){return n.search(/^(data:)/)!==-1}function H0(n,e){return`data:${e};base64,${n}`}async function W0(n,e,t){const i=await fetch(n,e);if(i.status===404)throw new Error(`Resource "${i.url}" not found`);const o=await i.blob();return new Promise((h,u)=>{const l=new FileReader;l.onerror=u,l.onloadend=()=>{try{h(t({res:i,result:l.result}))}catch(p){u(p)}},l.readAsDataURL(o)})}const ep={};function iw(n,e,t){let i=n.replace(/\?.*/,"");return t&&(i=n),/ttf|otf|eot|woff2?/i.test(i)&&(i=i.replace(/.*\//,"")),e?`[${e}]${i}`:i}async function Gp(n,e,t){const i=iw(n,e,t.includeQueryParams);if(ep[i]!=null)return ep[i];t.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+new Date().getTime());let o;try{const h=await W0(n,t.fetchRequestInit,({res:u,result:l})=>(e||(e=u.headers.get("Content-Type")||""),tw(l)));o=H0(h,e)}catch(h){o=t.imagePlaceholder||"";let u=`Failed to fetch resource: ${n}`;h&&(u=typeof h=="string"?h:h.message),u&&console.warn(u)}return ep[i]=o,o}async function nw(n){const e=n.toDataURL();return e==="data:,"?n.cloneNode(!1):bp(e)}async function sw(n,e){if(n.currentSrc){const h=document.createElement("canvas"),u=h.getContext("2d");h.width=n.clientWidth,h.height=n.clientHeight,u==null||u.drawImage(n,0,0,h.width,h.height);const l=h.toDataURL();return bp(l)}const t=n.poster,i=$p(t),o=await Gp(t,i,e);return bp(o)}async function rw(n){var e;try{if(!((e=n==null?void 0:n.contentDocument)===null||e===void 0)&&e.body)return await Ed(n.contentDocument.body,{},!0)}catch{}return n.cloneNode(!1)}async function ow(n,e){return js(n,HTMLCanvasElement)?nw(n):js(n,HTMLVideoElement)?sw(n,e):js(n,HTMLIFrameElement)?rw(n):n.cloneNode(!1)}const aw=n=>n.tagName!=null&&n.tagName.toUpperCase()==="SLOT";async function lw(n,e,t){var i,o;let h=[];return aw(n)&&n.assignedNodes?h=bo(n.assignedNodes()):js(n,HTMLIFrameElement)&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?h=bo(n.contentDocument.body.childNodes):h=bo(((o=n.shadowRoot)!==null&&o!==void 0?o:n).childNodes),h.length===0||js(n,HTMLVideoElement)||await h.reduce((u,l)=>u.then(()=>Ed(l,t)).then(p=>{p&&e.appendChild(p)}),Promise.resolve()),e}function cw(n,e){const t=e.style;if(!t)return;const i=window.getComputedStyle(n);i.cssText?(t.cssText=i.cssText,t.transformOrigin=i.transformOrigin):bo(i).forEach(o=>{let h=i.getPropertyValue(o);o==="font-size"&&h.endsWith("px")&&(h=`${Math.floor(parseFloat(h.substring(0,h.length-2)))-.1}px`),js(n,HTMLIFrameElement)&&o==="display"&&h==="inline"&&(h="block"),o==="d"&&e.getAttribute("d")&&(h=`path(${e.getAttribute("d")})`),t.setProperty(o,h,i.getPropertyPriority(o))})}function hw(n,e){js(n,HTMLTextAreaElement)&&(e.innerHTML=n.value),js(n,HTMLInputElement)&&e.setAttribute("value",n.value)}function uw(n,e){if(js(n,HTMLSelectElement)){const t=e,i=Array.from(t.children).find(o=>n.value===o.getAttribute("value"));i&&i.setAttribute("selected","")}}function dw(n,e){return js(e,Element)&&(cw(n,e),Jv(n,e),hw(n,e),uw(n,e)),e}async function fw(n,e){const t=n.querySelectorAll?n.querySelectorAll("use"):[];if(t.length===0)return n;const i={};for(let h=0;h<t.length;h++){const l=t[h].getAttribute("xlink:href");if(l){const p=n.querySelector(l),y=document.querySelector(l);!p&&y&&!i[l]&&(i[l]=await Ed(y,e,!0))}}const o=Object.values(i);if(o.length){const h="http://www.w3.org/1999/xhtml",u=document.createElementNS(h,"svg");u.setAttribute("xmlns",h),u.style.position="absolute",u.style.width="0",u.style.height="0",u.style.overflow="hidden",u.style.display="none";const l=document.createElementNS(h,"defs");u.appendChild(l);for(let p=0;p<o.length;p++)l.appendChild(o[p]);n.appendChild(u)}return n}async function Ed(n,e,t){return!t&&e.filter&&!e.filter(n)?null:Promise.resolve(n).then(i=>ow(i,e)).then(i=>lw(n,i,e)).then(i=>dw(n,i)).then(i=>fw(i,e))}const Z0=/url\((['"]?)([^'"]+?)\1\)/g,pw=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,mw=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function gw(n){const e=n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function _w(n){const e=[];return n.replace(Z0,(t,i,o)=>(e.push(o),t)),e.filter(t=>!xp(t))}async function yw(n,e,t,i,o){try{const h=t?jv(e,t):e,u=$p(e);let l;if(o){const p=await o(h);l=H0(p,u)}else l=await Gp(h,u,i);return n.replace(gw(e),`$1${l}$3`)}catch{}return n}function bw(n,{preferredFontFormat:e}){return e?n.replace(mw,t=>{for(;;){const[i,,o]=pw.exec(t)||[];if(!o)return"";if(o===e)return`src: ${i};`}}):n}function $0(n){return n.search(Z0)!==-1}async function G0(n,e,t){if(!$0(n))return n;const i=bw(n,t);return _w(i).reduce((h,u)=>h.then(l=>yw(l,u,e,t)),Promise.resolve(i))}async function Nu(n,e,t){var i;const o=(i=e.style)===null||i===void 0?void 0:i.getPropertyValue(n);if(o){const h=await G0(o,null,t);return e.style.setProperty(n,h,e.style.getPropertyPriority(n)),!0}return!1}async function xw(n,e){await Nu("background",n,e)||await Nu("background-image",n,e),await Nu("mask",n,e)||await Nu("mask-image",n,e)}async function vw(n,e){const t=js(n,HTMLImageElement);if(!(t&&!xp(n.src))&&!(js(n,SVGImageElement)&&!xp(n.href.baseVal)))return;const i=t?n.src:n.href.baseVal,o=await Gp(i,$p(i),e);await new Promise((h,u)=>{n.onload=h,n.onerror=u;const l=n;l.decode&&(l.decode=h),l.loading==="lazy"&&(l.loading="eager"),t?(n.srcset="",n.src=o):n.href.baseVal=o})}async function ww(n,e){const i=bo(n.childNodes).map(o=>X0(o,e));await Promise.all(i).then(()=>n)}async function X0(n,e){js(n,Element)&&(await xw(n,e),await vw(n,e),await ww(n,e))}function kw(n,e){const{style:t}=n;e.backgroundColor&&(t.backgroundColor=e.backgroundColor),e.width&&(t.width=`${e.width}px`),e.height&&(t.height=`${e.height}px`);const i=e.style;return i!=null&&Object.keys(i).forEach(o=>{t[o]=i[o]}),n}const n_={};async function s_(n){let e=n_[n];if(e!=null)return e;const i=await(await fetch(n)).text();return e={url:n,cssText:i},n_[n]=e,e}async function r_(n,e){let t=n.cssText;const i=/url\(["']?([^"')]+)["']?\)/g,h=(t.match(/url\([^)]+\)/g)||[]).map(async u=>{let l=u.replace(i,"$1");return l.startsWith("https://")||(l=new URL(l,n.url).href),W0(l,e.fetchRequestInit,({result:p})=>(t=t.replace(u,`url(${p})`),[u,p]))});return Promise.all(h).then(()=>t)}function o_(n){if(n==null)return[];const e=[],t=/(\/\*[\s\S]*?\*\/)/gi;let i=n.replace(t,"");const o=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const p=o.exec(i);if(p===null)break;e.push(p[0])}i=i.replace(o,"");const h=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,u="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(u,"gi");for(;;){let p=h.exec(i);if(p===null){if(p=l.exec(i),p===null)break;h.lastIndex=l.lastIndex}else l.lastIndex=h.lastIndex;e.push(p[0])}return e}async function Sw(n,e){const t=[],i=[];return n.forEach(o=>{if("cssRules"in o)try{bo(o.cssRules||[]).forEach((h,u)=>{if(h.type===CSSRule.IMPORT_RULE){let l=u+1;const p=h.href,y=s_(p).then(k=>r_(k,e)).then(k=>o_(k).forEach(C=>{try{o.insertRule(C,C.startsWith("@import")?l+=1:o.cssRules.length)}catch(S){console.error("Error inserting rule from remote css",{rule:C,error:S})}})).catch(k=>{console.error("Error loading remote css",k.toString())});i.push(y)}})}catch(h){const u=n.find(l=>l.href==null)||document.styleSheets[0];o.href!=null&&i.push(s_(o.href).then(l=>r_(l,e)).then(l=>o_(l).forEach(p=>{u.insertRule(p,o.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",h)}}),Promise.all(i).then(()=>(n.forEach(o=>{if("cssRules"in o)try{bo(o.cssRules||[]).forEach(h=>{t.push(h)})}catch(h){console.error(`Error while reading CSS rules from ${o.href}`,h)}}),t))}function Cw(n){return n.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>$0(e.style.getPropertyValue("src")))}async function Tw(n,e){if(n.ownerDocument==null)throw new Error("Provided element is not within a Document");const t=bo(n.ownerDocument.styleSheets),i=await Sw(t,e);return Cw(i)}async function Mw(n,e){const t=await Tw(n,e);return(await Promise.all(t.map(o=>{const h=o.parentStyleSheet?o.parentStyleSheet.href:null;return G0(o.cssText,h,e)}))).join(`
`)}async function Pw(n,e){const t=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await Mw(n,e);if(t){const i=document.createElement("style"),o=document.createTextNode(t);i.appendChild(o),n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i)}}async function Iw(n,e={}){const{width:t,height:i}=Zv(n,e),o=await Ed(n,e,!0);return await Pw(o,e),await X0(o,e),kw(o,e),await Gv(o,t,i)}const ph=class ph{constructor(e,t,i){Ge(this,"opacity",new Tt(0));Ge(this,"_map");Ge(this,"_background");Ge(this,"_targetLayer");Ge(this,"_deactivationTime");Ge(this,"fadeStep",.1);this._targetLayer=t,this._map=e,this._background=i,i.addCallback(async()=>{await this.update()}),e.addCallbackAndRunD(async o=>{o.on("load",async()=>{await this.update()}),await this.update(),o.on("moveend",()=>this.onMove(o)),o.on("zoomend",()=>this.onMove(o))})}onMove(e){if(!(!this._deactivationTime||(new Date().getTime()-this._deactivationTime.getTime())/1e3<ph.DEACTIVATE_AFTER)){console.debug("Removing raster layer",this._targetLayer.properties.id,"map moved and not been used for",ph.DEACTIVATE_AFTER);try{e.getLayer(this._targetLayer.properties.id)&&e.removeLayer(this._targetLayer.properties.id)}catch(i){console.warn("Could not (try to) remove the raster layer",i)}}}async update(){var i;const e=this._background.data,t=this._targetLayer;((i=e==null?void 0:e.properties)==null?void 0:i.id)!==t.properties.id?(this._deactivationTime=new Date,await this.awaitStyleIsLoaded(),this.fadeOut()):(this._deactivationTime=void 0,await this.enable(),this.fadeIn())}async awaitStyleIsLoaded(){const e=this._map.data;if(e)for(;!(e!=null&&e.isStyleLoaded());)await Ni.waitFor(250)}async enable(){let e=15;for(await this.awaitStyleIsLoaded();!this.tryEnable()&&e>0;)e--,await Ni.waitFor(250)}tryEnableSafe(){try{return this.tryEnable()}catch(e){return console.log("Error: could not enable due to error",e),!1}}tryEnable(){var o;const e=this._map.data;if(!e)return!0;const t=this._targetLayer.properties;console.debug("Enabling",t.id);let i="transit_pier";if(e.getLayer(i)||(console.warn("Layer",i,"not found"),i=void 0),(t.category==="osmbasedmap"||t.category==="map")&&(i=void 0),!e.getSource(t.id))try{e.addSource(t.id,gh.prepareSource(t))}catch{return!1}if(!e.getLayer(t.id))if(i??(i=(o=e.getStyle().layers.find(h=>h.id.startsWith("mapcomplete_")))==null?void 0:o.id),t.type==="vector"){const h=t.style??t.url;e.setStyle(h)}else e.addLayer({id:t.id,type:"raster",source:t.id,paint:{"raster-opacity":0}},i),this.opacity.addCallbackAndRun(h=>{try{e.setPaintProperty(t.id,"raster-opacity",h)}catch{return console.debug("Could not set raster-opacity of",t.id),!0}});return!0}fadeOut(){gp.Chronic(8,()=>this.opacity.data>0&&this._deactivationTime!==void 0).addCallback(e=>this.opacity.setData(Math.max(0,this.opacity.data-this.fadeStep)))}fadeIn(){gp.Chronic(8,()=>this.opacity.data<1&&this._deactivationTime===void 0).addCallback(e=>this.opacity.setData(Math.min(1,this.opacity.data+this.fadeStep)))}};Ge(ph,"DEACTIVATE_AFTER",60);let vp=ph;class gh{constructor(e,t){Ge(this,"_singleLayerHandlers",{});t.addCallbackAndRunD(i=>{const o=i.properties.id;this._singleLayerHandlers[o]||(this._singleLayerHandlers[o]=new vp(e,i,t))})}static prepareSource(e){return e.type==="vector"?{type:"vector",url:e.url}:{type:"raster",tiles:[gh.prepareWmsURL(e.url,e["tile-size"]??256)],tileSize:e["tile-size"]??256,minzoom:e.min_zoom??1,maxzoom:e.max_zoom??25,scheme:e.url.includes("{-y}")?"tms":"xyz"}}static prepareWmsURL(e,t=256){const i={"{bbox}":"{bbox-epsg-3857}","{proj}":"EPSG:3857","{width}":""+t,"{height}":""+t,"{zoom}":"{z}","{-y}":"{y}"};for(const h in i)e=e.replace(new RegExp(h),i[h]);const o=e.match(/\{switch:([a-zA-Z0-9,]*)}/);if(o!==null){const h=o[1].split(","),u=h[Math.floor(Math.random()*h.length)];e=e.replace(o[0],u)}return e}}var zl=Math.pow,ps=(n,e,t)=>new Promise((i,o)=>{var h=p=>{try{l(t.next(p))}catch(y){o(y)}},u=p=>{try{l(t.throw(p))}catch(y){o(y)}},l=p=>p.done?i(p.value):Promise.resolve(p.value).then(h,u);l((t=t.apply(n,e)).next())}),sr=Uint8Array,El=Uint16Array,Aw=Int32Array,K0=new sr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Y0=new sr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ew=new sr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),J0=function(n,e){for(var t=new El(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var o=new Aw(t[30]),i=1;i<30;++i)for(var h=t[i];h<t[i+1];++h)o[h]=h-t[i]<<5|i;return{b:t,r:o}},Q0=J0(K0,2),e1=Q0.b,zw=Q0.r;e1[28]=258,zw[258]=28;var Dw=J0(Y0,0),Lw=Dw.b,wp=new El(32768);for(gi=0;gi<32768;++gi)ho=(gi&43690)>>1|(gi&21845)<<1,ho=(ho&52428)>>2|(ho&13107)<<2,ho=(ho&61680)>>4|(ho&3855)<<4,wp[gi]=((ho&65280)>>8|(ho&255)<<8)>>1;var ho,gi,oh=function(n,e,t){for(var i=n.length,o=0,h=new El(e);o<i;++o)n[o]&&++h[n[o]-1];var u=new El(e);for(o=1;o<e;++o)u[o]=u[o-1]+h[o-1]<<1;var l;if(t){l=new El(1<<e);var p=15-e;for(o=0;o<i;++o)if(n[o])for(var y=o<<4|n[o],k=e-n[o],C=u[n[o]-1]++<<k,S=C|(1<<k)-1;C<=S;++C)l[wp[C]>>p]=y}else for(l=new El(i),o=0;o<i;++o)n[o]&&(l[o]=wp[u[n[o]-1]++]>>15-n[o]);return l},Sh=new sr(288);for(gi=0;gi<144;++gi)Sh[gi]=8;var gi;for(gi=144;gi<256;++gi)Sh[gi]=9;var gi;for(gi=256;gi<280;++gi)Sh[gi]=7;var gi;for(gi=280;gi<288;++gi)Sh[gi]=8;var gi,t1=new sr(32);for(gi=0;gi<32;++gi)t1[gi]=5;var gi,Rw=oh(Sh,9,1),Fw=oh(t1,5,1),tp=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Cr=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},ip=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Bw=function(n){return(n+7)/8|0},Ow=function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var i=new sr(t-e);return i.set(n.subarray(e,t)),i},Vw=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],tr=function(n,e,t){var i=new Error(e||Vw[n]);if(i.code=n,Error.captureStackTrace&&Error.captureStackTrace(i,tr),!t)throw i;return i},Xp=function(n,e,t,i){var o=n.length,h=i?i.length:0;if(!o||e.f&&!e.l)return t||new sr(0);var u=!t||e.i!=2,l=e.i;t||(t=new sr(o*3));var p=function(_n){var Zn=t.length;if(_n>Zn){var En=new sr(Math.max(Zn*2,_n));En.set(t),t=En}},y=e.f||0,k=e.p||0,C=e.b||0,S=e.l,z=e.d,R=e.m,j=e.n,H=o*8;do{if(!S){y=Cr(n,k,1);var X=Cr(n,k+1,3);if(k+=3,X)if(X==1)S=Rw,z=Fw,R=9,j=5;else if(X==2){var de=Cr(n,k,31)+257,Ae=Cr(n,k+10,15)+4,xe=de+Cr(n,k+5,31)+1;k+=14;for(var pe=new sr(xe),ke=new sr(19),Ie=0;Ie<Ae;++Ie)ke[Ew[Ie]]=Cr(n,k+Ie*3,7);k+=Ae*3;for(var Ve=tp(ke),We=(1<<Ve)-1,Oe=oh(ke,Ve,1),Ie=0;Ie<xe;){var It=Oe[Cr(n,k,We)];k+=It&15;var re=It>>4;if(re<16)pe[Ie++]=re;else{var mt=0,Ft=0;for(re==16?(Ft=3+Cr(n,k,3),k+=2,mt=pe[Ie-1]):re==17?(Ft=3+Cr(n,k,7),k+=3):re==18&&(Ft=11+Cr(n,k,127),k+=7);Ft--;)pe[Ie++]=mt}}var Yt=pe.subarray(0,de),Qt=pe.subarray(de);R=tp(Yt),j=tp(Qt),S=oh(Yt,R,1),z=oh(Qt,j,1)}else tr(1);else{var re=Bw(k)+4,W=n[re-4]|n[re-3]<<8,ae=re+W;if(ae>o){l&&tr(0);break}u&&p(C+W),t.set(n.subarray(re,ae),C),e.b=C+=W,e.p=k=ae*8,e.f=y;continue}if(k>H){l&&tr(0);break}}u&&p(C+131072);for(var Tn=(1<<R)-1,ji=(1<<j)-1,di=k;;di=k){var mt=S[ip(n,k)&Tn],ii=mt>>4;if(k+=mt&15,k>H){l&&tr(0);break}if(mt||tr(2),ii<256)t[C++]=ii;else if(ii==256){di=k,S=null;break}else{var Ci=ii-254;if(ii>264){var Ie=ii-257,Ti=K0[Ie];Ci=Cr(n,k,(1<<Ti)-1)+e1[Ie],k+=Ti}var Gi=z[ip(n,k)&ji],qi=Gi>>4;Gi||tr(3),k+=Gi&15;var Qt=Lw[qi];if(qi>3){var Ti=Y0[qi];Qt+=ip(n,k)&(1<<Ti)-1,k+=Ti}if(k>H){l&&tr(0);break}u&&p(C+131072);var Xi=C+Ci;if(C<Qt){var nt=h-Qt,sn=Math.min(Qt,Xi);for(nt+C<0&&tr(3);C<sn;++C)t[C]=i[nt+C]}for(;C<Xi;C+=4)t[C]=t[C-Qt],t[C+1]=t[C+1-Qt],t[C+2]=t[C+2-Qt],t[C+3]=t[C+3-Qt];C=Xi}}e.l=S,e.p=di,e.b=C,e.f=y,S&&(y=1,e.m=R,e.d=z,e.n=j)}while(!y);return C==t.length?t:Ow(t,0,C)},Nw=new sr(0),Uw=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&tr(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!n[t++]);return t+(e&2)},jw=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},qw=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&tr(6,"invalid zlib data"),(n[1]>>5&1)==+!e&&tr(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function Hw(n,e){return Xp(n,{i:2},e&&e.out,e&&e.dictionary)}function Ww(n,e){var t=Uw(n);return t+8>n.length&&tr(6,"invalid gzip data"),Xp(n.subarray(t,-8),{i:2},e&&e.out||new sr(jw(n)),e&&e.dictionary)}function Zw(n,e){return Xp(n.subarray(qw(n,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function kp(n,e){return n[0]==31&&n[1]==139&&n[2]==8?Ww(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?Hw(n,e):Zw(n,e)}var $w=typeof TextDecoder<"u"&&new TextDecoder,Gw=0;try{$w.decode(Nw,{stream:!0}),Gw=1}catch{}var i1=(n,e)=>n*zl(2,e),Gc=(n,e)=>Math.floor(n/zl(2,e)),ad=(n,e)=>i1(n.getUint16(e+1,!0),8)+n.getUint8(e),n1=(n,e)=>i1(n.getUint32(e+2,!0),16)+n.getUint16(e,!0),Xw=(n,e,t,i,o)=>{if(n!==i.getUint8(o))return n-i.getUint8(o);const h=ad(i,o+1);if(e!==h)return e-h;const u=ad(i,o+4);return t!==u?t-u:0},Kw=(n,e,t,i)=>{const o=s1(n,e|128,t,i);return o?{z:e,x:t,y:i,offset:o[0],length:o[1],isDir:!0}:null},a_=(n,e,t,i)=>{const o=s1(n,e,t,i);return o?{z:e,x:t,y:i,offset:o[0],length:o[1],isDir:!1}:null},s1=(n,e,t,i)=>{let o=0,h=n.byteLength/17-1;for(;o<=h;){const u=h+o>>1,l=Xw(e,t,i,n,u*17);if(l>0)o=u+1;else if(l<0)h=u-1;else return[n1(n,u*17+7),n.getUint32(u*17+13,!0)]}return null},Yw=(n,e)=>n.isDir&&!e.isDir?1:!n.isDir&&e.isDir?-1:n.z!==e.z?n.z-e.z:n.x!==e.x?n.x-e.x:n.y-e.y,r1=(n,e)=>{const t=n.getUint8(e*17);return{z:t&127,x:ad(n,e*17+1),y:ad(n,e*17+4),offset:n1(n,e*17+7),length:n.getUint32(e*17+13,!0),isDir:t>>7===1}},l_=n=>{const e=[],t=new DataView(n);for(let i=0;i<t.byteLength/17;i++)e.push(r1(t,i));return Jw(e)},Jw=n=>{n.sort(Yw);const e=new ArrayBuffer(17*n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++){const o=n[i];let h=o.z;o.isDir&&(h=h|128),t[i*17]=h,t[i*17+1]=o.x&255,t[i*17+2]=o.x>>8&255,t[i*17+3]=o.x>>16&255,t[i*17+4]=o.y&255,t[i*17+5]=o.y>>8&255,t[i*17+6]=o.y>>16&255,t[i*17+7]=o.offset&255,t[i*17+8]=Gc(o.offset,8)&255,t[i*17+9]=Gc(o.offset,16)&255,t[i*17+10]=Gc(o.offset,24)&255,t[i*17+11]=Gc(o.offset,32)&255,t[i*17+12]=Gc(o.offset,48)&255,t[i*17+13]=o.length&255,t[i*17+14]=o.length>>8&255,t[i*17+15]=o.length>>16&255,t[i*17+16]=o.length>>24&255}return e},Qw=(n,e)=>{if(n.byteLength<17)return null;const t=n.byteLength/17,i=r1(n,t-1);if(i.isDir){const o=i.z,h=e.z-o,u=Math.trunc(e.x/(1<<h)),l=Math.trunc(e.y/(1<<h));return{z:o,x:u,y:l}}return null};function e2(n){return ps(this,null,function*(){const e=yield n.getBytes(0,512e3),t=new DataView(e.data),i=t.getUint32(4,!0),o=t.getUint16(8,!0),h=new TextDecoder("utf-8"),u=JSON.parse(h.decode(new DataView(e.data,10,i)));let l=0;u.compression==="gzip"&&(l=2);let p=0;"minzoom"in u&&(p=+u.minzoom);let y=0;"maxzoom"in u&&(y=+u.maxzoom);let k=0,C=0,S=0,z=-180,R=-85,j=180,H=85;if(u.bounds){const re=u.bounds.split(",");z=+re[0],R=+re[1],j=+re[2],H=+re[3]}if(u.center){const re=u.center.split(",");k=+re[0],C=+re[1],S=+re[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:o*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:p,maxZoom:y,minLon:z,minLat:R,maxLon:j,maxLat:H,centerZoom:S,centerLon:k,centerLat:C,etag:e.etag}})}function t2(n,e,t,i,o,h,u){return ps(this,null,function*(){let l=yield t.getArrayBuffer(e,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(l=l_(l));const p=a_(new DataView(l),i,o,h);if(p){let C=(yield e.getBytes(p.offset,p.length,u)).data;const S=new DataView(C);return S.getUint8(0)===31&&S.getUint8(1)===139&&(C=kp(new Uint8Array(C))),{data:C}}const y=Qw(new DataView(l),{z:i,x:o,y:h});if(y){const k=Kw(new DataView(l),y.z,y.x,y.y);if(k){let C=yield t.getArrayBuffer(e,k.offset,k.length,n);n.specVersion===1&&(C=l_(C));const S=a_(new DataView(C),i,o,h);if(S){let R=(yield e.getBytes(S.offset,S.length,u)).data;const j=new DataView(R);return j.getUint8(0)===31&&j.getUint8(1)===139&&(R=kp(new Uint8Array(R))),{data:R}}}}})}var o1={getHeader:e2,getZxy:t2},i2=n=>(e,t)=>{if(t instanceof AbortController)return n(e,t);const i=new AbortController;return n(e,i).then(o=>t(void 0,o.data,o.cacheControl||"",o.expires||""),o=>t(o)).catch(o=>t(o)),{cancel:()=>i.abort()}},n2=class{constructor(){this.tilev4=(n,e)=>ps(this,null,function*(){if(n.type==="json"){const C=n.url.substr(10);let S=this.tiles.get(C);S||(S=new c_(C),this.tiles.set(C,S));const z=yield S.getHeader();return{data:{tiles:[`${n.url}/{z}/{x}/{y}`],minzoom:z.minZoom,maxzoom:z.maxZoom,bounds:[z.minLon,z.minLat,z.maxLon,z.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),i=n.url.match(t);if(!i)throw new Error("Invalid PMTiles protocol URL");const o=i[1];let h=this.tiles.get(o);h||(h=new c_(o),this.tiles.set(o,h));const u=i[2],l=i[3],p=i[4],y=yield h.getHeader(),k=yield h==null?void 0:h.getZxy(+u,+l,+p,e.signal);return k?{data:new Uint8Array(k.data),cacheControl:k.cacheControl,expires:k.expires}:y.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=i2(this.tilev4),this.tiles=new Map}add(n){this.tiles.set(n.source.getKey(),n)}get(n){return this.tiles.get(n)}};function Tl(n,e){return(e>>>0)*4294967296+(n>>>0)}function s2(n,e){const t=e.buf;let i=t[e.pos++],o=(i&112)>>4;if(i<128||(i=t[e.pos++],o|=(i&127)<<3,i<128)||(i=t[e.pos++],o|=(i&127)<<10,i<128)||(i=t[e.pos++],o|=(i&127)<<17,i<128)||(i=t[e.pos++],o|=(i&127)<<24,i<128)||(i=t[e.pos++],o|=(i&1)<<31,i<128))return Tl(n,o);throw new Error("Expected varint not more than 10 bytes")}function Xc(n){const e=n.buf;let t=e[n.pos++],i=t&127;return t<128||(t=e[n.pos++],i|=(t&127)<<7,t<128)||(t=e[n.pos++],i|=(t&127)<<14,t<128)||(t=e[n.pos++],i|=(t&127)<<21,t<128)?i:(t=e[n.pos],i|=(t&15)<<28,s2(i,n))}function r2(n,e,t,i){if(i===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const o=e[0];e[0]=e[1],e[1]=o}}var o2=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function a2(n,e,t){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>zl(2,n)-1||t>zl(2,n)-1)throw Error("tile x/y outside zoom level bounds");const i=o2[n],o=zl(2,n);let h=0,u=0,l=0;const p=[e,t];let y=o/2;for(;y>0;)h=(p[0]&y)>0?1:0,u=(p[1]&y)>0?1:0,l+=y*y*(3*h^u),r2(y,p,h,u),y=y/2;return i+l}function a1(n,e){return ps(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return kp(new Uint8Array(n));const t=new Response(n).body;if(!t)throw Error("Failed to read response stream");const i=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}var l2=127;function c2(n,e){let t=0,i=n.length-1;for(;t<=i;){const o=i+t>>1,h=e-n[o].tileId;if(h>0)t=o+1;else if(h<0)i=o-1;else return n[o]}return i>=0&&(n[i].runLength===0||e-n[i].tileId<n[i].runLength)?n[i]:null}var h2=class{constructor(n,e=new Headers){this.url=n,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(n){this.customHeaders=n}getBytes(n,e,t,i){return ps(this,null,function*(){let o,h;t?h=t:(o=new AbortController,h=o.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${n}-${n+e-1}`);let l;this.mustReload&&(l="reload");let p=yield fetch(this.url,{signal:h,cache:l,headers:u});if(n===0&&p.status===416){const S=p.headers.get("Content-Range");if(!S||!S.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const z=+S.substr(8);p=yield fetch(this.url,{signal:h,cache:"reload",headers:{range:`bytes=0-${z-1}`}})}let y=p.headers.get("Etag");if(y!=null&&y.startsWith("W/")&&(y=null),p.status===416||i&&y&&y!==i)throw this.mustReload=!0,new Sp(i);if(p.status>=300)throw Error(`Bad response code: ${p.status}`);const k=p.headers.get("Content-Length");if(p.status===200&&(!k||+k>e))throw o&&o.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield p.arrayBuffer(),etag:y||void 0,cacheControl:p.headers.get("Cache-Control")||void 0,expires:p.headers.get("Expires")||void 0}})}};function Tr(n,e){const t=n.getUint32(e+4,!0),i=n.getUint32(e+0,!0);return t*zl(2,32)+i}function u2(n,e){const t=new DataView(n),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:Tr(t,8),rootDirectoryLength:Tr(t,16),jsonMetadataOffset:Tr(t,24),jsonMetadataLength:Tr(t,32),leafDirectoryOffset:Tr(t,40),leafDirectoryLength:Tr(t,48),tileDataOffset:Tr(t,56),tileDataLength:Tr(t,64),numAddressedTiles:Tr(t,72),numTileEntries:Tr(t,80),numTileContents:Tr(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function l1(n){const e={buf:new Uint8Array(n),pos:0},t=Xc(e),i=[];let o=0;for(let h=0;h<t;h++){const u=Xc(e);i.push({tileId:o+u,offset:0,length:0,runLength:1}),o+=u}for(let h=0;h<t;h++)i[h].runLength=Xc(e);for(let h=0;h<t;h++)i[h].length=Xc(e);for(let h=0;h<t;h++){const u=Xc(e);u===0&&h>0?i[h].offset=i[h-1].offset+i[h-1].length:i[h].offset=u-1}return i}function d2(n){const e=new DataView(n);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Sp=class extends Error{};function f2(n,e){return ps(this,null,function*(){const t=yield n.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(d2(t.data)<3)return[yield o1.getHeader(n)];const o=t.data.slice(0,l2),h=u2(o,t.etag),u=t.data.slice(h.rootDirectoryOffset,h.rootDirectoryOffset+h.rootDirectoryLength),l=`${n.getKey()}|${h.etag||""}|${h.rootDirectoryOffset}|${h.rootDirectoryLength}`,p=l1(yield e(u,h.internalCompression));return[h,[l,p.length,p]]})}function p2(n,e,t,i,o){return ps(this,null,function*(){const h=yield n.getBytes(t,i,void 0,o.etag),u=yield e(h.data,o.internalCompression),l=l1(u);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var m2=class{constructor(n=100,e=!0,t=a1){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=n,this.counter=1,this.decompress=t}getHeader(n){return ps(this,null,function*(){const e=n.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const i=new Promise((o,h)=>{f2(n,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),o(u[0]),this.prune()}).catch(u=>{h(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(n,e,t,i){return ps(this,null,function*(){const o=`${n.getKey()}|${i.etag||""}|${e}|${t}`,h=this.cache.get(o);if(h)return h.lastUsed=this.counter++,yield h.data;const u=new Promise((l,p)=>{p2(n,this.decompress,e,t,i).then(y=>{l(y),this.prune()}).catch(y=>{p(y)})});return this.cache.set(o,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(n,e,t,i){return ps(this,null,function*(){const o=`${n.getKey()}|${i.etag||""}|${e}|${t}`,h=this.cache.get(o);if(h)return h.lastUsed=this.counter++,yield h.data;const u=new Promise((l,p)=>{n.getBytes(e,t,void 0,i.etag).then(y=>{l(y.data),this.cache.has(o),this.prune()}).catch(y=>{p(y)})});return this.cache.set(o,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,e;this.cache.forEach((t,i)=>{t.lastUsed<n&&(n=t.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(n){return ps(this,null,function*(){const e=n.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(n.getKey());const t=new Promise((i,o)=>{this.getHeader(n).then(h=>{i(),this.invalidations.delete(e)}).catch(h=>{o(h)})});this.invalidations.set(e,t)})}},c_=class{constructor(n,e,t){typeof n=="string"?this.source=new h2(n):this.source=n,t?this.decompress=t:this.decompress=a1,e?this.cache=e:this.cache=new m2}getHeader(){return ps(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,e,t,i){return ps(this,null,function*(){const o=a2(n,e,t),h=yield this.cache.getHeader(this.source);if(h.specVersion<3)return o1.getZxy(h,this.source,this.cache,n,e,t,i);if(n<h.minZoom||n>h.maxZoom)return;let u=h.rootDirectoryOffset,l=h.rootDirectoryLength;for(let p=0;p<=3;p++){const y=yield this.cache.getDirectory(this.source,u,l,h),k=c2(y,o);if(k){if(k.runLength>0){const C=yield this.source.getBytes(h.tileDataOffset+k.offset,k.length,i,h.etag);return{data:yield this.decompress(C.data,h.tileCompression),cacheControl:C.cacheControl,expires:C.expires}}u=h.leafDirectoryOffset+k.offset,l=k.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,e,t,i){return ps(this,null,function*(){try{return yield this.getZxyAttempt(n,e,t,i)}catch(o){if(o instanceof Sp)return this.cache.invalidate(this.source),yield this.getZxyAttempt(n,e,t,i);throw o}})}getMetadataAttempt(){return ps(this,null,function*(){const n=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength,void 0,n.etag),t=yield this.decompress(e.data,n.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return ps(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof Sp)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw n}})}};const Vs=class Vs{constructor(e,t){Ge(this,"location");Ge(this,"zoom");Ge(this,"bounds");Ge(this,"rasterLayer");Ge(this,"maxbounds");Ge(this,"allowMoving");Ge(this,"allowRotating");Ge(this,"allowZooming");Ge(this,"lastClickLocation");Ge(this,"minzoom");Ge(this,"maxzoom");Ge(this,"rotation");Ge(this,"pitch");Ge(this,"useTerrain");Ge(this,"showScale");Ge(this,"_onKeyNavigation",[]);Ge(this,"_maplibreMap");Ge(this,"scaleControl");var l,p;Vs.pmtilesInited||(Vv.addProtocol("pmtiles",new n2().tile),Vs.pmtilesInited=!0),this._maplibreMap=e,this.location=(t==null?void 0:t.location)??new Tt(void 0),this.location.data&&this.location.setData({...this.location.data}),this.zoom=(t==null?void 0:t.zoom)??new Tt(1),this.minzoom=(t==null?void 0:t.minzoom)??new Tt(.5),this.maxzoom=(t==null?void 0:t.maxzoom)??new Tt(24),this.zoom.addCallbackAndRunD(y=>{y<this.minzoom.data&&this.zoom.setData(this.minzoom.data);const k=Math.min(24,this.maxzoom.data??24);y>k&&this.zoom.setData(k)}),this.maxbounds=(t==null?void 0:t.maxbounds)??new Tt(void 0),this.allowMoving=(t==null?void 0:t.allowMoving)??new Tt(!0),this.allowRotating=(t==null?void 0:t.allowRotating)??new Tt(!0),this.allowZooming=(t==null?void 0:t.allowZooming)??new Tt(!0),this.bounds=(t==null?void 0:t.bounds)??new Tt(void 0),this.rotation=(t==null?void 0:t.rotation)??new Tt(0),this.pitch=(t==null?void 0:t.pitch)??new Tt(0),this.useTerrain=(t==null?void 0:t.useTerrain)??new id(!1),this.rasterLayer=(t==null?void 0:t.rasterLayer)??new Tt(void 0),this.showScale=(t==null?void 0:t.showScale)??new Tt(!1);const i=new Tt(void 0);this.lastClickLocation=i;const o=this;new gh(this._maplibreMap,this.rasterLayer);const h=["left","middle","right"];function u(y,k){if(y.originalEvent.consumed)return;const C=y.lngLat.lng,S=y.lngLat.lat,z=y.originalEvent;k=k??h[z.button],i.setData({lon:C,lat:S,mode:k})}e.addCallbackAndRunD(y=>{y.on("load",()=>{o.MoveMapToCurrentLoc(o.location.data),o.SetZoom(o.zoom.data),o.setMaxBounds(o.maxbounds.data),o.setAllowMoving(o.allowMoving.data),o.setAllowRotating(o.allowRotating.data),o.setAllowZooming(o.allowZooming.data),o.setMinzoom(o.minzoom.data),o.setMaxzoom(o.maxzoom.data),o.setBounds(o.bounds.data),o.setTerrain(o.useTerrain.data),o.setScale(o.showScale.data),this.updateStores(!0)}),o.MoveMapToCurrentLoc(o.location.data),o.SetZoom(o.zoom.data),o.setMaxBounds(o.maxbounds.data),o.setAllowMoving(o.allowMoving.data),o.setAllowRotating(o.allowRotating.data),o.setAllowZooming(o.allowZooming.data),o.setMinzoom(o.minzoom.data),o.setMaxzoom(o.maxzoom.data),o.setBounds(o.bounds.data),o.SetRotation(o.rotation.data),o.setTerrain(o.useTerrain.data),o.setScale(o.showScale.data),this.updateStores(!0),y.on("moveend",()=>this.updateStores()),y.on("click",k=>{u(k)}),y._container.addEventListener("contextmenu",k=>{const C=y.unproject([k.x,k.y]);i.setData({lon:C.lng,lat:C.lat,mode:"right"})}),y.on("dblclick",k=>{u(k,"left")}),y.on("touchend",k=>{k.originalEvent}),y.on("rotateend",k=>{this.updateStores()}),y.on("pitchend",()=>{this.updateStores()}),y.getContainer().addEventListener("keydown",k=>{let C;switch(this.allowMoving.data||(C="islocked"),k.key){case"ArrowUp":this.pingKeycodeEvent(C??"north");break;case"ArrowRight":this.pingKeycodeEvent(C??"east");break;case"ArrowDown":this.pingKeycodeEvent(C??"south");break;case"ArrowLeft":this.pingKeycodeEvent(C??"west");break;case"+":this.pingKeycodeEvent("in");break;case"=":this.pingKeycodeEvent("in");break;case"-":this.pingKeycodeEvent("out");break}})}),this.location.addCallbackAndRunD(y=>{o.MoveMapToCurrentLoc(y)}),this.zoom.addCallbackAndRunD(y=>o.SetZoom(y)),this.maxbounds.addCallbackAndRun(y=>o.setMaxBounds(y)),this.rotation.addCallbackAndRunD(y=>o.SetRotation(y)),this.allowMoving.addCallbackAndRun(y=>{o.setAllowMoving(y),o.pingKeycodeEvent(y?"unlocked":"locked")}),this.allowRotating.addCallbackAndRunD(y=>o.setAllowRotating(y)),this.allowZooming.addCallbackAndRun(y=>o.setAllowZooming(y)),this.bounds.addCallbackAndRunD(y=>o.setBounds(y)),(l=this.useTerrain)==null||l.addCallbackAndRun(y=>o.setTerrain(y)),(p=this.showScale)==null||p.addCallbackAndRun(y=>o.setScale(y))}static construct(){const e=new Tt(void 0);return{map:e,ui:new Sd(q0,{map:e}),mapproperties:new Vs(e)}}static prepareWmsSource(e){return gh.prepareSource(e)}static async toBlob(e){return await new Promise(t=>e.toBlob(i=>t(i)))}static async createImage(e){return new Promise((t,i)=>{const o=new Image;o.decode=()=>t(o),o.onload=()=>t(o),o.onerror=i,o.crossOrigin="anonymous",o.decoding="async",o.src=e})}onKeyNavigationEvent(e){return this._onKeyNavigation.push(e),()=>{this._onKeyNavigation.splice(this._onKeyNavigation.indexOf(e),1)}}async exportAsPng(e=1,t=void 0){const i=this._maplibreMap.data;if(!i)return;const o=document.createElement("canvas",{}),h=o.getContext("2d"),u=i.getContainer().getBoundingClientRect().width,l=i.getContainer().getBoundingClientRect().height,p=i.getPixelRatio();return o.style.width=u+"px",o.style.height=l+"px",o.width=Math.ceil(u*p),o.height=Math.ceil(l*p),await this.exportBackgroundOnCanvas(h),await this.drawMarkers(h,e,t),await Vs.toBlob(o)}pingKeycodeEvent(e){const t={date:new Date,key:e};for(let i=0;i<this._onKeyNavigation.length;i++){const o=this._onKeyNavigation[i];o(t)===!0&&(this._onKeyNavigation.splice(i,1),i--)}}async exportBackgroundOnCanvas(e){const t=this._maplibreMap.data,i=new Promise(o=>{t.once("render",()=>{e.drawImage(t.getCanvas(),0,0),o()})});for(;!t.isStyleLoaded();)console.log("Waiting to fully load the style..."),await Ni.waitFor(100);t.triggerRepaint(),await i}async drawElement(e,t,i,o){{const X=t.getElementsByTagName("img");for(const re of Array.from(X)){let W=!1;for(;!W;)console.log("Waiting for image",re.src,"to load",re.complete,re.naturalWidth,re),await Ni.waitFor(250),W=re.complete&&re.width>0}}const h=t.style.transform;let u=t.getBoundingClientRect().x,l=t.getBoundingClientRect().y;t.style.transform="";const p=h.match(/translate\(([-0-9]+)%, ?([-0-9]+)%\)/);let y=Array.from(t.getElementsByClassName("marker-label"));const k=y.map(X=>X.style.transform),C=t.style.width,S=Number(t.style.height),z=Math.max(t.getBoundingClientRect().width*4,...y.map(X=>X.getBoundingClientRect().width)),R=t.getBoundingClientRect().height+Math.max(...y.map(X=>X.getBoundingClientRect().height*2));t.style.width=z+"px",t.style.height=R+"px",t.classList.add("w-full","flex","flex-col","items-center"),y.forEach(X=>{X.style.transform=""}),await Ni.awaitAnimationFrame();const j=await Iw(t),H=await Vs.createImage(j);for(let X=0;X<y.length;X++)y[X].style.transform=k[X];if(t.style.width=""+C,t.style.height=""+S,p&&i!==1){const[X,re,W]=p,ae=Number(W);l+=H.height*(ae/100)}u*=o,l*=o;try{const X=H.width*i/2;e.drawImage(H,u-X,l,H.width*i,H.height*i)}catch(X){console.log("Could not draw image because of",X)}t.classList.remove("w-full","flex","flex-col","items-center")}async drawMarkers(e,t=1,i){const o=this._maplibreMap.data;if(!o){console.error("There is no map to export from");return}const h=o.getContainer(),u=o.getPixelRatio();function l(y){const k=y.getBoundingClientRect(),C=h.getBoundingClientRect();return!(C.left>k.right||C.right<k.left||C.top>k.bottom||C.bottom<k.top)}const p=Array.from(h.getElementsByClassName("marker"));for(let y=0;y<p.length;y++){const k=p[y],C=k.style.transform;l(k)&&await this.drawElement(e,k,t,u),i&&i.setData({current:y,total:p.length}),k.style.transform=C}}updateStores(e=!1){const t=this._maplibreMap.data;if(!t)return;const{lng:i,lat:o}=t.getCenter();if(i===0&&o===0)return;if(this.location.data===void 0)this.location.setData({lon:i,lat:o});else if(!e){const l=t.getCenter().lng,p=t.getCenter().lat;this.location.setData({lon:l,lat:p})}this.zoom.setData(Math.round(t.getZoom()*10)/10);const h=t.getBounds(),u=new vv([[h.getEast(),h.getNorth()],[h.getWest(),h.getSouth()]]);(this.bounds.data===void 0||!e)&&this.bounds.setData(u),this.rotation.setData(t.getBearing()),this.pitch.setData(t.getPitch())}SetZoom(e){const t=this._maplibreMap.data;!t||e===void 0||Math.abs(t.getZoom()-e)>.01&&t.setZoom(e)}SetRotation(e){const t=this._maplibreMap.data;!t||e===void 0||t.rotateTo(e,{duration:0})}MoveMapToCurrentLoc(e){const t=this._maplibreMap.data;if(!t||e===void 0)return;const i=t.getCenter();(i.lng!==e.lon||i.lat!==e.lat)&&(isNaN(e.lon)||isNaN(e.lat)?console.error("Got invalid lat or lon, not setting"):t.setCenter({lng:e.lon,lat:e.lat}))}installCustomKeyboardHandler(e){e.mapD(t=>{const i=this._maplibreMap.data;if(!i)return;const o=i.keyboard,h=t.getBoundingClientRect().width;if(h<10){console.log("Got a very small bound",h,t),window.requestAnimationFrame(()=>{e.ping()});return}o._panStep=h},[this._maplibreMap])}setMaxBounds(e){const t=this._maplibreMap.data;t&&(e?t==null||t.setMaxBounds(e.toLngLat()):t==null||t.setMaxBounds(null))}setAllowRotating(e){const t=this._maplibreMap.data;t&&(e===!1?(t.rotateTo(0,{duration:0}),t.setPitch(0),t.dragRotate.disable(),t.keyboard.disableRotation(),t.touchZoomRotate.disableRotation()):(t.dragRotate.enable(),t.keyboard.enableRotation(),t.touchZoomRotate.enableRotation()))}setAllowMoving(e){const t=this._maplibreMap.data;if(t){if(e===!1)for(const i of Vs.maplibre_control_handlers)t[i].disable();else for(const i of Vs.maplibre_control_handlers)t[i].enable();this.setAllowRotating(this.allowRotating.data)}}setMinzoom(e){const t=this._maplibreMap.data;t&&t.setMinZoom(e)}setMaxzoom(e){const t=this._maplibreMap.data;t&&t.setMaxZoom(e)}setAllowZooming(e){const t=this._maplibreMap.data;if(t)if(e===!1)for(const i of Vs.maplibre_zoom_handlers)t[i].disable();else for(const i of Vs.maplibre_zoom_handlers)t[i].enable()}setBounds(e){const t=this._maplibreMap.data;if(!t||e===void 0)return;const i=t.getBounds(),o=1e-7;Math.abs(i.getWest()-e.getWest())>o&&Math.abs(i.getEast()-e.getEast())>o&&Math.abs(i.getNorth()-e.getNorth())>o&&Math.abs(i.getSouth()-e.getSouth())>o&&t.fitBounds(e.toLngLat())}async setTerrain(e){const t=this._maplibreMap.data;if(!t)return;const i="maptiler-terrain-data";if(e){if(t.getTerrain())return;t.addSource(i,{type:"raster-dem",url:"https://api.maptiler.com/tiles/terrain-rgb/tiles.json?key="+Bv.maptilerApiKey});try{for(;!(t!=null&&t.isStyleLoaded());)await Ni.waitFor(250);t.setTerrain({source:i})}catch(o){console.error(o)}}}setScale(e){const t=this._maplibreMap.data;if(t){if(!e){this.scaleControl&&(t.removeControl(this.scaleControl),this.scaleControl=void 0);return}this.scaleControl===void 0&&(this.scaleControl=new rd.ScaleControl({maxWidth:100,unit:"metric"})),t.hasControl(this.scaleControl)||t.addControl(this.scaleControl,"bottom-right")}}};Ge(Vs,"maplibre_control_handlers",["dragRotate","dragPan","keyboard","touchZoomRotate"]),Ge(Vs,"maplibre_zoom_handlers",["scrollZoom","boxZoom","doubleClickZoom","touchZoomRotate"]),Ge(Vs,"pmtilesInited",!1);let Cp=Vs;function g2(n){let e,t,i,o,h;const u=n[2].default,l=jn(u,n,n[1],null);let p=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},{viewBox:"0 0 24 24"},{"stroke-width":"1.5"},{stroke:"currentColor"},{"aria-hidden":"true"},n[0]],y={};for(let k=0;k<p.length;k+=1)y=Ht(y,p[k]);return{c(){e=Re("svg"),l&&l.c(),t=Re("path"),ie(t,"stroke-linecap","round"),ie(t,"stroke-linejoin","round"),ie(t,"d","M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"),An(e,y)},m(k,C){qe(k,e,C),l&&l.m(e,null),ue(e,t),i=!0,o||(h=[Je(e,"click",n[3]),Je(e,"mouseover",n[4]),Je(e,"mouseenter",n[5]),Je(e,"mouseleave",n[6]),Je(e,"keydown",n[7])],o=!0)},p(k,[C]){l&&l.p&&(!i||C&2)&&qn(l,u,k,k[1],i?Wn(u,k[1],C,null):Hn(k[1]),null),An(e,y=bs(p,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},{viewBox:"0 0 24 24"},{"stroke-width":"1.5"},{stroke:"currentColor"},{"aria-hidden":"true"},C&1&&k[0]]))},i(k){i||(we(l,k),i=!0)},o(k){Ce(l,k),i=!1},d(k){k&&je(e),l&&l.d(k),o=!1,es(h)}}}function _2(n,e,t){const i=[];let o=Ui(e,i),{$$slots:h={},$$scope:u}=e;function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(0,o=Ui(e,i)),"$$scope"in S&&t(1,u=S.$$scope)},[o,u,h,l,p,y,k,C]}class y2 extends Gt{constructor(e){super(),Xt(this,e,_2,g2,Kt,{})}}function b2(n){let e,t,i,o,h;const u=n[2].default,l=jn(u,n,n[1],null);let p=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},n[0]],y={};for(let k=0;k<p.length;k+=1)y=Ht(y,p[k]);return{c(){e=Re("svg"),l&&l.c(),t=Re("path"),ie(t,"fill-rule","evenodd"),ie(t,"d","M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"),ie(t,"clip-rule","evenodd"),An(e,y)},m(k,C){qe(k,e,C),l&&l.m(e,null),ue(e,t),i=!0,o||(h=[Je(e,"click",n[3]),Je(e,"mouseover",n[4]),Je(e,"mouseenter",n[5]),Je(e,"mouseleave",n[6]),Je(e,"keydown",n[7])],o=!0)},p(k,[C]){l&&l.p&&(!i||C&2)&&qn(l,u,k,k[1],i?Wn(u,k[1],C,null):Hn(k[1]),null),An(e,y=bs(p,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 20 20"},{fill:"currentColor"},{"aria-hidden":"true"},C&1&&k[0]]))},i(k){i||(we(l,k),i=!0)},o(k){Ce(l,k),i=!1},d(k){k&&je(e),l&&l.d(k),o=!1,es(h)}}}function x2(n,e,t){const i=[];let o=Ui(e,i),{$$slots:h={},$$scope:u}=e;function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(0,o=Ui(e,i)),"$$scope"in S&&t(1,u=S.$$scope)},[o,u,h,l,p,y,k,C]}class v2 extends Gt{constructor(e){super(),Xt(this,e,x2,b2,Kt,{})}}class w2 extends kh{InnerConstructElement(){const e=this.InnerRender();if(e===void 0||e==="")return;const t=document.createElement("span");if(typeof e=="string")t.innerHTML=e;else{const i=e.ConstructElement();if(i===void 0)return;t.appendChild(i)}return t}}class zd extends kh{constructor(t,i=!1,o){super();Ge(this,"_src");Ge(this,"_rawSvg");Ge(this,"_options");if(t===void 0||t==="undefined")throw"Undefined src for image";this._src=t,this._rawSvg=i,this._options=o}static AsData(t){if(Ni.runningFromConsole)return t;try{return`data:image/svg+xml;base64,${btoa(t)}`}catch(i){return console.error("Cannot create an image for",t.slice(0,100)),console.trace("Cannot create an image for the given source string due to ",i),""}}static AsImageElement(t,i="",o=""){return`<img class="${i}" style="${o}" alt="" src="${zd.AsData(t)}">`}AsMarkdown(){if(this._rawSvg===!0){console.warn("Converting raw svgs to markdown is not supported");return}let t=this._src;return this._src.startsWith("./")&&(t="https://mapcomplete.org/"+t),"![]("+t+")"}InnerConstructElement(){const t=this;if(this._rawSvg){const o=document.createElement("div");return o.innerHTML=this._src,o}const i=document.createElement("img");return i.src=this._src,i.onload=()=>{i.style.opacity="1"},i.onerror=()=>{var o;if((o=t._options)!=null&&o.fallbackImage){if(i.src===t._options.fallbackImage)return;i.src=t._options.fallbackImage}},i}}const k2=n=>({}),h_=n=>({});function u_(n){let e,t,i,o;const h=[C2,S2],u=[];function l(p,y){return typeof p[0]=="string"?0:1}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,y){let k=e;e=l(p),e===k?u[e].p(p,y):(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai(),t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i))},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function S2(n){let e;return{c(){e=et("template")},m(t,i){qe(t,e,i),n[8](e)},p:St,i:St,o:St,d(t){t&&je(e),n[8](null)}}}function C2(n){let e,t;return e=new zd({props:{src:n[0],class:n[5]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&1&&(h.src=i[0]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function T2(n){let e,t,i=n[0]!==void 0&&u_(n);return{c(){i&&i.c(),e=Di()},m(o,h){i&&i.m(o,h),qe(o,e,h),t=!0},p(o,h){o[0]!==void 0?i?(i.p(o,h),h&1&&we(i,1)):(i=u_(o),i.c(),we(i,1),i.m(e.parentNode,e)):i&&(oi(),Ce(i,1,1,()=>{i=null}),ai())},i(o){t||(we(i),t=!0)},o(o){Ce(i),t=!1},d(o){i&&i.d(o),o&&je(e)}}}function M2(n){let e,t,i,o,h,u;const l=n[7].image,p=jn(l,n,n[6],h_),y=p||T2(n),k=n[7].default,C=jn(k,n,n[6],null);return{c(){e=et("a"),y&&y.c(),t=xt(),C&&C.c(),ie(e,"class",i=Fl(n[3].extraClasses,"button text-ellipsis")),ie(e,"href",n[1]),ie(e,"target",o=n[2]?"_blank":void 0),ie(e,"rel",h=n[2]?"noopener":void 0)},m(S,z){qe(S,e,z),y&&y.m(e,null),ue(e,t),C&&C.m(e,null),u=!0},p(S,[z]){p?p.p&&(!u||z&64)&&qn(p,l,S,S[6],u?Wn(l,S[6],z,k2):Hn(S[6]),h_):y&&y.p&&(!u||z&17)&&y.p(S,u?z:-1),C&&C.p&&(!u||z&64)&&qn(C,k,S,S[6],u?Wn(k,S[6],z,null):Hn(S[6]),null),(!u||z&8&&i!==(i=Fl(S[3].extraClasses,"button text-ellipsis")))&&ie(e,"class",i),(!u||z&2)&&ie(e,"href",S[1]),(!u||z&4&&o!==(o=S[2]?"_blank":void 0))&&ie(e,"target",o),(!u||z&4&&h!==(h=S[2]?"noopener":void 0))&&ie(e,"rel",h)},i(S){u||(we(y,S),we(C,S),u=!0)},o(S){Ce(y,S),Ce(C,S),u=!1},d(S){S&&je(e),y&&y.d(S),C&&C.d(S)}}}function P2(n,e,t){let{$$slots:i={},$$scope:o}=e,{imageUrl:h=void 0}=e,{href:u}=e,{newTab:l=!1}=e,{options:p={}}=e,y,k=Ev("block justify-center shrink-0 mr-4",(p==null?void 0:p.imgSize)??"h-11 w-11");Td(()=>{if(y&&h){let S;(h??"")===""?S=void 0:typeof h!="string"&&(S=h==null?void 0:h.SetClass(k)),S&&y.replaceWith(S.ConstructElement())}});function C(S){xo[S?"unshift":"push"](()=>{y=S,t(4,y)})}return n.$$set=S=>{"imageUrl"in S&&t(0,h=S.imageUrl),"href"in S&&t(1,u=S.href),"newTab"in S&&t(2,l=S.newTab),"options"in S&&t(3,p=S.options),"$$scope"in S&&t(6,o=S.$$scope)},[h,u,l,p,y,k,o,i,C]}class I2 extends Gt{constructor(e){super(),Xt(this,e,P2,M2,Kt,{imageUrl:0,href:1,newTab:2,options:3})}}class DP extends w2{constructor(t,i,o={}){super();Ge(this,"imageUrl");Ge(this,"message");Ge(this,"options");this.imageUrl=t,this.message=i,this.options=o}InnerRender(){var l,p,y,k;if(this.options.url!==void 0)return new Sd(I2,{href:this.options.url,newTab:this.options.newTab});const t="button",i=(l=gs.W(this.message))==null?void 0:l.SetClass("block overflow-ellipsis no-images flex-shrink");let o;const h="block justify-center flex-none mr-4 "+(((p=this.options)==null?void 0:p.imgSize)??"h-11 w-11");(this.imageUrl??"")===""?o=void 0:typeof this.imageUrl=="string"?o=(y=new zd(this.imageUrl))==null?void 0:y.SetClass(h):o=(k=this.imageUrl)==null?void 0:k.SetClass(h);const u=new Hp([o,i]).SetClass("flex items-center group w-full");return this.SetClass(t),u}}class A2{GetRelevantUrls(e,t){const i=(t==null?void 0:t.prefixes)??this.defaultKeyPrefixes;if(i===void 0)throw"No `defaultKeyPrefixes` defined by this image provider";const o=new Tt([]),h=new Set;return e.addCallbackAndRunD(u=>{var l,p;for(const y in u){if(!i.some(C=>y.startsWith(C)))continue;const k=Ni.NoEmpty(((p=(l=u[y])==null?void 0:l.split(";"))==null?void 0:p.map(C=>C.trim()))??[]);for(const C of k)h.has(C)||(h.add(C),this.ExtractUrls(y,C).then(S=>{for(const z of S??[])z!==void 0&&z.then(R=>{R!==void 0&&(o.data.push(R),o.ping())})}))}}),o}}class E2{constructor(){Ge(this,"title","");Ge(this,"artist","");Ge(this,"license");Ge(this,"licenseShortName","");Ge(this,"usageTerms","");Ge(this,"attributionRequired",!1);Ge(this,"copyrighted",!1);Ge(this,"credit","");Ge(this,"description","");Ge(this,"informationLocation");Ge(this,"date");Ge(this,"views")}}class Kp{static async GetCategoryContents(e,t=10,i=void 0){var y;if(e==null||e==="")return[];e.startsWith("Category:")||(e="Category:"+e);let o="https://commons.wikimedia.org/w/api.php?action=query&list=categorymembers&format=json&&origin=*&cmtitle="+encodeURIComponent(e);i!==void 0&&(o=`${o}&cmcontinue=${i}`);const h=await Ni.downloadJson(o),l=(((y=h.query)==null?void 0:y.categorymembers)??[]).map(k=>k.title);if(h.continue===void 0)return l;if(t-l.length<=0)return console.debug(`Recursive wikimedia category load stopped for ${e}`),l;const p=await Kp.GetCategoryContents(e,t-l.length,h.continue.cmcontinue);return l.push(...p),l}}function z2(n){let e,t,i,o,h,u,l,p,y,k,C,S,z,R,j,H,X,re,W,ae,de,Ae,xe,pe,ke,Ie,Ve,We,Oe,It,mt,Ft,Yt,Qt,Tn,ji,di,ii,Ci,Ti,Gi,qi,Xi,nt,sn,_n,Zn,En,$n,Ds,Fi,qs,De,Hs,or,Ut,Ki,ts,xi,is,Mn,Gn,Ls,Ws,Ye,yn,ln,xs,vs,Ke,At,Et,Hi,cn,Dt,ns,zn,Q,V,U,G,J,me,ge,be,ce,Se,Ne,Ee,Be,pt,wt,vt,Nt,Mt,ci,ni,fi,Lt,pi,Mi,hn,Yi,Wi,Dn,sa,ra=[n[0],{xmlns:"http://www.w3.org/2000/svg"},{width:"279px"},{height:"374px"},{viewBox:"0 0 279 374"},{version:"1.1"}],ei={};for(let ws=0;ws<ra.length;ws+=1)ei=Ht(ei,ra[ws]);return{c(){e=Re("svg"),t=Re("defs"),i=Re("clipPath"),o=Re("path"),h=Re("clipPath"),u=Re("path"),l=Re("clipPath"),p=Re("path"),y=Re("clipPath"),k=Re("path"),C=Re("clipPath"),S=Re("path"),z=Re("clipPath"),R=Re("path"),j=Re("clipPath"),H=Re("path"),X=Re("clipPath"),re=Re("path"),W=Re("clipPath"),ae=Re("path"),de=Re("clipPath"),Ae=Re("path"),xe=Re("clipPath"),pe=Re("path"),ke=Re("clipPath"),Ie=Re("path"),Ve=Re("clipPath"),We=Re("path"),Oe=Re("clipPath"),It=Re("path"),mt=Re("clipPath"),Ft=Re("path"),Yt=Re("clipPath"),Qt=Re("path"),Tn=Re("clipPath"),ji=Re("path"),di=Re("clipPath"),ii=Re("path"),Ci=Re("clipPath"),Ti=Re("path"),Gi=Re("clipPath"),qi=Re("path"),Xi=Re("clipPath"),nt=Re("path"),sn=Re("clipPath"),_n=Re("path"),Zn=Re("clipPath"),En=Re("path"),$n=Re("clipPath"),Ds=Re("path"),Fi=Re("clipPath"),qs=Re("path"),De=Re("clipPath"),Hs=Re("path"),or=Re("clipPath"),Ut=Re("path"),Ki=Re("clipPath"),ts=Re("path"),xi=Re("g"),is=Re("path"),Mn=Re("path"),Gn=Re("path"),Ls=Re("g"),Ws=Re("g"),Ye=Re("path"),yn=Re("g"),ln=Re("g"),xs=Re("path"),vs=Re("g"),Ke=Re("g"),At=Re("path"),Et=Re("g"),Hi=Re("g"),cn=Re("path"),Dt=Re("g"),ns=Re("g"),zn=Re("path"),Q=Re("g"),V=Re("g"),U=Re("path"),G=Re("g"),J=Re("g"),me=Re("path"),ge=Re("g"),be=Re("g"),ce=Re("path"),Se=Re("g"),Ne=Re("g"),Ee=Re("path"),Be=Re("g"),pt=Re("g"),wt=Re("path"),vt=Re("g"),Nt=Re("g"),Mt=Re("path"),ci=Re("g"),ni=Re("g"),fi=Re("path"),Lt=Re("g"),pi=Re("g"),Mi=Re("path"),hn=Re("g"),Yi=Re("g"),Wi=Re("path"),ie(o,"d","M 134 317 L 145 317 L 145 372 L 134 372 Z M 134 317 "),ie(i,"id","clip1"),ie(u,"d","M 275.746094 235.347656 C 275.746094 310.410156 214.746094 371.261719 139.5 371.261719 C 64.253906 371.261719 3.253906 310.410156 3.253906 235.347656 C 3.253906 160.28125 64.253906 99.429688 139.5 99.429688 C 214.746094 99.429688 275.746094 160.28125 275.746094 235.347656 Z M 275.746094 235.347656 "),ie(h,"id","clip2"),ie(p,"d","M 119 285 L 160 285 L 160 320 L 119 320 Z M 119 285 "),ie(l,"id","clip3"),ie(k,"d","M 275.746094 235.347656 C 275.746094 310.410156 214.746094 371.261719 139.5 371.261719 C 64.253906 371.261719 3.253906 310.410156 3.253906 235.347656 C 3.253906 160.28125 64.253906 99.429688 139.5 99.429688 C 214.746094 99.429688 275.746094 160.28125 275.746094 235.347656 Z M 275.746094 235.347656 "),ie(y,"id","clip4"),ie(S,"d","M 39 289 L 85 289 L 85 335 L 39 335 Z M 39 289 "),ie(C,"id","clip5"),ie(R,"d","M 235.839844 331.453125 C 182.632812 384.53125 96.367188 384.53125 43.160156 331.453125 C -10.046875 278.375 -10.046875 192.316406 43.160156 139.238281 C 96.367188 86.160156 182.632812 86.160156 235.839844 139.238281 C 289.046875 192.316406 289.046875 278.375 235.839844 331.453125 Z M 235.839844 331.453125 "),ie(z,"id","clip6"),ie(H,"d","M 65 270 L 104 270 L 104 309 L 65 309 Z M 65 270 "),ie(j,"id","clip7"),ie(re,"d","M 235.839844 331.453125 C 182.632812 384.53125 96.367188 384.53125 43.160156 331.453125 C -10.046875 278.375 -10.046875 192.316406 43.160156 139.238281 C 96.367188 86.160156 182.632812 86.160156 235.839844 139.238281 C 289.046875 192.316406 289.046875 278.375 235.839844 331.453125 Z M 235.839844 331.453125 "),ie(X,"id","clip8"),ie(ae,"d","M 3 230 L 58 230 L 58 241 L 3 241 Z M 3 230 "),ie(W,"id","clip9"),ie(Ae,"d","M 139.5 371.261719 C 64.253906 371.261719 3.253906 310.410156 3.253906 235.347656 C 3.253906 160.28125 64.253906 99.429688 139.5 99.429688 C 214.746094 99.429688 275.746094 160.28125 275.746094 235.347656 C 275.746094 310.410156 214.746094 371.261719 139.5 371.261719 Z M 139.5 371.261719 "),ie(de,"id","clip10"),ie(pe,"d","M 54 215 L 90 215 L 90 255 L 54 255 Z M 54 215 "),ie(xe,"id","clip11"),ie(Ie,"d","M 139.5 371.261719 C 64.253906 371.261719 3.253906 310.410156 3.253906 235.347656 C 3.253906 160.28125 64.253906 99.429688 139.5 99.429688 C 214.746094 99.429688 275.746094 160.28125 275.746094 235.347656 C 275.746094 310.410156 214.746094 371.261719 139.5 371.261719 Z M 139.5 371.261719 "),ie(ke,"id","clip12"),ie(We,"d","M 39 135 L 85 135 L 85 181 L 39 181 Z M 39 135 "),ie(Ve,"id","clip13"),ie(It,"d","M 43.160156 331.453125 C -10.046875 278.375 -10.046875 192.316406 43.160156 139.238281 C 96.367188 86.160156 182.632812 86.160156 235.839844 139.238281 C 289.046875 192.316406 289.046875 278.375 235.839844 331.453125 C 182.632812 384.53125 96.367188 384.53125 43.160156 331.453125 Z M 43.160156 331.453125 "),ie(Oe,"id","clip14"),ie(Ft,"d","M 65 161 L 104 161 L 104 200 L 65 200 Z M 65 161 "),ie(mt,"id","clip15"),ie(Qt,"d","M 43.160156 331.453125 C -10.046875 278.375 -10.046875 192.316406 43.160156 139.238281 C 96.367188 86.160156 182.632812 86.160156 235.839844 139.238281 C 289.046875 192.316406 289.046875 278.375 235.839844 331.453125 C 182.632812 384.53125 96.367188 384.53125 43.160156 331.453125 Z M 43.160156 331.453125 "),ie(Yt,"id","clip16"),ie(ji,"d","M 194 289 L 240 289 L 240 335 L 194 335 Z M 194 289 "),ie(Tn,"id","clip17"),ie(ii,"d","M 43.160156 331.453125 C 96.367188 384.53125 182.632812 384.53125 235.839844 331.453125 C 289.046875 278.375 289.046875 192.316406 235.839844 139.238281 C 182.632812 86.160156 96.367188 86.160156 43.160156 139.238281 C -10.046875 192.316406 -10.046875 278.375 43.160156 331.453125 Z M 43.160156 331.453125 "),ie(di,"id","clip18"),ie(Ti,"d","M 175 270 L 214 270 L 214 309 L 175 309 Z M 175 270 "),ie(Ci,"id","clip19"),ie(qi,"d","M 43.160156 331.453125 C 96.367188 384.53125 182.632812 384.53125 235.839844 331.453125 C 289.046875 278.375 289.046875 192.316406 235.839844 139.238281 C 182.632812 86.160156 96.367188 86.160156 43.160156 139.238281 C -10.046875 192.316406 -10.046875 278.375 43.160156 331.453125 Z M 43.160156 331.453125 "),ie(Gi,"id","clip20"),ie(nt,"d","M 221 230 L 276 230 L 276 241 L 221 241 Z M 221 230 "),ie(Xi,"id","clip21"),ie(_n,"d","M 139.5 371.261719 C 214.746094 371.261719 275.746094 310.410156 275.746094 235.347656 C 275.746094 160.28125 214.746094 99.429688 139.5 99.429688 C 64.253906 99.429688 3.253906 160.28125 3.253906 235.347656 C 3.253906 310.410156 64.253906 371.261719 139.5 371.261719 Z M 139.5 371.261719 "),ie(sn,"id","clip22"),ie(En,"d","M 189 215 L 225 215 L 225 255 L 189 255 Z M 189 215 "),ie(Zn,"id","clip23"),ie(Ds,"d","M 139.5 371.261719 C 214.746094 371.261719 275.746094 310.410156 275.746094 235.347656 C 275.746094 160.28125 214.746094 99.429688 139.5 99.429688 C 64.253906 99.429688 3.253906 160.28125 3.253906 235.347656 C 3.253906 310.410156 64.253906 371.261719 139.5 371.261719 Z M 139.5 371.261719 "),ie($n,"id","clip24"),ie(qs,"d","M 194 135 L 240 135 L 240 181 L 194 181 Z M 194 135 "),ie(Fi,"id","clip25"),ie(Hs,"d","M 235.839844 331.453125 C 289.046875 278.375 289.046875 192.316406 235.839844 139.238281 C 182.632812 86.160156 96.367188 86.160156 43.160156 139.238281 C -10.046875 192.316406 -10.046875 278.375 43.160156 331.453125 C 96.367188 384.53125 182.632812 384.53125 235.839844 331.453125 Z M 235.839844 331.453125 "),ie(De,"id","clip26"),ie(Ut,"d","M 175 161 L 214 161 L 214 200 L 175 200 Z M 175 161 "),ie(or,"id","clip27"),ie(ts,"d","M 235.839844 331.453125 C 289.046875 278.375 289.046875 192.316406 235.839844 139.238281 C 182.632812 86.160156 96.367188 86.160156 43.160156 139.238281 C -10.046875 192.316406 -10.046875 278.375 43.160156 331.453125 C 96.367188 384.53125 182.632812 384.53125 235.839844 331.453125 Z M 235.839844 331.453125 "),ie(Ki,"id","clip28"),Le(is,"stroke","none"),Le(is,"fill-rule","nonzero"),Le(is,"fill","rgb(100%,100%,100%)"),Le(is,"fill-opacity","1"),ie(is,"d","M 185.21875 235.347656 C 185.21875 260.535156 164.75 280.957031 139.5 280.957031 C 114.25 280.957031 93.78125 260.535156 93.78125 235.347656 C 93.78125 210.15625 114.25 189.738281 139.5 189.738281 C 164.75 189.738281 185.21875 210.15625 185.21875 235.347656 Z M 185.21875 235.347656 "),Le(Mn,"fill","none",1),Le(Mn,"stroke-width","84"),Le(Mn,"stroke-linecap","butt"),Le(Mn,"stroke-linejoin","miter"),Le(Mn,"stroke","rgb(100%,100%,100%)"),Le(Mn,"stroke-opacity","1"),Le(Mn,"stroke-miterlimit","4"),ie(Mn,"d","M -0.000738017 -255.996731 C -141.388895 -256.001049 -256.005126 -141.384818 -256.000807 0.00333872 C -256.00253 141.385454 -141.385454 256.00253 -0.00333872 256.000807 C 141.384818 256.005126 256.001049 141.388895 255.996731 0.000738017 C 256.002819 -100.002285 155.001784 -149.999521 250.002579 -275.001813 "),ie(Mn,"transform","matrix(0.323291,-0.32251,0.323291,0.32251,139.5,235.346341)"),Le(Gn,"stroke","none"),Le(Gn,"fill-rule","nonzero"),Le(Gn,"fill","rgb(100%,100%,100%)"),Le(Gn,"fill-opacity","1"),ie(Gn,"d","M 128.984375 0.457031 C 128.984375 0.457031 112.523438 62.027344 92.40625 84.835938 C 72.292969 107.640625 145.445312 56.554688 170.132812 82.554688 C 194.820312 108.550781 128.984375 0.457031 128.984375 0.457031 Z M 128.984375 0.457031 "),Le(Ye,"stroke","none"),Le(Ye,"fill-rule","nonzero"),Le(Ye,"fill","rgb(100%,100%,100%)"),Le(Ye,"fill-opacity","1"),ie(Ye,"d","M 134.472656 317.445312 L 134.472656 371.261719 L 144.527344 371.261719 L 144.527344 317.445312 "),ie(Ws,"clip-path","url(#clip2)"),ie(Ws,"clip-rule","nonzero"),ie(Ls,"clip-path","url(#clip1)"),ie(Ls,"clip-rule","nonzero"),Le(xs,"stroke","none"),Le(xs,"fill-rule","nonzero"),Le(xs,"fill","rgb(100%,100%,100%)"),Le(xs,"fill-opacity","1"),ie(xs,"d","M 119.839844 319.722656 L 139.5 285.515625 L 159.160156 319.722656 "),ie(ln,"clip-path","url(#clip4)"),ie(ln,"clip-rule","nonzero"),ie(yn,"clip-path","url(#clip3)"),ie(yn,"clip-rule","nonzero"),Le(At,"stroke","none"),Le(At,"fill-rule","nonzero"),Le(At,"fill","rgb(100%,100%,100%)"),Le(At,"fill-opacity","1"),ie(At,"d","M 77.75 289.851562 L 39.601562 327.90625 L 46.714844 335 L 84.863281 296.945312 "),ie(Ke,"clip-path","url(#clip6)"),ie(Ke,"clip-rule","nonzero"),ie(vs,"clip-path","url(#clip5)"),ie(vs,"clip-rule","nonzero"),Le(cn,"stroke","none"),Le(cn,"fill-rule","nonzero"),Le(cn,"fill","rgb(100%,100%,100%)"),Le(cn,"fill-opacity","1"),ie(cn,"d","M 65.789062 281.144531 L 103.9375 270.824219 L 93.59375 308.878906 "),ie(Hi,"clip-path","url(#clip8)"),ie(Hi,"clip-rule","nonzero"),ie(Et,"clip-path","url(#clip7)"),ie(Et,"clip-rule","nonzero"),Le(zn,"stroke","none"),Le(zn,"fill-rule","nonzero"),Le(zn,"fill","rgb(100%,100%,100%)"),Le(zn,"fill-opacity","1"),ie(zn,"d","M 57.203125 230.328125 L 3.253906 230.328125 L 3.253906 240.363281 L 57.203125 240.363281 "),ie(ns,"clip-path","url(#clip10)"),ie(ns,"clip-rule","nonzero"),ie(Dt,"clip-path","url(#clip9)"),ie(Dt,"clip-rule","nonzero"),Le(U,"stroke","none"),Le(U,"fill-rule","nonzero"),Le(U,"fill","rgb(100%,100%,100%)"),Le(U,"fill-opacity","1"),ie(U,"d","M 54.917969 215.734375 L 89.207031 235.347656 L 54.917969 254.957031 "),ie(V,"clip-path","url(#clip12)"),ie(V,"clip-rule","nonzero"),ie(Q,"clip-path","url(#clip11)"),ie(Q,"clip-rule","nonzero"),Le(me,"stroke","none"),Le(me,"fill-rule","nonzero"),Le(me,"fill","rgb(100%,100%,100%)"),Le(me,"fill-opacity","1"),ie(me,"d","M 84.863281 173.746094 L 46.714844 135.691406 L 39.601562 142.785156 L 77.75 180.84375 "),ie(J,"clip-path","url(#clip14)"),ie(J,"clip-rule","nonzero"),ie(G,"clip-path","url(#clip13)"),ie(G,"clip-rule","nonzero"),Le(ce,"stroke","none"),Le(ce,"fill-rule","nonzero"),Le(ce,"fill","rgb(100%,100%,100%)"),Le(ce,"fill-opacity","1"),ie(ce,"d","M 93.59375 161.8125 L 103.9375 199.871094 L 65.789062 189.550781 "),ie(be,"clip-path","url(#clip16)"),ie(be,"clip-rule","nonzero"),ie(ge,"clip-path","url(#clip15)"),ie(ge,"clip-rule","nonzero"),Le(Ee,"stroke","none"),Le(Ee,"fill-rule","nonzero"),Le(Ee,"fill","rgb(100%,100%,100%)"),Le(Ee,"fill-opacity","1"),ie(Ee,"d","M 201.25 289.851562 L 239.398438 327.90625 L 232.285156 335 L 194.136719 296.945312 "),ie(Ne,"clip-path","url(#clip18)"),ie(Ne,"clip-rule","nonzero"),ie(Se,"clip-path","url(#clip17)"),ie(Se,"clip-rule","nonzero"),Le(wt,"stroke","none"),Le(wt,"fill-rule","nonzero"),Le(wt,"fill","rgb(100%,100%,100%)"),Le(wt,"fill-opacity","1"),ie(wt,"d","M 213.210938 281.144531 L 175.0625 270.824219 L 185.40625 308.878906 "),ie(pt,"clip-path","url(#clip20)"),ie(pt,"clip-rule","nonzero"),ie(Be,"clip-path","url(#clip19)"),ie(Be,"clip-rule","nonzero"),Le(Mt,"stroke","none"),Le(Mt,"fill-rule","nonzero"),Le(Mt,"fill","rgb(100%,100%,100%)"),Le(Mt,"fill-opacity","1"),ie(Mt,"d","M 221.796875 230.328125 L 275.746094 230.328125 L 275.746094 240.363281 L 221.796875 240.363281 "),ie(Nt,"clip-path","url(#clip22)"),ie(Nt,"clip-rule","nonzero"),ie(vt,"clip-path","url(#clip21)"),ie(vt,"clip-rule","nonzero"),Le(fi,"stroke","none"),Le(fi,"fill-rule","nonzero"),Le(fi,"fill","rgb(100%,100%,100%)"),Le(fi,"fill-opacity","1"),ie(fi,"d","M 224.082031 215.734375 L 189.792969 235.347656 L 224.082031 254.957031 "),ie(ni,"clip-path","url(#clip24)"),ie(ni,"clip-rule","nonzero"),ie(ci,"clip-path","url(#clip23)"),ie(ci,"clip-rule","nonzero"),Le(Mi,"stroke","none"),Le(Mi,"fill-rule","nonzero"),Le(Mi,"fill","rgb(100%,100%,100%)"),Le(Mi,"fill-opacity","1"),ie(Mi,"d","M 194.136719 173.746094 L 232.285156 135.691406 L 239.398438 142.785156 L 201.25 180.84375 "),ie(pi,"clip-path","url(#clip26)"),ie(pi,"clip-rule","nonzero"),ie(Lt,"clip-path","url(#clip25)"),ie(Lt,"clip-rule","nonzero"),Le(Wi,"stroke","none"),Le(Wi,"fill-rule","nonzero"),Le(Wi,"fill","rgb(100%,100%,100%)"),Le(Wi,"fill-opacity","1"),ie(Wi,"d","M 185.40625 161.8125 L 175.0625 199.871094 L 213.210938 189.550781 "),ie(Yi,"clip-path","url(#clip28)"),ie(Yi,"clip-rule","nonzero"),ie(hn,"clip-path","url(#clip27)"),ie(hn,"clip-rule","nonzero"),ie(xi,"id","surface1"),An(e,ei)},m(ws,Hr){qe(ws,e,Hr),ue(e,t),ue(t,i),ue(i,o),ue(t,h),ue(h,u),ue(t,l),ue(l,p),ue(t,y),ue(y,k),ue(t,C),ue(C,S),ue(t,z),ue(z,R),ue(t,j),ue(j,H),ue(t,X),ue(X,re),ue(t,W),ue(W,ae),ue(t,de),ue(de,Ae),ue(t,xe),ue(xe,pe),ue(t,ke),ue(ke,Ie),ue(t,Ve),ue(Ve,We),ue(t,Oe),ue(Oe,It),ue(t,mt),ue(mt,Ft),ue(t,Yt),ue(Yt,Qt),ue(t,Tn),ue(Tn,ji),ue(t,di),ue(di,ii),ue(t,Ci),ue(Ci,Ti),ue(t,Gi),ue(Gi,qi),ue(t,Xi),ue(Xi,nt),ue(t,sn),ue(sn,_n),ue(t,Zn),ue(Zn,En),ue(t,$n),ue($n,Ds),ue(t,Fi),ue(Fi,qs),ue(t,De),ue(De,Hs),ue(t,or),ue(or,Ut),ue(t,Ki),ue(Ki,ts),ue(e,xi),ue(xi,is),ue(xi,Mn),ue(xi,Gn),ue(xi,Ls),ue(Ls,Ws),ue(Ws,Ye),ue(xi,yn),ue(yn,ln),ue(ln,xs),ue(xi,vs),ue(vs,Ke),ue(Ke,At),ue(xi,Et),ue(Et,Hi),ue(Hi,cn),ue(xi,Dt),ue(Dt,ns),ue(ns,zn),ue(xi,Q),ue(Q,V),ue(V,U),ue(xi,G),ue(G,J),ue(J,me),ue(xi,ge),ue(ge,be),ue(be,ce),ue(xi,Se),ue(Se,Ne),ue(Ne,Ee),ue(xi,Be),ue(Be,pt),ue(pt,wt),ue(xi,vt),ue(vt,Nt),ue(Nt,Mt),ue(xi,ci),ue(ci,ni),ue(ni,fi),ue(xi,Lt),ue(Lt,pi),ue(pi,Mi),ue(xi,hn),ue(hn,Yi),ue(Yi,Wi),Dn||(sa=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],Dn=!0)},p(ws,[Hr]){An(e,ei=bs(ra,[Hr&1&&ws[0],{xmlns:"http://www.w3.org/2000/svg"},{width:"279px"},{height:"374px"},{viewBox:"0 0 279 374"},{version:"1.1"}]))},i:St,o:St,d(ws){ws&&je(e),Dn=!1,es(sa)}}}function D2(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(0,o=Ui(e,i)),"color"in S&&t(1,h=S.color)},[o,h,u,l,p,y,k,C]}class L2 extends Gt{constructor(e){super(),Xt(this,e,D2,z2,Kt,{color:1})}}const ds=class ds extends A2{constructor(){super();Ge(this,"commons_key","wikimedia_commons");Ge(this,"defaultKeyPrefixes",[this.commons_key,"image"]);Ge(this,"name","Wikimedia")}static ExtractFileName(t){if(!t.startsWith("http"))return t;const i=new URL(t).pathname;return i.substring(i.lastIndexOf("/")+1)}static PrepareUrl(t,i=!1){if(t.toLowerCase().startsWith("https://commons.wikimedia.org/wiki/"))return t;const o=`https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(t)}`;return i?o:o+"?width=500&height=400"}static startsWithCommonsPrefix(t){return ds.commonsPrefixes.some(i=>t.startsWith(i))}static removeCommonsPrefix(t){if(t.startsWith("https://upload.wikimedia.org/"))return t=t.substring(t.lastIndexOf("/")+1),t=decodeURIComponent(t),t.startsWith("File:")||(t="File:"+t),t;for(const i of ds.commonsPrefixes)if(t.startsWith(i)){let o=t.substr(i.length);return i.startsWith("http")&&(o=decodeURIComponent(o)),o}return t}apiUrls(){return ds.apiUrls}SourceIcon(){return new Sd(L2).SetStyle("width:2em;height: 2em")}PrepUrl(t){if(t!==void 0)return t=ds.removeCommonsPrefix(t),t.startsWith("File:")?this.UrlForImage(t):this.UrlForImage("File:"+t)}async ExtractUrls(t,i){const o=ds.startsWithCommonsPrefix(i);return t!==void 0&&t!==this.commons_key&&!o?[]:(i=ds.removeCommonsPrefix(i),i.startsWith("Category:")?(await Kp.GetCategoryContents(i)).filter(u=>u.startsWith("File:")).map(u=>Promise.resolve(this.UrlForImage(u))):i.startsWith("File:")?[Promise.resolve(this.UrlForImage(i))]:i.startsWith("http")?[]:[Promise.resolve(this.UrlForImage("File:"+i))])}async DownloadAttribution(t){var k,C,S,z,R,j,H,X,re;const i=ds.ExtractFileName(t.url);if(i==="")return;const o="https://en.wikipedia.org/w/api.php?action=query&prop=imageinfo&iiprop=extmetadata&titles="+i+"&format=json&origin=*",h=await Ni.downloadJsonCached(o,365*24*60*60),u=new E2,l=h.query.pages.at(-1);if(l===void 0)return;const p=(k=(l.imageinfo??[])[0])==null?void 0:k.extmetadata;if(p===void 0){console.warn("The file",i,"has no usable metedata or license attached... Please fix the license info file yourself!");return}let y=l.title;return y.startsWith("File:")&&(y=y.substr(5)),(y.endsWith(".jpg")||y.endsWith(".png"))&&(y=y.substring(0,y.length-4)),u.title=y,u.artist=(C=p.Artist)==null?void 0:C.value,u.license=(S=p.License)==null?void 0:S.value,u.copyrighted=(z=p.Copyrighted)==null?void 0:z.value,u.attributionRequired=(R=p.AttributionRequired)==null?void 0:R.value,u.usageTerms=(j=p.UsageTerms)==null?void 0:j.value,u.licenseShortName=(H=p.LicenseShortName)==null?void 0:H.value,u.credit=(X=p.Credit)==null?void 0:X.value,u.description=(re=p.ImageDescription)==null?void 0:re.value,u.informationLocation=new URL("https://en.wikipedia.org/wiki/"+l.title),u}UrlForImage(t){return t.startsWith("File:")||(t="File:"+t),{url:ds.PrepareUrl(t),url_hd:ds.PrepareUrl(t,!0),key:void 0,provider:this,id:t}}};Ge(ds,"singleton",new ds),Ge(ds,"apiUrls",["https://commons.wikimedia.org/wiki/","https://upload.wikimedia.org"]),Ge(ds,"commonsPrefixes",[...ds.apiUrls,"File:"]);let Tp=ds;function R2(n){let e,t,i,o,h,u,l,p=[n[0],{xmlns:"http://www.w3.org/2000/svg"},{width:"373px"},{height:"210px"},{viewBox:"0 0 373 210"},{version:"1.1"}],y={};for(let k=0;k<p.length;k+=1)y=Ht(y,p[k]);return{c(){e=Re("svg"),t=Re("g"),i=Re("path"),o=Re("path"),h=Re("path"),Le(i,"stroke","none"),Le(i,"fill-rule","nonzero"),Le(i,"fill","rgb(60.000002%,0%,0%)"),Le(i,"fill-opacity","1"),ie(i,"d","M 42.628906 193.984375 L 53.285156 193.984375 L 53.285156 16.015625 L 42.628906 16.015625 Z M 63.941406 193.984375 L 95.914062 193.984375 L 95.914062 16.015625 L 63.941406 16.015625 Z M 106.570312 16.015625 L 106.570312 193.984375 L 138.542969 193.984375 L 138.542969 16.015625 Z M 106.570312 16.015625 "),Le(o,"stroke","none"),Le(o,"fill-rule","nonzero"),Le(o,"fill","rgb(20%,60.000002%,40.000001%)"),Le(o,"fill-opacity","1"),ie(o,"d","M 298.398438 193.984375 L 309.058594 193.984375 L 309.058594 16.015625 L 298.398438 16.015625 Z M 319.714844 16.015625 L 319.714844 193.984375 L 330.371094 193.984375 L 330.371094 16.015625 Z M 149.199219 193.984375 L 159.855469 193.984375 L 159.855469 16.015625 L 149.199219 16.015625 Z M 170.515625 16.015625 L 170.515625 193.984375 L 181.171875 193.984375 L 181.171875 16.015625 Z M 170.515625 16.015625 "),Le(h,"stroke","none"),Le(h,"fill-rule","nonzero"),Le(h,"fill","rgb(0%,40.000001%,60.000002%)"),Le(h,"fill-opacity","1"),ie(h,"d","M 191.828125 193.984375 L 223.800781 193.984375 L 223.800781 16.015625 L 191.828125 16.015625 Z M 234.457031 193.984375 L 245.113281 193.984375 L 245.113281 16.015625 L 234.457031 16.015625 Z M 255.769531 16.015625 L 255.769531 193.984375 L 287.742188 193.984375 L 287.742188 16.015625 Z M 255.769531 16.015625 "),ie(t,"id","surface1"),An(e,y)},m(k,C){qe(k,e,C),ue(e,t),ue(t,i),ue(t,o),ue(t,h),u||(l=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],u=!0)},p(k,[C]){An(e,y=bs(p,[C&1&&k[0],{xmlns:"http://www.w3.org/2000/svg"},{width:"373px"},{height:"210px"},{viewBox:"0 0 373 210"},{version:"1.1"}]))},i:St,o:St,d(k){k&&je(e),u=!1,es(l)}}}function F2(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(0,o=Ui(e,i)),"color"in S&&t(1,h=S.color)},[o,h,u,l,p,y,k,C]}class c1 extends Gt{constructor(e){super(),Xt(this,e,F2,R2,Kt,{color:1})}}const LP=Object.freeze(Object.defineProperty({__proto__:null,default:c1},Symbol.toStringTag,{value:"Module"}));function B2(n){let e,t,i,o,h,u=[n[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}],l={};for(let p=0;p<u.length;p+=1)l=Ht(l,u[p]);return{c(){e=Re("svg"),t=Re("g"),i=Re("path"),Le(i,"stroke","none"),Le(i,"fill-rule","nonzero"),Le(i,"fill",n[0]),Le(i,"fill-opacity","1"),ie(i,"d","M 254.679688 2.875 L 254.679688 27.652344 L 329.832031 27.652344 L 240.109375 117.371094 C 214.984375 96.203125 182.582031 83.410156 147.230469 83.410156 C 67.632812 83.414062 2.875 148.171875 2.875 227.769531 C 2.875 307.367188 67.632812 372.125 147.230469 372.125 C 226.828125 372.125 291.585938 307.367188 291.585938 227.769531 C 291.585938 192.417969 278.792969 160.015625 257.625 134.890625 L 347.347656 45.167969 L 347.347656 120.320312 L 372.125 120.320312 L 372.125 2.875 Z M 147.230469 347.347656 C 81.296875 347.347656 27.648438 293.703125 27.648438 227.769531 C 27.648438 161.832031 81.292969 108.1875 147.230469 108.1875 C 213.171875 108.1875 266.8125 161.828125 266.8125 227.769531 C 266.8125 293.703125 213.171875 347.347656 147.230469 347.347656 Z M 147.230469 347.347656 "),ie(t,"id","surface1"),An(e,l)},m(p,y){qe(p,e,y),ue(e,t),ue(t,i),o||(h=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],o=!0)},p(p,[y]){y&1&&Le(i,"fill",p[0]),An(e,l=bs(u,[y&2&&p[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}]))},i:St,o:St,d(p){p&&je(e),o=!1,es(h)}}}function O2(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(1,o=Ui(e,i)),"color"in S&&t(0,h=S.color)},[h,o,u,l,p,y,k,C]}class V2 extends Gt{constructor(e){super(),Xt(this,e,O2,B2,Kt,{color:0})}}function N2(n){let e,t,i,o,h,u=[n[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}],l={};for(let p=0;p<u.length;p+=1)l=Ht(l,u[p]);return{c(){e=Re("svg"),t=Re("g"),i=Re("path"),Le(i,"stroke","none"),Le(i,"fill-rule","nonzero"),Le(i,"fill",n[0]),Le(i,"fill-opacity","1"),ie(i,"d","M 273.230469 209.789062 C 320.503906 162.519531 320.503906 85.601562 273.230469 38.328125 C 225.964844 -8.941406 149.039062 -8.941406 101.769531 38.328125 C 54.496094 85.601562 54.496094 162.515625 101.769531 209.789062 C 122.273438 230.300781 148.363281 241.898438 175.191406 244.609375 L 175.191406 294.210938 L 123.847656 294.210938 L 123.847656 318.832031 L 175.191406 318.832031 L 175.191406 372.125 L 199.808594 372.125 L 199.808594 318.835938 L 251.148438 318.835938 L 251.148438 294.214844 L 199.808594 294.214844 L 199.808594 244.609375 C 226.636719 241.898438 252.726562 230.300781 273.230469 209.789062 Z M 119.175781 55.742188 C 138.015625 36.90625 162.757812 27.484375 187.5 27.484375 C 212.242188 27.484375 236.984375 36.902344 255.824219 55.738281 C 293.496094 93.410156 293.496094 154.707031 255.824219 192.382812 C 218.148438 230.054688 156.847656 230.050781 119.179688 192.382812 C 81.503906 154.710938 81.503906 93.410156 119.175781 55.742188 Z M 119.175781 55.742188 "),ie(t,"id","surface1"),An(e,l)},m(p,y){qe(p,e,y),ue(e,t),ue(t,i),o||(h=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],o=!0)},p(p,[y]){y&1&&Le(i,"fill",p[0]),An(e,l=bs(u,[y&2&&p[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}]))},i:St,o:St,d(p){p&&je(e),o=!1,es(h)}}}function U2(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(1,o=Ui(e,i)),"color"in S&&t(0,h=S.color)},[h,o,u,l,p,y,k,C]}class j2 extends Gt{constructor(e){super(),Xt(this,e,U2,N2,Kt,{color:0})}}function q2(n){let e,t,i,o,h,u=[n[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}],l={};for(let p=0;p<u.length;p+=1)l=Ht(l,u[p]);return{c(){e=Re("svg"),t=Re("g"),i=Re("path"),Le(i,"stroke","none"),Le(i,"fill-rule","nonzero"),Le(i,"fill",n[0]),Le(i,"fill-opacity","1"),ie(i,"d","M 244 216.746094 L 364.355469 337.101562 L 364.355469 212.675781 L 339.773438 212.675781 L 339.773438 277.761719 L 257.871094 195.851562 C 267.695312 177.457031 273.289062 156.472656 273.289062 134.199219 C 273.289062 61.789062 214.378906 2.875 141.964844 2.875 C 69.550781 2.875 10.644531 61.789062 10.644531 134.199219 C 10.644531 206.605469 69.554688 265.519531 141.964844 265.519531 C 164.238281 265.519531 185.222656 259.925781 203.621094 250.097656 L 240.511719 286.992188 L 197.96875 329.523438 L 215.347656 346.902344 L 257.886719 304.371094 L 325.640625 372.125 L 343.019531 354.742188 L 224.511719 236.230469 C 231.664062 230.433594 238.199219 223.898438 244 216.746094 Z M 35.226562 134.199219 C 35.226562 75.34375 83.109375 27.460938 141.964844 27.460938 C 200.820312 27.460938 248.703125 75.34375 248.703125 134.199219 C 248.703125 193.050781 200.820312 240.933594 141.964844 240.933594 C 83.105469 240.933594 35.226562 193.054688 35.226562 134.199219 Z M 35.226562 134.199219 "),ie(t,"id","surface1"),An(e,l)},m(p,y){qe(p,e,y),ue(e,t),ue(t,i),o||(h=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],o=!0)},p(p,[y]){y&1&&Le(i,"fill",p[0]),An(e,l=bs(u,[y&2&&p[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}]))},i:St,o:St,d(p){p&&je(e),o=!1,es(h)}}}function H2(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(1,o=Ui(e,i)),"color"in S&&t(0,h=S.color)},[h,o,u,l,p,y,k,C]}class W2 extends Gt{constructor(e){super(),Xt(this,e,H2,q2,Kt,{color:0})}}function Z2(n){let e,t,i,o,h,u=[n[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}],l={};for(let p=0;p<u.length;p+=1)l=Ht(l,u[p]);return{c(){e=Re("svg"),t=Re("g"),i=Re("path"),Le(i,"stroke","none"),Le(i,"fill-rule","nonzero"),Le(i,"fill",n[0]),Le(i,"fill-opacity","1"),ie(i,"d","M 278.738281 2.875 L 278.738281 27.492188 L 309.691406 27.492188 L 250.769531 86.417969 C 233.425781 73.042969 211.722656 65.0625 188.179688 65.0625 C 164.289062 65.0625 142.296875 73.285156 124.832031 87.015625 L 106.859375 69.046875 L 128.496094 47.414062 L 111.089844 30.007812 L 89.457031 51.640625 L 65.308594 27.492188 L 96.261719 27.492188 L 96.261719 2.875 L 23.289062 2.875 L 23.289062 75.855469 L 47.90625 75.855469 L 47.90625 44.902344 L 72.050781 69.046875 L 50.414062 90.675781 L 67.820312 108.078125 L 89.453125 86.445312 L 107.421875 104.414062 C 93.691406 121.882812 85.46875 143.875 85.46875 167.765625 C 85.46875 220.230469 125.023438 263.605469 175.871094 269.710938 L 175.871094 300.851562 L 145.277344 300.851562 L 145.277344 325.464844 L 175.871094 325.464844 L 175.871094 372.125 L 200.488281 372.125 L 200.488281 325.476562 L 231.078125 325.476562 L 231.078125 300.859375 L 200.488281 300.859375 L 200.488281 269.71875 C 251.339844 263.613281 290.890625 220.234375 290.890625 167.769531 C 290.890625 143.53125 282.429688 121.246094 268.335938 103.65625 L 327.09375 44.898438 L 327.09375 75.851562 L 351.710938 75.851562 L 351.710938 2.875 Z M 188.179688 245.867188 C 145.117188 245.867188 110.085938 210.832031 110.085938 167.773438 C 110.085938 124.710938 145.117188 89.679688 188.179688 89.679688 C 231.238281 89.679688 266.273438 124.710938 266.273438 167.773438 C 266.273438 210.832031 231.238281 245.867188 188.179688 245.867188 Z M 188.179688 245.867188 "),ie(t,"id","surface1"),An(e,l)},m(p,y){qe(p,e,y),ue(e,t),ue(t,i),o||(h=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],o=!0)},p(p,[y]){y&1&&Le(i,"fill",p[0]),An(e,l=bs(u,[y&2&&p[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}]))},i:St,o:St,d(p){p&&je(e),o=!1,es(h)}}}function $2(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(1,o=Ui(e,i)),"color"in S&&t(0,h=S.color)},[h,o,u,l,p,y,k,C]}class d_ extends Gt{constructor(e){super(),Xt(this,e,$2,Z2,Kt,{color:0})}}function G2(n){let e,t,i,o,h,u=[n[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}],l={};for(let p=0;p<u.length;p+=1)l=Ht(l,u[p]);return{c(){e=Re("svg"),t=Re("g"),i=Re("path"),Le(i,"stroke","none"),Le(i,"fill-rule","nonzero"),Le(i,"fill",n[0]),Le(i,"fill-opacity","1"),ie(i,"d","M 273.230469 165.210938 C 252.726562 144.699219 226.636719 133.105469 199.808594 130.390625 L 199.808594 79.359375 L 234.339844 98.398438 L 246.226562 76.832031 L 213 58.515625 L 246.226562 40.195312 L 234.339844 18.632812 L 199.808594 37.671875 L 199.808594 2.875 L 175.191406 2.875 L 175.191406 37.671875 L 140.660156 18.636719 L 128.773438 40.199219 L 162 58.519531 L 128.773438 76.835938 L 140.660156 98.402344 L 175.191406 79.359375 L 175.191406 130.390625 C 148.367188 133.105469 122.277344 144.699219 101.773438 165.207031 C 78.871094 188.105469 66.261719 218.550781 66.261719 250.9375 C 66.261719 283.324219 78.871094 313.769531 101.773438 336.667969 C 125.40625 360.308594 156.449219 372.125 187.5 372.125 C 218.550781 372.125 249.59375 360.308594 273.230469 336.667969 C 296.132812 313.769531 308.742188 283.324219 308.742188 250.9375 C 308.742188 218.550781 296.132812 188.105469 273.230469 165.210938 Z M 255.824219 319.257812 C 218.152344 356.925781 156.855469 356.929688 119.175781 319.257812 C 100.929688 301.011719 90.875 276.746094 90.875 250.9375 C 90.875 225.128906 100.929688 200.867188 119.175781 182.617188 C 138.015625 163.78125 162.757812 154.367188 187.5 154.367188 C 212.242188 154.367188 236.984375 163.78125 255.824219 182.621094 C 274.070312 200.871094 284.125 225.132812 284.125 250.941406 C 284.121094 276.746094 274.070312 301.011719 255.824219 319.257812 Z M 255.824219 319.257812 "),ie(t,"id","surface1"),An(e,l)},m(p,y){qe(p,e,y),ue(e,t),ue(t,i),o||(h=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],o=!0)},p(p,[y]){y&1&&Le(i,"fill",p[0]),An(e,l=bs(u,[y&2&&p[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}]))},i:St,o:St,d(p){p&&je(e),o=!1,es(h)}}}function X2(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(1,o=Ui(e,i)),"color"in S&&t(0,h=S.color)},[h,o,u,l,p,y,k,C]}class K2 extends Gt{constructor(e){super(),Xt(this,e,X2,G2,Kt,{color:0})}}const za=class za{};Ge(za,"isHuman",[{p:31,q:5}]),Ge(za,"extraProperties",[{requires:za.isHuman,property:"P21",display:new Map([["Q6581097",V2],["Q6581072",j2],["Q1097630",W2],["Q1052281",d_],["Q2449503",d_],["Q48270",K2]]),textMode:new Map([["Q6581097","♂️"],["Q6581072","♀️"],["Q1097630","⚥️"],["Q1052281","🏳️‍⚧️"],["Q2449503","🏳️‍⚧️"],["Q48270","🏳️‍🌈 ⚧"]])},{property:"P569",requires:za.isHuman,display:gs.t.general.wikipedia.previewbox.born},{property:"P570",requires:za.isHuman,display:gs.t.general.wikipedia.previewbox.died}]);let Mp=za;function f_(n,e,t){const i=n.slice();return i[3]=e[t],i}function Y2(n){let e,t,i=n[0],o=[];for(let u=0;u<i.length;u+=1)o[u]=p_(f_(n,i,u));const h=u=>Ce(o[u],1,1,()=>{o[u]=null});return{c(){e=et("div");for(let u=0;u<o.length;u+=1)o[u].c();ie(e,"class","flex items-center justify-start")},m(u,l){qe(u,e,l);for(let p=0;p<o.length;p+=1)o[p]&&o[p].m(e,null);t=!0},p(u,l){if(l&3){i=u[0];let p;for(p=0;p<i.length;p+=1){const y=f_(u,i,p);o[p]?(o[p].p(y,l),we(o[p],1)):(o[p]=p_(y),o[p].c(),we(o[p],1),o[p].m(e,null))}for(oi(),p=i.length;p<o.length;p+=1)h(p);ai()}},i(u){if(!t){for(let l=0;l<i.length;l+=1)we(o[l]);t=!0}},o(u){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)Ce(o[l]);t=!1},d(u){u&&je(e),Fa(o,u)}}}function J2(n){let e,t,i;var o=n[3].display.get(n[1](n[3]));function h(u){return{props:{class:"m-1 h-6 w-fit"}}}return o&&(e=Rl(o,h())),{c(){e&&lt(e.$$.fragment),t=Di()},m(u,l){e&&ct(e,u,l),qe(u,t,l),i=!0},p(u,l){if(o!==(o=u[3].display.get(u[1](u[3])))){if(e){oi();const p=e;Ce(p.$$.fragment,1,0,()=>{ht(p,1)}),ai()}o?(e=Rl(o,h()),lt(e.$$.fragment),we(e.$$.fragment,1),ct(e,t.parentNode,t)):e=null}},i(u){i||(e&&we(e.$$.fragment,u),i=!0)},o(u){e&&Ce(e.$$.fragment,u),i=!1},d(u){u&&je(t),e&&ht(e,u)}}}function Q2(n){let e,t;return e=new mn({props:{cls:"m-2 shrink-0",t:n[3].display.Subs({value:n[1](n[3])})}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p:St,i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function ek(n){let e=n[3].display+"",t;return{c(){t=Si(e)},m(i,o){qe(i,t,o)},p:St,i:St,o:St,d(i){i&&je(t)}}}function p_(n){let e,t,i,o;const h=[ek,Q2,J2],u=[];function l(p,y){return typeof p[3].display=="string"?0:p[3].display instanceof Al?1:2}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,y){t.p(p,y)},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function tk(n){let e,t,i=n[0].length>0&&Y2(n);return{c(){i&&i.c(),e=Di()},m(o,h){i&&i.m(o,h),qe(o,e,h),t=!0},p(o,[h]){o[0].length>0&&i.p(o,h)},i(o){t||(we(i),t=!0)},o(o){Ce(i),t=!1},d(o){i&&i.d(o),o&&je(e)}}}function ik(n,e,t){let{wikidata:i}=e,o=Mp.extraProperties.filter(u=>{var l,p,y;for(const k of u.requires){if(!((l=i.claims)!=null&&l.has("P"+k.p))||!((p=i.claims)!=null&&p.get("P"+k.p).has("Q"+k.q)))return!1;const C=u.property;return((y=i.claims)==null?void 0:y.get(C))!==void 0}});function h(u){var y;const l=u.property;return Array.from((y=i.claims)==null?void 0:y.get(l)).join(", ")}return n.$$set=u=>{"wikidata"in u&&t(2,i=u.wikidata)},[o,h,i]}class nk extends Gt{constructor(e){super(),Xt(this,e,ik,tk,Kt,{wikidata:2})}}const sk=n=>({}),m_=n=>({});function rk(n){let e,t;return{c(){e=et("img"),yp(e.src,t=n[2])||ie(e,"src",t),ie(e,"style",n[1]),ie(e,"class","mr-2")},m(i,o){qe(i,e,o)},p(i,o){o&2&&ie(e,"style",i[1])},d(i){i&&je(e)}}}function ok(n){let e,t,i,o,h,u,l,p,y,k=n[0].id+"",C,S,z,R,j,H,X,re,W,ae=n[2]&&rk(n);h=new mn({props:{cls:"font-bold",t:Al.fromMap(n[0].labels)}}),p=new c1({props:{class:"w-10"}}),R=new mn({props:{t:Al.fromMap(n[0].descriptions,!0)}}),X=new nk({props:{wikidata:n[0]}});const de=n[4].extra,Ae=jn(de,n,n[3],m_);return{c(){e=et("div"),ae&&ae.c(),t=xt(),i=et("div"),o=et("div"),lt(h.$$.fragment),u=xt(),l=et("a"),lt(p.$$.fragment),y=xt(),C=Si(k),z=xt(),lt(R.$$.fragment),j=xt(),H=et("div"),lt(X.$$.fragment),re=xt(),Ae&&Ae.c(),ie(l,"href",S=mh.IdToArticle(n[0].id)),ie(l,"target","_blank"),ie(l,"class","must-link flex items-center"),ie(o,"class","flex w-full flex-wrap justify-between"),ie(H,"class","flex"),ie(i,"class","flex flex-grow flex-col"),ie(e,"class","flex w-full flex-wrap p-2")},m(xe,pe){qe(xe,e,pe),ae&&ae.m(e,null),ue(e,t),ue(e,i),ue(i,o),ct(h,o,null),ue(o,u),ue(o,l),ct(p,l,null),ue(l,y),ue(l,C),ue(i,z),ct(R,i,null),ue(i,j),ue(i,H),ct(X,H,null),ue(i,re),Ae&&Ae.m(i,null),W=!0},p(xe,[pe]){xe[2]&&ae.p(xe,pe);const ke={};pe&1&&(ke.t=Al.fromMap(xe[0].labels)),h.$set(ke),(!W||pe&1)&&k!==(k=xe[0].id+"")&&zs(C,k),(!W||pe&1&&S!==(S=mh.IdToArticle(xe[0].id)))&&ie(l,"href",S);const Ie={};pe&1&&(Ie.t=Al.fromMap(xe[0].descriptions,!0)),R.$set(Ie);const Ve={};pe&1&&(Ve.wikidata=xe[0]),X.$set(Ve),Ae&&Ae.p&&(!W||pe&8)&&qn(Ae,de,xe,xe[3],W?Wn(de,xe[3],pe,sk):Hn(xe[3]),m_)},i(xe){W||(we(h.$$.fragment,xe),we(p.$$.fragment,xe),we(R.$$.fragment,xe),we(X.$$.fragment,xe),we(Ae,xe),W=!0)},o(xe){Ce(h.$$.fragment,xe),Ce(p.$$.fragment,xe),Ce(R.$$.fragment,xe),Ce(X.$$.fragment,xe),Ce(Ae,xe),W=!1},d(xe){xe&&je(e),ae&&ae.d(),ht(h),ht(p),ht(R),ht(X),Ae&&Ae.d(xe)}}}function ak(n,e,t){var y,k;let{$$slots:i={},$$scope:o}=e,{wikidata:h}=e,{imageStyle:u="max-width: 5rem; width: unset; height: 4rem"}=e,l=Array.from(((y=h==null?void 0:h.claims)==null?void 0:y.get("P18"))??[])[0],p=(k=Tp.singleton.PrepUrl(l))==null?void 0:k.url;return n.$$set=C=>{"wikidata"in C&&t(0,h=C.wikidata),"imageStyle"in C&&t(1,u=C.imageStyle),"$$scope"in C&&t(3,o=C.$$scope)},[h,u,p,o,i]}class h1 extends Gt{constructor(e){super(),Xt(this,e,ak,ok,Kt,{wikidata:0,imageStyle:1})}}const lk=n=>({svgSize:n&4}),g_=n=>({svgSize:n[5][n[2]]}),ck=n=>({svgSize:n&4}),__=n=>({svgSize:n[5][n[2]]});function hk(n){let e,t,i,o,h,u,l=n[0]&&y_(n);const p=n[9].default,y=jn(p,n,n[8],g_);let k=[{type:"button"},n[6],{class:n[4]},{"aria-label":i=n[1]??n[0]}],C={};for(let S=0;S<k.length;S+=1)C=Ht(C,k[S]);return{c(){e=et("button"),l&&l.c(),t=xt(),y&&y.c(),nd(e,C)},m(S,z){qe(S,e,z),l&&l.m(e,null),ue(e,t),y&&y.m(e,null),e.autofocus&&e.focus(),o=!0,h||(u=Je(e,"click",n[10]),h=!0)},p(S,z){S[0]?l?l.p(S,z):(l=y_(S),l.c(),l.m(e,t)):l&&(l.d(1),l=null),y&&y.p&&(!o||z&260)&&qn(y,p,S,S[8],o?Wn(p,S[8],z,lk):Hn(S[8]),g_),nd(e,C=bs(k,[{type:"button"},z&64&&S[6],(!o||z&16)&&{class:S[4]},(!o||z&3&&i!==(i=S[1]??S[0]))&&{"aria-label":i}]))},i(S){o||(we(y,S),o=!0)},o(S){Ce(y,S),o=!1},d(S){S&&je(e),l&&l.d(),y&&y.d(S),h=!1,u()}}}function uk(n){let e,t,i,o,h=n[0]&&b_(n);const u=n[9].default,l=jn(u,n,n[8],__);let p=[{href:n[3]},n[6],{class:n[4]},{"aria-label":i=n[1]??n[0]}],y={};for(let k=0;k<p.length;k+=1)y=Ht(y,p[k]);return{c(){e=et("a"),h&&h.c(),t=xt(),l&&l.c(),nd(e,y)},m(k,C){qe(k,e,C),h&&h.m(e,null),ue(e,t),l&&l.m(e,null),o=!0},p(k,C){k[0]?h?h.p(k,C):(h=b_(k),h.c(),h.m(e,t)):h&&(h.d(1),h=null),l&&l.p&&(!o||C&260)&&qn(l,u,k,k[8],o?Wn(u,k[8],C,ck):Hn(k[8]),__),nd(e,y=bs(p,[(!o||C&8)&&{href:k[3]},C&64&&k[6],(!o||C&16)&&{class:k[4]},(!o||C&3&&i!==(i=k[1]??k[0]))&&{"aria-label":i}]))},i(k){o||(we(l,k),o=!0)},o(k){Ce(l,k),o=!1},d(k){k&&je(e),h&&h.d(),l&&l.d(k)}}}function y_(n){let e,t;return{c(){e=et("span"),t=Si(n[0]),ie(e,"class","sr-only")},m(i,o){qe(i,e,o),ue(e,t)},p(i,o){o&1&&zs(t,i[0])},d(i){i&&je(e)}}}function b_(n){let e,t;return{c(){e=et("span"),t=Si(n[0]),ie(e,"class","sr-only")},m(i,o){qe(i,e,o),ue(e,t)},p(i,o){o&1&&zs(t,i[0])},d(i){i&&je(e)}}}function dk(n){let e,t,i,o;const h=[uk,hk],u=[];function l(p,y){return p[3]?0:1}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,[y]){let k=e;e=l(p),e===k?u[e].p(p,y):(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai(),t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i))},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function fk(n,e,t){const i=["color","name","ariaLabel","size","href"];let o=Ui(e,i),{$$slots:h={},$$scope:u}=e;const l=Tv("background");let{color:p="default"}=e,{name:y=void 0}=e,{ariaLabel:k=void 0}=e,{size:C="md"}=e,{href:S=void 0}=e;const z={dark:"text-gray-500 hover:text-gray-900 hover:bg-gray-200 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600",gray:"text-gray-500 focus:ring-gray-400 hover:bg-gray-200 dark:hover:bg-gray-800 dark:hover:text-gray-300",red:"text-red-500 focus:ring-red-400 hover:bg-red-200 dark:hover:bg-red-800 dark:hover:text-red-300",yellow:"text-yellow-500 focus:ring-yellow-400 hover:bg-yellow-200 dark:hover:bg-yellow-800 dark:hover:text-yellow-300",green:"text-green-500 focus:ring-green-400 hover:bg-green-200 dark:hover:bg-green-800 dark:hover:text-green-300",indigo:"text-indigo-500 focus:ring-indigo-400 hover:bg-indigo-200 dark:hover:bg-indigo-800 dark:hover:text-indigo-300",purple:"text-purple-500 focus:ring-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 dark:hover:text-purple-300",pink:"text-pink-500 focus:ring-pink-400 hover:bg-pink-200 dark:hover:bg-pink-800 dark:hover:text-pink-300",blue:"text-blue-500 focus:ring-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 dark:hover:text-blue-300",primary:"text-primary-500 focus:ring-primary-400 hover:bg-primary-200 dark:hover:bg-primary-800 dark:hover:text-primary-300",default:"focus:ring-gray-400 hover:bg-gray-100"},R={xs:"m-0.5 rounded-sm focus:ring-1 p-0.5",sm:"m-0.5 rounded focus:ring-1 p-0.5",md:"m-0.5 rounded-lg focus:ring-2 p-1.5",lg:"m-0.5 rounded-lg focus:ring-2 p-2.5"};let j;const H={xs:"w-3 h-3",sm:"w-3.5 h-3.5",md:"w-5 h-5",lg:"w-5 h-5"};function X(re){_t.call(this,n,re)}return n.$$set=re=>{t(14,e=Ht(Ht({},e),_s(re))),t(6,o=Ui(e,i)),"color"in re&&t(7,p=re.color),"name"in re&&t(0,y=re.name),"ariaLabel"in re&&t(1,k=re.ariaLabel),"size"in re&&t(2,C=re.size),"href"in re&&t(3,S=re.href),"$$scope"in re&&t(8,u=re.$$scope)},n.$$.update=()=>{t(4,j=mo("focus:outline-none whitespace-normal",R[C],z[p],p==="default"&&(l?"dark:hover:bg-gray-600":"dark:hover:bg-gray-700"),e.class))},e=_s(e),[y,k,C,S,j,H,o,p,u,h,X]}class pk extends Gt{constructor(e){super(),Xt(this,e,fk,dk,Kt,{color:7,name:0,ariaLabel:1,size:2,href:3})}}function mk(n){let e,t,i;return{c(){e=Re("svg"),t=Re("path"),ie(t,"fill-rule","evenodd"),ie(t,"d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"),ie(t,"clip-rule","evenodd"),ie(e,"class",i=n[4]),ie(e,"fill","currentColor"),ie(e,"viewBox","0 0 20 20"),ie(e,"xmlns","http://www.w3.org/2000/svg")},m(o,h){qe(o,e,h),ue(e,t)},p(o,h){h&16&&i!==(i=o[4])&&ie(e,"class",i)},d(o){o&&je(e)}}}function gk(n){let e,t;const i=[{name:n[0]},n[1],{class:mo("ms-auto",n[2].class)}];let o={$$slots:{default:[mk,({svgSize:h})=>({4:h}),({svgSize:h})=>h?16:0]},$$scope:{ctx:n}};for(let h=0;h<i.length;h+=1)o=Ht(o,i[h]);return e=new pk({props:o}),e.$on("click",n[3]),{c(){lt(e.$$.fragment)},m(h,u){ct(e,h,u),t=!0},p(h,[u]){const l=u&7?bs(i,[u&1&&{name:h[0]},u&2&&Md(h[1]),u&4&&{class:mo("ms-auto",h[2].class)}]):{};u&48&&(l.$$scope={dirty:u,ctx:h}),e.$set(l)},i(h){t||(we(e.$$.fragment,h),t=!0)},o(h){Ce(e.$$.fragment,h),t=!1},d(h){ht(e,h)}}}function _k(n,e,t){const i=["name"];let o=Ui(e,i),{name:h="Close"}=e;function u(l){_t.call(this,n,l)}return n.$$set=l=>{t(2,e=Ht(Ht({},e),_s(l))),t(1,o=Ui(e,i)),"name"in l&&t(0,h=l.name)},e=_s(e),[h,o,e,u]}class u1 extends Gt{constructor(e){super(),Xt(this,e,_k,gk,Kt,{name:0})}}const yk=`
  a[href], area[href], input:not([disabled]):not([tabindex='-1']),
  button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),
  textarea:not([disabled]):not([tabindex='-1']),
  iframe, object, embed, *[tabindex]:not([tabindex='-1']):not([disabled]), *[contenteditable=true]
`;function bk(n){function e(t){if(!(t.key==="Tab"||t.keyCode===9))return;const o=Array.from(n.querySelectorAll(yk)).filter(u=>u.hidden!==!0);let h=o.indexOf(document.activeElement??n);h===-1&&t.shiftKey&&(h=0),h+=o.length+(t.shiftKey?-1:1),h%=o.length,o[h].focus(),t.preventDefault()}return document.addEventListener("keydown",e,!0),{destroy(){document.removeEventListener("keydown",e,!0)}}}const xk=n=>({}),x_=n=>({}),vk=n=>({}),v_=n=>({});function w_(n){let e,t,i,o,h,u,l,p,y;const k=[{rounded:!0},{shadow:!0},n[17],{class:n[8]},{color:n[3]}];let C={$$slots:{default:[Ck]},$$scope:{ctx:n}};for(let S=0;S<k.length;S+=1)C=Ht(C,k[S]);return h=new Zp({props:C}),{c(){e=et("div"),t=xt(),i=et("div"),o=et("div"),lt(h.$$.fragment),ie(e,"class",n[10]),ie(o,"class",u="flex relative "+n[12][n[2]]+" w-full max-h-full"),ie(i,"class",n[9]),ie(i,"tabindex","-1"),ie(i,"aria-modal","true"),ie(i,"role","dialog")},m(S,z){qe(S,e,z),qe(S,t,z),qe(S,i,z),ue(i,o),ct(h,o,null),l=!0,p||(y=[Je(i,"keydown",n[16]),Je(i,"wheel",F0(n[34]),{passive:!1}),sd(n[11].call(null,i)),sd(bk.call(null,i)),Je(i,"click",n[13]),Je(i,"mousedown",n[14])],p=!0)},p(S,z){(!l||z[0]&1024)&&ie(e,"class",S[10]);const R=z[0]&131336?bs(k,[k[0],k[1],z[0]&131072&&Md(S[17]),z[0]&256&&{class:S[8]},z[0]&8&&{color:S[3]}]):{};z[0]&262394|z[1]&32&&(R.$$scope={dirty:z,ctx:S}),h.$set(R),(!l||z[0]&4&&u!==(u="flex relative "+S[12][S[2]]+" w-full max-h-full"))&&ie(o,"class",u),(!l||z[0]&512)&&ie(i,"class",S[9])},i(S){l||(we(h.$$.fragment,S),l=!0)},o(S){Ce(h.$$.fragment,S),l=!1},d(S){S&&je(e),S&&je(t),S&&je(i),ht(h),p=!1,es(y)}}}function k_(n){let e,t;return e=new Zp({props:{class:n[7],color:n[3],$$slots:{default:[kk]},$$scope:{ctx:n}}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o[0]&128&&(h.class=i[7]),o[0]&8&&(h.color=i[3]),o[0]&26|o[1]&32&&(h.$$scope={dirty:o,ctx:i}),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function wk(n){let e,t,i;return{c(){e=et("h3"),t=Si(n[1]),ie(e,"class",i="text-xl font-semibold "+(n[3]==="default"?"":"text-gray-900 dark:text-white")+" p-0")},m(o,h){qe(o,e,h),ue(e,t)},p(o,h){h[0]&2&&zs(t,o[1]),h[0]&8&&i!==(i="text-xl font-semibold "+(o[3]==="default"?"":"text-gray-900 dark:text-white")+" p-0")&&ie(e,"class",i)},d(o){o&&je(e)}}}function S_(n){let e,t;return e=new u1({props:{name:"Close modal",color:n[3]}}),e.$on("click",n[15]),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o[0]&8&&(h.color=i[3]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function kk(n){let e,t,i;const o=n[33].header,h=jn(o,n,n[36],v_),u=h||wk(n);let l=n[4]&&S_(n);return{c(){u&&u.c(),e=xt(),l&&l.c(),t=Di()},m(p,y){u&&u.m(p,y),qe(p,e,y),l&&l.m(p,y),qe(p,t,y),i=!0},p(p,y){h?h.p&&(!i||y[1]&32)&&qn(h,o,p,p[36],i?Wn(o,p[36],y,vk):Hn(p[36]),v_):u&&u.p&&(!i||y[0]&10)&&u.p(p,i?y:[-1,-1]),p[4]?l?(l.p(p,y),y[0]&16&&we(l,1)):(l=S_(p),l.c(),we(l,1),l.m(t.parentNode,t)):l&&(oi(),Ce(l,1,1,()=>{l=null}),ai())},i(p){i||(we(u,p),we(l),i=!0)},o(p){Ce(u,p),Ce(l),i=!1},d(p){u&&u.d(p),p&&je(e),l&&l.d(p),p&&je(t)}}}function C_(n){let e,t;return e=new u1({props:{name:"Close modal",class:"absolute top-3 end-2.5",color:n[3]}}),e.$on("click",n[15]),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o[0]&8&&(h.color=i[3]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function T_(n){let e,t;return e=new Zp({props:{class:n[5],color:n[3],$$slots:{default:[Sk]},$$scope:{ctx:n}}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o[0]&32&&(h.class=i[5]),o[0]&8&&(h.color=i[3]),o[1]&32&&(h.$$scope={dirty:o,ctx:i}),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function Sk(n){let e;const t=n[33].footer,i=jn(t,n,n[36],x_);return{c(){i&&i.c()},m(o,h){i&&i.m(o,h),e=!0},p(o,h){i&&i.p&&(!e||h[1]&32)&&qn(i,t,o,o[36],e?Wn(t,o[36],h,xk):Hn(o[36]),x_)},i(o){e||(we(i,o),e=!0)},o(o){Ce(i,o),e=!1},d(o){i&&i.d(o)}}}function Ck(n){let e,t,i,o,h,u,l,p,y=(n[18].header||n[1])&&k_(n),k=n[4]&&!n[18].header&&!n[1]&&C_(n);const C=n[33].default,S=jn(C,n,n[36],null);let z=n[18].footer&&T_(n);return{c(){y&&y.c(),e=xt(),t=et("div"),k&&k.c(),i=xt(),S&&S.c(),o=xt(),z&&z.c(),h=Di(),ie(t,"class",n[6]),ie(t,"role","document")},m(R,j){y&&y.m(R,j),qe(R,e,j),qe(R,t,j),k&&k.m(t,null),ue(t,i),S&&S.m(t,null),qe(R,o,j),z&&z.m(R,j),qe(R,h,j),u=!0,l||(p=[Je(t,"keydown",Qg(n[16])),Je(t,"wheel",Qg(n[35]),{passive:!0})],l=!0)},p(R,j){R[18].header||R[1]?y?(y.p(R,j),j[0]&262146&&we(y,1)):(y=k_(R),y.c(),we(y,1),y.m(e.parentNode,e)):y&&(oi(),Ce(y,1,1,()=>{y=null}),ai()),R[4]&&!R[18].header&&!R[1]?k?(k.p(R,j),j[0]&262162&&we(k,1)):(k=C_(R),k.c(),we(k,1),k.m(t,i)):k&&(oi(),Ce(k,1,1,()=>{k=null}),ai()),S&&S.p&&(!u||j[1]&32)&&qn(S,C,R,R[36],u?Wn(C,R[36],j,null):Hn(R[36]),null),(!u||j[0]&64)&&ie(t,"class",R[6]),R[18].footer?z?(z.p(R,j),j[0]&262144&&we(z,1)):(z=T_(R),z.c(),we(z,1),z.m(h.parentNode,h)):z&&(oi(),Ce(z,1,1,()=>{z=null}),ai())},i(R){u||(we(y),we(k),we(S,R),we(z),u=!0)},o(R){Ce(y),Ce(k),Ce(S,R),Ce(z),u=!1},d(R){y&&y.d(R),R&&je(e),R&&je(t),k&&k.d(),S&&S.d(R),R&&je(o),z&&z.d(R),R&&je(h),l=!1,es(p)}}}function Tk(n){let e,t,i=n[0]&&w_(n);return{c(){i&&i.c(),e=Di()},m(o,h){i&&i.m(o,h),qe(o,e,h),t=!0},p(o,h){o[0]?i?(i.p(o,h),h[0]&1&&we(i,1)):(i=w_(o),i.c(),we(i,1),i.m(e.parentNode,e)):i&&(oi(),Ce(i,1,1,()=>{i=null}),ai())},i(o){t||(we(i),t=!0)},o(o){Ce(i),t=!1},d(o){i&&i.d(o),o&&je(e)}}}function Mk(n,e,t){let i,o,h,u,l,p;const y=["open","title","size","color","placement","autoclose","outsideclose","dismissable","backdropClass","classBackdrop","dialogClass","classDialog","defaultClass","headerClass","classHeader","bodyClass","classBody","footerClass","classFooter"];let k=Ui(e,y),{$$slots:C={},$$scope:S}=e;const z=R0(C);let{open:R=!1}=e,{title:j=""}=e,{size:H="md"}=e,{color:X="default"}=e,{placement:re="center"}=e,{autoclose:W=!1}=e,{outsideclose:ae=!1}=e,{dismissable:de=!0}=e,{backdropClass:Ae="fixed inset-0 z-40 bg-gray-900 bg-opacity-50 dark:bg-opacity-80"}=e,{classBackdrop:xe=void 0}=e,{dialogClass:pe="fixed top-0 start-0 end-0 h-modal md:inset-0 md:h-full z-50 w-full p-4 flex"}=e,{classDialog:ke=void 0}=e,{defaultClass:Ie="relative flex flex-col mx-auto"}=e,{headerClass:Ve="flex justify-between items-center p-4 md:p-5 rounded-t-lg"}=e,{classHeader:We=void 0}=e,{bodyClass:Oe="p-4 md:p-5 space-y-4 flex-1 overflow-y-auto overscroll-contain"}=e,{classBody:It=void 0}=e,{footerClass:mt="flex items-center p-4 md:p-5 space-x-3 rtl:space-x-reverse rounded-b-lg"}=e,{classFooter:Ft=void 0}=e;const Yt=Pd();function Qt(nt){const sn=document.createTreeWalker(nt,NodeFilter.SHOW_ELEMENT);let _n;for(;_n=sn.nextNode();)if(_n instanceof HTMLElement){const Zn=_n,[En,$n]=Ti(Zn);(En||$n)&&(Zn.tabIndex=0)}nt.focus()}const Tn=nt=>{switch(nt){case"top-left":return["justify-start","items-start"];case"top-center":return["justify-center","items-start"];case"top-right":return["justify-end","items-start"];case"center-left":return["justify-start","items-center"];case"center":return["justify-center","items-center"];case"center-right":return["justify-end","items-center"];case"bottom-left":return["justify-start","items-end"];case"bottom-center":return["justify-center","items-end"];case"bottom-right":return["justify-end","items-end"];default:return["justify-center","items-center"]}},ji={xs:"max-w-md",sm:"max-w-lg",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-7xl"},di=nt=>{const sn=nt.target;W&&(sn==null?void 0:sn.tagName)==="BUTTON"&&Ci(nt)},ii=nt=>{const sn=nt.target;ae&&sn===nt.currentTarget&&Ci(nt)},Ci=nt=>{nt.preventDefault(),t(0,R=!1)},Ti=nt=>[nt.scrollWidth>nt.clientWidth&&["scroll","auto"].indexOf(getComputedStyle(nt).overflowX)>=0,nt.scrollHeight>nt.clientHeight&&["scroll","auto"].indexOf(getComputedStyle(nt).overflowY)>=0];function Gi(nt){if(nt.key==="Escape"&&de)return Ci(nt)}function qi(nt){_t.call(this,n,nt)}function Xi(nt){_t.call(this,n,nt)}return n.$$set=nt=>{t(40,e=Ht(Ht({},e),_s(nt))),t(17,k=Ui(e,y)),"open"in nt&&t(0,R=nt.open),"title"in nt&&t(1,j=nt.title),"size"in nt&&t(2,H=nt.size),"color"in nt&&t(3,X=nt.color),"placement"in nt&&t(19,re=nt.placement),"autoclose"in nt&&t(20,W=nt.autoclose),"outsideclose"in nt&&t(21,ae=nt.outsideclose),"dismissable"in nt&&t(4,de=nt.dismissable),"backdropClass"in nt&&t(22,Ae=nt.backdropClass),"classBackdrop"in nt&&t(23,xe=nt.classBackdrop),"dialogClass"in nt&&t(24,pe=nt.dialogClass),"classDialog"in nt&&t(25,ke=nt.classDialog),"defaultClass"in nt&&t(26,Ie=nt.defaultClass),"headerClass"in nt&&t(27,Ve=nt.headerClass),"classHeader"in nt&&t(28,We=nt.classHeader),"bodyClass"in nt&&t(29,Oe=nt.bodyClass),"classBody"in nt&&t(30,It=nt.classBody),"footerClass"in nt&&t(31,mt=nt.footerClass),"classFooter"in nt&&t(32,Ft=nt.classFooter),"$$scope"in nt&&t(36,S=nt.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&1&&Yt(R?"open":"close"),n.$$.dirty[0]&12582912&&t(10,i=mo(Ae,xe)),n.$$.dirty[0]&50855936&&t(9,o=mo(pe,ke,Tn(re))),t(8,h=mo(Ie,"w-full divide-y",e.class)),n.$$.dirty[0]&402653184&&t(7,u=mo(Ve,We)),n.$$.dirty[0]&1610612736&&t(6,l=mo(Oe,It)),n.$$.dirty[1]&3&&t(5,p=mo(mt,Ft))},e=_s(e),[R,j,H,X,de,p,l,u,h,o,i,Qt,ji,di,ii,Ci,Gi,k,z,re,W,ae,Ae,xe,pe,ke,Ie,Ve,We,Oe,It,mt,Ft,C,qi,Xi,S]}class Pk extends Gt{constructor(e){super(),Xt(this,e,Mk,Tk,Kt,{open:0,title:1,size:2,color:3,placement:19,autoclose:20,outsideclose:21,dismissable:4,backdropClass:22,classBackdrop:23,dialogClass:24,classDialog:25,defaultClass:26,headerClass:27,classHeader:28,bodyClass:29,classBody:30,footerClass:31,classFooter:32},null,[-1,-1])}}function Ik(n){let e;return{c(){e=et("span")},m(t,i){qe(t,e,i),n[4](e)},p:St,i:St,o:St,d(t){t&&je(e),n[4](null)}}}function Ak(n){let e,t,i,o,h;const u=[zk,Ek],l=[];function p(y,k){return k&4&&(e=null),e==null&&(e=!!(y[2].getClass()||y[2].getStyle())),e?0:1}return t=p(n,-1),i=l[t]=u[t](n),{c(){i.c(),o=Di()},m(y,k){l[t].m(y,k),qe(y,o,k),h=!0},p(y,k){let C=t;t=p(y,k),t===C?l[t].p(y,k):(oi(),Ce(l[C],1,1,()=>{l[C]=null}),ai(),i=l[t],i?i.p(y,k):(i=l[t]=u[t](y),i.c()),we(i,1),i.m(o.parentNode,o))},i(y){h||(we(i),h=!0)},o(y){Ce(i),h=!1},d(y){l[t].d(y),y&&je(o)}}}function Ek(n){var l;let e,t,i;const o=[n[2]._props];var h=(l=n[2])==null?void 0:l._svelteComponent;function u(p){let y={};for(let k=0;k<o.length;k+=1)y=Ht(y,o[k]);return{props:y}}return h&&(e=Rl(h,u())),{c(){e&&lt(e.$$.fragment),t=Di()},m(p,y){e&&ct(e,p,y),qe(p,t,y),i=!0},p(p,y){var C;const k=y&4?bs(o,[Md(p[2]._props)]):{};if(y&4&&h!==(h=(C=p[2])==null?void 0:C._svelteComponent)){if(e){oi();const S=e;Ce(S.$$.fragment,1,0,()=>{ht(S,1)}),ai()}h?(e=Rl(h,u()),lt(e.$$.fragment),we(e.$$.fragment,1),ct(e,t.parentNode,t)):e=null}else h&&e.$set(k)},i(p){i||(e&&we(e.$$.fragment,p),i=!0)},o(p){e&&Ce(e.$$.fragment,p),i=!1},d(p){p&&je(t),e&&ht(e,p)}}}function zk(n){var l;let e,t,i;const o=[n[2]._props,{class:n[2].getClass()},{style:n[2].getStyle()}];var h=(l=n[2])==null?void 0:l._svelteComponent;function u(p){let y={};for(let k=0;k<o.length;k+=1)y=Ht(y,o[k]);return{props:y}}return h&&(e=Rl(h,u())),{c(){e&&lt(e.$$.fragment),t=Di()},m(p,y){e&&ct(e,p,y),qe(p,t,y),i=!0},p(p,y){var C;const k=y&4?bs(o,[Md(p[2]._props),{class:p[2].getClass()},{style:p[2].getStyle()}]):{};if(y&4&&h!==(h=(C=p[2])==null?void 0:C._svelteComponent)){if(e){oi();const S=e;Ce(S.$$.fragment,1,0,()=>{ht(S,1)}),ai()}h?(e=Rl(h,u()),lt(e.$$.fragment),we(e.$$.fragment,1),ct(e,t.parentNode,t)):e=null}else h&&e.$set(k)},i(p){i||(e&&we(e.$$.fragment,p),i=!0)},o(p){e&&Ce(e.$$.fragment,p),i=!1},d(p){p&&je(t),e&&ht(e,p)}}}function Dk(n){let e,t,i,o;const h=[Ak,Ik],u=[];function l(p,y){return p[1]?0:1}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,[y]){let k=e;e=l(p),e===k?u[e].p(p,y):(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai(),t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i))},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function Lk(n,e,t){let{construct:i}=e,o,h,u=!1,l,p;Td(()=>{if(l=typeof i=="function"?i():i,l!=null&&l.isSvelte){t(1,u=!0),t(2,p=l);return}h=l==null?void 0:l.ConstructElement(),h!==void 0&&(o==null||o.replaceWith(h))}),rr(()=>{h==null||h.remove(),l==null||l.Destroy()});function y(k){xo[k?"unshift":"push"](()=>{o=k,t(0,o)})}return n.$$set=k=>{"construct"in k&&t(3,i=k.construct)},[o,u,p,i,y]}class M_ extends Gt{constructor(e){super(),Xt(this,e,Lk,Dk,Kt,{construct:3})}}const Rk=n=>({}),P_=n=>({}),Fk=n=>({}),I_=n=>({});function A_(n){let e;const t=n[10].footer,i=jn(t,n,n[12],P_);return{c(){i&&i.c()},m(o,h){i&&i.m(o,h),e=!0},p(o,h){i&&i.p&&(!e||h&4096)&&qn(i,t,o,o[12],e?Wn(t,o[12],h,Rk):Hn(o[12]),P_)},i(o){e||(we(i,o),e=!0)},o(o){Ce(i,o),e=!1},d(o){i&&i.d(o)}}}function Bk(n){let e,t,i;const o=n[10].default,h=jn(o,n,n[12],null);let u=n[7].footer&&A_(n);return{c(){h&&h.c(),e=xt(),u&&u.c(),t=Di()},m(l,p){h&&h.m(l,p),qe(l,e,p),u&&u.m(l,p),qe(l,t,p),i=!0},p(l,p){h&&h.p&&(!i||p&4096)&&qn(h,o,l,l[12],i?Wn(o,l[12],p,null):Hn(l[12]),null),l[7].footer?u?(u.p(l,p),p&128&&we(u,1)):(u=A_(l),u.c(),we(u,1),u.m(t.parentNode,t)):u&&(oi(),Ce(u,1,1,()=>{u=null}),ai())},i(l){i||(we(h,l),we(u),i=!0)},o(l){Ce(h,l),Ce(u),i=!1},d(l){h&&h.d(l),l&&je(e),u&&u.d(l),l&&je(t)}}}function E_(n){let e,t;const i=n[10].header,o=jn(i,n,n[12],I_);return{c(){e=et("h1"),o&&o.c(),ie(e,"class","page-header w-full")},m(h,u){qe(h,e,u),o&&o.m(e,null),t=!0},p(h,u){o&&o.p&&(!t||u&4096)&&qn(o,i,h,h[12],t?Wn(i,h[12],u,Fk):Hn(h[12]),I_)},i(h){t||(we(o,h),t=!0)},o(h){Ce(o,h),t=!1},d(h){h&&je(e),o&&o.d(h)}}}function Ok(n){let e,t,i=n[7].header&&E_(n);return{c(){i&&i.c(),e=Di()},m(o,h){i&&i.m(o,h),qe(o,e,h),t=!0},p(o,h){o[7].header?i?(i.p(o,h),h&128&&we(i,1)):(i=E_(o),i.c(),we(i,1),i.m(e.parentNode,e)):i&&(oi(),Ce(i,1,1,()=>{i=null}),ai())},i(o){t||(we(i),t=!0)},o(o){Ce(i),t=!1},d(o){i&&i.d(o),o&&je(e)}}}function Vk(n){let e,t;return e=new Pk({props:{open:n[5],outsideclose:!0,size:"xl",dismissable:n[1],defaultClass:n[2],bodyClass:n[6],dialogClass:n[3],headerClass:n[4],color:"none",$$slots:{header:[Ok],default:[Bk]},$$scope:{ctx:n}}}),e.$on("close",n[11]),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,[o]){const h={};o&32&&(h.open=i[5]),o&2&&(h.dismissable=i[1]),o&4&&(h.defaultClass=i[2]),o&8&&(h.dialogClass=i[3]),o&16&&(h.headerClass=i[4]),o&4224&&(h.$$scope={dirty:o,ctx:i}),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}const z_="in-page normal-background dark:bg-gray-800 rounded-lg border-gray-200 dark:border-gray-700 border-gray-200 dark:border-gray-700 divide-gray-200 dark:divide-gray-700 shadow-md";function Nk(n,e,t){let{$$slots:i={},$$scope:o}=e;const h=R0(i);let{fullscreen:u=!1}=e,l="relative flex flex-col mx-auto w-full divide-y "+z_;u&&(l=z_);let p="fixed top-0 start-0 end-0 h-modal inset-0 z-50 w-full p-4 flex";u&&(p+=" h-full-child");let{bodyPadding:y="p-4 md:p-5 "}=e,k=y+" h-full space-y-4 flex-1 overflow-y-auto overscroll-contain",C="flex justify-between items-center p-2 px-4 md:px-5 rounded-t-lg";h.header||(C="hidden");let{shown:S}=e,{dismissable:z=!0}=e,R=!1;S.addCallbackAndRun(H=>{t(5,R=H)});const j=()=>S.set(!1);return n.$$set=H=>{"fullscreen"in H&&t(8,u=H.fullscreen),"bodyPadding"in H&&t(9,y=H.bodyPadding),"shown"in H&&t(0,S=H.shown),"dismissable"in H&&t(1,z=H.dismissable),"$$scope"in H&&t(12,o=H.$$scope)},[S,z,l,p,C,R,k,h,u,y,i,j,o]}class Uk extends Gt{constructor(e){super(),Xt(this,e,Nk,Vk,Kt,{fullscreen:8,bodyPadding:9,shown:0,dismissable:1})}}class RP extends Hp{constructor(e){const t=gs.W(e)??gs.t.general.loading;t.SetClass("pl-2"),super([new Sd(zv).SetClass("animate-spin self-center").SetStyle("width: 1.5rem; height: 1.5rem; min-width: 1.5rem;"),t]),this.SetClass("flex p-1")}}class FP extends kh{constructor(t,i=!1){super();Ge(this,"uiElements");Ge(this,"_ordered");this._ordered=i,this.uiElements=Ni.NoNull(t).map(o=>gs.W(o))}AsMarkdown(){return this._ordered?`

`+this.uiElements.map((t,i)=>"  "+i+". "+t.AsMarkdown().replace(/\n/g,`  
`)).join(`
`)+`
`:`

`+this.uiElements.map(t=>"  - "+t.AsMarkdown().replace(/\n/g,`  
`)).join(`
`)+`
`}InnerConstructElement(){const t=document.createElement(this._ordered?"ol":"ul");for(const i of this.uiElements){if(i==null)continue;const o=i.ConstructElement();if(o!==void 0){const h=document.createElement("li");h.appendChild(o),t.appendChild(h)}}return t}}/*!
 * Chart.js v3.9.1
 * https://www.chartjs.org
 * (c) 2022 Chart.js Contributors
 * Released under the MIT License
 */function uo(){}const jk=function(){let n=0;return function(){return n++}}();function ui(n){return n===null||typeof n>"u"}function Vi(n){if(Array.isArray&&Array.isArray(n))return!0;const e=Object.prototype.toString.call(n);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function ri(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}const Cn=n=>(typeof n=="number"||n instanceof Number)&&isFinite(+n);function gr(n,e){return Cn(n)?n:e}function $t(n,e){return typeof n>"u"?e:n}const qk=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:n/e,d1=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*e:+n;function Oi(n,e,t){if(n&&typeof n.call=="function")return n.apply(t,e)}function ki(n,e,t,i){let o,h,u;if(Vi(n))if(h=n.length,i)for(o=h-1;o>=0;o--)e.call(t,n[o],o);else for(o=0;o<h;o++)e.call(t,n[o],o);else if(ri(n))for(u=Object.keys(n),h=u.length,o=0;o<h;o++)e.call(t,n[u[o]],u[o])}function ld(n,e){let t,i,o,h;if(!n||!e||n.length!==e.length)return!1;for(t=0,i=n.length;t<i;++t)if(o=n[t],h=e[t],o.datasetIndex!==h.datasetIndex||o.index!==h.index)return!1;return!0}function cd(n){if(Vi(n))return n.map(cd);if(ri(n)){const e=Object.create(null),t=Object.keys(n),i=t.length;let o=0;for(;o<i;++o)e[t[o]]=cd(n[t[o]]);return e}return n}function f1(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function Hk(n,e,t,i){if(!f1(n))return;const o=e[n],h=t[n];ri(o)&&ri(h)?_h(o,h,i):e[n]=cd(h)}function _h(n,e,t){const i=Vi(e)?e:[e],o=i.length;if(!ri(n))return n;t=t||{};const h=t.merger||Hk;for(let u=0;u<o;++u){if(e=i[u],!ri(e))continue;const l=Object.keys(e);for(let p=0,y=l.length;p<y;++p)h(l[p],n,e,t)}return n}function ah(n,e){return _h(n,e,{merger:Wk})}function Wk(n,e,t){if(!f1(n))return;const i=e[n],o=t[n];ri(i)&&ri(o)?ah(i,o):Object.prototype.hasOwnProperty.call(e,n)||(e[n]=cd(o))}const D_={"":n=>n,x:n=>n.x,y:n=>n.y};function ea(n,e){return(D_[e]||(D_[e]=Zk(e)))(n)}function Zk(n){const e=$k(n);return t=>{for(const i of e){if(i==="")break;t=t&&t[i]}return t}}function $k(n){const e=n.split("."),t=[];let i="";for(const o of e)i+=o,i.endsWith("\\")?i=i.slice(0,-1)+".":(t.push(i),i="");return t}function Yp(n){return n.charAt(0).toUpperCase()+n.slice(1)}const yr=n=>typeof n<"u",ta=n=>typeof n=="function",L_=(n,e)=>{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0};function Gk(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const nn=Math.PI,Ei=2*nn,Xk=Ei+nn,hd=Number.POSITIVE_INFINITY,Kk=nn/180,gn=nn/2,Kc=nn/4,R_=nn*2/3,_r=Math.log10,jr=Math.sign;function F_(n){const e=Math.round(n);n=lh(n,e,n/1e3)?e:n;const t=Math.pow(10,Math.floor(_r(n))),i=n/t;return(i<=1?1:i<=2?2:i<=5?5:10)*t}function Yk(n){const e=[],t=Math.sqrt(n);let i;for(i=1;i<t;i++)n%i===0&&(e.push(i),e.push(n/i));return t===(t|0)&&e.push(t),e.sort((o,h)=>o-h).pop(),e}function Bl(n){return!isNaN(parseFloat(n))&&isFinite(n)}function lh(n,e,t){return Math.abs(n-e)<t}function Jk(n,e){const t=Math.round(n);return t-e<=n&&t+e>=n}function p1(n,e,t){let i,o,h;for(i=0,o=n.length;i<o;i++)h=n[i][t],isNaN(h)||(e.min=Math.min(e.min,h),e.max=Math.max(e.max,h))}function Pr(n){return n*(nn/180)}function Jp(n){return n*(180/nn)}function B_(n){if(!Cn(n))return;let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}function m1(n,e){const t=e.x-n.x,i=e.y-n.y,o=Math.sqrt(t*t+i*i);let h=Math.atan2(i,t);return h<-.5*nn&&(h+=Ei),{angle:h,distance:o}}function Pp(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function Qk(n,e){return(n-e+Xk)%Ei-nn}function ir(n){return(n%Ei+Ei)%Ei}function yh(n,e,t,i){const o=ir(n),h=ir(e),u=ir(t),l=ir(h-o),p=ir(u-o),y=ir(o-h),k=ir(o-u);return o===h||o===u||i&&h===u||l>p&&y<k}function Un(n,e,t){return Math.max(e,Math.min(t,n))}function eS(n){return Un(n,-32768,32767)}function _o(n,e,t,i=1e-6){return n>=Math.min(e,t)-i&&n<=Math.max(e,t)+i}function Qp(n,e,t){t=t||(u=>n[u]<e);let i=n.length-1,o=0,h;for(;i-o>1;)h=o+i>>1,t(h)?o=h:i=h;return{lo:o,hi:i}}const yo=(n,e,t,i)=>Qp(n,t,i?o=>n[o][e]<=t:o=>n[o][e]<t),tS=(n,e,t)=>Qp(n,t,i=>n[i][e]>=t);function iS(n,e,t){let i=0,o=n.length;for(;i<o&&n[i]<e;)i++;for(;o>i&&n[o-1]>t;)o--;return i>0||o<n.length?n.slice(i,o):n}const g1=["push","pop","shift","splice","unshift"];function nS(n,e){if(n._chartjs){n._chartjs.listeners.push(e);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),g1.forEach(t=>{const i="_onData"+Yp(t),o=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...h){const u=o.apply(this,h);return n._chartjs.listeners.forEach(l=>{typeof l[i]=="function"&&l[i](...h)}),u}})})}function O_(n,e){const t=n._chartjs;if(!t)return;const i=t.listeners,o=i.indexOf(e);o!==-1&&i.splice(o,1),!(i.length>0)&&(g1.forEach(h=>{delete n[h]}),delete n._chartjs)}function _1(n){const e=new Set;let t,i;for(t=0,i=n.length;t<i;++t)e.add(n[t]);return e.size===i?n:Array.from(e)}const y1=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function b1(n,e,t){const i=t||(u=>Array.prototype.slice.call(u));let o=!1,h=[];return function(...u){h=i(u),o||(o=!0,y1.call(window,()=>{o=!1,n.apply(e,h)}))}}function sS(n,e){let t;return function(...i){return e?(clearTimeout(t),t=setTimeout(n,e,i)):n.apply(this,i),e}}const em=n=>n==="start"?"left":n==="end"?"right":"center",fs=(n,e,t)=>n==="start"?e:n==="end"?t:(e+t)/2,rS=(n,e,t,i)=>n===(i?"left":"right")?t:n==="center"?(e+t)/2:e;function x1(n,e,t){const i=e.length;let o=0,h=i;if(n._sorted){const{iScale:u,_parsed:l}=n,p=u.axis,{min:y,max:k,minDefined:C,maxDefined:S}=u.getUserBounds();C&&(o=Un(Math.min(yo(l,u.axis,y).lo,t?i:yo(e,p,u.getPixelForValue(y)).lo),0,i-1)),S?h=Un(Math.max(yo(l,u.axis,k,!0).hi+1,t?0:yo(e,p,u.getPixelForValue(k),!0).hi+1),o,i)-o:h=i-o}return{start:o,count:h}}function v1(n){const{xScale:e,yScale:t,_scaleRanges:i}=n,o={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!i)return n._scaleRanges=o,!0;const h=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==t.min||i.ymax!==t.max;return Object.assign(i,o),h}const Uu=n=>n===0||n===1,V_=(n,e,t)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-e)*Ei/t)),N_=(n,e,t)=>Math.pow(2,-10*n)*Math.sin((n-e)*Ei/t)+1,ch={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*gn)+1,easeOutSine:n=>Math.sin(n*gn),easeInOutSine:n=>-.5*(Math.cos(nn*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Uu(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Uu(n)?n:V_(n,.075,.3),easeOutElastic:n=>Uu(n)?n:N_(n,.075,.3),easeInOutElastic(n){return Uu(n)?n:n<.5?.5*V_(n*2,.1125,.45):.5+.5*N_(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let e=1.70158;return(n/=.5)<1?.5*(n*n*(((e*=1.525)+1)*n-e)):.5*((n-=2)*n*(((e*=1.525)+1)*n+e)+2)},easeInBounce:n=>1-ch.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?ch.easeInBounce(n*2)*.5:ch.easeOutBounce(n*2-1)*.5+.5};/*!
 * @kurkle/color v0.2.1
 * https://github.com/kurkle/color#readme
 * (c) 2022 Jukka Kurkela
 * Released under the MIT License
 */function Ch(n){return n+.5|0}const Ko=(n,e,t)=>Math.max(Math.min(n,t),e);function nh(n){return Ko(Ch(n*2.55),0,255)}function Jo(n){return Ko(Ch(n*255),0,255)}function go(n){return Ko(Ch(n/2.55)/100,0,1)}function U_(n){return Ko(Ch(n*100),0,100)}const mr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Ip=[..."0123456789ABCDEF"],oS=n=>Ip[n&15],aS=n=>Ip[(n&240)>>4]+Ip[n&15],ju=n=>(n&240)>>4===(n&15),lS=n=>ju(n.r)&&ju(n.g)&&ju(n.b)&&ju(n.a);function cS(n){var e=n.length,t;return n[0]==="#"&&(e===4||e===5?t={r:255&mr[n[1]]*17,g:255&mr[n[2]]*17,b:255&mr[n[3]]*17,a:e===5?mr[n[4]]*17:255}:(e===7||e===9)&&(t={r:mr[n[1]]<<4|mr[n[2]],g:mr[n[3]]<<4|mr[n[4]],b:mr[n[5]]<<4|mr[n[6]],a:e===9?mr[n[7]]<<4|mr[n[8]]:255})),t}const hS=(n,e)=>n<255?e(n):"";function uS(n){var e=lS(n)?oS:aS;return n?"#"+e(n.r)+e(n.g)+e(n.b)+hS(n.a,e):void 0}const dS=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function w1(n,e,t){const i=e*Math.min(t,1-t),o=(h,u=(h+n/30)%12)=>t-i*Math.max(Math.min(u-3,9-u,1),-1);return[o(0),o(8),o(4)]}function fS(n,e,t){const i=(o,h=(o+n/60)%6)=>t-t*e*Math.max(Math.min(h,4-h,1),0);return[i(5),i(3),i(1)]}function pS(n,e,t){const i=w1(n,1,.5);let o;for(e+t>1&&(o=1/(e+t),e*=o,t*=o),o=0;o<3;o++)i[o]*=1-e-t,i[o]+=e;return i}function mS(n,e,t,i,o){return n===o?(e-t)/i+(e<t?6:0):e===o?(t-n)/i+2:(n-e)/i+4}function tm(n){const t=n.r/255,i=n.g/255,o=n.b/255,h=Math.max(t,i,o),u=Math.min(t,i,o),l=(h+u)/2;let p,y,k;return h!==u&&(k=h-u,y=l>.5?k/(2-h-u):k/(h+u),p=mS(t,i,o,k,h),p=p*60+.5),[p|0,y||0,l]}function im(n,e,t,i){return(Array.isArray(e)?n(e[0],e[1],e[2]):n(e,t,i)).map(Jo)}function nm(n,e,t){return im(w1,n,e,t)}function gS(n,e,t){return im(pS,n,e,t)}function _S(n,e,t){return im(fS,n,e,t)}function k1(n){return(n%360+360)%360}function yS(n){const e=dS.exec(n);let t=255,i;if(!e)return;e[5]!==i&&(t=e[6]?nh(+e[5]):Jo(+e[5]));const o=k1(+e[2]),h=+e[3]/100,u=+e[4]/100;return e[1]==="hwb"?i=gS(o,h,u):e[1]==="hsv"?i=_S(o,h,u):i=nm(o,h,u),{r:i[0],g:i[1],b:i[2],a:t}}function bS(n,e){var t=tm(n);t[0]=k1(t[0]+e),t=nm(t),n.r=t[0],n.g=t[1],n.b=t[2]}function xS(n){if(!n)return;const e=tm(n),t=e[0],i=U_(e[1]),o=U_(e[2]);return n.a<255?`hsla(${t}, ${i}%, ${o}%, ${go(n.a)})`:`hsl(${t}, ${i}%, ${o}%)`}const j_={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},q_={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function vS(){const n={},e=Object.keys(q_),t=Object.keys(j_);let i,o,h,u,l;for(i=0;i<e.length;i++){for(u=l=e[i],o=0;o<t.length;o++)h=t[o],l=l.replace(h,j_[h]);h=parseInt(q_[u],16),n[l]=[h>>16&255,h>>8&255,h&255]}return n}let qu;function wS(n){qu||(qu=vS(),qu.transparent=[0,0,0,0]);const e=qu[n.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const kS=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function SS(n){const e=kS.exec(n);let t=255,i,o,h;if(e){if(e[7]!==i){const u=+e[7];t=e[8]?nh(u):Ko(u*255,0,255)}return i=+e[1],o=+e[3],h=+e[5],i=255&(e[2]?nh(i):Ko(i,0,255)),o=255&(e[4]?nh(o):Ko(o,0,255)),h=255&(e[6]?nh(h):Ko(h,0,255)),{r:i,g:o,b:h,a:t}}}function CS(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${go(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const np=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,Ml=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function TS(n,e,t){const i=Ml(go(n.r)),o=Ml(go(n.g)),h=Ml(go(n.b));return{r:Jo(np(i+t*(Ml(go(e.r))-i))),g:Jo(np(o+t*(Ml(go(e.g))-o))),b:Jo(np(h+t*(Ml(go(e.b))-h))),a:n.a+t*(e.a-n.a)}}function Hu(n,e,t){if(n){let i=tm(n);i[e]=Math.max(0,Math.min(i[e]+i[e]*t,e===0?360:1)),i=nm(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function S1(n,e){return n&&Object.assign(e||{},n)}function H_(n){var e={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(e={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(e.a=Jo(n[3]))):(e=S1(n,{r:0,g:0,b:0,a:1}),e.a=Jo(e.a)),e}function MS(n){return n.charAt(0)==="r"?SS(n):yS(n)}class ud{constructor(e){if(e instanceof ud)return e;const t=typeof e;let i;t==="object"?i=H_(e):t==="string"&&(i=cS(e)||wS(e)||MS(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=S1(this._rgb);return e&&(e.a=go(e.a)),e}set rgb(e){this._rgb=H_(e)}rgbString(){return this._valid?CS(this._rgb):void 0}hexString(){return this._valid?uS(this._rgb):void 0}hslString(){return this._valid?xS(this._rgb):void 0}mix(e,t){if(e){const i=this.rgb,o=e.rgb;let h;const u=t===h?.5:t,l=2*u-1,p=i.a-o.a,y=((l*p===-1?l:(l+p)/(1+l*p))+1)/2;h=1-y,i.r=255&y*i.r+h*o.r+.5,i.g=255&y*i.g+h*o.g+.5,i.b=255&y*i.b+h*o.b+.5,i.a=u*i.a+(1-u)*o.a,this.rgb=i}return this}interpolate(e,t){return e&&(this._rgb=TS(this._rgb,e._rgb,t)),this}clone(){return new ud(this.rgb)}alpha(e){return this._rgb.a=Jo(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=Ch(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Hu(this._rgb,2,e),this}darken(e){return Hu(this._rgb,2,-e),this}saturate(e){return Hu(this._rgb,1,e),this}desaturate(e){return Hu(this._rgb,1,-e),this}rotate(e){return bS(this._rgb,e),this}}function C1(n){return new ud(n)}function T1(n){if(n&&typeof n=="object"){const e=n.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function W_(n){return T1(n)?n:C1(n)}function sp(n){return T1(n)?n:C1(n).saturate(.5).darken(.1).hexString()}const Ba=Object.create(null),Ap=Object.create(null);function hh(n,e){if(!e)return n;const t=e.split(".");for(let i=0,o=t.length;i<o;++i){const h=t[i];n=n[h]||(n[h]=Object.create(null))}return n}function rp(n,e,t){return typeof e=="string"?_h(hh(n,e),t):_h(hh(n,""),e)}class PS{constructor(e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,i)=>sp(i.backgroundColor),this.hoverBorderColor=(t,i)=>sp(i.borderColor),this.hoverColor=(t,i)=>sp(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e)}set(e,t){return rp(this,e,t)}get(e){return hh(this,e)}describe(e,t){return rp(Ap,e,t)}override(e,t){return rp(Ba,e,t)}route(e,t,i,o){const h=hh(this,e),u=hh(this,i),l="_"+t;Object.defineProperties(h,{[l]:{value:h[t],writable:!0},[t]:{enumerable:!0,get(){const p=this[l],y=u[o];return ri(p)?Object.assign({},y,p):$t(p,y)},set(p){this[l]=p}}})}}var li=new PS({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function IS(n){return!n||ui(n.size)||ui(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function dd(n,e,t,i,o){let h=e[o];return h||(h=e[o]=n.measureText(o).width,t.push(o)),h>i&&(i=h),i}function AS(n,e,t,i){i=i||{};let o=i.data=i.data||{},h=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(o=i.data={},h=i.garbageCollect=[],i.font=e),n.save(),n.font=e;let u=0;const l=t.length;let p,y,k,C,S;for(p=0;p<l;p++)if(C=t[p],C!=null&&Vi(C)!==!0)u=dd(n,o,h,u,C);else if(Vi(C))for(y=0,k=C.length;y<k;y++)S=C[y],S!=null&&!Vi(S)&&(u=dd(n,o,h,u,S));n.restore();const z=h.length/2;if(z>t.length){for(p=0;p<z;p++)delete o[h[p]];h.splice(0,z)}return u}function Pa(n,e,t){const i=n.currentDevicePixelRatio,o=t!==0?Math.max(t/2,.5):0;return Math.round((e-o)*i)/i+o}function Z_(n,e){e=e||n.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,n.width,n.height),e.restore()}function Ep(n,e,t,i){M1(n,e,t,i,null)}function M1(n,e,t,i,o){let h,u,l,p,y,k;const C=e.pointStyle,S=e.rotation,z=e.radius;let R=(S||0)*Kk;if(C&&typeof C=="object"&&(h=C.toString(),h==="[object HTMLImageElement]"||h==="[object HTMLCanvasElement]")){n.save(),n.translate(t,i),n.rotate(R),n.drawImage(C,-C.width/2,-C.height/2,C.width,C.height),n.restore();return}if(!(isNaN(z)||z<=0)){switch(n.beginPath(),C){default:o?n.ellipse(t,i,o/2,z,0,0,Ei):n.arc(t,i,z,0,Ei),n.closePath();break;case"triangle":n.moveTo(t+Math.sin(R)*z,i-Math.cos(R)*z),R+=R_,n.lineTo(t+Math.sin(R)*z,i-Math.cos(R)*z),R+=R_,n.lineTo(t+Math.sin(R)*z,i-Math.cos(R)*z),n.closePath();break;case"rectRounded":y=z*.516,p=z-y,u=Math.cos(R+Kc)*p,l=Math.sin(R+Kc)*p,n.arc(t-u,i-l,y,R-nn,R-gn),n.arc(t+l,i-u,y,R-gn,R),n.arc(t+u,i+l,y,R,R+gn),n.arc(t-l,i+u,y,R+gn,R+nn),n.closePath();break;case"rect":if(!S){p=Math.SQRT1_2*z,k=o?o/2:p,n.rect(t-k,i-p,2*k,2*p);break}R+=Kc;case"rectRot":u=Math.cos(R)*z,l=Math.sin(R)*z,n.moveTo(t-u,i-l),n.lineTo(t+l,i-u),n.lineTo(t+u,i+l),n.lineTo(t-l,i+u),n.closePath();break;case"crossRot":R+=Kc;case"cross":u=Math.cos(R)*z,l=Math.sin(R)*z,n.moveTo(t-u,i-l),n.lineTo(t+u,i+l),n.moveTo(t+l,i-u),n.lineTo(t-l,i+u);break;case"star":u=Math.cos(R)*z,l=Math.sin(R)*z,n.moveTo(t-u,i-l),n.lineTo(t+u,i+l),n.moveTo(t+l,i-u),n.lineTo(t-l,i+u),R+=Kc,u=Math.cos(R)*z,l=Math.sin(R)*z,n.moveTo(t-u,i-l),n.lineTo(t+u,i+l),n.moveTo(t+l,i-u),n.lineTo(t-l,i+u);break;case"line":u=o?o/2:Math.cos(R)*z,l=Math.sin(R)*z,n.moveTo(t-u,i-l),n.lineTo(t+u,i+l);break;case"dash":n.moveTo(t,i),n.lineTo(t+Math.cos(R)*z,i+Math.sin(R)*z);break}n.fill(),e.borderWidth>0&&n.stroke()}}function bh(n,e,t){return t=t||.5,!e||n&&n.x>e.left-t&&n.x<e.right+t&&n.y>e.top-t&&n.y<e.bottom+t}function Dd(n,e){n.save(),n.beginPath(),n.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),n.clip()}function Ld(n){n.restore()}function ES(n,e,t,i,o){if(!e)return n.lineTo(t.x,t.y);if(o==="middle"){const h=(e.x+t.x)/2;n.lineTo(h,e.y),n.lineTo(h,t.y)}else o==="after"!=!!i?n.lineTo(e.x,t.y):n.lineTo(t.x,e.y);n.lineTo(t.x,t.y)}function zS(n,e,t,i){if(!e)return n.lineTo(t.x,t.y);n.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?t.cp2x:t.cp1x,i?t.cp2y:t.cp1y,t.x,t.y)}function Oa(n,e,t,i,o,h={}){const u=Vi(e)?e:[e],l=h.strokeWidth>0&&h.strokeColor!=="";let p,y;for(n.save(),n.font=o.string,DS(n,h),p=0;p<u.length;++p)y=u[p],l&&(h.strokeColor&&(n.strokeStyle=h.strokeColor),ui(h.strokeWidth)||(n.lineWidth=h.strokeWidth),n.strokeText(y,t,i,h.maxWidth)),n.fillText(y,t,i,h.maxWidth),LS(n,t,i,y,h),i+=o.lineHeight;n.restore()}function DS(n,e){e.translation&&n.translate(e.translation[0],e.translation[1]),ui(e.rotation)||n.rotate(e.rotation),e.color&&(n.fillStyle=e.color),e.textAlign&&(n.textAlign=e.textAlign),e.textBaseline&&(n.textBaseline=e.textBaseline)}function LS(n,e,t,i,o){if(o.strikethrough||o.underline){const h=n.measureText(i),u=e-h.actualBoundingBoxLeft,l=e+h.actualBoundingBoxRight,p=t-h.actualBoundingBoxAscent,y=t+h.actualBoundingBoxDescent,k=o.strikethrough?(p+y)/2:y;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=o.decorationWidth||2,n.moveTo(u,k),n.lineTo(l,k),n.stroke()}}function xh(n,e){const{x:t,y:i,w:o,h,radius:u}=e;n.arc(t+u.topLeft,i+u.topLeft,u.topLeft,-gn,nn,!0),n.lineTo(t,i+h-u.bottomLeft),n.arc(t+u.bottomLeft,i+h-u.bottomLeft,u.bottomLeft,nn,gn,!0),n.lineTo(t+o-u.bottomRight,i+h),n.arc(t+o-u.bottomRight,i+h-u.bottomRight,u.bottomRight,gn,0,!0),n.lineTo(t+o,i+u.topRight),n.arc(t+o-u.topRight,i+u.topRight,u.topRight,0,-gn,!0),n.lineTo(t+u.topLeft,i)}const RS=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),FS=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function BS(n,e){const t=(""+n).match(RS);if(!t||t[1]==="normal")return e*1.2;switch(n=+t[2],t[3]){case"px":return n;case"%":n/=100;break}return e*n}const OS=n=>+n||0;function sm(n,e){const t={},i=ri(e),o=i?Object.keys(e):e,h=ri(n)?i?u=>$t(n[u],n[e[u]]):u=>n[u]:()=>n;for(const u of o)t[u]=OS(h(u));return t}function P1(n){return sm(n,{top:"y",right:"x",bottom:"y",left:"x"})}function La(n){return sm(n,["topLeft","topRight","bottomLeft","bottomRight"])}function ys(n){const e=P1(n);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Rn(n,e){n=n||{},e=e||li.font;let t=$t(n.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let i=$t(n.style,e.style);i&&!(""+i).match(FS)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");const o={family:$t(n.family,e.family),lineHeight:BS($t(n.lineHeight,e.lineHeight),t),size:t,style:i,weight:$t(n.weight,e.weight),string:""};return o.string=IS(o),o}function sh(n,e,t,i){let o=!0,h,u,l;for(h=0,u=n.length;h<u;++h)if(l=n[h],l!==void 0&&(e!==void 0&&typeof l=="function"&&(l=l(e),o=!1),t!==void 0&&Vi(l)&&(l=l[t%l.length],o=!1),l!==void 0))return i&&!o&&(i.cacheable=!1),l}function VS(n,e,t){const{min:i,max:o}=n,h=d1(e,(o-i)/2),u=(l,p)=>t&&l===0?0:l+p;return{min:u(i,-Math.abs(h)),max:u(o,h)}}function ia(n,e){return Object.assign(Object.create(n),e)}function rm(n,e=[""],t=n,i,o=()=>n[0]){yr(i)||(i=z1("_fallback",n));const h={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:t,_fallback:i,_getTarget:o,override:u=>rm([u,...n],e,t,i)};return new Proxy(h,{deleteProperty(u,l){return delete u[l],delete u._keys,delete n[0][l],!0},get(u,l){return A1(u,l,()=>$S(l,e,n,u))},getOwnPropertyDescriptor(u,l){return Reflect.getOwnPropertyDescriptor(u._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(u,l){return G_(u).includes(l)},ownKeys(u){return G_(u)},set(u,l,p){const y=u._storage||(u._storage=o());return u[l]=y[l]=p,delete u._keys,!0}})}function Ol(n,e,t,i){const o={_cacheable:!1,_proxy:n,_context:e,_subProxy:t,_stack:new Set,_descriptors:I1(n,i),setContext:h=>Ol(n,h,t,i),override:h=>Ol(n.override(h),e,t,i)};return new Proxy(o,{deleteProperty(h,u){return delete h[u],delete n[u],!0},get(h,u,l){return A1(h,u,()=>US(h,u,l))},getOwnPropertyDescriptor(h,u){return h._descriptors.allKeys?Reflect.has(n,u)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,u)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(h,u){return Reflect.has(n,u)},ownKeys(){return Reflect.ownKeys(n)},set(h,u,l){return n[u]=l,delete h[u],!0}})}function I1(n,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:i=e.indexable,_allKeys:o=e.allKeys}=n;return{allKeys:o,scriptable:t,indexable:i,isScriptable:ta(t)?t:()=>t,isIndexable:ta(i)?i:()=>i}}const NS=(n,e)=>n?n+Yp(e):e,om=(n,e)=>ri(e)&&n!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function A1(n,e,t){if(Object.prototype.hasOwnProperty.call(n,e))return n[e];const i=t();return n[e]=i,i}function US(n,e,t){const{_proxy:i,_context:o,_subProxy:h,_descriptors:u}=n;let l=i[e];return ta(l)&&u.isScriptable(e)&&(l=jS(e,l,n,t)),Vi(l)&&l.length&&(l=qS(e,l,n,u.isIndexable)),om(e,l)&&(l=Ol(l,o,h&&h[e],u)),l}function jS(n,e,t,i){const{_proxy:o,_context:h,_subProxy:u,_stack:l}=t;if(l.has(n))throw new Error("Recursion detected: "+Array.from(l).join("->")+"->"+n);return l.add(n),e=e(h,u||i),l.delete(n),om(n,e)&&(e=am(o._scopes,o,n,e)),e}function qS(n,e,t,i){const{_proxy:o,_context:h,_subProxy:u,_descriptors:l}=t;if(yr(h.index)&&i(n))e=e[h.index%e.length];else if(ri(e[0])){const p=e,y=o._scopes.filter(k=>k!==p);e=[];for(const k of p){const C=am(y,o,n,k);e.push(Ol(C,h,u&&u[n],l))}}return e}function E1(n,e,t){return ta(n)?n(e,t):n}const HS=(n,e)=>n===!0?e:typeof n=="string"?ea(e,n):void 0;function WS(n,e,t,i,o){for(const h of e){const u=HS(t,h);if(u){n.add(u);const l=E1(u._fallback,t,o);if(yr(l)&&l!==t&&l!==i)return l}else if(u===!1&&yr(i)&&t!==i)return null}return!1}function am(n,e,t,i){const o=e._rootScopes,h=E1(e._fallback,t,i),u=[...n,...o],l=new Set;l.add(i);let p=$_(l,u,t,h||t,i);return p===null||yr(h)&&h!==t&&(p=$_(l,u,h,p,i),p===null)?!1:rm(Array.from(l),[""],o,h,()=>ZS(e,t,i))}function $_(n,e,t,i,o){for(;t;)t=WS(n,e,t,i,o);return t}function ZS(n,e,t){const i=n._getTarget();e in i||(i[e]={});const o=i[e];return Vi(o)&&ri(t)?t:o}function $S(n,e,t,i){let o;for(const h of e)if(o=z1(NS(h,n),t),yr(o))return om(n,o)?am(t,i,n,o):o}function z1(n,e){for(const t of e){if(!t)continue;const i=t[n];if(yr(i))return i}}function G_(n){let e=n._keys;return e||(e=n._keys=GS(n._scopes)),e}function GS(n){const e=new Set;for(const t of n)for(const i of Object.keys(t).filter(o=>!o.startsWith("_")))e.add(i);return Array.from(e)}function D1(n,e,t,i){const{iScale:o}=n,{key:h="r"}=this._parsing,u=new Array(i);let l,p,y,k;for(l=0,p=i;l<p;++l)y=l+t,k=e[y],u[l]={r:o.parse(ea(k,h),y)};return u}const XS=Number.EPSILON||1e-14,Vl=(n,e)=>e<n.length&&!n[e].skip&&n[e],L1=n=>n==="x"?"y":"x";function KS(n,e,t,i){const o=n.skip?e:n,h=e,u=t.skip?e:t,l=Pp(h,o),p=Pp(u,h);let y=l/(l+p),k=p/(l+p);y=isNaN(y)?0:y,k=isNaN(k)?0:k;const C=i*y,S=i*k;return{previous:{x:h.x-C*(u.x-o.x),y:h.y-C*(u.y-o.y)},next:{x:h.x+S*(u.x-o.x),y:h.y+S*(u.y-o.y)}}}function YS(n,e,t){const i=n.length;let o,h,u,l,p,y=Vl(n,0);for(let k=0;k<i-1;++k)if(p=y,y=Vl(n,k+1),!(!p||!y)){if(lh(e[k],0,XS)){t[k]=t[k+1]=0;continue}o=t[k]/e[k],h=t[k+1]/e[k],l=Math.pow(o,2)+Math.pow(h,2),!(l<=9)&&(u=3/Math.sqrt(l),t[k]=o*u*e[k],t[k+1]=h*u*e[k])}}function JS(n,e,t="x"){const i=L1(t),o=n.length;let h,u,l,p=Vl(n,0);for(let y=0;y<o;++y){if(u=l,l=p,p=Vl(n,y+1),!l)continue;const k=l[t],C=l[i];u&&(h=(k-u[t])/3,l[`cp1${t}`]=k-h,l[`cp1${i}`]=C-h*e[y]),p&&(h=(p[t]-k)/3,l[`cp2${t}`]=k+h,l[`cp2${i}`]=C+h*e[y])}}function QS(n,e="x"){const t=L1(e),i=n.length,o=Array(i).fill(0),h=Array(i);let u,l,p,y=Vl(n,0);for(u=0;u<i;++u)if(l=p,p=y,y=Vl(n,u+1),!!p){if(y){const k=y[e]-p[e];o[u]=k!==0?(y[t]-p[t])/k:0}h[u]=l?y?jr(o[u-1])!==jr(o[u])?0:(o[u-1]+o[u])/2:o[u-1]:o[u]}YS(n,o,h),JS(n,h,e)}function Wu(n,e,t){return Math.max(Math.min(n,t),e)}function e3(n,e){let t,i,o,h,u,l=bh(n[0],e);for(t=0,i=n.length;t<i;++t)u=h,h=l,l=t<i-1&&bh(n[t+1],e),h&&(o=n[t],u&&(o.cp1x=Wu(o.cp1x,e.left,e.right),o.cp1y=Wu(o.cp1y,e.top,e.bottom)),l&&(o.cp2x=Wu(o.cp2x,e.left,e.right),o.cp2y=Wu(o.cp2y,e.top,e.bottom)))}function t3(n,e,t,i,o){let h,u,l,p;if(e.spanGaps&&(n=n.filter(y=>!y.skip)),e.cubicInterpolationMode==="monotone")QS(n,o);else{let y=i?n[n.length-1]:n[0];for(h=0,u=n.length;h<u;++h)l=n[h],p=KS(y,l,n[Math.min(h+1,u-(i?0:1))%u],e.tension),l.cp1x=p.previous.x,l.cp1y=p.previous.y,l.cp2x=p.next.x,l.cp2y=p.next.y,y=l}e.capBezierPoints&&e3(n,t)}function R1(){return typeof window<"u"&&typeof document<"u"}function lm(n){let e=n.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function fd(n,e,t){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*e.parentNode[t])):i=n,i}const Rd=n=>window.getComputedStyle(n,null);function i3(n,e){return Rd(n).getPropertyValue(e)}const n3=["top","right","bottom","left"];function Ra(n,e,t){const i={};t=t?"-"+t:"";for(let o=0;o<4;o++){const h=n3[o];i[h]=parseFloat(n[e+"-"+h+t])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const s3=(n,e,t)=>(n>0||e>0)&&(!t||!t.shadowRoot);function r3(n,e){const t=n.touches,i=t&&t.length?t[0]:n,{offsetX:o,offsetY:h}=i;let u=!1,l,p;if(s3(o,h,n.target))l=o,p=h;else{const y=e.getBoundingClientRect();l=i.clientX-y.left,p=i.clientY-y.top,u=!0}return{x:l,y:p,box:u}}function Aa(n,e){if("native"in n)return n;const{canvas:t,currentDevicePixelRatio:i}=e,o=Rd(t),h=o.boxSizing==="border-box",u=Ra(o,"padding"),l=Ra(o,"border","width"),{x:p,y,box:k}=r3(n,t),C=u.left+(k&&l.left),S=u.top+(k&&l.top);let{width:z,height:R}=e;return h&&(z-=u.width+l.width,R-=u.height+l.height),{x:Math.round((p-C)/z*t.width/i),y:Math.round((y-S)/R*t.height/i)}}function o3(n,e,t){let i,o;if(e===void 0||t===void 0){const h=lm(n);if(!h)e=n.clientWidth,t=n.clientHeight;else{const u=h.getBoundingClientRect(),l=Rd(h),p=Ra(l,"border","width"),y=Ra(l,"padding");e=u.width-y.width-p.width,t=u.height-y.height-p.height,i=fd(l.maxWidth,h,"clientWidth"),o=fd(l.maxHeight,h,"clientHeight")}}return{width:e,height:t,maxWidth:i||hd,maxHeight:o||hd}}const op=n=>Math.round(n*10)/10;function a3(n,e,t,i){const o=Rd(n),h=Ra(o,"margin"),u=fd(o.maxWidth,n,"clientWidth")||hd,l=fd(o.maxHeight,n,"clientHeight")||hd,p=o3(n,e,t);let{width:y,height:k}=p;if(o.boxSizing==="content-box"){const C=Ra(o,"border","width"),S=Ra(o,"padding");y-=S.width+C.width,k-=S.height+C.height}return y=Math.max(0,y-h.width),k=Math.max(0,i?Math.floor(y/i):k-h.height),y=op(Math.min(y,u,p.maxWidth)),k=op(Math.min(k,l,p.maxHeight)),y&&!k&&(k=op(y/2)),{width:y,height:k}}function X_(n,e,t){const i=e||1,o=Math.floor(n.height*i),h=Math.floor(n.width*i);n.height=o/i,n.width=h/i;const u=n.canvas;return u.style&&(t||!u.style.height&&!u.style.width)&&(u.style.height=`${n.height}px`,u.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||u.height!==o||u.width!==h?(n.currentDevicePixelRatio=i,u.height=o,u.width=h,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const l3=function(){let n=!1;try{const e={get passive(){return n=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return n}();function K_(n,e){const t=i3(n,e),i=t&&t.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Ea(n,e,t,i){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function c3(n,e,t,i){return{x:n.x+t*(e.x-n.x),y:i==="middle"?t<.5?n.y:e.y:i==="after"?t<1?n.y:e.y:t>0?e.y:n.y}}function h3(n,e,t,i){const o={x:n.cp2x,y:n.cp2y},h={x:e.cp1x,y:e.cp1y},u=Ea(n,o,t),l=Ea(o,h,t),p=Ea(h,e,t),y=Ea(u,l,t),k=Ea(l,p,t);return Ea(y,k,t)}const Y_=new Map;function u3(n,e){e=e||{};const t=n+JSON.stringify(e);let i=Y_.get(t);return i||(i=new Intl.NumberFormat(n,e),Y_.set(t,i)),i}function Th(n,e,t){return u3(e,t).format(n)}const d3=function(n,e){return{x(t){return n+n+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,i){return t-i},leftForLtr(t,i){return t-i}}},f3=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,e){return n+e},leftForLtr(n,e){return n}}};function Dl(n,e,t){return n?d3(e,t):f3()}function F1(n,e){let t,i;(e==="ltr"||e==="rtl")&&(t=n.canvas.style,i=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),n.prevTextDirection=i)}function B1(n,e){e!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",e[0],e[1]))}function O1(n){return n==="angle"?{between:yh,compare:Qk,normalize:ir}:{between:_o,compare:(e,t)=>e-t,normalize:e=>e}}function J_({start:n,end:e,count:t,loop:i,style:o}){return{start:n%t,end:e%t,loop:i&&(e-n+1)%t===0,style:o}}function p3(n,e,t){const{property:i,start:o,end:h}=t,{between:u,normalize:l}=O1(i),p=e.length;let{start:y,end:k,loop:C}=n,S,z;if(C){for(y+=p,k+=p,S=0,z=p;S<z&&u(l(e[y%p][i]),o,h);++S)y--,k--;y%=p,k%=p}return k<y&&(k+=p),{start:y,end:k,loop:C,style:n.style}}function V1(n,e,t){if(!t)return[n];const{property:i,start:o,end:h}=t,u=e.length,{compare:l,between:p,normalize:y}=O1(i),{start:k,end:C,loop:S,style:z}=p3(n,e,t),R=[];let j=!1,H=null,X,re,W;const ae=()=>p(o,W,X)&&l(o,W)!==0,de=()=>l(h,X)===0||p(h,W,X),Ae=()=>j||ae(),xe=()=>!j||de();for(let pe=k,ke=k;pe<=C;++pe)re=e[pe%u],!re.skip&&(X=y(re[i]),X!==W&&(j=p(X,o,h),H===null&&Ae()&&(H=l(X,o)===0?pe:ke),H!==null&&xe()&&(R.push(J_({start:H,end:pe,loop:S,count:u,style:z})),H=null),ke=pe,W=X));return H!==null&&R.push(J_({start:H,end:C,loop:S,count:u,style:z})),R}function N1(n,e){const t=[],i=n.segments;for(let o=0;o<i.length;o++){const h=V1(i[o],n.points,e);h.length&&t.push(...h)}return t}function m3(n,e,t,i){let o=0,h=e-1;if(t&&!i)for(;o<e&&!n[o].skip;)o++;for(;o<e&&n[o].skip;)o++;for(o%=e,t&&(h+=o);h>o&&n[h%e].skip;)h--;return h%=e,{start:o,end:h}}function g3(n,e,t,i){const o=n.length,h=[];let u=e,l=n[e],p;for(p=e+1;p<=t;++p){const y=n[p%o];y.skip||y.stop?l.skip||(i=!1,h.push({start:e%o,end:(p-1)%o,loop:i}),e=u=y.stop?p:null):(u=p,l.skip&&(e=p)),l=y}return u!==null&&h.push({start:e%o,end:u%o,loop:i}),h}function _3(n,e){const t=n.points,i=n.options.spanGaps,o=t.length;if(!o)return[];const h=!!n._loop,{start:u,end:l}=m3(t,o,h,i);if(i===!0)return Q_(n,[{start:u,end:l,loop:h}],t,e);const p=l<u?l+o:l,y=!!n._fullLoop&&u===0&&l===o-1;return Q_(n,g3(t,u,p,y),t,e)}function Q_(n,e,t,i){return!i||!i.setContext||!t?e:y3(n,e,t,i)}function y3(n,e,t,i){const o=n._chart.getContext(),h=ey(n.options),{_datasetIndex:u,options:{spanGaps:l}}=n,p=t.length,y=[];let k=h,C=e[0].start,S=C;function z(R,j,H,X){const re=l?-1:1;if(R!==j){for(R+=p;t[R%p].skip;)R-=re;for(;t[j%p].skip;)j+=re;R%p!==j%p&&(y.push({start:R%p,end:j%p,loop:H,style:X}),k=X,C=j%p)}}for(const R of e){C=l?C:R.start;let j=t[C%p],H;for(S=C+1;S<=R.end;S++){const X=t[S%p];H=ey(i.setContext(ia(o,{type:"segment",p0:j,p1:X,p0DataIndex:(S-1)%p,p1DataIndex:S%p,datasetIndex:u}))),b3(H,k)&&z(C,S-1,R.loop,k),j=X,k=H}C<S-1&&z(C,S-1,R.loop,k)}return y}function ey(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function b3(n,e){return e&&JSON.stringify(n)!==JSON.stringify(e)}/*!
 * Chart.js v3.9.1
 * https://www.chartjs.org
 * (c) 2022 Chart.js Contributors
 * Released under the MIT License
 */class x3{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,i,o){const h=t.listeners[o],u=t.duration;h.forEach(l=>l({chart:e,initial:t.initial,numSteps:u,currentStep:Math.min(i-t.start,u)}))}_refresh(){this._request||(this._running=!0,this._request=y1.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((i,o)=>{if(!i.running||!i.items.length)return;const h=i.items;let u=h.length-1,l=!1,p;for(;u>=0;--u)p=h[u],p._active?(p._total>i.duration&&(i.duration=p._total),p.tick(e),l=!0):(h[u]=h[h.length-1],h.pop());l&&(o.draw(),this._notify(o,i,e,"progress")),h.length||(i.running=!1,this._notify(o,i,e,"complete"),i.initial=!1),t+=h.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let i=t.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,i)),i}listen(e,t,i){this._getAnims(e).listeners[t].push(i)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((i,o)=>Math.max(i,o._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const i=t.items;let o=i.length-1;for(;o>=0;--o)i[o].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var fo=new x3;const ty="transparent",v3={boolean(n,e,t){return t>.5?e:n},color(n,e,t){const i=W_(n||ty),o=i.valid&&W_(e||ty);return o&&o.valid?o.mix(i,t).hexString():e},number(n,e,t){return n+(e-n)*t}};class w3{constructor(e,t,i,o){const h=t[i];o=sh([e.to,o,h,e.from]);const u=sh([e.from,h,o]);this._active=!0,this._fn=e.fn||v3[e.type||typeof u],this._easing=ch[e.easing]||ch.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=i,this._from=u,this._to=o,this._promises=void 0}active(){return this._active}update(e,t,i){if(this._active){this._notify(!1);const o=this._target[this._prop],h=i-this._start,u=this._duration-h;this._start=i,this._duration=Math.floor(Math.max(u,e.duration)),this._total+=h,this._loop=!!e.loop,this._to=sh([e.to,t,o,e.from]),this._from=sh([e.from,o,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,i=this._duration,o=this._prop,h=this._from,u=this._loop,l=this._to;let p;if(this._active=h!==l&&(u||t<i),!this._active){this._target[o]=l,this._notify(!0);return}if(t<0){this._target[o]=h;return}p=t/i%2,p=u&&p>1?2-p:p,p=this._easing(Math.min(1,Math.max(0,p))),this._target[o]=this._fn(h,l,p)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,i)=>{e.push({res:t,rej:i})})}_notify(e){const t=e?"res":"rej",i=this._promises||[];for(let o=0;o<i.length;o++)i[o][t]()}}const k3=["x","y","borderWidth","radius","tension"],S3=["color","borderColor","backgroundColor"];li.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const C3=Object.keys(li.animation);li.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:n=>n!=="onProgress"&&n!=="onComplete"&&n!=="fn"});li.set("animations",{colors:{type:"color",properties:S3},numbers:{type:"number",properties:k3}});li.describe("animations",{_fallback:"animation"});li.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:n=>n|0}}}});class U1{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!ri(e))return;const t=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const o=e[i];if(!ri(o))return;const h={};for(const u of C3)h[u]=o[u];(Vi(o.properties)&&o.properties||[i]).forEach(u=>{(u===i||!t.has(u))&&t.set(u,h)})})}_animateOptions(e,t){const i=t.options,o=M3(e,i);if(!o)return[];const h=this._createAnimations(o,i);return i.$shared&&T3(e.options.$animations,i).then(()=>{e.options=i},()=>{}),h}_createAnimations(e,t){const i=this._properties,o=[],h=e.$animations||(e.$animations={}),u=Object.keys(t),l=Date.now();let p;for(p=u.length-1;p>=0;--p){const y=u[p];if(y.charAt(0)==="$")continue;if(y==="options"){o.push(...this._animateOptions(e,t));continue}const k=t[y];let C=h[y];const S=i.get(y);if(C)if(S&&C.active()){C.update(S,k,l);continue}else C.cancel();if(!S||!S.duration){e[y]=k;continue}h[y]=C=new w3(S,e,y,k),o.push(C)}return o}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const i=this._createAnimations(e,t);if(i.length)return fo.add(this._chart,i),!0}}function T3(n,e){const t=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const h=n[i[o]];h&&h.active()&&t.push(h.wait())}return Promise.all(t)}function M3(n,e){if(!e)return;let t=n.options;if(!t){n.options=e;return}return t.$shared&&(n.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function iy(n,e){const t=n&&n.options||{},i=t.reverse,o=t.min===void 0?e:0,h=t.max===void 0?e:0;return{start:i?h:o,end:i?o:h}}function P3(n,e,t){if(t===!1)return!1;const i=iy(n,t),o=iy(e,t);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}function I3(n){let e,t,i,o;return ri(n)?(e=n.top,t=n.right,i=n.bottom,o=n.left):e=t=i=o=n,{top:e,right:t,bottom:i,left:o,disabled:n===!1}}function j1(n,e){const t=[],i=n._getSortedDatasetMetas(e);let o,h;for(o=0,h=i.length;o<h;++o)t.push(i[o].index);return t}function ny(n,e,t,i={}){const o=n.keys,h=i.mode==="single";let u,l,p,y;if(e!==null){for(u=0,l=o.length;u<l;++u){if(p=+o[u],p===t){if(i.all)continue;break}y=n.values[p],Cn(y)&&(h||e===0||jr(e)===jr(y))&&(e+=y)}return e}}function A3(n){const e=Object.keys(n),t=new Array(e.length);let i,o,h;for(i=0,o=e.length;i<o;++i)h=e[i],t[i]={x:h,y:n[h]};return t}function sy(n,e){const t=n&&n.options.stacked;return t||t===void 0&&e.stack!==void 0}function E3(n,e,t){return`${n.id}.${e.id}.${t.stack||t.type}`}function z3(n){const{min:e,max:t,minDefined:i,maxDefined:o}=n.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:o?t:Number.POSITIVE_INFINITY}}function D3(n,e,t){const i=n[e]||(n[e]={});return i[t]||(i[t]={})}function ry(n,e,t,i){for(const o of e.getMatchingVisibleMetas(i).reverse()){const h=n[o.index];if(t&&h>0||!t&&h<0)return o.index}return null}function oy(n,e){const{chart:t,_cachedMeta:i}=n,o=t._stacks||(t._stacks={}),{iScale:h,vScale:u,index:l}=i,p=h.axis,y=u.axis,k=E3(h,u,i),C=e.length;let S;for(let z=0;z<C;++z){const R=e[z],{[p]:j,[y]:H}=R,X=R._stacks||(R._stacks={});S=X[y]=D3(o,k,j),S[l]=H,S._top=ry(S,u,!0,i.type),S._bottom=ry(S,u,!1,i.type)}}function ap(n,e){const t=n.scales;return Object.keys(t).filter(i=>t[i].axis===e).shift()}function L3(n,e){return ia(n,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function R3(n,e,t){return ia(n,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function Yc(n,e){const t=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){e=e||n._parsed;for(const o of e){const h=o._stacks;if(!h||h[i]===void 0||h[i][t]===void 0)return;delete h[i][t]}}}const lp=n=>n==="reset"||n==="none",ay=(n,e)=>e?n:Object.assign({},n),F3=(n,e,t)=>n&&!e.hidden&&e._stacked&&{keys:j1(t,!0),values:null};class Ir{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=sy(e.vScale,e),this.addElements()}updateIndex(e){this.index!==e&&Yc(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,i=this.getDataset(),o=(C,S,z,R)=>C==="x"?S:C==="r"?R:z,h=t.xAxisID=$t(i.xAxisID,ap(e,"x")),u=t.yAxisID=$t(i.yAxisID,ap(e,"y")),l=t.rAxisID=$t(i.rAxisID,ap(e,"r")),p=t.indexAxis,y=t.iAxisID=o(p,h,u,l),k=t.vAxisID=o(p,u,h,l);t.xScale=this.getScaleForId(h),t.yScale=this.getScaleForId(u),t.rScale=this.getScaleForId(l),t.iScale=this.getScaleForId(y),t.vScale=this.getScaleForId(k)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&O_(this._data,this),e._stacked&&Yc(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),i=this._data;if(ri(t))this._data=A3(t);else if(i!==t){if(i){O_(i,this);const o=this._cachedMeta;Yc(o),o._parsed=[]}t&&Object.isExtensible(t)&&nS(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,i=this.getDataset();let o=!1;this._dataCheck();const h=t._stacked;t._stacked=sy(t.vScale,t),t.stack!==i.stack&&(o=!0,Yc(t),t.stack=i.stack),this._resyncElements(e),(o||h!==t._stacked)&&oy(this,t._parsed)}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:i,_data:o}=this,{iScale:h,_stacked:u}=i,l=h.axis;let p=e===0&&t===o.length?!0:i._sorted,y=e>0&&i._parsed[e-1],k,C,S;if(this._parsing===!1)i._parsed=o,i._sorted=!0,S=o;else{Vi(o[e])?S=this.parseArrayData(i,o,e,t):ri(o[e])?S=this.parseObjectData(i,o,e,t):S=this.parsePrimitiveData(i,o,e,t);const z=()=>C[l]===null||y&&C[l]<y[l];for(k=0;k<t;++k)i._parsed[k+e]=C=S[k],p&&(z()&&(p=!1),y=C);i._sorted=p}u&&oy(this,S)}parsePrimitiveData(e,t,i,o){const{iScale:h,vScale:u}=e,l=h.axis,p=u.axis,y=h.getLabels(),k=h===u,C=new Array(o);let S,z,R;for(S=0,z=o;S<z;++S)R=S+i,C[S]={[l]:k||h.parse(y[R],R),[p]:u.parse(t[R],R)};return C}parseArrayData(e,t,i,o){const{xScale:h,yScale:u}=e,l=new Array(o);let p,y,k,C;for(p=0,y=o;p<y;++p)k=p+i,C=t[k],l[p]={x:h.parse(C[0],k),y:u.parse(C[1],k)};return l}parseObjectData(e,t,i,o){const{xScale:h,yScale:u}=e,{xAxisKey:l="x",yAxisKey:p="y"}=this._parsing,y=new Array(o);let k,C,S,z;for(k=0,C=o;k<C;++k)S=k+i,z=t[S],y[k]={x:h.parse(ea(z,l),S),y:u.parse(ea(z,p),S)};return y}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,i){const o=this.chart,h=this._cachedMeta,u=t[e.axis],l={keys:j1(o,!0),values:t._stacks[e.axis]};return ny(l,u,h.index,{mode:i})}updateRangeFromParsed(e,t,i,o){const h=i[t.axis];let u=h===null?NaN:h;const l=o&&i._stacks[t.axis];o&&l&&(o.values=l,u=ny(o,h,this._cachedMeta.index)),e.min=Math.min(e.min,u),e.max=Math.max(e.max,u)}getMinMax(e,t){const i=this._cachedMeta,o=i._parsed,h=i._sorted&&e===i.iScale,u=o.length,l=this._getOtherScale(e),p=F3(t,i,this.chart),y={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:k,max:C}=z3(l);let S,z;function R(){z=o[S];const j=z[l.axis];return!Cn(z[e.axis])||k>j||C<j}for(S=0;S<u&&!(!R()&&(this.updateRangeFromParsed(y,e,z,p),h));++S);if(h){for(S=u-1;S>=0;--S)if(!R()){this.updateRangeFromParsed(y,e,z,p);break}}return y}getAllParsedValues(e){const t=this._cachedMeta._parsed,i=[];let o,h,u;for(o=0,h=t.length;o<h;++o)u=t[o][e.axis],Cn(u)&&i.push(u);return i}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,i=t.iScale,o=t.vScale,h=this.getParsed(e);return{label:i?""+i.getLabelForValue(h[i.axis]):"",value:o?""+o.getLabelForValue(h[o.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=I3($t(this.options.clip,P3(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,i=this._cachedMeta,o=i.data||[],h=t.chartArea,u=[],l=this._drawStart||0,p=this._drawCount||o.length-l,y=this.options.drawActiveElementsOnTop;let k;for(i.dataset&&i.dataset.draw(e,h,l,p),k=l;k<l+p;++k){const C=o[k];C.hidden||(C.active&&y?u.push(C):C.draw(e,h))}for(k=0;k<u.length;++k)u[k].draw(e,h)}getStyle(e,t){const i=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,t,i){const o=this.getDataset();let h;if(e>=0&&e<this._cachedMeta.data.length){const u=this._cachedMeta.data[e];h=u.$context||(u.$context=R3(this.getContext(),e,u)),h.parsed=this.getParsed(e),h.raw=o.data[e],h.index=h.dataIndex=e}else h=this.$context||(this.$context=L3(this.chart.getContext(),this.index)),h.dataset=o,h.index=h.datasetIndex=this.index;return h.active=!!t,h.mode=i,h}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",i){const o=t==="active",h=this._cachedDataOpts,u=e+"-"+t,l=h[u],p=this.enableOptionSharing&&yr(i);if(l)return ay(l,p);const y=this.chart.config,k=y.datasetElementScopeKeys(this._type,e),C=o?[`${e}Hover`,"hover",e,""]:[e,""],S=y.getOptionScopes(this.getDataset(),k),z=Object.keys(li.elements[e]),R=()=>this.getContext(i,o),j=y.resolveNamedOptions(S,z,R,C);return j.$shared&&(j.$shared=p,h[u]=Object.freeze(ay(j,p))),j}_resolveAnimations(e,t,i){const o=this.chart,h=this._cachedDataOpts,u=`animation-${t}`,l=h[u];if(l)return l;let p;if(o.options.animation!==!1){const k=this.chart.config,C=k.datasetAnimationScopeKeys(this._type,t),S=k.getOptionScopes(this.getDataset(),C);p=k.createResolver(S,this.getContext(e,i,t))}const y=new U1(o,p&&p.animations);return p&&p._cacheable&&(h[u]=Object.freeze(y)),y}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||lp(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const i=this.resolveDataElementOptions(e,t),o=this._sharedOptions,h=this.getSharedOptions(i),u=this.includeOptions(t,h)||h!==o;return this.updateSharedOptions(h,t,i),{sharedOptions:h,includeOptions:u}}updateElement(e,t,i,o){lp(o)?Object.assign(e,i):this._resolveAnimations(t,o).update(e,i)}updateSharedOptions(e,t,i){e&&!lp(t)&&this._resolveAnimations(void 0,t).update(e,i)}_setStyle(e,t,i,o){e.active=o;const h=this.getStyle(t,o);this._resolveAnimations(t,i,o).update(e,{options:!o&&this.getSharedOptions(h)||h})}removeHoverStyle(e,t,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,t,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,i=this._cachedMeta.data;for(const[l,p,y]of this._syncList)this[l](p,y);this._syncList=[];const o=i.length,h=t.length,u=Math.min(h,o);u&&this.parse(0,u),h>o?this._insertElements(o,h-o,e):h<o&&this._removeElements(h,o-h)}_insertElements(e,t,i=!0){const o=this._cachedMeta,h=o.data,u=e+t;let l;const p=y=>{for(y.length+=t,l=y.length-1;l>=u;l--)y[l]=y[l-t]};for(p(h),l=e;l<u;++l)h[l]=new this.dataElementType;this._parsing&&p(o._parsed),this.parse(e,t),i&&this.updateElements(h,e,t,"reset")}updateElements(e,t,i,o){}_removeElements(e,t){const i=this._cachedMeta;if(this._parsing){const o=i._parsed.splice(e,t);i._stacked&&Yc(i,o)}i.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,i,o]=e;this[t](i,o)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Ir.defaults={};Ir.prototype.datasetElementType=null;Ir.prototype.dataElementType=null;function B3(n,e){if(!n._cache.$bar){const t=n.getMatchingVisibleMetas(e);let i=[];for(let o=0,h=t.length;o<h;o++)i=i.concat(t[o].controller.getAllParsedValues(n));n._cache.$bar=_1(i.sort((o,h)=>o-h))}return n._cache.$bar}function O3(n){const e=n.iScale,t=B3(e,n.type);let i=e._length,o,h,u,l;const p=()=>{u===32767||u===-32768||(yr(l)&&(i=Math.min(i,Math.abs(u-l)||i)),l=u)};for(o=0,h=t.length;o<h;++o)u=e.getPixelForValue(t[o]),p();for(l=void 0,o=0,h=e.ticks.length;o<h;++o)u=e.getPixelForTick(o),p();return i}function V3(n,e,t,i){const o=t.barThickness;let h,u;return ui(o)?(h=e.min*t.categoryPercentage,u=t.barPercentage):(h=o*i,u=1),{chunk:h/i,ratio:u,start:e.pixels[n]-h/2}}function N3(n,e,t,i){const o=e.pixels,h=o[n];let u=n>0?o[n-1]:null,l=n<o.length-1?o[n+1]:null;const p=t.categoryPercentage;u===null&&(u=h-(l===null?e.end-e.start:l-h)),l===null&&(l=h+h-u);const y=h-(h-Math.min(u,l))/2*p;return{chunk:Math.abs(l-u)/2*p/i,ratio:t.barPercentage,start:y}}function U3(n,e,t,i){const o=t.parse(n[0],i),h=t.parse(n[1],i),u=Math.min(o,h),l=Math.max(o,h);let p=u,y=l;Math.abs(u)>Math.abs(l)&&(p=l,y=u),e[t.axis]=y,e._custom={barStart:p,barEnd:y,start:o,end:h,min:u,max:l}}function q1(n,e,t,i){return Vi(n)?U3(n,e,t,i):e[t.axis]=t.parse(n,i),e}function ly(n,e,t,i){const o=n.iScale,h=n.vScale,u=o.getLabels(),l=o===h,p=[];let y,k,C,S;for(y=t,k=t+i;y<k;++y)S=e[y],C={},C[o.axis]=l||o.parse(u[y],y),p.push(q1(S,C,h,y));return p}function cp(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function j3(n,e,t){return n!==0?jr(n):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function q3(n){let e,t,i,o,h;return n.horizontal?(e=n.base>n.x,t="left",i="right"):(e=n.base<n.y,t="bottom",i="top"),e?(o="end",h="start"):(o="start",h="end"),{start:t,end:i,reverse:e,top:o,bottom:h}}function H3(n,e,t,i){let o=e.borderSkipped;const h={};if(!o){n.borderSkipped=h;return}if(o===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:u,end:l,reverse:p,top:y,bottom:k}=q3(n);o==="middle"&&t&&(n.enableBorderRadius=!0,(t._top||0)===i?o=y:(t._bottom||0)===i?o=k:(h[cy(k,u,l,p)]=!0,o=y)),h[cy(o,u,l,p)]=!0,n.borderSkipped=h}function cy(n,e,t,i){return i?(n=W3(n,e,t),n=hy(n,t,e)):n=hy(n,e,t),n}function W3(n,e,t){return n===e?t:n===t?e:n}function hy(n,e,t){return n==="start"?e:n==="end"?t:n}function Z3(n,{inflateAmount:e},t){n.inflateAmount=e==="auto"?t===1?.33:0:e}class Fd extends Ir{parsePrimitiveData(e,t,i,o){return ly(e,t,i,o)}parseArrayData(e,t,i,o){return ly(e,t,i,o)}parseObjectData(e,t,i,o){const{iScale:h,vScale:u}=e,{xAxisKey:l="x",yAxisKey:p="y"}=this._parsing,y=h.axis==="x"?l:p,k=u.axis==="x"?l:p,C=[];let S,z,R,j;for(S=i,z=i+o;S<z;++S)j=t[S],R={},R[h.axis]=h.parse(ea(j,y),S),C.push(q1(ea(j,k),R,u,S));return C}updateRangeFromParsed(e,t,i,o){super.updateRangeFromParsed(e,t,i,o);const h=i._custom;h&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,h.min),e.max=Math.max(e.max,h.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:i,vScale:o}=t,h=this.getParsed(e),u=h._custom,l=cp(u)?"["+u.start+", "+u.end+"]":""+o.getLabelForValue(h[o.axis]);return{label:""+i.getLabelForValue(h[i.axis]),value:l}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,i,o){const h=o==="reset",{index:u,_cachedMeta:{vScale:l}}=this,p=l.getBasePixel(),y=l.isHorizontal(),k=this._getRuler(),{sharedOptions:C,includeOptions:S}=this._getSharedOptions(t,o);for(let z=t;z<t+i;z++){const R=this.getParsed(z),j=h||ui(R[l.axis])?{base:p,head:p}:this._calculateBarValuePixels(z),H=this._calculateBarIndexPixels(z,k),X=(R._stacks||{})[l.axis],re={horizontal:y,base:j.base,enableBorderRadius:!X||cp(R._custom)||u===X._top||u===X._bottom,x:y?j.head:H.center,y:y?H.center:j.head,height:y?H.size:Math.abs(j.size),width:y?Math.abs(j.size):H.size};S&&(re.options=C||this.resolveDataElementOptions(z,e[z].active?"active":o));const W=re.options||e[z].options;H3(re,W,X,u),Z3(re,W,k.ratio),this.updateElement(e[z],z,re,o)}}_getStacks(e,t){const{iScale:i}=this._cachedMeta,o=i.getMatchingVisibleMetas(this._type).filter(p=>p.controller.options.grouped),h=i.options.stacked,u=[],l=p=>{const y=p.controller.getParsed(t),k=y&&y[p.vScale.axis];if(ui(k)||isNaN(k))return!0};for(const p of o)if(!(t!==void 0&&l(p))&&((h===!1||u.indexOf(p.stack)===-1||h===void 0&&p.stack===void 0)&&u.push(p.stack),p.index===e))break;return u.length||u.push(void 0),u}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,t,i){const o=this._getStacks(e,i),h=t!==void 0?o.indexOf(t):-1;return h===-1?o.length-1:h}_getRuler(){const e=this.options,t=this._cachedMeta,i=t.iScale,o=[];let h,u;for(h=0,u=t.data.length;h<u;++h)o.push(i.getPixelForValue(this.getParsed(h)[i.axis],h));const l=e.barThickness;return{min:l||O3(t),pixels:o,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:e.grouped,ratio:l?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:i},options:{base:o,minBarLength:h}}=this,u=o||0,l=this.getParsed(e),p=l._custom,y=cp(p);let k=l[t.axis],C=0,S=i?this.applyStack(t,l,i):k,z,R;S!==k&&(C=S-k,S=k),y&&(k=p.barStart,S=p.barEnd-p.barStart,k!==0&&jr(k)!==jr(p.barEnd)&&(C=0),C+=k);const j=!ui(o)&&!y?o:C;let H=t.getPixelForValue(j);if(this.chart.getDataVisibility(e)?z=t.getPixelForValue(C+S):z=H,R=z-H,Math.abs(R)<h){R=j3(R,t,u)*h,k===u&&(H-=R/2);const X=t.getPixelForDecimal(0),re=t.getPixelForDecimal(1),W=Math.min(X,re),ae=Math.max(X,re);H=Math.max(Math.min(H,ae),W),z=H+R}if(H===t.getPixelForValue(u)){const X=jr(R)*t.getLineWidthForValue(u)/2;H+=X,R-=X}return{size:R,base:H,head:z,center:z+R/2}}_calculateBarIndexPixels(e,t){const i=t.scale,o=this.options,h=o.skipNull,u=$t(o.maxBarThickness,1/0);let l,p;if(t.grouped){const y=h?this._getStackCount(e):t.stackCount,k=o.barThickness==="flex"?N3(e,t,o,y):V3(e,t,o,y),C=this._getStackIndex(this.index,this._cachedMeta.stack,h?e:void 0);l=k.start+k.chunk*C+k.chunk/2,p=Math.min(u,k.chunk*k.ratio)}else l=i.getPixelForValue(this.getParsed(e)[i.axis],e),p=Math.min(u,t.min*t.ratio);return{base:l-p/2,head:l+p/2,center:l,size:p}}draw(){const e=this._cachedMeta,t=e.vScale,i=e.data,o=i.length;let h=0;for(;h<o;++h)this.getParsed(h)[t.axis]!==null&&i[h].draw(this._ctx)}}Fd.id="bar";Fd.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};Fd.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class Bd extends Ir{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,i,o){const h=super.parsePrimitiveData(e,t,i,o);for(let u=0;u<h.length;u++)h[u]._custom=this.resolveDataElementOptions(u+i).radius;return h}parseArrayData(e,t,i,o){const h=super.parseArrayData(e,t,i,o);for(let u=0;u<h.length;u++){const l=t[i+u];h[u]._custom=$t(l[2],this.resolveDataElementOptions(u+i).radius)}return h}parseObjectData(e,t,i,o){const h=super.parseObjectData(e,t,i,o);for(let u=0;u<h.length;u++){const l=t[i+u];h[u]._custom=$t(l&&l.r&&+l.r,this.resolveDataElementOptions(u+i).radius)}return h}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,{xScale:i,yScale:o}=t,h=this.getParsed(e),u=i.getLabelForValue(h.x),l=o.getLabelForValue(h.y),p=h._custom;return{label:t.label,value:"("+u+", "+l+(p?", "+p:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,i,o){const h=o==="reset",{iScale:u,vScale:l}=this._cachedMeta,{sharedOptions:p,includeOptions:y}=this._getSharedOptions(t,o),k=u.axis,C=l.axis;for(let S=t;S<t+i;S++){const z=e[S],R=!h&&this.getParsed(S),j={},H=j[k]=h?u.getPixelForDecimal(.5):u.getPixelForValue(R[k]),X=j[C]=h?l.getBasePixel():l.getPixelForValue(R[C]);j.skip=isNaN(H)||isNaN(X),y&&(j.options=p||this.resolveDataElementOptions(S,z.active?"active":o),h&&(j.options.radius=0)),this.updateElement(z,S,j,o)}}resolveDataElementOptions(e,t){const i=this.getParsed(e);let o=super.resolveDataElementOptions(e,t);o.$shared&&(o=Object.assign({},o,{$shared:!1}));const h=o.radius;return t!=="active"&&(o.radius=0),o.radius+=$t(i&&i._custom,h),o}}Bd.id="bubble";Bd.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};Bd.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title(){return""}}}}};function $3(n,e,t){let i=1,o=1,h=0,u=0;if(e<Ei){const l=n,p=l+e,y=Math.cos(l),k=Math.sin(l),C=Math.cos(p),S=Math.sin(p),z=(W,ae,de)=>yh(W,l,p,!0)?1:Math.max(ae,ae*t,de,de*t),R=(W,ae,de)=>yh(W,l,p,!0)?-1:Math.min(ae,ae*t,de,de*t),j=z(0,y,C),H=z(gn,k,S),X=R(nn,y,C),re=R(nn+gn,k,S);i=(j-X)/2,o=(H-re)/2,h=-(j+X)/2,u=-(H+re)/2}return{ratioX:i,ratioY:o,offsetX:h,offsetY:u}}class Nl extends Ir{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const i=this.getDataset().data,o=this._cachedMeta;if(this._parsing===!1)o._parsed=i;else{let h=p=>+i[p];if(ri(i[e])){const{key:p="value"}=this._parsing;h=y=>+ea(i[y],p)}let u,l;for(u=e,l=e+t;u<l;++u)o._parsed[u]=h(u)}}_getRotation(){return Pr(this.options.rotation-90)}_getCircumference(){return Pr(this.options.circumference)}_getRotationExtents(){let e=Ei,t=-Ei;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)){const o=this.chart.getDatasetMeta(i).controller,h=o._getRotation(),u=o._getCircumference();e=Math.min(e,h),t=Math.max(t,h+u)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:i}=t,o=this._cachedMeta,h=o.data,u=this.getMaxBorderWidth()+this.getMaxOffset(h)+this.options.spacing,l=Math.max((Math.min(i.width,i.height)-u)/2,0),p=Math.min(qk(this.options.cutout,l),1),y=this._getRingWeight(this.index),{circumference:k,rotation:C}=this._getRotationExtents(),{ratioX:S,ratioY:z,offsetX:R,offsetY:j}=$3(C,k,p),H=(i.width-u)/S,X=(i.height-u)/z,re=Math.max(Math.min(H,X)/2,0),W=d1(this.options.radius,re),ae=Math.max(W*p,0),de=(W-ae)/this._getVisibleDatasetWeightTotal();this.offsetX=R*W,this.offsetY=j*W,o.total=this.calculateTotal(),this.outerRadius=W-de*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-de*y,0),this.updateElements(h,0,h.length,e)}_circumference(e,t){const i=this.options,o=this._cachedMeta,h=this._getCircumference();return t&&i.animation.animateRotate||!this.chart.getDataVisibility(e)||o._parsed[e]===null||o.data[e].hidden?0:this.calculateCircumference(o._parsed[e]*h/Ei)}updateElements(e,t,i,o){const h=o==="reset",u=this.chart,l=u.chartArea,y=u.options.animation,k=(l.left+l.right)/2,C=(l.top+l.bottom)/2,S=h&&y.animateScale,z=S?0:this.innerRadius,R=S?0:this.outerRadius,{sharedOptions:j,includeOptions:H}=this._getSharedOptions(t,o);let X=this._getRotation(),re;for(re=0;re<t;++re)X+=this._circumference(re,h);for(re=t;re<t+i;++re){const W=this._circumference(re,h),ae=e[re],de={x:k+this.offsetX,y:C+this.offsetY,startAngle:X,endAngle:X+W,circumference:W,outerRadius:R,innerRadius:z};H&&(de.options=j||this.resolveDataElementOptions(re,ae.active?"active":o)),X+=W,this.updateElement(ae,re,de,o)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let i=0,o;for(o=0;o<t.length;o++){const h=e._parsed[o];h!==null&&!isNaN(h)&&this.chart.getDataVisibility(o)&&!t[o].hidden&&(i+=Math.abs(h))}return i}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?Ei*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,o=i.data.labels||[],h=Th(t._parsed[e],i.options.locale);return{label:o[e]||"",value:h}}getMaxBorderWidth(e){let t=0;const i=this.chart;let o,h,u,l,p;if(!e){for(o=0,h=i.data.datasets.length;o<h;++o)if(i.isDatasetVisible(o)){u=i.getDatasetMeta(o),e=u.data,l=u.controller;break}}if(!e)return 0;for(o=0,h=e.length;o<h;++o)p=l.resolveDataElementOptions(o),p.borderAlign!=="inner"&&(t=Math.max(t,p.borderWidth||0,p.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let i=0,o=e.length;i<o;++i){const h=this.resolveDataElementOptions(i);t=Math.max(t,h.offset||0,h.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let i=0;i<e;++i)this.chart.isDatasetVisible(i)&&(t+=this._getRingWeight(i));return t}_getRingWeight(e){return Math.max($t(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Nl.id="doughnut";Nl.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};Nl.descriptors={_scriptable:n=>n!=="spacing",_indexable:n=>n!=="spacing"};Nl.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const e=n.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:t}}=n.legend.options;return e.labels.map((i,o)=>{const u=n.getDatasetMeta(0).controller.getStyle(o);return{text:i,fillStyle:u.backgroundColor,strokeStyle:u.borderColor,lineWidth:u.borderWidth,pointStyle:t,hidden:!n.getDataVisibility(o),index:o}})}return[]}},onClick(n,e,t){t.chart.toggleDataVisibility(e.index),t.chart.update()}},tooltip:{callbacks:{title(){return""},label(n){let e=n.label;const t=": "+n.formattedValue;return Vi(e)?(e=e.slice(),e[0]+=t):e+=t,e}}}}};class Od extends Ir{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:i,data:o=[],_dataset:h}=t,u=this.chart._animationsDisabled;let{start:l,count:p}=x1(t,o,u);this._drawStart=l,this._drawCount=p,v1(t)&&(l=0,p=o.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!h._decimated,i.points=o;const y=this.resolveDatasetElementOptions(e);this.options.showLine||(y.borderWidth=0),y.segment=this.options.segment,this.updateElement(i,void 0,{animated:!u,options:y},e),this.updateElements(o,l,p,e)}updateElements(e,t,i,o){const h=o==="reset",{iScale:u,vScale:l,_stacked:p,_dataset:y}=this._cachedMeta,{sharedOptions:k,includeOptions:C}=this._getSharedOptions(t,o),S=u.axis,z=l.axis,{spanGaps:R,segment:j}=this.options,H=Bl(R)?R:Number.POSITIVE_INFINITY,X=this.chart._animationsDisabled||h||o==="none";let re=t>0&&this.getParsed(t-1);for(let W=t;W<t+i;++W){const ae=e[W],de=this.getParsed(W),Ae=X?ae:{},xe=ui(de[z]),pe=Ae[S]=u.getPixelForValue(de[S],W),ke=Ae[z]=h||xe?l.getBasePixel():l.getPixelForValue(p?this.applyStack(l,de,p):de[z],W);Ae.skip=isNaN(pe)||isNaN(ke)||xe,Ae.stop=W>0&&Math.abs(de[S]-re[S])>H,j&&(Ae.parsed=de,Ae.raw=y.data[W]),C&&(Ae.options=k||this.resolveDataElementOptions(W,ae.active?"active":o)),X||this.updateElement(ae,W,Ae,o),re=de}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,i=t.options&&t.options.borderWidth||0,o=e.data||[];if(!o.length)return i;const h=o[0].size(this.resolveDataElementOptions(0)),u=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(i,h,u)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}Od.id="line";Od.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};Od.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class Vd extends Ir{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,i=this.chart,o=i.data.labels||[],h=Th(t._parsed[e].r,i.options.locale);return{label:o[e]||"",value:h}}parseObjectData(e,t,i,o){return D1.bind(this)(e,t,i,o)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((i,o)=>{const h=this.getParsed(o).r;!isNaN(h)&&this.chart.getDataVisibility(o)&&(h<t.min&&(t.min=h),h>t.max&&(t.max=h))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,i=e.options,o=Math.min(t.right-t.left,t.bottom-t.top),h=Math.max(o/2,0),u=Math.max(i.cutoutPercentage?h/100*i.cutoutPercentage:1,0),l=(h-u)/e.getVisibleDatasetCount();this.outerRadius=h-l*this.index,this.innerRadius=this.outerRadius-l}updateElements(e,t,i,o){const h=o==="reset",u=this.chart,p=u.options.animation,y=this._cachedMeta.rScale,k=y.xCenter,C=y.yCenter,S=y.getIndexAngle(0)-.5*nn;let z=S,R;const j=360/this.countVisibleElements();for(R=0;R<t;++R)z+=this._computeAngle(R,o,j);for(R=t;R<t+i;R++){const H=e[R];let X=z,re=z+this._computeAngle(R,o,j),W=u.getDataVisibility(R)?y.getDistanceFromCenterForValue(this.getParsed(R).r):0;z=re,h&&(p.animateScale&&(W=0),p.animateRotate&&(X=re=S));const ae={x:k,y:C,innerRadius:0,outerRadius:W,startAngle:X,endAngle:re,options:this.resolveDataElementOptions(R,H.active?"active":o)};this.updateElement(H,R,ae,o)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((i,o)=>{!isNaN(this.getParsed(o).r)&&this.chart.getDataVisibility(o)&&t++}),t}_computeAngle(e,t,i){return this.chart.getDataVisibility(e)?Pr(this.resolveDataElementOptions(e,t).angle||i):0}}Vd.id="polarArea";Vd.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};Vd.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const e=n.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:t}}=n.legend.options;return e.labels.map((i,o)=>{const u=n.getDatasetMeta(0).controller.getStyle(o);return{text:i,fillStyle:u.backgroundColor,strokeStyle:u.borderColor,lineWidth:u.borderWidth,pointStyle:t,hidden:!n.getDataVisibility(o),index:o}})}return[]}},onClick(n,e,t){t.chart.toggleDataVisibility(e.index),t.chart.update()}},tooltip:{callbacks:{title(){return""},label(n){return n.chart.data.labels[n.dataIndex]+": "+n.formattedValue}}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class cm extends Nl{}cm.id="pie";cm.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class Nd extends Ir{getLabelAndValue(e){const t=this._cachedMeta.vScale,i=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(i[t.axis])}}parseObjectData(e,t,i,o){return D1.bind(this)(e,t,i,o)}update(e){const t=this._cachedMeta,i=t.dataset,o=t.data||[],h=t.iScale.getLabels();if(i.points=o,e!=="resize"){const u=this.resolveDatasetElementOptions(e);this.options.showLine||(u.borderWidth=0);const l={_loop:!0,_fullLoop:h.length===o.length,options:u};this.updateElement(i,void 0,l,e)}this.updateElements(o,0,o.length,e)}updateElements(e,t,i,o){const h=this._cachedMeta.rScale,u=o==="reset";for(let l=t;l<t+i;l++){const p=e[l],y=this.resolveDataElementOptions(l,p.active?"active":o),k=h.getPointPositionForValue(l,this.getParsed(l).r),C=u?h.xCenter:k.x,S=u?h.yCenter:k.y,z={x:C,y:S,angle:k.angle,skip:isNaN(C)||isNaN(S),options:y};this.updateElement(p,l,z,o)}}}Nd.id="radar";Nd.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};Nd.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};let Ar=class{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}hasValue(){return Bl(this.x)&&Bl(this.y)}getProps(e,t){const i=this.$animations;if(!t||!i)return this;const o={};return e.forEach(h=>{o[h]=i[h]&&i[h].active()?i[h]._to:this[h]}),o}};Ar.defaults={};Ar.defaultRoutes=void 0;const H1={values(n){return Vi(n)?n:""+n},numeric(n,e,t){if(n===0)return"0";const i=this.chart.options.locale;let o,h=n;if(t.length>1){const y=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(y<1e-4||y>1e15)&&(o="scientific"),h=G3(n,t)}const u=_r(Math.abs(h)),l=Math.max(Math.min(-1*Math.floor(u),20),0),p={notation:o,minimumFractionDigits:l,maximumFractionDigits:l};return Object.assign(p,this.options.ticks.format),Th(n,i,p)},logarithmic(n,e,t){if(n===0)return"0";const i=n/Math.pow(10,Math.floor(_r(n)));return i===1||i===2||i===5?H1.numeric.call(this,n,e,t):""}};function G3(n,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&n!==Math.floor(n)&&(t=n-Math.floor(n)),t}var Ud={formatters:H1};li.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(n,e)=>e.lineWidth,tickColor:(n,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ud.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}});li.route("scale.ticks","color","","color");li.route("scale.grid","color","","borderColor");li.route("scale.grid","borderColor","","borderColor");li.route("scale.title","color","","color");li.describe("scale",{_fallback:!1,_scriptable:n=>!n.startsWith("before")&&!n.startsWith("after")&&n!=="callback"&&n!=="parser",_indexable:n=>n!=="borderDash"&&n!=="tickBorderDash"});li.describe("scales",{_fallback:"scale"});li.describe("scale.ticks",{_scriptable:n=>n!=="backdropPadding"&&n!=="callback",_indexable:n=>n!=="backdropPadding"});function X3(n,e){const t=n.options.ticks,i=t.maxTicksLimit||K3(n),o=t.major.enabled?J3(e):[],h=o.length,u=o[0],l=o[h-1],p=[];if(h>i)return Q3(e,p,o,h/i),p;const y=Y3(o,e,i);if(h>0){let k,C;const S=h>1?Math.round((l-u)/(h-1)):null;for(Zu(e,p,y,ui(S)?0:u-S,u),k=0,C=h-1;k<C;k++)Zu(e,p,y,o[k],o[k+1]);return Zu(e,p,y,l,ui(S)?e.length:l+S),p}return Zu(e,p,y),p}function K3(n){const e=n.options.offset,t=n._tickSize(),i=n._length/t+(e?0:1),o=n._maxLength/t;return Math.floor(Math.min(i,o))}function Y3(n,e,t){const i=e5(n),o=e.length/t;if(!i)return Math.max(o,1);const h=Yk(i);for(let u=0,l=h.length-1;u<l;u++){const p=h[u];if(p>o)return p}return Math.max(o,1)}function J3(n){const e=[];let t,i;for(t=0,i=n.length;t<i;t++)n[t].major&&e.push(t);return e}function Q3(n,e,t,i){let o=0,h=t[0],u;for(i=Math.ceil(i),u=0;u<n.length;u++)u===h&&(e.push(n[u]),o++,h=t[o*i])}function Zu(n,e,t,i,o){const h=$t(i,0),u=Math.min($t(o,n.length),n.length);let l=0,p,y,k;for(t=Math.ceil(t),o&&(p=o-i,t=p/Math.floor(p/t)),k=h;k<0;)l++,k=Math.round(h+l*t);for(y=Math.max(h,0);y<u;y++)y===k&&(e.push(n[y]),l++,k=Math.round(h+l*t))}function e5(n){const e=n.length;let t,i;if(e<2)return!1;for(i=n[0],t=1;t<e;++t)if(n[t]-n[t-1]!==i)return!1;return i}const t5=n=>n==="left"?"right":n==="right"?"left":n,uy=(n,e,t)=>e==="top"||e==="left"?n[e]+t:n[e]-t;function dy(n,e){const t=[],i=n.length/e,o=n.length;let h=0;for(;h<o;h+=i)t.push(n[Math.floor(h)]);return t}function i5(n,e,t){const i=n.ticks.length,o=Math.min(e,i-1),h=n._startPixel,u=n._endPixel,l=1e-6;let p=n.getPixelForTick(o),y;if(!(t&&(i===1?y=Math.max(p-h,u-p):e===0?y=(n.getPixelForTick(1)-p)/2:y=(p-n.getPixelForTick(o-1))/2,p+=o<e?y:-y,p<h-l||p>u+l)))return p}function n5(n,e){ki(n,t=>{const i=t.gc,o=i.length/2;let h;if(o>e){for(h=0;h<o;++h)delete t.data[i[h]];i.splice(0,o)}})}function Jc(n){return n.drawTicks?n.tickLength:0}function fy(n,e){if(!n.display)return 0;const t=Rn(n.font,e),i=ys(n.padding);return(Vi(n.text)?n.text.length:1)*t.lineHeight+i.height}function s5(n,e){return ia(n,{scale:e,type:"scale"})}function r5(n,e,t){return ia(n,{tick:t,index:e,type:"tick"})}function o5(n,e,t){let i=em(n);return(t&&e!=="right"||!t&&e==="right")&&(i=t5(i)),i}function a5(n,e,t,i){const{top:o,left:h,bottom:u,right:l,chart:p}=n,{chartArea:y,scales:k}=p;let C=0,S,z,R;const j=u-o,H=l-h;if(n.isHorizontal()){if(z=fs(i,h,l),ri(t)){const X=Object.keys(t)[0],re=t[X];R=k[X].getPixelForValue(re)+j-e}else t==="center"?R=(y.bottom+y.top)/2+j-e:R=uy(n,t,e);S=l-h}else{if(ri(t)){const X=Object.keys(t)[0],re=t[X];z=k[X].getPixelForValue(re)-H+e}else t==="center"?z=(y.left+y.right)/2-H+e:z=uy(n,t,e);R=fs(i,u,o),C=t==="left"?-gn:gn}return{titleX:z,titleY:R,maxWidth:S,rotation:C}}class Na extends Ar{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:i,_suggestedMax:o}=this;return e=gr(e,Number.POSITIVE_INFINITY),t=gr(t,Number.NEGATIVE_INFINITY),i=gr(i,Number.POSITIVE_INFINITY),o=gr(o,Number.NEGATIVE_INFINITY),{min:gr(e,i),max:gr(t,o),minDefined:Cn(e),maxDefined:Cn(t)}}getMinMax(e){let{min:t,max:i,minDefined:o,maxDefined:h}=this.getUserBounds(),u;if(o&&h)return{min:t,max:i};const l=this.getMatchingVisibleMetas();for(let p=0,y=l.length;p<y;++p)u=l[p].controller.getMinMax(this,e),o||(t=Math.min(t,u.min)),h||(i=Math.max(i,u.max));return t=h&&t>i?i:t,i=o&&t>i?t:i,{min:gr(t,gr(i,t)),max:gr(i,gr(t,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Oi(this.options.beforeUpdate,[this])}update(e,t,i){const{beginAtZero:o,grace:h,ticks:u}=this.options,l=u.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=VS(this,h,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const p=l<this.ticks.length;this._convertTicksToLabels(p?dy(this.ticks,l):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),u.display&&(u.autoSkip||u.source==="auto")&&(this.ticks=X3(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),p&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,i;this.isHorizontal()?(t=this.left,i=this.right):(t=this.top,i=this.bottom,e=!e),this._startPixel=t,this._endPixel=i,this._reversePixels=e,this._length=i-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Oi(this.options.afterUpdate,[this])}beforeSetDimensions(){Oi(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Oi(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Oi(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Oi(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let i,o,h;for(i=0,o=e.length;i<o;i++)h=e[i],h.label=Oi(t.callback,[h.value,i,e],this)}afterTickToLabelConversion(){Oi(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Oi(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,i=this.ticks.length,o=t.minRotation||0,h=t.maxRotation;let u=o,l,p,y;if(!this._isVisible()||!t.display||o>=h||i<=1||!this.isHorizontal()){this.labelRotation=o;return}const k=this._getLabelSizes(),C=k.widest.width,S=k.highest.height,z=Un(this.chart.width-C,0,this.maxWidth);l=e.offset?this.maxWidth/i:z/(i-1),C+6>l&&(l=z/(i-(e.offset?.5:1)),p=this.maxHeight-Jc(e.grid)-t.padding-fy(e.title,this.chart.options.font),y=Math.sqrt(C*C+S*S),u=Jp(Math.min(Math.asin(Un((k.highest.height+6)/l,-1,1)),Math.asin(Un(p/y,-1,1))-Math.asin(Un(S/y,-1,1)))),u=Math.max(o,Math.min(h,u))),this.labelRotation=u}afterCalculateLabelRotation(){Oi(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Oi(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:i,title:o,grid:h}}=this,u=this._isVisible(),l=this.isHorizontal();if(u){const p=fy(o,t.options.font);if(l?(e.width=this.maxWidth,e.height=Jc(h)+p):(e.height=this.maxHeight,e.width=Jc(h)+p),i.display&&this.ticks.length){const{first:y,last:k,widest:C,highest:S}=this._getLabelSizes(),z=i.padding*2,R=Pr(this.labelRotation),j=Math.cos(R),H=Math.sin(R);if(l){const X=i.mirror?0:H*C.width+j*S.height;e.height=Math.min(this.maxHeight,e.height+X+z)}else{const X=i.mirror?0:j*C.width+H*S.height;e.width=Math.min(this.maxWidth,e.width+X+z)}this._calculatePadding(y,k,H,j)}}this._handleMargins(),l?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,i,o){const{ticks:{align:h,padding:u},position:l}=this.options,p=this.labelRotation!==0,y=l!=="top"&&this.axis==="x";if(this.isHorizontal()){const k=this.getPixelForTick(0)-this.left,C=this.right-this.getPixelForTick(this.ticks.length-1);let S=0,z=0;p?y?(S=o*e.width,z=i*t.height):(S=i*e.height,z=o*t.width):h==="start"?z=t.width:h==="end"?S=e.width:h!=="inner"&&(S=e.width/2,z=t.width/2),this.paddingLeft=Math.max((S-k+u)*this.width/(this.width-k),0),this.paddingRight=Math.max((z-C+u)*this.width/(this.width-C),0)}else{let k=t.height/2,C=e.height/2;h==="start"?(k=0,C=e.height):h==="end"&&(k=t.height,C=0),this.paddingTop=k+u,this.paddingBottom=C+u}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Oi(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,i;for(t=0,i=e.length;t<i;t++)ui(e[t].label)&&(e.splice(t,1),i--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let i=this.ticks;t<i.length&&(i=dy(i,t)),this._labelSizes=e=this._computeLabelSizes(i,i.length)}return e}_computeLabelSizes(e,t){const{ctx:i,_longestTextCache:o}=this,h=[],u=[];let l=0,p=0,y,k,C,S,z,R,j,H,X,re,W;for(y=0;y<t;++y){if(S=e[y].label,z=this._resolveTickFontOptions(y),i.font=R=z.string,j=o[R]=o[R]||{data:{},gc:[]},H=z.lineHeight,X=re=0,!ui(S)&&!Vi(S))X=dd(i,j.data,j.gc,X,S),re=H;else if(Vi(S))for(k=0,C=S.length;k<C;++k)W=S[k],!ui(W)&&!Vi(W)&&(X=dd(i,j.data,j.gc,X,W),re+=H);h.push(X),u.push(re),l=Math.max(X,l),p=Math.max(re,p)}n5(o,t);const ae=h.indexOf(l),de=u.indexOf(p),Ae=xe=>({width:h[xe]||0,height:u[xe]||0});return{first:Ae(0),last:Ae(t-1),widest:Ae(ae),highest:Ae(de),widths:h,heights:u}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return eS(this._alignToPixels?Pa(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const i=t[e];return i.$context||(i.$context=r5(this.getContext(),e,i))}return this.$context||(this.$context=s5(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Pr(this.labelRotation),i=Math.abs(Math.cos(t)),o=Math.abs(Math.sin(t)),h=this._getLabelSizes(),u=e.autoSkipPadding||0,l=h?h.widest.width+u:0,p=h?h.highest.height+u:0;return this.isHorizontal()?p*i>l*o?l/i:p/o:p*o<l*i?p/i:l/o}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,i=this.chart,o=this.options,{grid:h,position:u}=o,l=h.offset,p=this.isHorizontal(),k=this.ticks.length+(l?1:0),C=Jc(h),S=[],z=h.setContext(this.getContext()),R=z.drawBorder?z.borderWidth:0,j=R/2,H=function(mt){return Pa(i,mt,R)};let X,re,W,ae,de,Ae,xe,pe,ke,Ie,Ve,We;if(u==="top")X=H(this.bottom),Ae=this.bottom-C,pe=X-j,Ie=H(e.top)+j,We=e.bottom;else if(u==="bottom")X=H(this.top),Ie=e.top,We=H(e.bottom)-j,Ae=X+j,pe=this.top+C;else if(u==="left")X=H(this.right),de=this.right-C,xe=X-j,ke=H(e.left)+j,Ve=e.right;else if(u==="right")X=H(this.left),ke=e.left,Ve=H(e.right)-j,de=X+j,xe=this.left+C;else if(t==="x"){if(u==="center")X=H((e.top+e.bottom)/2+.5);else if(ri(u)){const mt=Object.keys(u)[0],Ft=u[mt];X=H(this.chart.scales[mt].getPixelForValue(Ft))}Ie=e.top,We=e.bottom,Ae=X+j,pe=Ae+C}else if(t==="y"){if(u==="center")X=H((e.left+e.right)/2);else if(ri(u)){const mt=Object.keys(u)[0],Ft=u[mt];X=H(this.chart.scales[mt].getPixelForValue(Ft))}de=X-j,xe=de-C,ke=e.left,Ve=e.right}const Oe=$t(o.ticks.maxTicksLimit,k),It=Math.max(1,Math.ceil(k/Oe));for(re=0;re<k;re+=It){const mt=h.setContext(this.getContext(re)),Ft=mt.lineWidth,Yt=mt.color,Qt=mt.borderDash||[],Tn=mt.borderDashOffset,ji=mt.tickWidth,di=mt.tickColor,ii=mt.tickBorderDash||[],Ci=mt.tickBorderDashOffset;W=i5(this,re,l),W!==void 0&&(ae=Pa(i,W,Ft),p?de=xe=ke=Ve=ae:Ae=pe=Ie=We=ae,S.push({tx1:de,ty1:Ae,tx2:xe,ty2:pe,x1:ke,y1:Ie,x2:Ve,y2:We,width:Ft,color:Yt,borderDash:Qt,borderDashOffset:Tn,tickWidth:ji,tickColor:di,tickBorderDash:ii,tickBorderDashOffset:Ci}))}return this._ticksLength=k,this._borderValue=X,S}_computeLabelItems(e){const t=this.axis,i=this.options,{position:o,ticks:h}=i,u=this.isHorizontal(),l=this.ticks,{align:p,crossAlign:y,padding:k,mirror:C}=h,S=Jc(i.grid),z=S+k,R=C?-k:z,j=-Pr(this.labelRotation),H=[];let X,re,W,ae,de,Ae,xe,pe,ke,Ie,Ve,We,Oe="middle";if(o==="top")Ae=this.bottom-R,xe=this._getXAxisLabelAlignment();else if(o==="bottom")Ae=this.top+R,xe=this._getXAxisLabelAlignment();else if(o==="left"){const mt=this._getYAxisLabelAlignment(S);xe=mt.textAlign,de=mt.x}else if(o==="right"){const mt=this._getYAxisLabelAlignment(S);xe=mt.textAlign,de=mt.x}else if(t==="x"){if(o==="center")Ae=(e.top+e.bottom)/2+z;else if(ri(o)){const mt=Object.keys(o)[0],Ft=o[mt];Ae=this.chart.scales[mt].getPixelForValue(Ft)+z}xe=this._getXAxisLabelAlignment()}else if(t==="y"){if(o==="center")de=(e.left+e.right)/2-z;else if(ri(o)){const mt=Object.keys(o)[0],Ft=o[mt];de=this.chart.scales[mt].getPixelForValue(Ft)}xe=this._getYAxisLabelAlignment(S).textAlign}t==="y"&&(p==="start"?Oe="top":p==="end"&&(Oe="bottom"));const It=this._getLabelSizes();for(X=0,re=l.length;X<re;++X){W=l[X],ae=W.label;const mt=h.setContext(this.getContext(X));pe=this.getPixelForTick(X)+h.labelOffset,ke=this._resolveTickFontOptions(X),Ie=ke.lineHeight,Ve=Vi(ae)?ae.length:1;const Ft=Ve/2,Yt=mt.color,Qt=mt.textStrokeColor,Tn=mt.textStrokeWidth;let ji=xe;u?(de=pe,xe==="inner"&&(X===re-1?ji=this.options.reverse?"left":"right":X===0?ji=this.options.reverse?"right":"left":ji="center"),o==="top"?y==="near"||j!==0?We=-Ve*Ie+Ie/2:y==="center"?We=-It.highest.height/2-Ft*Ie+Ie:We=-It.highest.height+Ie/2:y==="near"||j!==0?We=Ie/2:y==="center"?We=It.highest.height/2-Ft*Ie:We=It.highest.height-Ve*Ie,C&&(We*=-1)):(Ae=pe,We=(1-Ve)*Ie/2);let di;if(mt.showLabelBackdrop){const ii=ys(mt.backdropPadding),Ci=It.heights[X],Ti=It.widths[X];let Gi=Ae+We-ii.top,qi=de-ii.left;switch(Oe){case"middle":Gi-=Ci/2;break;case"bottom":Gi-=Ci;break}switch(xe){case"center":qi-=Ti/2;break;case"right":qi-=Ti;break}di={left:qi,top:Gi,width:Ti+ii.width,height:Ci+ii.height,color:mt.backdropColor}}H.push({rotation:j,label:ae,font:ke,color:Yt,strokeColor:Qt,strokeWidth:Tn,textOffset:We,textAlign:ji,textBaseline:Oe,translation:[de,Ae],backdrop:di})}return H}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Pr(this.labelRotation))return e==="top"?"left":"right";let o="center";return t.align==="start"?o="left":t.align==="end"?o="right":t.align==="inner"&&(o="inner"),o}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:i,mirror:o,padding:h}}=this.options,u=this._getLabelSizes(),l=e+h,p=u.widest.width;let y,k;return t==="left"?o?(k=this.right+h,i==="near"?y="left":i==="center"?(y="center",k+=p/2):(y="right",k+=p)):(k=this.right-l,i==="near"?y="right":i==="center"?(y="center",k-=p/2):(y="left",k=this.left)):t==="right"?o?(k=this.left+h,i==="near"?y="right":i==="center"?(y="center",k-=p/2):(y="left",k-=p)):(k=this.left+l,i==="near"?y="left":i==="center"?(y="center",k+=p/2):(y="right",k=this.right)):y="right",{textAlign:y,x:k}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:i,top:o,width:h,height:u}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(i,o,h,u),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const o=this.ticks.findIndex(h=>h.value===e);return o>=0?t.setContext(this.getContext(o)).lineWidth:0}drawGrid(e){const t=this.options.grid,i=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let h,u;const l=(p,y,k)=>{!k.width||!k.color||(i.save(),i.lineWidth=k.width,i.strokeStyle=k.color,i.setLineDash(k.borderDash||[]),i.lineDashOffset=k.borderDashOffset,i.beginPath(),i.moveTo(p.x,p.y),i.lineTo(y.x,y.y),i.stroke(),i.restore())};if(t.display)for(h=0,u=o.length;h<u;++h){const p=o[h];t.drawOnChartArea&&l({x:p.x1,y:p.y1},{x:p.x2,y:p.y2},p),t.drawTicks&&l({x:p.tx1,y:p.ty1},{x:p.tx2,y:p.ty2},{color:p.tickColor,width:p.tickWidth,borderDash:p.tickBorderDash,borderDashOffset:p.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{grid:i}}=this,o=i.setContext(this.getContext()),h=i.drawBorder?o.borderWidth:0;if(!h)return;const u=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let p,y,k,C;this.isHorizontal()?(p=Pa(e,this.left,h)-h/2,y=Pa(e,this.right,u)+u/2,k=C=l):(k=Pa(e,this.top,h)-h/2,C=Pa(e,this.bottom,u)+u/2,p=y=l),t.save(),t.lineWidth=o.borderWidth,t.strokeStyle=o.borderColor,t.beginPath(),t.moveTo(p,k),t.lineTo(y,C),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const i=this.ctx,o=this._computeLabelArea();o&&Dd(i,o);const h=this._labelItems||(this._labelItems=this._computeLabelItems(e));let u,l;for(u=0,l=h.length;u<l;++u){const p=h[u],y=p.font,k=p.label;p.backdrop&&(i.fillStyle=p.backdrop.color,i.fillRect(p.backdrop.left,p.backdrop.top,p.backdrop.width,p.backdrop.height));let C=p.textOffset;Oa(i,k,0,C,y,p)}o&&Ld(i)}drawTitle(){const{ctx:e,options:{position:t,title:i,reverse:o}}=this;if(!i.display)return;const h=Rn(i.font),u=ys(i.padding),l=i.align;let p=h.lineHeight/2;t==="bottom"||t==="center"||ri(t)?(p+=u.bottom,Vi(i.text)&&(p+=h.lineHeight*(i.text.length-1))):p+=u.top;const{titleX:y,titleY:k,maxWidth:C,rotation:S}=a5(this,p,t,l);Oa(e,i.text,0,0,h,{color:i.color,maxWidth:C,rotation:S,textAlign:o5(l,t,o),textBaseline:"middle",translation:[y,k]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,i=$t(e.grid&&e.grid.z,-1);return!this._isVisible()||this.draw!==Na.prototype.draw?[{z:t,draw:o=>{this.draw(o)}}]:[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:t,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",o=[];let h,u;for(h=0,u=t.length;h<u;++h){const l=t[h];l[i]===this.id&&(!e||l.type===e)&&o.push(l)}return o}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return Rn(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class $u{constructor(e,t,i){this.type=e,this.scope=t,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let i;h5(t)&&(i=this.register(t));const o=this.items,h=e.id,u=this.scope+"."+h;if(!h)throw new Error("class does not have id: "+e);return h in o||(o[h]=e,l5(e,u,i),this.override&&li.override(e.id,e.overrides)),u}get(e){return this.items[e]}unregister(e){const t=this.items,i=e.id,o=this.scope;i in t&&delete t[i],o&&i in li[o]&&(delete li[o][i],this.override&&delete Ba[i])}}function l5(n,e,t){const i=_h(Object.create(null),[t?li.get(t):{},li.get(e),n.defaults]);li.set(e,i),n.defaultRoutes&&c5(e,n.defaultRoutes),n.descriptors&&li.describe(e,n.descriptors)}function c5(n,e){Object.keys(e).forEach(t=>{const i=t.split("."),o=i.pop(),h=[n].concat(i).join("."),u=e[t].split("."),l=u.pop(),p=u.join(".");li.route(h,o,p,l)})}function h5(n){return"id"in n&&"defaults"in n}class u5{constructor(){this.controllers=new $u(Ir,"datasets",!0),this.elements=new $u(Ar,"elements"),this.plugins=new $u(Object,"plugins"),this.scales=new $u(Na,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,i){[...t].forEach(o=>{const h=i||this._getRegistryForType(o);i||h.isForType(o)||h===this.plugins&&o.id?this._exec(e,h,o):ki(o,u=>{const l=i||this._getRegistryForType(u);this._exec(e,l,u)})})}_exec(e,t,i){const o=Yp(e);Oi(i["before"+o],[],i),t[e](i),Oi(i["after"+o],[],i)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const i=this._typedRegistries[t];if(i.isForType(e))return i}return this.plugins}_get(e,t,i){const o=t.get(e);if(o===void 0)throw new Error('"'+e+'" is not a registered '+i+".");return o}}var Vr=new u5;class jd extends Ir{update(e){const t=this._cachedMeta,{data:i=[]}=t,o=this.chart._animationsDisabled;let{start:h,count:u}=x1(t,i,o);if(this._drawStart=h,this._drawCount=u,v1(t)&&(h=0,u=i.length),this.options.showLine){const{dataset:l,_dataset:p}=t;l._chart=this.chart,l._datasetIndex=this.index,l._decimated=!!p._decimated,l.points=i;const y=this.resolveDatasetElementOptions(e);y.segment=this.options.segment,this.updateElement(l,void 0,{animated:!o,options:y},e)}this.updateElements(i,h,u,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=Vr.getElement("line")),super.addElements()}updateElements(e,t,i,o){const h=o==="reset",{iScale:u,vScale:l,_stacked:p,_dataset:y}=this._cachedMeta,k=this.resolveDataElementOptions(t,o),C=this.getSharedOptions(k),S=this.includeOptions(o,C),z=u.axis,R=l.axis,{spanGaps:j,segment:H}=this.options,X=Bl(j)?j:Number.POSITIVE_INFINITY,re=this.chart._animationsDisabled||h||o==="none";let W=t>0&&this.getParsed(t-1);for(let ae=t;ae<t+i;++ae){const de=e[ae],Ae=this.getParsed(ae),xe=re?de:{},pe=ui(Ae[R]),ke=xe[z]=u.getPixelForValue(Ae[z],ae),Ie=xe[R]=h||pe?l.getBasePixel():l.getPixelForValue(p?this.applyStack(l,Ae,p):Ae[R],ae);xe.skip=isNaN(ke)||isNaN(Ie)||pe,xe.stop=ae>0&&Math.abs(Ae[z]-W[z])>X,H&&(xe.parsed=Ae,xe.raw=y.data[ae]),S&&(xe.options=C||this.resolveDataElementOptions(ae,de.active?"active":o)),re||this.updateElement(de,ae,xe,o),W=Ae}this.updateSharedOptions(C,o,k)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let l=0;for(let p=t.length-1;p>=0;--p)l=Math.max(l,t[p].size(this.resolveDataElementOptions(p))/2);return l>0&&l}const i=e.dataset,o=i.options&&i.options.borderWidth||0;if(!t.length)return o;const h=t[0].size(this.resolveDataElementOptions(0)),u=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(o,h,u)/2}}jd.id="scatter";jd.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};jd.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title(){return""},label(n){return"("+n.label+", "+n.formattedValue+")"}}}},scales:{x:{type:"linear"},y:{type:"linear"}}};var d5=Object.freeze({__proto__:null,BarController:Fd,BubbleController:Bd,DoughnutController:Nl,LineController:Od,PolarAreaController:Vd,PieController:cm,RadarController:Nd,ScatterController:jd});function Ia(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class zp{constructor(e){this.options=e||{}}init(e){}formats(){return Ia()}parse(e,t){return Ia()}format(e,t){return Ia()}add(e,t,i){return Ia()}diff(e,t,i){return Ia()}startOf(e,t,i){return Ia()}endOf(e,t){return Ia()}}zp.override=function(n){Object.assign(zp.prototype,n)};var f5={_date:zp};function p5(n,e,t,i){const{controller:o,data:h,_sorted:u}=n,l=o._cachedMeta.iScale;if(l&&e===l.axis&&e!=="r"&&u&&h.length){const p=l._reversePixels?tS:yo;if(i){if(o._sharedOptions){const y=h[0],k=typeof y.getRange=="function"&&y.getRange(e);if(k){const C=p(h,e,t-k),S=p(h,e,t+k);return{lo:C.lo,hi:S.hi}}}}else return p(h,e,t)}return{lo:0,hi:h.length-1}}function Mh(n,e,t,i,o){const h=n.getSortedVisibleDatasetMetas(),u=t[e];for(let l=0,p=h.length;l<p;++l){const{index:y,data:k}=h[l],{lo:C,hi:S}=p5(h[l],e,u,o);for(let z=C;z<=S;++z){const R=k[z];R.skip||i(R,y,z)}}}function m5(n){const e=n.indexOf("x")!==-1,t=n.indexOf("y")!==-1;return function(i,o){const h=e?Math.abs(i.x-o.x):0,u=t?Math.abs(i.y-o.y):0;return Math.sqrt(Math.pow(h,2)+Math.pow(u,2))}}function hp(n,e,t,i,o){const h=[];return!o&&!n.isPointInArea(e)||Mh(n,t,e,function(l,p,y){!o&&!bh(l,n.chartArea,0)||l.inRange(e.x,e.y,i)&&h.push({element:l,datasetIndex:p,index:y})},!0),h}function g5(n,e,t,i){let o=[];function h(u,l,p){const{startAngle:y,endAngle:k}=u.getProps(["startAngle","endAngle"],i),{angle:C}=m1(u,{x:e.x,y:e.y});yh(C,y,k)&&o.push({element:u,datasetIndex:l,index:p})}return Mh(n,t,e,h),o}function _5(n,e,t,i,o,h){let u=[];const l=m5(t);let p=Number.POSITIVE_INFINITY;function y(k,C,S){const z=k.inRange(e.x,e.y,o);if(i&&!z)return;const R=k.getCenterPoint(o);if(!(!!h||n.isPointInArea(R))&&!z)return;const H=l(e,R);H<p?(u=[{element:k,datasetIndex:C,index:S}],p=H):H===p&&u.push({element:k,datasetIndex:C,index:S})}return Mh(n,t,e,y),u}function up(n,e,t,i,o,h){return!h&&!n.isPointInArea(e)?[]:t==="r"&&!i?g5(n,e,t,o):_5(n,e,t,i,o,h)}function py(n,e,t,i,o){const h=[],u=t==="x"?"inXRange":"inYRange";let l=!1;return Mh(n,t,e,(p,y,k)=>{p[u](e[t],o)&&(h.push({element:p,datasetIndex:y,index:k}),l=l||p.inRange(e.x,e.y,o))}),i&&!l?[]:h}var y5={evaluateInteractionItems:Mh,modes:{index(n,e,t,i){const o=Aa(e,n),h=t.axis||"x",u=t.includeInvisible||!1,l=t.intersect?hp(n,o,h,i,u):up(n,o,h,!1,i,u),p=[];return l.length?(n.getSortedVisibleDatasetMetas().forEach(y=>{const k=l[0].index,C=y.data[k];C&&!C.skip&&p.push({element:C,datasetIndex:y.index,index:k})}),p):[]},dataset(n,e,t,i){const o=Aa(e,n),h=t.axis||"xy",u=t.includeInvisible||!1;let l=t.intersect?hp(n,o,h,i,u):up(n,o,h,!1,i,u);if(l.length>0){const p=l[0].datasetIndex,y=n.getDatasetMeta(p).data;l=[];for(let k=0;k<y.length;++k)l.push({element:y[k],datasetIndex:p,index:k})}return l},point(n,e,t,i){const o=Aa(e,n),h=t.axis||"xy",u=t.includeInvisible||!1;return hp(n,o,h,i,u)},nearest(n,e,t,i){const o=Aa(e,n),h=t.axis||"xy",u=t.includeInvisible||!1;return up(n,o,h,t.intersect,i,u)},x(n,e,t,i){const o=Aa(e,n);return py(n,o,"x",t.intersect,i)},y(n,e,t,i){const o=Aa(e,n);return py(n,o,"y",t.intersect,i)}}};const W1=["left","top","right","bottom"];function Qc(n,e){return n.filter(t=>t.pos===e)}function my(n,e){return n.filter(t=>W1.indexOf(t.pos)===-1&&t.box.axis===e)}function eh(n,e){return n.sort((t,i)=>{const o=e?i:t,h=e?t:i;return o.weight===h.weight?o.index-h.index:o.weight-h.weight})}function b5(n){const e=[];let t,i,o,h,u,l;for(t=0,i=(n||[]).length;t<i;++t)o=n[t],{position:h,options:{stack:u,stackWeight:l=1}}=o,e.push({index:t,box:o,pos:h,horizontal:o.isHorizontal(),weight:o.weight,stack:u&&h+u,stackWeight:l});return e}function x5(n){const e={};for(const t of n){const{stack:i,pos:o,stackWeight:h}=t;if(!i||!W1.includes(o))continue;const u=e[i]||(e[i]={count:0,placed:0,weight:0,size:0});u.count++,u.weight+=h}return e}function v5(n,e){const t=x5(n),{vBoxMaxWidth:i,hBoxMaxHeight:o}=e;let h,u,l;for(h=0,u=n.length;h<u;++h){l=n[h];const{fullSize:p}=l.box,y=t[l.stack],k=y&&l.stackWeight/y.weight;l.horizontal?(l.width=k?k*i:p&&e.availableWidth,l.height=o):(l.width=i,l.height=k?k*o:p&&e.availableHeight)}return t}function w5(n){const e=b5(n),t=eh(e.filter(y=>y.box.fullSize),!0),i=eh(Qc(e,"left"),!0),o=eh(Qc(e,"right")),h=eh(Qc(e,"top"),!0),u=eh(Qc(e,"bottom")),l=my(e,"x"),p=my(e,"y");return{fullSize:t,leftAndTop:i.concat(h),rightAndBottom:o.concat(p).concat(u).concat(l),chartArea:Qc(e,"chartArea"),vertical:i.concat(o).concat(p),horizontal:h.concat(u).concat(l)}}function gy(n,e,t,i){return Math.max(n[t],e[t])+Math.max(n[i],e[i])}function Z1(n,e){n.top=Math.max(n.top,e.top),n.left=Math.max(n.left,e.left),n.bottom=Math.max(n.bottom,e.bottom),n.right=Math.max(n.right,e.right)}function k5(n,e,t,i){const{pos:o,box:h}=t,u=n.maxPadding;if(!ri(o)){t.size&&(n[o]-=t.size);const C=i[t.stack]||{size:0,count:1};C.size=Math.max(C.size,t.horizontal?h.height:h.width),t.size=C.size/C.count,n[o]+=t.size}h.getPadding&&Z1(u,h.getPadding());const l=Math.max(0,e.outerWidth-gy(u,n,"left","right")),p=Math.max(0,e.outerHeight-gy(u,n,"top","bottom")),y=l!==n.w,k=p!==n.h;return n.w=l,n.h=p,t.horizontal?{same:y,other:k}:{same:k,other:y}}function S5(n){const e=n.maxPadding;function t(i){const o=Math.max(e[i]-n[i],0);return n[i]+=o,o}n.y+=t("top"),n.x+=t("left"),t("right"),t("bottom")}function C5(n,e){const t=e.maxPadding;function i(o){const h={left:0,top:0,right:0,bottom:0};return o.forEach(u=>{h[u]=Math.max(e[u],t[u])}),h}return i(n?["left","right"]:["top","bottom"])}function rh(n,e,t,i){const o=[];let h,u,l,p,y,k;for(h=0,u=n.length,y=0;h<u;++h){l=n[h],p=l.box,p.update(l.width||e.w,l.height||e.h,C5(l.horizontal,e));const{same:C,other:S}=k5(e,t,l,i);y|=C&&o.length,k=k||S,p.fullSize||o.push(l)}return y&&rh(o,e,t,i)||k}function Gu(n,e,t,i,o){n.top=t,n.left=e,n.right=e+i,n.bottom=t+o,n.width=i,n.height=o}function _y(n,e,t,i){const o=t.padding;let{x:h,y:u}=e;for(const l of n){const p=l.box,y=i[l.stack]||{count:1,placed:0,weight:1},k=l.stackWeight/y.weight||1;if(l.horizontal){const C=e.w*k,S=y.size||p.height;yr(y.start)&&(u=y.start),p.fullSize?Gu(p,o.left,u,t.outerWidth-o.right-o.left,S):Gu(p,e.left+y.placed,u,C,S),y.start=u,y.placed+=C,u=p.bottom}else{const C=e.h*k,S=y.size||p.width;yr(y.start)&&(h=y.start),p.fullSize?Gu(p,h,o.top,S,t.outerHeight-o.bottom-o.top):Gu(p,h,e.top+y.placed,S,C),y.start=h,y.placed+=C,h=p.right}}e.x=h,e.y=u}li.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var ms={addBox(n,e){n.boxes||(n.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},n.boxes.push(e)},removeBox(n,e){const t=n.boxes?n.boxes.indexOf(e):-1;t!==-1&&n.boxes.splice(t,1)},configure(n,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(n,e,t,i){if(!n)return;const o=ys(n.options.layout.padding),h=Math.max(e-o.width,0),u=Math.max(t-o.height,0),l=w5(n.boxes),p=l.vertical,y=l.horizontal;ki(n.boxes,j=>{typeof j.beforeLayout=="function"&&j.beforeLayout()});const k=p.reduce((j,H)=>H.box.options&&H.box.options.display===!1?j:j+1,0)||1,C=Object.freeze({outerWidth:e,outerHeight:t,padding:o,availableWidth:h,availableHeight:u,vBoxMaxWidth:h/2/k,hBoxMaxHeight:u/2}),S=Object.assign({},o);Z1(S,ys(i));const z=Object.assign({maxPadding:S,w:h,h:u,x:o.left,y:o.top},o),R=v5(p.concat(y),C);rh(l.fullSize,z,C,R),rh(p,z,C,R),rh(y,z,C,R)&&rh(p,z,C,R),S5(z),_y(l.leftAndTop,z,C,R),z.x+=z.w,z.y+=z.h,_y(l.rightAndBottom,z,C,R),n.chartArea={left:z.left,top:z.top,right:z.left+z.w,bottom:z.top+z.h,height:z.h,width:z.w},ki(l.chartArea,j=>{const H=j.box;Object.assign(H,n.chartArea),H.update(z.w,z.h,{left:0,top:0,right:0,bottom:0})})}};class $1{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,i){}removeEventListener(e,t,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,i,o){return t=Math.max(0,t||e.width),i=i||e.height,{width:t,height:Math.max(0,o?Math.floor(t/o):i)}}isAttached(e){return!0}updateConfig(e){}}class T5 extends $1{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const td="$chartjs",M5={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},yy=n=>n===null||n==="";function P5(n,e){const t=n.style,i=n.getAttribute("height"),o=n.getAttribute("width");if(n[td]={initial:{height:i,width:o,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",yy(o)){const h=K_(n,"width");h!==void 0&&(n.width=h)}if(yy(i))if(n.style.height==="")n.height=n.width/(e||2);else{const h=K_(n,"height");h!==void 0&&(n.height=h)}return n}const G1=l3?{passive:!0}:!1;function I5(n,e,t){n.addEventListener(e,t,G1)}function A5(n,e,t){n.canvas.removeEventListener(e,t,G1)}function E5(n,e){const t=M5[n.type]||n.type,{x:i,y:o}=Aa(n,e);return{type:t,chart:e,native:n,x:i!==void 0?i:null,y:o!==void 0?o:null}}function pd(n,e){for(const t of n)if(t===e||t.contains(e))return!0}function z5(n,e,t){const i=n.canvas,o=new MutationObserver(h=>{let u=!1;for(const l of h)u=u||pd(l.addedNodes,i),u=u&&!pd(l.removedNodes,i);u&&t()});return o.observe(document,{childList:!0,subtree:!0}),o}function D5(n,e,t){const i=n.canvas,o=new MutationObserver(h=>{let u=!1;for(const l of h)u=u||pd(l.removedNodes,i),u=u&&!pd(l.addedNodes,i);u&&t()});return o.observe(document,{childList:!0,subtree:!0}),o}const vh=new Map;let by=0;function X1(){const n=window.devicePixelRatio;n!==by&&(by=n,vh.forEach((e,t)=>{t.currentDevicePixelRatio!==n&&e()}))}function L5(n,e){vh.size||window.addEventListener("resize",X1),vh.set(n,e)}function R5(n){vh.delete(n),vh.size||window.removeEventListener("resize",X1)}function F5(n,e,t){const i=n.canvas,o=i&&lm(i);if(!o)return;const h=b1((l,p)=>{const y=o.clientWidth;t(l,p),y<o.clientWidth&&t()},window),u=new ResizeObserver(l=>{const p=l[0],y=p.contentRect.width,k=p.contentRect.height;y===0&&k===0||h(y,k)});return u.observe(o),L5(n,h),u}function dp(n,e,t){t&&t.disconnect(),e==="resize"&&R5(n)}function B5(n,e,t){const i=n.canvas,o=b1(h=>{n.ctx!==null&&t(E5(h,n))},n,h=>{const u=h[0];return[u,u.offsetX,u.offsetY]});return I5(i,e,o),o}class O5 extends $1{acquireContext(e,t){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(P5(e,t),i):null}releaseContext(e){const t=e.canvas;if(!t[td])return!1;const i=t[td].initial;["height","width"].forEach(h=>{const u=i[h];ui(u)?t.removeAttribute(h):t.setAttribute(h,u)});const o=i.style||{};return Object.keys(o).forEach(h=>{t.style[h]=o[h]}),t.width=t.width,delete t[td],!0}addEventListener(e,t,i){this.removeEventListener(e,t);const o=e.$proxies||(e.$proxies={}),u={attach:z5,detach:D5,resize:F5}[t]||B5;o[t]=u(e,t,i)}removeEventListener(e,t){const i=e.$proxies||(e.$proxies={}),o=i[t];if(!o)return;({attach:dp,detach:dp,resize:dp}[t]||A5)(e,t,o),i[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,i,o){return a3(e,t,i,o)}isAttached(e){const t=lm(e);return!!(t&&t.isConnected)}}function V5(n){return!R1()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?T5:O5}class N5{constructor(){this._init=[]}notify(e,t,i,o){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const h=o?this._descriptors(e).filter(o):this._descriptors(e),u=this._notify(h,e,t,i);return t==="afterDestroy"&&(this._notify(h,e,"stop"),this._notify(this._init,e,"uninstall")),u}_notify(e,t,i,o){o=o||{};for(const h of e){const u=h.plugin,l=u[i],p=[t,o,h.options];if(Oi(l,p,u)===!1&&o.cancelable)return!1}return!0}invalidate(){ui(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const i=e&&e.config,o=$t(i.options&&i.options.plugins,{}),h=U5(i);return o===!1&&!t?[]:q5(e,h,o,t)}_notifyStateChanges(e){const t=this._oldCache||[],i=this._cache,o=(h,u)=>h.filter(l=>!u.some(p=>l.plugin.id===p.plugin.id));this._notify(o(t,i),e,"stop"),this._notify(o(i,t),e,"start")}}function U5(n){const e={},t=[],i=Object.keys(Vr.plugins.items);for(let h=0;h<i.length;h++)t.push(Vr.getPlugin(i[h]));const o=n.plugins||[];for(let h=0;h<o.length;h++){const u=o[h];t.indexOf(u)===-1&&(t.push(u),e[u.id]=!0)}return{plugins:t,localIds:e}}function j5(n,e){return!e&&n===!1?null:n===!0?{}:n}function q5(n,{plugins:e,localIds:t},i,o){const h=[],u=n.getContext();for(const l of e){const p=l.id,y=j5(i[p],o);y!==null&&h.push({plugin:l,options:H5(n.config,{plugin:l,local:t[p]},y,u)})}return h}function H5(n,{plugin:e,local:t},i,o){const h=n.pluginScopeKeys(e),u=n.getOptionScopes(i,h);return t&&e.defaults&&u.push(e.defaults),n.createResolver(u,o,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Dp(n,e){const t=li.datasets[n]||{};return((e.datasets||{})[n]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function W5(n,e){let t=n;return n==="_index_"?t=e:n==="_value_"&&(t=e==="x"?"y":"x"),t}function Z5(n,e){return n===e?"_index_":"_value_"}function $5(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Lp(n,e){return n==="x"||n==="y"?n:e.axis||$5(e.position)||n.charAt(0).toLowerCase()}function G5(n,e){const t=Ba[n.type]||{scales:{}},i=e.scales||{},o=Dp(n.type,e),h=Object.create(null),u=Object.create(null);return Object.keys(i).forEach(l=>{const p=i[l];if(!ri(p))return console.error(`Invalid scale configuration for scale: ${l}`);if(p._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${l}`);const y=Lp(l,p),k=Z5(y,o),C=t.scales||{};h[y]=h[y]||l,u[l]=ah(Object.create(null),[{axis:y},p,C[y],C[k]])}),n.data.datasets.forEach(l=>{const p=l.type||n.type,y=l.indexAxis||Dp(p,e),C=(Ba[p]||{}).scales||{};Object.keys(C).forEach(S=>{const z=W5(S,y),R=l[z+"AxisID"]||h[z]||z;u[R]=u[R]||Object.create(null),ah(u[R],[{axis:z},i[R],C[S]])})}),Object.keys(u).forEach(l=>{const p=u[l];ah(p,[li.scales[p.type],li.scale])}),u}function K1(n){const e=n.options||(n.options={});e.plugins=$t(e.plugins,{}),e.scales=G5(n,e)}function Y1(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function X5(n){return n=n||{},n.data=Y1(n.data),K1(n),n}const xy=new Map,J1=new Set;function Xu(n,e){let t=xy.get(n);return t||(t=e(),xy.set(n,t),J1.add(t)),t}const th=(n,e,t)=>{const i=ea(e,t);i!==void 0&&n.add(i)};class K5{constructor(e){this._config=X5(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=Y1(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),K1(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Xu(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Xu(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Xu(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,i=this.type;return Xu(`${i}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const i=this._scopeCache;let o=i.get(e);return(!o||t)&&(o=new Map,i.set(e,o)),o}getOptionScopes(e,t,i){const{options:o,type:h}=this,u=this._cachedScopes(e,i),l=u.get(t);if(l)return l;const p=new Set;t.forEach(k=>{e&&(p.add(e),k.forEach(C=>th(p,e,C))),k.forEach(C=>th(p,o,C)),k.forEach(C=>th(p,Ba[h]||{},C)),k.forEach(C=>th(p,li,C)),k.forEach(C=>th(p,Ap,C))});const y=Array.from(p);return y.length===0&&y.push(Object.create(null)),J1.has(t)&&u.set(t,y),y}chartOptionScopes(){const{options:e,type:t}=this;return[e,Ba[t]||{},li.datasets[t]||{},{type:t},li,Ap]}resolveNamedOptions(e,t,i,o=[""]){const h={$shared:!0},{resolver:u,subPrefixes:l}=vy(this._resolverCache,e,o);let p=u;if(J5(u,t)){h.$shared=!1,i=ta(i)?i():i;const y=this.createResolver(e,i,l);p=Ol(u,i,y)}for(const y of t)h[y]=p[y];return h}createResolver(e,t,i=[""],o){const{resolver:h}=vy(this._resolverCache,e,i);return ri(t)?Ol(h,t,void 0,o):h}}function vy(n,e,t){let i=n.get(e);i||(i=new Map,n.set(e,i));const o=t.join();let h=i.get(o);return h||(h={resolver:rm(e,t),subPrefixes:t.filter(l=>!l.toLowerCase().includes("hover"))},i.set(o,h)),h}const Y5=n=>ri(n)&&Object.getOwnPropertyNames(n).reduce((e,t)=>e||ta(n[t]),!1);function J5(n,e){const{isScriptable:t,isIndexable:i}=I1(n);for(const o of e){const h=t(o),u=i(o),l=(u||h)&&n[o];if(h&&(ta(l)||Y5(l))||u&&Vi(l))return!0}return!1}var Q5="3.9.1";const eC=["top","bottom","left","right","chartArea"];function wy(n,e){return n==="top"||n==="bottom"||eC.indexOf(n)===-1&&e==="x"}function ky(n,e){return function(t,i){return t[n]===i[n]?t[e]-i[e]:t[n]-i[n]}}function Sy(n){const e=n.chart,t=e.options.animation;e.notifyPlugins("afterRender"),Oi(t&&t.onComplete,[n],e)}function tC(n){const e=n.chart,t=e.options.animation;Oi(t&&t.onProgress,[n],e)}function Q1(n){return R1()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const md={},eb=n=>{const e=Q1(n);return Object.values(md).filter(t=>t.canvas===e).pop()};function iC(n,e,t){const i=Object.keys(n);for(const o of i){const h=+o;if(h>=e){const u=n[o];delete n[o],(t>0||h>e)&&(n[h+t]=u)}}}function nC(n,e,t,i){return!t||n.type==="mouseout"?null:i?e:n}class Ll{constructor(e,t){const i=this.config=new K5(t),o=Q1(e),h=eb(o);if(h)throw new Error("Canvas is already in use. Chart with ID '"+h.id+"' must be destroyed before the canvas with ID '"+h.canvas.id+"' can be reused.");const u=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||V5(o)),this.platform.updateConfig(i);const l=this.platform.acquireContext(o,u.aspectRatio),p=l&&l.canvas,y=p&&p.height,k=p&&p.width;if(this.id=jk(),this.ctx=l,this.canvas=p,this.width=k,this.height=y,this._options=u,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new N5,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=sS(C=>this.update(C),u.resizeDelay||0),this._dataChanges=[],md[this.id]=this,!l||!p){console.error("Failed to create chart: can't acquire context from the given item");return}fo.listen(this,"complete",Sy),fo.listen(this,"progress",tC),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:i,height:o,_aspectRatio:h}=this;return ui(e)?t&&h?h:o?i/o:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():X_(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Z_(this.canvas,this.ctx),this}stop(){return fo.stop(this),this}resize(e,t){fo.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const i=this.options,o=this.canvas,h=i.maintainAspectRatio&&this.aspectRatio,u=this.platform.getMaximumSize(o,e,t,h),l=i.devicePixelRatio||this.platform.getDevicePixelRatio(),p=this.width?"resize":"attach";this.width=u.width,this.height=u.height,this._aspectRatio=this.aspectRatio,X_(this,l,!0)&&(this.notifyPlugins("resize",{size:u}),Oi(i.onResize,[this,u],this),this.attached&&this._doResize(p)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};ki(t,(i,o)=>{i.id=o})}buildOrUpdateScales(){const e=this.options,t=e.scales,i=this.scales,o=Object.keys(i).reduce((u,l)=>(u[l]=!1,u),{});let h=[];t&&(h=h.concat(Object.keys(t).map(u=>{const l=t[u],p=Lp(u,l),y=p==="r",k=p==="x";return{options:l,dposition:y?"chartArea":k?"bottom":"left",dtype:y?"radialLinear":k?"category":"linear"}}))),ki(h,u=>{const l=u.options,p=l.id,y=Lp(p,l),k=$t(l.type,u.dtype);(l.position===void 0||wy(l.position,y)!==wy(u.dposition))&&(l.position=u.dposition),o[p]=!0;let C=null;if(p in i&&i[p].type===k)C=i[p];else{const S=Vr.getScale(k);C=new S({id:p,type:k,ctx:this.ctx,chart:this}),i[C.id]=C}C.init(l,e)}),ki(o,(u,l)=>{u||delete i[l]}),ki(i,u=>{ms.configure(this,u,u.options),ms.addBox(this,u)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,i=e.length;if(e.sort((o,h)=>o.index-h.index),i>t){for(let o=t;o<i;++o)this._destroyDatasetMeta(o);e.splice(t,i-t)}this._sortedMetasets=e.slice(0).sort(ky("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((i,o)=>{t.filter(h=>h===i._dataset).length===0&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let i,o;for(this._removeUnreferencedMetasets(),i=0,o=t.length;i<o;i++){const h=t[i];let u=this.getDatasetMeta(i);const l=h.type||this.config.type;if(u.type&&u.type!==l&&(this._destroyDatasetMeta(i),u=this.getDatasetMeta(i)),u.type=l,u.indexAxis=h.indexAxis||Dp(l,this.options),u.order=h.order||0,u.index=i,u.label=""+h.label,u.visible=this.isDatasetVisible(i),u.controller)u.controller.updateIndex(i),u.controller.linkScales();else{const p=Vr.getController(l),{datasetElementType:y,dataElementType:k}=li.datasets[l];Object.assign(p.prototype,{dataElementType:Vr.getElement(k),datasetElementType:y&&Vr.getElement(y)}),u.controller=new p(this,i),e.push(u.controller)}}return this._updateMetasets(),e}_resetElements(){ki(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const i=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const h=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let u=0;for(let y=0,k=this.data.datasets.length;y<k;y++){const{controller:C}=this.getDatasetMeta(y),S=!o&&h.indexOf(C)===-1;C.buildOrUpdateElements(S),u=Math.max(+C.getMaxOverflow(),u)}u=this._minPadding=i.layout.autoPadding?u:0,this._updateLayout(u),o||ki(h,y=>{y.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(ky("z","_idx"));const{_active:l,_lastEvent:p}=this;p?this._eventHandler(p,!0):l.length&&this._updateHoverStyles(l,l,!0),this.render()}_updateScales(){ki(this.scales,e=>{ms.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),i=new Set(e.events);(!L_(t,i)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:i,start:o,count:h}of t){const u=i==="_removeElements"?-h:h;iC(e,o,u)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,i=h=>new Set(e.filter(u=>u[0]===h).map((u,l)=>l+","+u.splice(1).join(","))),o=i(0);for(let h=1;h<t;h++)if(!L_(o,i(h)))return;return Array.from(o).map(h=>h.split(",")).map(h=>({method:h[1],start:+h[2],count:+h[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ms.update(this,this.width,this.height,e);const t=this.chartArea,i=t.width<=0||t.height<=0;this._layers=[],ki(this.boxes,o=>{i&&o.position==="chartArea"||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,h)=>{o._idx=h}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,i=this.data.datasets.length;t<i;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,i=this.data.datasets.length;t<i;++t)this._updateDataset(t,ta(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const i=this.getDatasetMeta(e),o={meta:i,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",o)!==!1&&(i.controller._update(t),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(fo.has(this)?this.attached&&!fo.running(this)&&fo.start(this):(this.draw(),Sy({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:i,height:o}=this._resizeBeforeDraw;this._resize(i,o),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,i=[];let o,h;for(o=0,h=t.length;o<h;++o){const u=t[o];(!e||u.visible)&&i.push(u)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,i=e._clip,o=!i.disabled,h=this.chartArea,u={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",u)!==!1&&(o&&Dd(t,{left:i.left===!1?0:h.left-i.left,right:i.right===!1?this.width:h.right+i.right,top:i.top===!1?0:h.top-i.top,bottom:i.bottom===!1?this.height:h.bottom+i.bottom}),e.controller.draw(),o&&Ld(t),u.cancelable=!1,this.notifyPlugins("afterDatasetDraw",u))}isPointInArea(e){return bh(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,i,o){const h=y5.modes[t];return typeof h=="function"?h(this,e,i,o):[]}getDatasetMeta(e){const t=this.data.datasets[e],i=this._metasets;let o=i.filter(h=>h&&h._dataset===t).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=ia(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const i=this.getDatasetMeta(e);return typeof i.hidden=="boolean"?!i.hidden:!t.hidden}setDatasetVisibility(e,t){const i=this.getDatasetMeta(e);i.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,i){const o=i?"show":"hide",h=this.getDatasetMeta(e),u=h.controller._resolveAnimations(void 0,o);yr(t)?(h.data[t].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),u.update(h,{visible:i}),this.update(l=>l.datasetIndex===e?o:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),fo.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),Z_(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete md[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,i=(h,u)=>{t.addEventListener(this,h,u),e[h]=u},o=(h,u,l)=>{h.offsetX=u,h.offsetY=l,this._eventHandler(h)};ki(this.options.events,h=>i(h,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,i=(p,y)=>{t.addEventListener(this,p,y),e[p]=y},o=(p,y)=>{e[p]&&(t.removeEventListener(this,p,y),delete e[p])},h=(p,y)=>{this.canvas&&this.resize(p,y)};let u;const l=()=>{o("attach",l),this.attached=!0,this.resize(),i("resize",h),i("detach",u)};u=()=>{this.attached=!1,o("resize",h),this._stop(),this._resize(0,0),i("attach",l)},t.isAttached(this.canvas)?l():u()}unbindEvents(){ki(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},ki(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,i){const o=i?"set":"remove";let h,u,l,p;for(t==="dataset"&&(h=this.getDatasetMeta(e[0].datasetIndex),h.controller["_"+o+"DatasetHoverStyle"]()),l=0,p=e.length;l<p;++l){u=e[l];const y=u&&this.getDatasetMeta(u.datasetIndex).controller;y&&y[o+"HoverStyle"](u.element,u.datasetIndex,u.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],i=e.map(({datasetIndex:h,index:u})=>{const l=this.getDatasetMeta(h);if(!l)throw new Error("No dataset found at index "+h);return{datasetIndex:h,element:l.data[u],index:u}});!ld(i,t)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,t))}notifyPlugins(e,t,i){return this._plugins.notify(this,e,t,i)}_updateHoverStyles(e,t,i){const o=this.options.hover,h=(p,y)=>p.filter(k=>!y.some(C=>k.datasetIndex===C.datasetIndex&&k.index===C.index)),u=h(t,e),l=i?e:h(e,t);u.length&&this.updateHoverStyle(u,o.mode,!1),l.length&&o.mode&&this.updateHoverStyle(l,o.mode,!0)}_eventHandler(e,t){const i={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},o=u=>(u.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",i,o)===!1)return;const h=this._handleEvent(e,t,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(h||i.changed)&&this.render(),this}_handleEvent(e,t,i){const{_active:o=[],options:h}=this,u=t,l=this._getActiveElements(e,o,i,u),p=Gk(e),y=nC(e,this._lastEvent,i,p);i&&(this._lastEvent=null,Oi(h.onHover,[e,l,this],this),p&&Oi(h.onClick,[e,l,this],this));const k=!ld(l,o);return(k||t)&&(this._active=l,this._updateHoverStyles(l,o,t)),this._lastEvent=y,k}_getActiveElements(e,t,i,o){if(e.type==="mouseout")return[];if(!i)return t;const h=this.options.hover;return this.getElementsAtEventForMode(e,h.mode,h,o)}}const Cy=()=>ki(Ll.instances,n=>n._plugins.invalidate()),Go=!0;Object.defineProperties(Ll,{defaults:{enumerable:Go,value:li},instances:{enumerable:Go,value:md},overrides:{enumerable:Go,value:Ba},registry:{enumerable:Go,value:Vr},version:{enumerable:Go,value:Q5},getChart:{enumerable:Go,value:eb},register:{enumerable:Go,value:(...n)=>{Vr.add(...n),Cy()}},unregister:{enumerable:Go,value:(...n)=>{Vr.remove(...n),Cy()}}});function tb(n,e,t){const{startAngle:i,pixelMargin:o,x:h,y:u,outerRadius:l,innerRadius:p}=e;let y=o/l;n.beginPath(),n.arc(h,u,l,i-y,t+y),p>o?(y=o/p,n.arc(h,u,p,t+y,i-y,!0)):n.arc(h,u,o,t+gn,i-gn),n.closePath(),n.clip()}function sC(n){return sm(n,["outerStart","outerEnd","innerStart","innerEnd"])}function rC(n,e,t,i){const o=sC(n.options.borderRadius),h=(t-e)/2,u=Math.min(h,i*e/2),l=p=>{const y=(t-Math.min(h,p))*i/2;return Un(p,0,Math.min(h,y))};return{outerStart:l(o.outerStart),outerEnd:l(o.outerEnd),innerStart:Un(o.innerStart,0,u),innerEnd:Un(o.innerEnd,0,u)}}function Pl(n,e,t,i){return{x:t+n*Math.cos(e),y:i+n*Math.sin(e)}}function Rp(n,e,t,i,o,h){const{x:u,y:l,startAngle:p,pixelMargin:y,innerRadius:k}=e,C=Math.max(e.outerRadius+i+t-y,0),S=k>0?k+i+t+y:0;let z=0;const R=o-p;if(i){const mt=k>0?k-i:0,Ft=C>0?C-i:0,Yt=(mt+Ft)/2,Qt=Yt!==0?R*Yt/(Yt+i):R;z=(R-Qt)/2}const j=Math.max(.001,R*C-t/nn)/C,H=(R-j)/2,X=p+H+z,re=o-H-z,{outerStart:W,outerEnd:ae,innerStart:de,innerEnd:Ae}=rC(e,S,C,re-X),xe=C-W,pe=C-ae,ke=X+W/xe,Ie=re-ae/pe,Ve=S+de,We=S+Ae,Oe=X+de/Ve,It=re-Ae/We;if(n.beginPath(),h){if(n.arc(u,l,C,ke,Ie),ae>0){const Yt=Pl(pe,Ie,u,l);n.arc(Yt.x,Yt.y,ae,Ie,re+gn)}const mt=Pl(We,re,u,l);if(n.lineTo(mt.x,mt.y),Ae>0){const Yt=Pl(We,It,u,l);n.arc(Yt.x,Yt.y,Ae,re+gn,It+Math.PI)}if(n.arc(u,l,S,re-Ae/S,X+de/S,!0),de>0){const Yt=Pl(Ve,Oe,u,l);n.arc(Yt.x,Yt.y,de,Oe+Math.PI,X-gn)}const Ft=Pl(xe,X,u,l);if(n.lineTo(Ft.x,Ft.y),W>0){const Yt=Pl(xe,ke,u,l);n.arc(Yt.x,Yt.y,W,X-gn,ke)}}else{n.moveTo(u,l);const mt=Math.cos(ke)*C+u,Ft=Math.sin(ke)*C+l;n.lineTo(mt,Ft);const Yt=Math.cos(Ie)*C+u,Qt=Math.sin(Ie)*C+l;n.lineTo(Yt,Qt)}n.closePath()}function oC(n,e,t,i,o){const{fullCircles:h,startAngle:u,circumference:l}=e;let p=e.endAngle;if(h){Rp(n,e,t,i,u+Ei,o);for(let y=0;y<h;++y)n.fill();isNaN(l)||(p=u+l%Ei,l%Ei===0&&(p+=Ei))}return Rp(n,e,t,i,p,o),n.fill(),p}function aC(n,e,t){const{x:i,y:o,startAngle:h,pixelMargin:u,fullCircles:l}=e,p=Math.max(e.outerRadius-u,0),y=e.innerRadius+u;let k;for(t&&tb(n,e,h+Ei),n.beginPath(),n.arc(i,o,y,h+Ei,h,!0),k=0;k<l;++k)n.stroke();for(n.beginPath(),n.arc(i,o,p,h,h+Ei),k=0;k<l;++k)n.stroke()}function lC(n,e,t,i,o,h){const{options:u}=e,{borderWidth:l,borderJoinStyle:p}=u,y=u.borderAlign==="inner";l&&(y?(n.lineWidth=l*2,n.lineJoin=p||"round"):(n.lineWidth=l,n.lineJoin=p||"bevel"),e.fullCircles&&aC(n,e,y),y&&tb(n,e,o),Rp(n,e,t,i,o,h),n.stroke())}class qd extends Ar{constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,i){const o=this.getProps(["x","y"],i),{angle:h,distance:u}=m1(o,{x:e,y:t}),{startAngle:l,endAngle:p,innerRadius:y,outerRadius:k,circumference:C}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),S=this.options.spacing/2,R=$t(C,p-l)>=Ei||yh(h,l,p),j=_o(u,y+S,k+S);return R&&j}getCenterPoint(e){const{x:t,y:i,startAngle:o,endAngle:h,innerRadius:u,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],e),{offset:p,spacing:y}=this.options,k=(o+h)/2,C=(u+l+y+p)/2;return{x:t+Math.cos(k)*C,y:i+Math.sin(k)*C}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:i}=this,o=(t.offset||0)/2,h=(t.spacing||0)/2,u=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=i>Ei?Math.floor(i/Ei):0,i===0||this.innerRadius<0||this.outerRadius<0)return;e.save();let l=0;if(o){l=o/2;const y=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(y)*l,Math.sin(y)*l),this.circumference>=nn&&(l=o)}e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor;const p=oC(e,this,l,h,u);lC(e,this,l,h,p,u),e.restore()}}qd.id="arc";qd.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};qd.defaultRoutes={backgroundColor:"backgroundColor"};function ib(n,e,t=e){n.lineCap=$t(t.borderCapStyle,e.borderCapStyle),n.setLineDash($t(t.borderDash,e.borderDash)),n.lineDashOffset=$t(t.borderDashOffset,e.borderDashOffset),n.lineJoin=$t(t.borderJoinStyle,e.borderJoinStyle),n.lineWidth=$t(t.borderWidth,e.borderWidth),n.strokeStyle=$t(t.borderColor,e.borderColor)}function cC(n,e,t){n.lineTo(t.x,t.y)}function hC(n){return n.stepped?ES:n.tension||n.cubicInterpolationMode==="monotone"?zS:cC}function nb(n,e,t={}){const i=n.length,{start:o=0,end:h=i-1}=t,{start:u,end:l}=e,p=Math.max(o,u),y=Math.min(h,l),k=o<u&&h<u||o>l&&h>l;return{count:i,start:p,loop:e.loop,ilen:y<p&&!k?i+y-p:y-p}}function uC(n,e,t,i){const{points:o,options:h}=e,{count:u,start:l,loop:p,ilen:y}=nb(o,t,i),k=hC(h);let{move:C=!0,reverse:S}=i||{},z,R,j;for(z=0;z<=y;++z)R=o[(l+(S?y-z:z))%u],!R.skip&&(C?(n.moveTo(R.x,R.y),C=!1):k(n,j,R,S,h.stepped),j=R);return p&&(R=o[(l+(S?y:0))%u],k(n,j,R,S,h.stepped)),!!p}function dC(n,e,t,i){const o=e.points,{count:h,start:u,ilen:l}=nb(o,t,i),{move:p=!0,reverse:y}=i||{};let k=0,C=0,S,z,R,j,H,X;const re=ae=>(u+(y?l-ae:ae))%h,W=()=>{j!==H&&(n.lineTo(k,H),n.lineTo(k,j),n.lineTo(k,X))};for(p&&(z=o[re(0)],n.moveTo(z.x,z.y)),S=0;S<=l;++S){if(z=o[re(S)],z.skip)continue;const ae=z.x,de=z.y,Ae=ae|0;Ae===R?(de<j?j=de:de>H&&(H=de),k=(C*k+ae)/++C):(W(),n.lineTo(ae,de),R=Ae,C=0,j=H=de),X=de}W()}function Fp(n){const e=n.options,t=e.borderDash&&e.borderDash.length;return!n._decimated&&!n._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?dC:uC}function fC(n){return n.stepped?c3:n.tension||n.cubicInterpolationMode==="monotone"?h3:Ea}function pC(n,e,t,i){let o=e._path;o||(o=e._path=new Path2D,e.path(o,t,i)&&o.closePath()),ib(n,e.options),n.stroke(o)}function mC(n,e,t,i){const{segments:o,options:h}=e,u=Fp(e);for(const l of o)ib(n,h,l.style),n.beginPath(),u(n,e,l,{start:t,end:t+i-1})&&n.closePath(),n.stroke()}const gC=typeof Path2D=="function";function _C(n,e,t,i){gC&&!e.options.segment?pC(n,e,t,i):mC(n,e,t,i)}class na extends Ar{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const o=i.spanGaps?this._loop:this._fullLoop;t3(this._points,i,e,o,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=_3(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,i=e.length;return i&&t[e[i-1].end]}interpolate(e,t){const i=this.options,o=e[t],h=this.points,u=N1(this,{property:t,start:o,end:o});if(!u.length)return;const l=[],p=fC(i);let y,k;for(y=0,k=u.length;y<k;++y){const{start:C,end:S}=u[y],z=h[C],R=h[S];if(z===R){l.push(z);continue}const j=Math.abs((o-z[t])/(R[t]-z[t])),H=p(z,R,j,i.stepped);H[t]=e[t],l.push(H)}return l.length===1?l[0]:l}pathSegment(e,t,i){return Fp(this)(e,this,t,i)}path(e,t,i){const o=this.segments,h=Fp(this);let u=this._loop;t=t||0,i=i||this.points.length-t;for(const l of o)u&=h(e,this,l,{start:t,end:t+i-1});return!!u}draw(e,t,i,o){const h=this.options||{};(this.points||[]).length&&h.borderWidth&&(e.save(),_C(e,this,i,o),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}na.id="line";na.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};na.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};na.descriptors={_scriptable:!0,_indexable:n=>n!=="borderDash"&&n!=="fill"};function Ty(n,e,t,i){const o=n.options,{[t]:h}=n.getProps([t],i);return Math.abs(e-h)<o.radius+o.hitRadius}class Hd extends Ar{constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,i){const o=this.options,{x:h,y:u}=this.getProps(["x","y"],i);return Math.pow(e-h,2)+Math.pow(t-u,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(e,t){return Ty(this,e,"x",t)}inYRange(e,t){return Ty(this,e,"y",t)}getCenterPoint(e){const{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}size(e){e=e||this.options||{};let t=e.radius||0;t=Math.max(t,t&&e.hoverRadius||0);const i=t&&e.borderWidth||0;return(t+i)*2}draw(e,t){const i=this.options;this.skip||i.radius<.1||!bh(this,t,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,Ep(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}Hd.id="point";Hd.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};Hd.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};function sb(n,e){const{x:t,y:i,base:o,width:h,height:u}=n.getProps(["x","y","base","width","height"],e);let l,p,y,k,C;return n.horizontal?(C=u/2,l=Math.min(t,o),p=Math.max(t,o),y=i-C,k=i+C):(C=h/2,l=t-C,p=t+C,y=Math.min(i,o),k=Math.max(i,o)),{left:l,top:y,right:p,bottom:k}}function Yo(n,e,t,i){return n?0:Un(e,t,i)}function yC(n,e,t){const i=n.options.borderWidth,o=n.borderSkipped,h=P1(i);return{t:Yo(o.top,h.top,0,t),r:Yo(o.right,h.right,0,e),b:Yo(o.bottom,h.bottom,0,t),l:Yo(o.left,h.left,0,e)}}function bC(n,e,t){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),o=n.options.borderRadius,h=La(o),u=Math.min(e,t),l=n.borderSkipped,p=i||ri(o);return{topLeft:Yo(!p||l.top||l.left,h.topLeft,0,u),topRight:Yo(!p||l.top||l.right,h.topRight,0,u),bottomLeft:Yo(!p||l.bottom||l.left,h.bottomLeft,0,u),bottomRight:Yo(!p||l.bottom||l.right,h.bottomRight,0,u)}}function xC(n){const e=sb(n),t=e.right-e.left,i=e.bottom-e.top,o=yC(n,t/2,i/2),h=bC(n,t/2,i/2);return{outer:{x:e.left,y:e.top,w:t,h:i,radius:h},inner:{x:e.left+o.l,y:e.top+o.t,w:t-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,h.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,h.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,h.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,h.bottomRight-Math.max(o.b,o.r))}}}}function fp(n,e,t,i){const o=e===null,h=t===null,l=n&&!(o&&h)&&sb(n,i);return l&&(o||_o(e,l.left,l.right))&&(h||_o(t,l.top,l.bottom))}function vC(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function wC(n,e){n.rect(e.x,e.y,e.w,e.h)}function pp(n,e,t={}){const i=n.x!==t.x?-e:0,o=n.y!==t.y?-e:0,h=(n.x+n.w!==t.x+t.w?e:0)-i,u=(n.y+n.h!==t.y+t.h?e:0)-o;return{x:n.x+i,y:n.y+o,w:n.w+h,h:n.h+u,radius:n.radius}}class Wd extends Ar{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:i,backgroundColor:o}}=this,{inner:h,outer:u}=xC(this),l=vC(u.radius)?xh:wC;e.save(),(u.w!==h.w||u.h!==h.h)&&(e.beginPath(),l(e,pp(u,t,h)),e.clip(),l(e,pp(h,-t,u)),e.fillStyle=i,e.fill("evenodd")),e.beginPath(),l(e,pp(h,t)),e.fillStyle=o,e.fill(),e.restore()}inRange(e,t,i){return fp(this,e,t,i)}inXRange(e,t){return fp(this,e,null,t)}inYRange(e,t){return fp(this,null,e,t)}getCenterPoint(e){const{x:t,y:i,base:o,horizontal:h}=this.getProps(["x","y","base","horizontal"],e);return{x:h?(t+o)/2:t,y:h?i:(i+o)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}Wd.id="bar";Wd.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};Wd.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var kC=Object.freeze({__proto__:null,ArcElement:qd,LineElement:na,PointElement:Hd,BarElement:Wd});function SC(n,e,t,i,o){const h=o.samples||i;if(h>=t)return n.slice(e,e+t);const u=[],l=(t-2)/(h-2);let p=0;const y=e+t-1;let k=e,C,S,z,R,j;for(u[p++]=n[k],C=0;C<h-2;C++){let H=0,X=0,re;const W=Math.floor((C+1)*l)+1+e,ae=Math.min(Math.floor((C+2)*l)+1,t)+e,de=ae-W;for(re=W;re<ae;re++)H+=n[re].x,X+=n[re].y;H/=de,X/=de;const Ae=Math.floor(C*l)+1+e,xe=Math.min(Math.floor((C+1)*l)+1,t)+e,{x:pe,y:ke}=n[k];for(z=R=-1,re=Ae;re<xe;re++)R=.5*Math.abs((pe-H)*(n[re].y-ke)-(pe-n[re].x)*(X-ke)),R>z&&(z=R,S=n[re],j=re);u[p++]=S,k=j}return u[p++]=n[y],u}function CC(n,e,t,i){let o=0,h=0,u,l,p,y,k,C,S,z,R,j;const H=[],X=e+t-1,re=n[e].x,ae=n[X].x-re;for(u=e;u<e+t;++u){l=n[u],p=(l.x-re)/ae*i,y=l.y;const de=p|0;if(de===k)y<R?(R=y,C=u):y>j&&(j=y,S=u),o=(h*o+l.x)/++h;else{const Ae=u-1;if(!ui(C)&&!ui(S)){const xe=Math.min(C,S),pe=Math.max(C,S);xe!==z&&xe!==Ae&&H.push({...n[xe],x:o}),pe!==z&&pe!==Ae&&H.push({...n[pe],x:o})}u>0&&Ae!==z&&H.push(n[Ae]),H.push(l),k=de,h=0,R=j=y,C=S=z=u}}return H}function rb(n){if(n._decimated){const e=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{value:e})}}function My(n){n.data.datasets.forEach(e=>{rb(e)})}function TC(n,e){const t=e.length;let i=0,o;const{iScale:h}=n,{min:u,max:l,minDefined:p,maxDefined:y}=h.getUserBounds();return p&&(i=Un(yo(e,h.axis,u).lo,0,t-1)),y?o=Un(yo(e,h.axis,l).hi+1,i,t)-i:o=t-i,{start:i,count:o}}var MC={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,e,t)=>{if(!t.enabled){My(n);return}const i=n.width;n.data.datasets.forEach((o,h)=>{const{_data:u,indexAxis:l}=o,p=n.getDatasetMeta(h),y=u||o.data;if(sh([l,n.options.indexAxis])==="y"||!p.controller.supportsDecimation)return;const k=n.scales[p.xAxisID];if(k.type!=="linear"&&k.type!=="time"||n.options.parsing)return;let{start:C,count:S}=TC(p,y);const z=t.threshold||4*i;if(S<=z){rb(o);return}ui(u)&&(o._data=y,delete o.data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(j){this._data=j}}));let R;switch(t.algorithm){case"lttb":R=SC(y,C,S,i,t);break;case"min-max":R=CC(y,C,S,i);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}o._decimated=R})},destroy(n){My(n)}};function PC(n,e,t){const i=n.segments,o=n.points,h=e.points,u=[];for(const l of i){let{start:p,end:y}=l;y=hm(p,y,o);const k=Bp(t,o[p],o[y],l.loop);if(!e.segments){u.push({source:l,target:k,start:o[p],end:o[y]});continue}const C=N1(e,k);for(const S of C){const z=Bp(t,h[S.start],h[S.end],S.loop),R=V1(l,o,z);for(const j of R)u.push({source:j,target:S,start:{[t]:Py(k,z,"start",Math.max)},end:{[t]:Py(k,z,"end",Math.min)}})}}return u}function Bp(n,e,t,i){if(i)return;let o=e[n],h=t[n];return n==="angle"&&(o=ir(o),h=ir(h)),{property:n,start:o,end:h}}function IC(n,e){const{x:t=null,y:i=null}=n||{},o=e.points,h=[];return e.segments.forEach(({start:u,end:l})=>{l=hm(u,l,o);const p=o[u],y=o[l];i!==null?(h.push({x:p.x,y:i}),h.push({x:y.x,y:i})):t!==null&&(h.push({x:t,y:p.y}),h.push({x:t,y:y.y}))}),h}function hm(n,e,t){for(;e>n;e--){const i=t[e];if(!isNaN(i.x)&&!isNaN(i.y))break}return e}function Py(n,e,t,i){return n&&e?i(n[t],e[t]):n?n[t]:e?e[t]:0}function ob(n,e){let t=[],i=!1;return Vi(n)?(i=!0,t=n):t=IC(n,e),t.length?new na({points:t,options:{tension:0},_loop:i,_fullLoop:i}):null}function Iy(n){return n&&n.fill!==!1}function AC(n,e,t){let o=n[e].fill;const h=[e];let u;if(!t)return o;for(;o!==!1&&h.indexOf(o)===-1;){if(!Cn(o))return o;if(u=n[o],!u)return!1;if(u.visible)return o;h.push(o),o=u.fill}return!1}function EC(n,e,t){const i=RC(n);if(ri(i))return isNaN(i.value)?!1:i;let o=parseFloat(i);return Cn(o)&&Math.floor(o)===o?zC(i[0],e,o,t):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function zC(n,e,t,i){return(n==="-"||n==="+")&&(t=e+t),t===e||t<0||t>=i?!1:t}function DC(n,e){let t=null;return n==="start"?t=e.bottom:n==="end"?t=e.top:ri(n)?t=e.getPixelForValue(n.value):e.getBasePixel&&(t=e.getBasePixel()),t}function LC(n,e,t){let i;return n==="start"?i=t:n==="end"?i=e.options.reverse?e.min:e.max:ri(n)?i=n.value:i=e.getBaseValue(),i}function RC(n){const e=n.options,t=e.fill;let i=$t(t&&t.target,t);return i===void 0&&(i=!!e.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function FC(n){const{scale:e,index:t,line:i}=n,o=[],h=i.segments,u=i.points,l=BC(e,t);l.push(ob({x:null,y:e.bottom},i));for(let p=0;p<h.length;p++){const y=h[p];for(let k=y.start;k<=y.end;k++)OC(o,u[k],l)}return new na({points:o,options:{}})}function BC(n,e){const t=[],i=n.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const h=i[o];if(h.index===e)break;h.hidden||t.unshift(h.dataset)}return t}function OC(n,e,t){const i=[];for(let o=0;o<t.length;o++){const h=t[o],{first:u,last:l,point:p}=VC(h,e,"x");if(!(!p||u&&l)){if(u)i.unshift(p);else if(n.push(p),!l)break}}n.push(...i)}function VC(n,e,t){const i=n.interpolate(e,t);if(!i)return{};const o=i[t],h=n.segments,u=n.points;let l=!1,p=!1;for(let y=0;y<h.length;y++){const k=h[y],C=u[k.start][t],S=u[k.end][t];if(_o(o,C,S)){l=o===C,p=o===S;break}}return{first:l,last:p,point:i}}class ab{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,i){const{x:o,y:h,radius:u}=this;return t=t||{start:0,end:Ei},e.arc(o,h,u,t.end,t.start,!0),!i.bounds}interpolate(e){const{x:t,y:i,radius:o}=this,h=e.angle;return{x:t+Math.cos(h)*o,y:i+Math.sin(h)*o,angle:h}}}function NC(n){const{chart:e,fill:t,line:i}=n;if(Cn(t))return UC(e,t);if(t==="stack")return FC(n);if(t==="shape")return!0;const o=jC(n);return o instanceof ab?o:ob(o,i)}function UC(n,e){const t=n.getDatasetMeta(e);return t&&n.isDatasetVisible(e)?t.dataset:null}function jC(n){return(n.scale||{}).getPointPositionForValue?HC(n):qC(n)}function qC(n){const{scale:e={},fill:t}=n,i=DC(t,e);if(Cn(i)){const o=e.isHorizontal();return{x:o?i:null,y:o?null:i}}return null}function HC(n){const{scale:e,fill:t}=n,i=e.options,o=e.getLabels().length,h=i.reverse?e.max:e.min,u=LC(t,e,h),l=[];if(i.grid.circular){const p=e.getPointPositionForValue(0,h);return new ab({x:p.x,y:p.y,radius:e.getDistanceFromCenterForValue(u)})}for(let p=0;p<o;++p)l.push(e.getPointPositionForValue(p,u));return l}function mp(n,e,t){const i=NC(e),{line:o,scale:h,axis:u}=e,l=o.options,p=l.fill,y=l.backgroundColor,{above:k=y,below:C=y}=p||{};i&&o.points.length&&(Dd(n,t),WC(n,{line:o,target:i,above:k,below:C,area:t,scale:h,axis:u}),Ld(n))}function WC(n,e){const{line:t,target:i,above:o,below:h,area:u,scale:l}=e,p=t._loop?"angle":e.axis;n.save(),p==="x"&&h!==o&&(Ay(n,i,u.top),Ey(n,{line:t,target:i,color:o,scale:l,property:p}),n.restore(),n.save(),Ay(n,i,u.bottom)),Ey(n,{line:t,target:i,color:h,scale:l,property:p}),n.restore()}function Ay(n,e,t){const{segments:i,points:o}=e;let h=!0,u=!1;n.beginPath();for(const l of i){const{start:p,end:y}=l,k=o[p],C=o[hm(p,y,o)];h?(n.moveTo(k.x,k.y),h=!1):(n.lineTo(k.x,t),n.lineTo(k.x,k.y)),u=!!e.pathSegment(n,l,{move:u}),u?n.closePath():n.lineTo(C.x,t)}n.lineTo(e.first().x,t),n.closePath(),n.clip()}function Ey(n,e){const{line:t,target:i,property:o,color:h,scale:u}=e,l=PC(t,i,o);for(const{source:p,target:y,start:k,end:C}of l){const{style:{backgroundColor:S=h}={}}=p,z=i!==!0;n.save(),n.fillStyle=S,ZC(n,u,z&&Bp(o,k,C)),n.beginPath();const R=!!t.pathSegment(n,p);let j;if(z){R?n.closePath():zy(n,i,C,o);const H=!!i.pathSegment(n,y,{move:R,reverse:!0});j=R&&H,j||zy(n,i,k,o)}n.closePath(),n.fill(j?"evenodd":"nonzero"),n.restore()}}function ZC(n,e,t){const{top:i,bottom:o}=e.chart.chartArea,{property:h,start:u,end:l}=t||{};h==="x"&&(n.beginPath(),n.rect(u,i,l-u,o-i),n.clip())}function zy(n,e,t,i){const o=e.interpolate(t,i);o&&n.lineTo(o.x,o.y)}var $C={id:"filler",afterDatasetsUpdate(n,e,t){const i=(n.data.datasets||[]).length,o=[];let h,u,l,p;for(u=0;u<i;++u)h=n.getDatasetMeta(u),l=h.dataset,p=null,l&&l.options&&l instanceof na&&(p={visible:n.isDatasetVisible(u),index:u,fill:EC(l,u,i),chart:n,axis:h.controller.options.indexAxis,scale:h.vScale,line:l}),h.$filler=p,o.push(p);for(u=0;u<i;++u)p=o[u],!(!p||p.fill===!1)&&(p.fill=AC(o,u,t.propagate))},beforeDraw(n,e,t){const i=t.drawTime==="beforeDraw",o=n.getSortedVisibleDatasetMetas(),h=n.chartArea;for(let u=o.length-1;u>=0;--u){const l=o[u].$filler;l&&(l.line.updateControlPoints(h,l.axis),i&&l.fill&&mp(n.ctx,l,h))}},beforeDatasetsDraw(n,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const h=i[o].$filler;Iy(h)&&mp(n.ctx,h,n.chartArea)}},beforeDatasetDraw(n,e,t){const i=e.meta.$filler;!Iy(i)||t.drawTime!=="beforeDatasetDraw"||mp(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Dy=(n,e)=>{let{boxHeight:t=e,boxWidth:i=e}=n;return n.usePointStyle&&(t=Math.min(t,e),i=n.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:t,itemHeight:Math.max(e,t)}},GC=(n,e)=>n!==null&&e!==null&&n.datasetIndex===e.datasetIndex&&n.index===e.index;class Ly extends Ar{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,i){this.maxWidth=e,this.maxHeight=t,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=Oi(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(i=>e.filter(i,this.chart.data))),e.sort&&(t=t.sort((i,o)=>e.sort(i,o,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const i=e.labels,o=Rn(i.font),h=o.size,u=this._computeTitleHeight(),{boxWidth:l,itemHeight:p}=Dy(i,h);let y,k;t.font=o.string,this.isHorizontal()?(y=this.maxWidth,k=this._fitRows(u,h,l,p)+10):(k=this.maxHeight,y=this._fitCols(u,h,l,p)+10),this.width=Math.min(y,e.maxWidth||this.maxWidth),this.height=Math.min(k,e.maxHeight||this.maxHeight)}_fitRows(e,t,i,o){const{ctx:h,maxWidth:u,options:{labels:{padding:l}}}=this,p=this.legendHitBoxes=[],y=this.lineWidths=[0],k=o+l;let C=e;h.textAlign="left",h.textBaseline="middle";let S=-1,z=-k;return this.legendItems.forEach((R,j)=>{const H=i+t/2+h.measureText(R.text).width;(j===0||y[y.length-1]+H+2*l>u)&&(C+=k,y[y.length-(j>0?0:1)]=0,z+=k,S++),p[j]={left:0,top:z,row:S,width:H,height:o},y[y.length-1]+=H+l}),C}_fitCols(e,t,i,o){const{ctx:h,maxHeight:u,options:{labels:{padding:l}}}=this,p=this.legendHitBoxes=[],y=this.columnSizes=[],k=u-e;let C=l,S=0,z=0,R=0,j=0;return this.legendItems.forEach((H,X)=>{const re=i+t/2+h.measureText(H.text).width;X>0&&z+o+2*l>k&&(C+=S+l,y.push({width:S,height:z}),R+=S+l,j++,S=z=0),p[X]={left:R,top:z,col:j,width:re,height:o},S=Math.max(S,re),z+=o+l}),C+=S,y.push({width:S,height:z}),C}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:i,labels:{padding:o},rtl:h}}=this,u=Dl(h,this.left,this.width);if(this.isHorizontal()){let l=0,p=fs(i,this.left+o,this.right-this.lineWidths[l]);for(const y of t)l!==y.row&&(l=y.row,p=fs(i,this.left+o,this.right-this.lineWidths[l])),y.top+=this.top+e+o,y.left=u.leftForLtr(u.x(p),y.width),p+=y.width+o}else{let l=0,p=fs(i,this.top+e+o,this.bottom-this.columnSizes[l].height);for(const y of t)y.col!==l&&(l=y.col,p=fs(i,this.top+e+o,this.bottom-this.columnSizes[l].height)),y.top=p,y.left+=this.left+o,y.left=u.leftForLtr(u.x(y.left),y.width),p+=y.height+o}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Dd(e,this),this._draw(),Ld(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:i,ctx:o}=this,{align:h,labels:u}=e,l=li.color,p=Dl(e.rtl,this.left,this.width),y=Rn(u.font),{color:k,padding:C}=u,S=y.size,z=S/2;let R;this.drawTitle(),o.textAlign=p.textAlign("left"),o.textBaseline="middle",o.lineWidth=.5,o.font=y.string;const{boxWidth:j,boxHeight:H,itemHeight:X}=Dy(u,S),re=function(xe,pe,ke){if(isNaN(j)||j<=0||isNaN(H)||H<0)return;o.save();const Ie=$t(ke.lineWidth,1);if(o.fillStyle=$t(ke.fillStyle,l),o.lineCap=$t(ke.lineCap,"butt"),o.lineDashOffset=$t(ke.lineDashOffset,0),o.lineJoin=$t(ke.lineJoin,"miter"),o.lineWidth=Ie,o.strokeStyle=$t(ke.strokeStyle,l),o.setLineDash($t(ke.lineDash,[])),u.usePointStyle){const Ve={radius:H*Math.SQRT2/2,pointStyle:ke.pointStyle,rotation:ke.rotation,borderWidth:Ie},We=p.xPlus(xe,j/2),Oe=pe+z;M1(o,Ve,We,Oe,u.pointStyleWidth&&j)}else{const Ve=pe+Math.max((S-H)/2,0),We=p.leftForLtr(xe,j),Oe=La(ke.borderRadius);o.beginPath(),Object.values(Oe).some(It=>It!==0)?xh(o,{x:We,y:Ve,w:j,h:H,radius:Oe}):o.rect(We,Ve,j,H),o.fill(),Ie!==0&&o.stroke()}o.restore()},W=function(xe,pe,ke){Oa(o,ke.text,xe,pe+X/2,y,{strikethrough:ke.hidden,textAlign:p.textAlign(ke.textAlign)})},ae=this.isHorizontal(),de=this._computeTitleHeight();ae?R={x:fs(h,this.left+C,this.right-i[0]),y:this.top+C+de,line:0}:R={x:this.left+C,y:fs(h,this.top+de+C,this.bottom-t[0].height),line:0},F1(this.ctx,e.textDirection);const Ae=X+C;this.legendItems.forEach((xe,pe)=>{o.strokeStyle=xe.fontColor||k,o.fillStyle=xe.fontColor||k;const ke=o.measureText(xe.text).width,Ie=p.textAlign(xe.textAlign||(xe.textAlign=u.textAlign)),Ve=j+z+ke;let We=R.x,Oe=R.y;p.setWidth(this.width),ae?pe>0&&We+Ve+C>this.right&&(Oe=R.y+=Ae,R.line++,We=R.x=fs(h,this.left+C,this.right-i[R.line])):pe>0&&Oe+Ae>this.bottom&&(We=R.x=We+t[R.line].width+C,R.line++,Oe=R.y=fs(h,this.top+de+C,this.bottom-t[R.line].height));const It=p.x(We);re(It,Oe,xe),We=rS(Ie,We+j+z,ae?We+Ve:this.right,e.rtl),W(p.x(We),Oe,xe),ae?R.x+=Ve+C:R.y+=Ae}),B1(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,i=Rn(t.font),o=ys(t.padding);if(!t.display)return;const h=Dl(e.rtl,this.left,this.width),u=this.ctx,l=t.position,p=i.size/2,y=o.top+p;let k,C=this.left,S=this.width;if(this.isHorizontal())S=Math.max(...this.lineWidths),k=this.top+y,C=fs(e.align,C,this.right-S);else{const R=this.columnSizes.reduce((j,H)=>Math.max(j,H.height),0);k=y+fs(e.align,this.top,this.bottom-R-e.labels.padding-this._computeTitleHeight())}const z=fs(l,C,C+S);u.textAlign=h.textAlign(em(l)),u.textBaseline="middle",u.strokeStyle=t.color,u.fillStyle=t.color,u.font=i.string,Oa(u,t.text,z,k,i)}_computeTitleHeight(){const e=this.options.title,t=Rn(e.font),i=ys(e.padding);return e.display?t.lineHeight+i.height:0}_getLegendItemAt(e,t){let i,o,h;if(_o(e,this.left,this.right)&&_o(t,this.top,this.bottom)){for(h=this.legendHitBoxes,i=0;i<h.length;++i)if(o=h[i],_o(e,o.left,o.left+o.width)&&_o(t,o.top,o.top+o.height))return this.legendItems[i]}return null}handleEvent(e){const t=this.options;if(!XC(e.type,t))return;const i=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const o=this._hoveredItem,h=GC(o,i);o&&!h&&Oi(t.onLeave,[e,o,this],this),this._hoveredItem=i,i&&!h&&Oi(t.onHover,[e,i,this],this)}else i&&Oi(t.onClick,[e,i,this],this)}}function XC(n,e){return!!((n==="mousemove"||n==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(n==="click"||n==="mouseup"))}var KC={id:"legend",_element:Ly,start(n,e,t){const i=n.legend=new Ly({ctx:n.ctx,options:t,chart:n});ms.configure(n,i,t),ms.addBox(n,i)},stop(n){ms.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,e,t){const i=n.legend;ms.configure(n,i,t),i.options=t},afterUpdate(n){const e=n.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(n,e){e.replay||n.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,e,t){const i=e.datasetIndex,o=t.chart;o.isDatasetVisible(i)?(o.hide(i),e.hidden=!0):(o.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const e=n.data.datasets,{labels:{usePointStyle:t,pointStyle:i,textAlign:o,color:h}}=n.legend.options;return n._getSortedDatasetMetas().map(u=>{const l=u.controller.getStyle(t?0:void 0),p=ys(l.borderWidth);return{text:e[u.index].label,fillStyle:l.backgroundColor,fontColor:h,hidden:!u.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(p.width+p.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:o||l.textAlign,borderRadius:0,datasetIndex:u.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class um extends Ar{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;const o=Vi(i.text)?i.text.length:1;this._padding=ys(i.padding);const h=o*Rn(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=h:this.width=h}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:t,left:i,bottom:o,right:h,options:u}=this,l=u.align;let p=0,y,k,C;return this.isHorizontal()?(k=fs(l,i,h),C=t+e,y=h-i):(u.position==="left"?(k=i+e,C=fs(l,o,t),p=nn*-.5):(k=h-e,C=fs(l,t,o),p=nn*.5),y=o-t),{titleX:k,titleY:C,maxWidth:y,rotation:p}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const i=Rn(t.font),h=i.lineHeight/2+this._padding.top,{titleX:u,titleY:l,maxWidth:p,rotation:y}=this._drawArgs(h);Oa(e,t.text,0,0,i,{color:t.color,maxWidth:p,rotation:y,textAlign:em(t.align),textBaseline:"middle",translation:[u,l]})}}function YC(n,e){const t=new um({ctx:n.ctx,options:e,chart:n});ms.configure(n,t,e),ms.addBox(n,t),n.titleBlock=t}var JC={id:"title",_element:um,start(n,e,t){YC(n,t)},stop(n){const e=n.titleBlock;ms.removeBox(n,e),delete n.titleBlock},beforeUpdate(n,e,t){const i=n.titleBlock;ms.configure(n,i,t),i.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ku=new WeakMap;var QC={id:"subtitle",start(n,e,t){const i=new um({ctx:n.ctx,options:t,chart:n});ms.configure(n,i,t),ms.addBox(n,i),Ku.set(n,i)},stop(n){ms.removeBox(n,Ku.get(n)),Ku.delete(n)},beforeUpdate(n,e,t){const i=Ku.get(n);ms.configure(n,i,t),i.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const uh={average(n){if(!n.length)return!1;let e,t,i=0,o=0,h=0;for(e=0,t=n.length;e<t;++e){const u=n[e].element;if(u&&u.hasValue()){const l=u.tooltipPosition();i+=l.x,o+=l.y,++h}}return{x:i/h,y:o/h}},nearest(n,e){if(!n.length)return!1;let t=e.x,i=e.y,o=Number.POSITIVE_INFINITY,h,u,l;for(h=0,u=n.length;h<u;++h){const p=n[h].element;if(p&&p.hasValue()){const y=p.getCenterPoint(),k=Pp(e,y);k<o&&(o=k,l=p)}}if(l){const p=l.tooltipPosition();t=p.x,i=p.y}return{x:t,y:i}}};function Or(n,e){return e&&(Vi(e)?Array.prototype.push.apply(n,e):n.push(e)),n}function po(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function eT(n,e){const{element:t,datasetIndex:i,index:o}=e,h=n.getDatasetMeta(i).controller,{label:u,value:l}=h.getLabelAndValue(o);return{chart:n,label:u,parsed:h.getParsed(o),raw:n.data.datasets[i].data[o],formattedValue:l,dataset:h.getDataset(),dataIndex:o,datasetIndex:i,element:t}}function Ry(n,e){const t=n.chart.ctx,{body:i,footer:o,title:h}=n,{boxWidth:u,boxHeight:l}=e,p=Rn(e.bodyFont),y=Rn(e.titleFont),k=Rn(e.footerFont),C=h.length,S=o.length,z=i.length,R=ys(e.padding);let j=R.height,H=0,X=i.reduce((ae,de)=>ae+de.before.length+de.lines.length+de.after.length,0);if(X+=n.beforeBody.length+n.afterBody.length,C&&(j+=C*y.lineHeight+(C-1)*e.titleSpacing+e.titleMarginBottom),X){const ae=e.displayColors?Math.max(l,p.lineHeight):p.lineHeight;j+=z*ae+(X-z)*p.lineHeight+(X-1)*e.bodySpacing}S&&(j+=e.footerMarginTop+S*k.lineHeight+(S-1)*e.footerSpacing);let re=0;const W=function(ae){H=Math.max(H,t.measureText(ae).width+re)};return t.save(),t.font=y.string,ki(n.title,W),t.font=p.string,ki(n.beforeBody.concat(n.afterBody),W),re=e.displayColors?u+2+e.boxPadding:0,ki(i,ae=>{ki(ae.before,W),ki(ae.lines,W),ki(ae.after,W)}),re=0,t.font=k.string,ki(n.footer,W),t.restore(),H+=R.width,{width:H,height:j}}function tT(n,e){const{y:t,height:i}=e;return t<i/2?"top":t>n.height-i/2?"bottom":"center"}function iT(n,e,t,i){const{x:o,width:h}=i,u=t.caretSize+t.caretPadding;if(n==="left"&&o+h+u>e.width||n==="right"&&o-h-u<0)return!0}function nT(n,e,t,i){const{x:o,width:h}=t,{width:u,chartArea:{left:l,right:p}}=n;let y="center";return i==="center"?y=o<=(l+p)/2?"left":"right":o<=h/2?y="left":o>=u-h/2&&(y="right"),iT(y,n,e,t)&&(y="center"),y}function Fy(n,e,t){const i=t.yAlign||e.yAlign||tT(n,t);return{xAlign:t.xAlign||e.xAlign||nT(n,e,t,i),yAlign:i}}function sT(n,e){let{x:t,width:i}=n;return e==="right"?t-=i:e==="center"&&(t-=i/2),t}function rT(n,e,t){let{y:i,height:o}=n;return e==="top"?i+=t:e==="bottom"?i-=o+t:i-=o/2,i}function By(n,e,t,i){const{caretSize:o,caretPadding:h,cornerRadius:u}=n,{xAlign:l,yAlign:p}=t,y=o+h,{topLeft:k,topRight:C,bottomLeft:S,bottomRight:z}=La(u);let R=sT(e,l);const j=rT(e,p,y);return p==="center"?l==="left"?R+=y:l==="right"&&(R-=y):l==="left"?R-=Math.max(k,S)+o:l==="right"&&(R+=Math.max(C,z)+o),{x:Un(R,0,i.width-e.width),y:Un(j,0,i.height-e.height)}}function Yu(n,e,t){const i=ys(t.padding);return e==="center"?n.x+n.width/2:e==="right"?n.x+n.width-i.right:n.x+i.left}function Oy(n){return Or([],po(n))}function oT(n,e,t){return ia(n,{tooltip:e,tooltipItems:t,type:"tooltip"})}function Vy(n,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?n.override(t):n}class Op extends Ar{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart||e._chart,this._chart=this.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,i=this.options.setContext(this.getContext()),o=i.enabled&&t.options.animation&&i.animations,h=new U1(this.chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(h)),h}getContext(){return this.$context||(this.$context=oT(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:i}=t,o=i.beforeTitle.apply(this,[e]),h=i.title.apply(this,[e]),u=i.afterTitle.apply(this,[e]);let l=[];return l=Or(l,po(o)),l=Or(l,po(h)),l=Or(l,po(u)),l}getBeforeBody(e,t){return Oy(t.callbacks.beforeBody.apply(this,[e]))}getBody(e,t){const{callbacks:i}=t,o=[];return ki(e,h=>{const u={before:[],lines:[],after:[]},l=Vy(i,h);Or(u.before,po(l.beforeLabel.call(this,h))),Or(u.lines,l.label.call(this,h)),Or(u.after,po(l.afterLabel.call(this,h))),o.push(u)}),o}getAfterBody(e,t){return Oy(t.callbacks.afterBody.apply(this,[e]))}getFooter(e,t){const{callbacks:i}=t,o=i.beforeFooter.apply(this,[e]),h=i.footer.apply(this,[e]),u=i.afterFooter.apply(this,[e]);let l=[];return l=Or(l,po(o)),l=Or(l,po(h)),l=Or(l,po(u)),l}_createItems(e){const t=this._active,i=this.chart.data,o=[],h=[],u=[];let l=[],p,y;for(p=0,y=t.length;p<y;++p)l.push(eT(this.chart,t[p]));return e.filter&&(l=l.filter((k,C,S)=>e.filter(k,C,S,i))),e.itemSort&&(l=l.sort((k,C)=>e.itemSort(k,C,i))),ki(l,k=>{const C=Vy(e.callbacks,k);o.push(C.labelColor.call(this,k)),h.push(C.labelPointStyle.call(this,k)),u.push(C.labelTextColor.call(this,k))}),this.labelColors=o,this.labelPointStyles=h,this.labelTextColors=u,this.dataPoints=l,l}update(e,t){const i=this.options.setContext(this.getContext()),o=this._active;let h,u=[];if(!o.length)this.opacity!==0&&(h={opacity:0});else{const l=uh[i.position].call(this,o,this._eventPosition);u=this._createItems(i),this.title=this.getTitle(u,i),this.beforeBody=this.getBeforeBody(u,i),this.body=this.getBody(u,i),this.afterBody=this.getAfterBody(u,i),this.footer=this.getFooter(u,i);const p=this._size=Ry(this,i),y=Object.assign({},l,p),k=Fy(this.chart,i,y),C=By(i,y,k,this.chart);this.xAlign=k.xAlign,this.yAlign=k.yAlign,h={opacity:1,x:C.x,y:C.y,width:p.width,height:p.height,caretX:l.x,caretY:l.y}}this._tooltipItems=u,this.$context=void 0,h&&this._resolveAnimations().update(this,h),e&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,i,o){const h=this.getCaretPosition(e,i,o);t.lineTo(h.x1,h.y1),t.lineTo(h.x2,h.y2),t.lineTo(h.x3,h.y3)}getCaretPosition(e,t,i){const{xAlign:o,yAlign:h}=this,{caretSize:u,cornerRadius:l}=i,{topLeft:p,topRight:y,bottomLeft:k,bottomRight:C}=La(l),{x:S,y:z}=e,{width:R,height:j}=t;let H,X,re,W,ae,de;return h==="center"?(ae=z+j/2,o==="left"?(H=S,X=H-u,W=ae+u,de=ae-u):(H=S+R,X=H+u,W=ae-u,de=ae+u),re=H):(o==="left"?X=S+Math.max(p,k)+u:o==="right"?X=S+R-Math.max(y,C)-u:X=this.caretX,h==="top"?(W=z,ae=W-u,H=X-u,re=X+u):(W=z+j,ae=W+u,H=X+u,re=X-u),de=W),{x1:H,x2:X,x3:re,y1:W,y2:ae,y3:de}}drawTitle(e,t,i){const o=this.title,h=o.length;let u,l,p;if(h){const y=Dl(i.rtl,this.x,this.width);for(e.x=Yu(this,i.titleAlign,i),t.textAlign=y.textAlign(i.titleAlign),t.textBaseline="middle",u=Rn(i.titleFont),l=i.titleSpacing,t.fillStyle=i.titleColor,t.font=u.string,p=0;p<h;++p)t.fillText(o[p],y.x(e.x),e.y+u.lineHeight/2),e.y+=u.lineHeight+l,p+1===h&&(e.y+=i.titleMarginBottom-l)}}_drawColorBox(e,t,i,o,h){const u=this.labelColors[i],l=this.labelPointStyles[i],{boxHeight:p,boxWidth:y,boxPadding:k}=h,C=Rn(h.bodyFont),S=Yu(this,"left",h),z=o.x(S),R=p<C.lineHeight?(C.lineHeight-p)/2:0,j=t.y+R;if(h.usePointStyle){const H={radius:Math.min(y,p)/2,pointStyle:l.pointStyle,rotation:l.rotation,borderWidth:1},X=o.leftForLtr(z,y)+y/2,re=j+p/2;e.strokeStyle=h.multiKeyBackground,e.fillStyle=h.multiKeyBackground,Ep(e,H,X,re),e.strokeStyle=u.borderColor,e.fillStyle=u.backgroundColor,Ep(e,H,X,re)}else{e.lineWidth=ri(u.borderWidth)?Math.max(...Object.values(u.borderWidth)):u.borderWidth||1,e.strokeStyle=u.borderColor,e.setLineDash(u.borderDash||[]),e.lineDashOffset=u.borderDashOffset||0;const H=o.leftForLtr(z,y-k),X=o.leftForLtr(o.xPlus(z,1),y-k-2),re=La(u.borderRadius);Object.values(re).some(W=>W!==0)?(e.beginPath(),e.fillStyle=h.multiKeyBackground,xh(e,{x:H,y:j,w:y,h:p,radius:re}),e.fill(),e.stroke(),e.fillStyle=u.backgroundColor,e.beginPath(),xh(e,{x:X,y:j+1,w:y-2,h:p-2,radius:re}),e.fill()):(e.fillStyle=h.multiKeyBackground,e.fillRect(H,j,y,p),e.strokeRect(H,j,y,p),e.fillStyle=u.backgroundColor,e.fillRect(X,j+1,y-2,p-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,t,i){const{body:o}=this,{bodySpacing:h,bodyAlign:u,displayColors:l,boxHeight:p,boxWidth:y,boxPadding:k}=i,C=Rn(i.bodyFont);let S=C.lineHeight,z=0;const R=Dl(i.rtl,this.x,this.width),j=function(pe){t.fillText(pe,R.x(e.x+z),e.y+S/2),e.y+=S+h},H=R.textAlign(u);let X,re,W,ae,de,Ae,xe;for(t.textAlign=u,t.textBaseline="middle",t.font=C.string,e.x=Yu(this,H,i),t.fillStyle=i.bodyColor,ki(this.beforeBody,j),z=l&&H!=="right"?u==="center"?y/2+k:y+2+k:0,ae=0,Ae=o.length;ae<Ae;++ae){for(X=o[ae],re=this.labelTextColors[ae],t.fillStyle=re,ki(X.before,j),W=X.lines,l&&W.length&&(this._drawColorBox(t,e,ae,R,i),S=Math.max(C.lineHeight,p)),de=0,xe=W.length;de<xe;++de)j(W[de]),S=C.lineHeight;ki(X.after,j)}z=0,S=C.lineHeight,ki(this.afterBody,j),e.y-=h}drawFooter(e,t,i){const o=this.footer,h=o.length;let u,l;if(h){const p=Dl(i.rtl,this.x,this.width);for(e.x=Yu(this,i.footerAlign,i),e.y+=i.footerMarginTop,t.textAlign=p.textAlign(i.footerAlign),t.textBaseline="middle",u=Rn(i.footerFont),t.fillStyle=i.footerColor,t.font=u.string,l=0;l<h;++l)t.fillText(o[l],p.x(e.x),e.y+u.lineHeight/2),e.y+=u.lineHeight+i.footerSpacing}}drawBackground(e,t,i,o){const{xAlign:h,yAlign:u}=this,{x:l,y:p}=e,{width:y,height:k}=i,{topLeft:C,topRight:S,bottomLeft:z,bottomRight:R}=La(o.cornerRadius);t.fillStyle=o.backgroundColor,t.strokeStyle=o.borderColor,t.lineWidth=o.borderWidth,t.beginPath(),t.moveTo(l+C,p),u==="top"&&this.drawCaret(e,t,i,o),t.lineTo(l+y-S,p),t.quadraticCurveTo(l+y,p,l+y,p+S),u==="center"&&h==="right"&&this.drawCaret(e,t,i,o),t.lineTo(l+y,p+k-R),t.quadraticCurveTo(l+y,p+k,l+y-R,p+k),u==="bottom"&&this.drawCaret(e,t,i,o),t.lineTo(l+z,p+k),t.quadraticCurveTo(l,p+k,l,p+k-z),u==="center"&&h==="left"&&this.drawCaret(e,t,i,o),t.lineTo(l,p+C),t.quadraticCurveTo(l,p,l+C,p),t.closePath(),t.fill(),o.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,i=this.$animations,o=i&&i.x,h=i&&i.y;if(o||h){const u=uh[e.position].call(this,this._active,this._eventPosition);if(!u)return;const l=this._size=Ry(this,e),p=Object.assign({},u,this._size),y=Fy(t,e,p),k=By(e,p,y,t);(o._to!==k.x||h._to!==k.y)&&(this.xAlign=y.xAlign,this.yAlign=y.yAlign,this.width=l.width,this.height=l.height,this.caretX=u.x,this.caretY=u.y,this._resolveAnimations().update(this,k))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(t);const o={width:this.width,height:this.height},h={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const u=ys(t.padding),l=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&l&&(e.save(),e.globalAlpha=i,this.drawBackground(h,e,o,t),F1(e,t.textDirection),h.y+=u.top,this.drawTitle(h,e,t),this.drawBody(h,e,t),this.drawFooter(h,e,t),B1(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const i=this._active,o=e.map(({datasetIndex:l,index:p})=>{const y=this.chart.getDatasetMeta(l);if(!y)throw new Error("Cannot find a dataset at index "+l);return{datasetIndex:l,element:y.data[p],index:p}}),h=!ld(i,o),u=this._positionChanged(o,t);(h||u)&&(this._active=o,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,i=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const o=this.options,h=this._active||[],u=this._getActiveElements(e,h,t,i),l=this._positionChanged(u,e),p=t||!ld(u,h)||l;return p&&(this._active=u,(o.enabled||o.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),p}_getActiveElements(e,t,i,o){const h=this.options;if(e.type==="mouseout")return[];if(!o)return t;const u=this.chart.getElementsAtEventForMode(e,h.mode,h,i);return h.reverse&&u.reverse(),u}_positionChanged(e,t){const{caretX:i,caretY:o,options:h}=this,u=uh[h.position].call(this,e,t);return u!==!1&&(i!==u.x||o!==u.y)}}Op.positioners=uh;var aT={id:"tooltip",_element:Op,positioners:uh,afterInit(n,e,t){t&&(n.tooltip=new Op({chart:n,options:t}))},beforeUpdate(n,e,t){n.tooltip&&n.tooltip.initialize(t)},reset(n,e,t){n.tooltip&&n.tooltip.initialize(t)},afterDraw(n){const e=n.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(n.notifyPlugins("beforeTooltipDraw",t)===!1)return;e.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",t)}},afterEvent(n,e){if(n.tooltip){const t=e.replay;n.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,e)=>e.bodyFont.size,boxWidth:(n,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:uo,title(n){if(n.length>0){const e=n[0],t=e.chart.data.labels,i=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return t[e.dataIndex]}return""},afterTitle:uo,beforeBody:uo,beforeLabel:uo,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let e=n.dataset.label||"";e&&(e+=": ");const t=n.formattedValue;return ui(t)||(e+=t),e},labelColor(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:uo,afterBody:uo,beforeFooter:uo,footer:uo,afterFooter:uo}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},lT=Object.freeze({__proto__:null,Decimation:MC,Filler:$C,Legend:KC,SubTitle:QC,Title:JC,Tooltip:aT});const cT=(n,e,t,i)=>(typeof e=="string"?(t=n.push(e)-1,i.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function hT(n,e,t,i){const o=n.indexOf(e);if(o===-1)return cT(n,e,t,i);const h=n.lastIndexOf(e);return o!==h?t:o}const uT=(n,e)=>n===null?null:Un(Math.round(n),0,e);class gd extends Na{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const i=this.getLabels();for(const{index:o,label:h}of t)i[o]===h&&i.splice(o,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(ui(e))return null;const i=this.getLabels();return t=isFinite(t)&&i[t]===e?t:hT(i,e,$t(t,e),this._addedLabels),uT(t,i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:i,max:o}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(i=0),t||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){const e=this.min,t=this.max,i=this.options.offset,o=[];let h=this.getLabels();h=e===0&&t===h.length-1?h:h.slice(e,t+1),this._valueRange=Math.max(h.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let u=e;u<=t;u++)o.push({value:u});return o}getLabelForValue(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}gd.id="category";gd.defaults={ticks:{callback:gd.prototype.getLabelForValue}};function dT(n,e){const t=[],{bounds:o,step:h,min:u,max:l,precision:p,count:y,maxTicks:k,maxDigits:C,includeBounds:S}=n,z=h||1,R=k-1,{min:j,max:H}=e,X=!ui(u),re=!ui(l),W=!ui(y),ae=(H-j)/(C+1);let de=F_((H-j)/R/z)*z,Ae,xe,pe,ke;if(de<1e-14&&!X&&!re)return[{value:j},{value:H}];ke=Math.ceil(H/de)-Math.floor(j/de),ke>R&&(de=F_(ke*de/R/z)*z),ui(p)||(Ae=Math.pow(10,p),de=Math.ceil(de*Ae)/Ae),o==="ticks"?(xe=Math.floor(j/de)*de,pe=Math.ceil(H/de)*de):(xe=j,pe=H),X&&re&&h&&Jk((l-u)/h,de/1e3)?(ke=Math.round(Math.min((l-u)/de,k)),de=(l-u)/ke,xe=u,pe=l):W?(xe=X?u:xe,pe=re?l:pe,ke=y-1,de=(pe-xe)/ke):(ke=(pe-xe)/de,lh(ke,Math.round(ke),de/1e3)?ke=Math.round(ke):ke=Math.ceil(ke));const Ie=Math.max(B_(de),B_(xe));Ae=Math.pow(10,ui(p)?Ie:p),xe=Math.round(xe*Ae)/Ae,pe=Math.round(pe*Ae)/Ae;let Ve=0;for(X&&(S&&xe!==u?(t.push({value:u}),xe<u&&Ve++,lh(Math.round((xe+Ve*de)*Ae)/Ae,u,Ny(u,ae,n))&&Ve++):xe<u&&Ve++);Ve<ke;++Ve)t.push({value:Math.round((xe+Ve*de)*Ae)/Ae});return re&&S&&pe!==l?t.length&&lh(t[t.length-1].value,l,Ny(l,ae,n))?t[t.length-1].value=l:t.push({value:l}):(!re||pe===l)&&t.push({value:pe}),t}function Ny(n,e,{horizontal:t,minRotation:i}){const o=Pr(i),h=(t?Math.sin(o):Math.cos(o))||.001,u=.75*e*(""+n).length;return Math.min(e/h,u)}class _d extends Na{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return ui(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:i}=this.getUserBounds();let{min:o,max:h}=this;const u=p=>o=t?o:p,l=p=>h=i?h:p;if(e){const p=jr(o),y=jr(h);p<0&&y<0?l(0):p>0&&y>0&&u(0)}if(o===h){let p=1;(h>=Number.MAX_SAFE_INTEGER||o<=Number.MIN_SAFE_INTEGER)&&(p=Math.abs(h*.05)),l(h+p),e||u(o-p)}this.min=o,this.max=h}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:i}=e,o;return i?(o=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,o>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${o} ticks. Limiting to 1000.`),o=1e3)):(o=this.computeTickLimit(),t=t||11),t&&(o=Math.min(t,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const o={maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},h=this._range||this,u=dT(o,h);return e.bounds==="ticks"&&p1(u,this,"value"),e.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}configure(){const e=this.ticks;let t=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const o=(i-t)/Math.max(e.length-1,1)/2;t-=o,i+=o}this._startValue=t,this._endValue=i,this._valueRange=i-t}getLabelForValue(e){return Th(e,this.chart.options.locale,this.options.ticks.format)}}class dm extends _d{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Cn(e)?e:0,this.max=Cn(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,i=Pr(this.options.ticks.minRotation),o=(e?Math.sin(i):Math.cos(i))||.001,h=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,h.lineHeight/o))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}dm.id="linear";dm.defaults={ticks:{callback:Ud.formatters.numeric}};function Uy(n){return n/Math.pow(10,Math.floor(_r(n)))===1}function fT(n,e){const t=Math.floor(_r(e.max)),i=Math.ceil(e.max/Math.pow(10,t)),o=[];let h=gr(n.min,Math.pow(10,Math.floor(_r(e.min)))),u=Math.floor(_r(h)),l=Math.floor(h/Math.pow(10,u)),p=u<0?Math.pow(10,Math.abs(u)):1;do o.push({value:h,major:Uy(h)}),++l,l===10&&(l=1,++u,p=u>=0?1:p),h=Math.round(l*Math.pow(10,u)*p)/p;while(u<t||u===t&&l<i);const y=gr(n.max,h);return o.push({value:y,major:Uy(h)}),o}class fm extends Na{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const i=_d.prototype.parse.apply(this,[e,t]);if(i===0){this._zero=!0;return}return Cn(i)&&i>0?i:null}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Cn(e)?Math.max(0,e):null,this.max=Cn(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let i=this.min,o=this.max;const h=p=>i=e?i:p,u=p=>o=t?o:p,l=(p,y)=>Math.pow(10,Math.floor(_r(p))+y);i===o&&(i<=0?(h(1),u(10)):(h(l(i,-1)),u(l(o,1)))),i<=0&&h(l(o,-1)),o<=0&&u(l(i,1)),this._zero&&this.min!==this._suggestedMin&&i===l(this.min,0)&&h(l(i,-1)),this.min=i,this.max=o}buildTicks(){const e=this.options,t={min:this._userMin,max:this._userMax},i=fT(t,this);return e.bounds==="ticks"&&p1(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(e){return e===void 0?"0":Th(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=_r(e),this._valueRange=_r(this.max)-_r(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(_r(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}fm.id="logarithmic";fm.defaults={ticks:{callback:Ud.formatters.logarithmic,major:{enabled:!0}}};function Vp(n){const e=n.ticks;if(e.display&&n.display){const t=ys(e.backdropPadding);return $t(e.font&&e.font.size,li.font.size)+t.height}return 0}function pT(n,e,t){return t=Vi(t)?t:[t],{w:AS(n,e.string,t),h:t.length*e.lineHeight}}function jy(n,e,t,i,o){return n===i||n===o?{start:e-t/2,end:e+t/2}:n<i||n>o?{start:e-t,end:e}:{start:e,end:e+t}}function mT(n){const e={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},t=Object.assign({},e),i=[],o=[],h=n._pointLabels.length,u=n.options.pointLabels,l=u.centerPointLabels?nn/h:0;for(let p=0;p<h;p++){const y=u.setContext(n.getPointLabelContext(p));o[p]=y.padding;const k=n.getPointPosition(p,n.drawingArea+o[p],l),C=Rn(y.font),S=pT(n.ctx,C,n._pointLabels[p]);i[p]=S;const z=ir(n.getIndexAngle(p)+l),R=Math.round(Jp(z)),j=jy(R,k.x,S.w,0,180),H=jy(R,k.y,S.h,90,270);gT(t,e,z,j,H)}n.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),n._pointLabelItems=_T(n,i,o)}function gT(n,e,t,i,o){const h=Math.abs(Math.sin(t)),u=Math.abs(Math.cos(t));let l=0,p=0;i.start<e.l?(l=(e.l-i.start)/h,n.l=Math.min(n.l,e.l-l)):i.end>e.r&&(l=(i.end-e.r)/h,n.r=Math.max(n.r,e.r+l)),o.start<e.t?(p=(e.t-o.start)/u,n.t=Math.min(n.t,e.t-p)):o.end>e.b&&(p=(o.end-e.b)/u,n.b=Math.max(n.b,e.b+p))}function _T(n,e,t){const i=[],o=n._pointLabels.length,h=n.options,u=Vp(h)/2,l=n.drawingArea,p=h.pointLabels.centerPointLabels?nn/o:0;for(let y=0;y<o;y++){const k=n.getPointPosition(y,l+u+t[y],p),C=Math.round(Jp(ir(k.angle+gn))),S=e[y],z=xT(k.y,S.h,C),R=yT(C),j=bT(k.x,S.w,R);i.push({x:k.x,y:z,textAlign:R,left:j,top:z,right:j+S.w,bottom:z+S.h})}return i}function yT(n){return n===0||n===180?"center":n<180?"left":"right"}function bT(n,e,t){return t==="right"?n-=e:t==="center"&&(n-=e/2),n}function xT(n,e,t){return t===90||t===270?n-=e/2:(t>270||t<90)&&(n-=e),n}function vT(n,e){const{ctx:t,options:{pointLabels:i}}=n;for(let o=e-1;o>=0;o--){const h=i.setContext(n.getPointLabelContext(o)),u=Rn(h.font),{x:l,y:p,textAlign:y,left:k,top:C,right:S,bottom:z}=n._pointLabelItems[o],{backdropColor:R}=h;if(!ui(R)){const j=La(h.borderRadius),H=ys(h.backdropPadding);t.fillStyle=R;const X=k-H.left,re=C-H.top,W=S-k+H.width,ae=z-C+H.height;Object.values(j).some(de=>de!==0)?(t.beginPath(),xh(t,{x:X,y:re,w:W,h:ae,radius:j}),t.fill()):t.fillRect(X,re,W,ae)}Oa(t,n._pointLabels[o],l,p+u.lineHeight/2,u,{color:h.color,textAlign:y,textBaseline:"middle"})}}function lb(n,e,t,i){const{ctx:o}=n;if(t)o.arc(n.xCenter,n.yCenter,e,0,Ei);else{let h=n.getPointPosition(0,e);o.moveTo(h.x,h.y);for(let u=1;u<i;u++)h=n.getPointPosition(u,e),o.lineTo(h.x,h.y)}}function wT(n,e,t,i){const o=n.ctx,h=e.circular,{color:u,lineWidth:l}=e;!h&&!i||!u||!l||t<0||(o.save(),o.strokeStyle=u,o.lineWidth=l,o.setLineDash(e.borderDash),o.lineDashOffset=e.borderDashOffset,o.beginPath(),lb(n,t,h,i),o.closePath(),o.stroke(),o.restore())}function kT(n,e,t){return ia(n,{label:t,index:e,type:"pointLabel"})}class Ph extends _d{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=ys(Vp(this.options)/2),t=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(t,i)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=Cn(e)&&!isNaN(e)?e:0,this.max=Cn(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Vp(this.options))}generateTickLabels(e){_d.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,i)=>{const o=Oi(this.options.pointLabels.callback,[t,i],this);return o||o===0?o:""}).filter((t,i)=>this.chart.getDataVisibility(i))}fit(){const e=this.options;e.display&&e.pointLabels.display?mT(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,i,o){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((i-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,i,o))}getIndexAngle(e){const t=Ei/(this._pointLabels.length||1),i=this.options.startAngle||0;return ir(e*t+Pr(i))}getDistanceFromCenterForValue(e){if(ui(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(ui(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const i=t[e];return kT(this.getContext(),e,i)}}getPointPosition(e,t,i=0){const o=this.getIndexAngle(e)-gn+i;return{x:Math.cos(o)*t+this.xCenter,y:Math.sin(o)*t+this.yCenter,angle:o}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:i,right:o,bottom:h}=this._pointLabelItems[e];return{left:t,top:i,right:o,bottom:h}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const i=this.ctx;i.save(),i.beginPath(),lb(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:i,grid:o}=t,h=this._pointLabels.length;let u,l,p;if(t.pointLabels.display&&vT(this,h),o.display&&this.ticks.forEach((y,k)=>{if(k!==0){l=this.getDistanceFromCenterForValue(y.value);const C=o.setContext(this.getContext(k-1));wT(this,C,l,h)}}),i.display){for(e.save(),u=h-1;u>=0;u--){const y=i.setContext(this.getPointLabelContext(u)),{color:k,lineWidth:C}=y;!C||!k||(e.lineWidth=C,e.strokeStyle=k,e.setLineDash(y.borderDash),e.lineDashOffset=y.borderDashOffset,l=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),p=this.getPointPosition(u,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(p.x,p.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,i=t.ticks;if(!i.display)return;const o=this.getIndexAngle(0);let h,u;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(o),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((l,p)=>{if(p===0&&!t.reverse)return;const y=i.setContext(this.getContext(p)),k=Rn(y.font);if(h=this.getDistanceFromCenterForValue(this.ticks[p].value),y.showLabelBackdrop){e.font=k.string,u=e.measureText(l.label).width,e.fillStyle=y.backdropColor;const C=ys(y.backdropPadding);e.fillRect(-u/2-C.left,-h-k.size/2-C.top,u+C.width,k.size+C.height)}Oa(e,l.label,0,-h,k,{color:y.color})}),e.restore()}drawTitle(){}}Ph.id="radialLinear";Ph.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ud.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(n){return n},padding:5,centerPointLabels:!1}};Ph.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};Ph.descriptors={angleLines:{_fallback:"grid"}};const Zd={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Us=Object.keys(Zd);function ST(n,e){return n-e}function qy(n,e){if(ui(e))return null;const t=n._adapter,{parser:i,round:o,isoWeekday:h}=n._parseOpts;let u=e;return typeof i=="function"&&(u=i(u)),Cn(u)||(u=typeof i=="string"?t.parse(u,i):t.parse(u)),u===null?null:(o&&(u=o==="week"&&(Bl(h)||h===!0)?t.startOf(u,"isoWeek",h):t.startOf(u,o)),+u)}function Hy(n,e,t,i){const o=Us.length;for(let h=Us.indexOf(n);h<o-1;++h){const u=Zd[Us[h]],l=u.steps?u.steps:Number.MAX_SAFE_INTEGER;if(u.common&&Math.ceil((t-e)/(l*u.size))<=i)return Us[h]}return Us[o-1]}function CT(n,e,t,i,o){for(let h=Us.length-1;h>=Us.indexOf(t);h--){const u=Us[h];if(Zd[u].common&&n._adapter.diff(o,i,u)>=e-1)return u}return Us[t?Us.indexOf(t):0]}function TT(n){for(let e=Us.indexOf(n)+1,t=Us.length;e<t;++e)if(Zd[Us[e]].common)return Us[e]}function Wy(n,e,t){if(!t)n[e]=!0;else if(t.length){const{lo:i,hi:o}=Qp(t,e),h=t[i]>=e?t[i]:t[o];n[h]=!0}}function MT(n,e,t,i){const o=n._adapter,h=+o.startOf(e[0].value,i),u=e[e.length-1].value;let l,p;for(l=h;l<=u;l=+o.add(l,1,i))p=t[l],p>=0&&(e[p].major=!0);return e}function Zy(n,e,t){const i=[],o={},h=e.length;let u,l;for(u=0;u<h;++u)l=e[u],o[l]=u,i.push({value:l,major:!1});return h===0||!t?i:MT(n,i,o,t)}class Ih extends Na{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t){const i=e.time||(e.time={}),o=this._adapter=new f5._date(e.adapters.date);o.init(t),ah(i.displayFormats,o.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:qy(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,i=e.time.unit||"day";let{min:o,max:h,minDefined:u,maxDefined:l}=this.getUserBounds();function p(y){!u&&!isNaN(y.min)&&(o=Math.min(o,y.min)),!l&&!isNaN(y.max)&&(h=Math.max(h,y.max))}(!u||!l)&&(p(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&p(this.getMinMax(!1))),o=Cn(o)&&!isNaN(o)?o:+t.startOf(Date.now(),i),h=Cn(h)&&!isNaN(h)?h:+t.endOf(Date.now(),i)+1,this.min=Math.min(o,h-1),this.max=Math.max(o+1,h)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],i=e[e.length-1]),{min:t,max:i}}buildTicks(){const e=this.options,t=e.time,i=e.ticks,o=i.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);const h=this.min,u=this.max,l=iS(o,h,u);return this._unit=t.unit||(i.autoSkip?Hy(t.minUnit,this.min,this.max,this._getLabelCapacity(h)):CT(this,l.length,t.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:TT(this._unit),this.initOffsets(o),e.reverse&&l.reverse(),Zy(this,l,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e){let t=0,i=0,o,h;this.options.offset&&e.length&&(o=this.getDecimalForValue(e[0]),e.length===1?t=1-o:t=(this.getDecimalForValue(e[1])-o)/2,h=this.getDecimalForValue(e[e.length-1]),e.length===1?i=h:i=(h-this.getDecimalForValue(e[e.length-2]))/2);const u=e.length<3?.5:.25;t=Un(t,0,u),i=Un(i,0,u),this._offsets={start:t,end:i,factor:1/(t+1+i)}}_generate(){const e=this._adapter,t=this.min,i=this.max,o=this.options,h=o.time,u=h.unit||Hy(h.minUnit,t,i,this._getLabelCapacity(t)),l=$t(h.stepSize,1),p=u==="week"?h.isoWeekday:!1,y=Bl(p)||p===!0,k={};let C=t,S,z;if(y&&(C=+e.startOf(C,"isoWeek",p)),C=+e.startOf(C,y?"day":u),e.diff(i,t,u)>1e5*l)throw new Error(t+" and "+i+" are too far apart with stepSize of "+l+" "+u);const R=o.ticks.source==="data"&&this.getDataTimestamps();for(S=C,z=0;S<i;S=+e.add(S,l,u),z++)Wy(k,S,R);return(S===i||o.bounds==="ticks"||z===1)&&Wy(k,S,R),Object.keys(k).sort((j,H)=>j-H).map(j=>+j)}getLabelForValue(e){const t=this._adapter,i=this.options.time;return i.tooltipFormat?t.format(e,i.tooltipFormat):t.format(e,i.displayFormats.datetime)}_tickFormatFunction(e,t,i,o){const h=this.options,u=h.time.displayFormats,l=this._unit,p=this._majorUnit,y=l&&u[l],k=p&&u[p],C=i[t],S=p&&k&&C&&C.major,z=this._adapter.format(e,o||(S?k:y)),R=h.ticks.callback;return R?Oi(R,[z,t,i],this):z}generateTickLabels(e){let t,i,o;for(t=0,i=e.length;t<i;++t)o=e[t],o.label=this._tickFormatFunction(o.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+i)*t.factor)}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,i=this.ctx.measureText(e).width,o=Pr(this.isHorizontal()?t.maxRotation:t.minRotation),h=Math.cos(o),u=Math.sin(o),l=this._resolveTickFontOptions(0).size;return{w:i*h+l*u,h:i*u+l*h}}_getLabelCapacity(e){const t=this.options.time,i=t.displayFormats,o=i[t.unit]||i.millisecond,h=this._tickFormatFunction(e,0,Zy(this,[e],this._majorUnit),o),u=this._getLabelSize(h),l=Math.floor(this.isHorizontal()?this.width/u.w:this.height/u.h)-1;return l>0?l:1}getDataTimestamps(){let e=this._cache.data||[],t,i;if(e.length)return e;const o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(t=0,i=o.length;t<i;++t)e=e.concat(o[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,i;if(e.length)return e;const o=this.getLabels();for(t=0,i=o.length;t<i;++t)e.push(qy(this,o[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return _1(e.sort(ST))}}Ih.id="time";Ih.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};function Ju(n,e,t){let i=0,o=n.length-1,h,u,l,p;t?(e>=n[i].pos&&e<=n[o].pos&&({lo:i,hi:o}=yo(n,"pos",e)),{pos:h,time:l}=n[i],{pos:u,time:p}=n[o]):(e>=n[i].time&&e<=n[o].time&&({lo:i,hi:o}=yo(n,"time",e)),{time:h,pos:l}=n[i],{time:u,pos:p}=n[o]);const y=u-h;return y?l+(p-l)*(e-h)/y:l}class pm extends Ih{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Ju(t,this.min),this._tableRange=Ju(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:i}=this,o=[],h=[];let u,l,p,y,k;for(u=0,l=e.length;u<l;++u)y=e[u],y>=t&&y<=i&&o.push(y);if(o.length<2)return[{time:t,pos:0},{time:i,pos:1}];for(u=0,l=o.length;u<l;++u)k=o[u+1],p=o[u-1],y=o[u],Math.round((k+p)/2)!==y&&h.push({time:y,pos:u/(l-1)});return h}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),i=this.getLabelTimestamps();return t.length&&i.length?e=this.normalize(t.concat(i)):e=t.length?t:i,e=this._cache.all=e,e}getDecimalForValue(e){return(Ju(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return Ju(this._table,i*this._tableRange+this._minPos,!0)}}pm.id="timeseries";pm.defaults=Ih.defaults;var PT=Object.freeze({__proto__:null,CategoryScale:gd,LinearScale:dm,LogarithmicScale:fm,RadialLinearScale:Ph,TimeScale:Ih,TimeSeriesScale:pm});const IT=[d5,kC,lT,PT];Ll==null||Ll.register(...IT??[]);class tn{}Ge(tn,"unknownColor","rgba(128, 128, 128, 0.2)"),Ge(tn,"unknownBorderColor","rgba(128, 128, 128, 0.2)"),Ge(tn,"otherColor","rgba(128, 128, 128, 0.2)"),Ge(tn,"otherBorderColor","rgba(128, 128, 255)"),Ge(tn,"notApplicableColor","rgba(128, 128, 128, 0.2)"),Ge(tn,"notApplicableBorderColor","rgba(255, 0, 0)"),Ge(tn,"backgroundColors",["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"]),Ge(tn,"borderColors",["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"]);class $d extends kh{constructor(t){super();Ge(this,"_config");this._config=t}static ConstructDoughnut(t){const i=[],o=[];let h=0;const u=tn.borderColors,l=tn.backgroundColors;for(const y in t)y===""?(i.push(tn.unknownBorderColor),o.push(tn.unknownColor)):(i.push(u[h%u.length]),o.push(l[h%l.length]),h++);const p={type:"doughnut",data:{labels:Object.keys(t),datasets:[{data:Object.values(t),backgroundColor:o,borderColor:i,borderWidth:1,label:void 0}]},options:{plugins:{legend:{display:!1}}}};return new $d(p)}InnerConstructElement(){var i;const t=document.createElement("canvas");if(this.style!==void 0&&(t.style.cssText=this.style),((i=this.clss)==null?void 0:i.size)>0)try{t.classList.add(...Array.from(this.clss))}catch(o){console.error("Invalid class name detected in:",Array.from(this.clss).join(" "),`
Err msg is `,o)}return new Ll(t,this._config),t}}class cb extends $d{constructor(e,t,i){var C;const{labels:o,data:h}=mm.extractDataAndLabels(e,t,{sort:!0,groupToOtherCutoff:i==null?void 0:i.groupToOtherCutoff,hideNotApplicable:i==null?void 0:i.hideNotApplicable,hideUnkown:i==null?void 0:i.hideUnknown});if(o===void 0||h===void 0)throw console.error("Could not extract data and labels for ",e," with features",t,": no labels or no data"),"No labels or data given...";for(let S=o.length;S>=0;S--)((C=h[S])==null?void 0:C.length)==0&&(h.splice(S,1),o.splice(S,1));const u=[];let p=cb.getAllDays(t).map(S=>S.substr(0,10));(i==null?void 0:i.period)==="month"&&(p=p.map(S=>S.substr(0,7))),p=Ni.Dedup(p);for(let S=0;S<o.length;S++){const z=o[S],R=h[S],j={};for(const re of R){const W=new Date(re.properties.date);Ni.SetMidnight(W);let ae=W.toISOString();ae=ae.substr(0,10),(i==null?void 0:i.period)==="month"&&(ae=ae.substr(0,7)),j[ae]===void 0?j[ae]=[re]:j[ae].push(re)}const H=[];for(let re=0;re<p.length;re++){const W=p[re],ae=j[W];if(ae)if(i.sumFields!==void 0){let de=0;for(const Ae of ae){const xe=Ae.properties;for(const pe of i.sumFields){if(!xe[pe])continue;const ke=Number(xe[pe]);isNaN(ke)||(de+=ke)}}H[re]=de}else H[re]=(ae==null?void 0:ae.length)??0}let X=tn.borderColors[S%tn.borderColors.length];z==="Unknown"&&(X=tn.unknownBorderColor),z==="Other"&&(X=tn.otherBorderColor),u.push({data:H,backgroundColor:X,label:z})}const k={type:"bar",data:{labels:p,datasets:u},options:{responsive:!0,legend:{display:!1},scales:{x:{stacked:!0},y:{stacked:!0}}}};super(k)}static getAllDays(e){let t,i,o=new Set;for(e.forEach(u=>{const l=new Date(u.properties.date);Ni.SetMidnight(l),(t===void 0||l<t)&&(t=l),(i===void 0||l>i)&&(i=l),o.add(l.toISOString())});t<i;)t.setDate(t.getDate()+1),o.add(t.toISOString());const h=Array.from(o);return h.sort(),h}}class mm extends Hp{constructor(e,t,i){var C,S,z;if(((C=t.mappings)==null?void 0:C.length)===0&&((S=t.freeform)==null?void 0:S.key)===void 0){super([]),this.SetClass("hidden");return}const{labels:o,data:h}=mm.extractDataAndLabels(t,e,i);if(o===void 0||h===void 0){super([]),this.SetClass("hidden");return}const u=[tn.unknownBorderColor,tn.otherBorderColor,tn.notApplicableBorderColor],l=[tn.unknownColor,tn.otherColor,tn.notApplicableColor];for(;u.length<h.length;)u.push(...tn.borderColors),l.push(...tn.backgroundColors);for(let R=h.length;R>=0;R--)((z=h[R])==null?void 0:z.length)===0&&(o.splice(R,1),h.splice(R,1),u.splice(R,1),l.splice(R,1));let p=t.multiAnswer;o.length>9&&(p=!0);const y={type:i.chartType??(p?"bar":"doughnut"),data:{labels:o,datasets:[{data:h.map(R=>R.length),backgroundColor:l,borderColor:u,borderWidth:1,label:void 0}]},options:{plugins:{legend:{display:!p}}}},k=new $d(y).SetClass((i==null?void 0:i.chartclasses)??"w-32 h-32");i.chartstyle!==void 0&&k.SetStyle(i.chartstyle),super([i!=null&&i.includeTitle?t.question.Clone()??t.id:void 0,k]),this.SetClass("block")}static extractDataAndLabels(e,t,i){var j;const o=e.mappings??[];i=i??{};let h=[];const u=o.map(H=>[]),l={};let p=[];for(const H of t){const X=H.properties;if(e.condition!==void 0&&!e.condition.matchesProperties(X)){p.push(H);continue}if(!e.IsKnown(X)){h.push(H);continue}let re=!1;if(e.multiAnswer)for(let W=0;W<o.length;W++){const ae=o[W];Mr.MatchesMultiAnswer(ae.if,X)&&(u[W].push(H),re=!0)}else for(let W=0;W<o.length;W++)if(o[W].if.matchesProperties(X)){u[W].push(H),re=!0;break}if(!re)if(((j=e.freeform)==null?void 0:j.key)!==void 0&&X[e.freeform.key]!==void 0){const W=X[e.freeform.key];l[W]=l[W]??[],l[W].push(H)}else h.push(H)}if(h.length+p.length===t.length)return console.log("Returning no label nor data: all features are unkown or notApplicable"),{labels:void 0,data:void 0};let y=[];const k=[],C=[],S=[];for(const H in l)S.push([H,l[H]]);i!=null&&i.sort&&S.sort((H,X)=>X[1].length-H[1].length);for(const[H,X]of S)X.length>=(i.groupToOtherCutoff??3)?(k.push(H),C.push(l[H])):y.push(...X);const z=[],R=[];return i.hideUnkown||(R.push(h),z.push("Unknown")),R.push(y),z.push("Other"),i.hideNotApplicable||(R.push(p),z.push("Not applicable")),R.push(...u,...C),z.push(...(o==null?void 0:o.map(H=>H.then.txt))??[],...k),{labels:z,data:R}}}function $y(n,e,t){const i=n.slice();return i[9]=e[t],i}function Gy(n){let e;return{c(){e=et("div"),e.textContent="/",ie(e,"class","bold px-2")},m(t,i){qe(t,e,i)},d(t){t&&je(e)}}}function AT(n){let e,t;return e=new mn({props:{t:n[9].human.Subs({quantity:""})}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&1&&(h.t=i[9].human.Subs({quantity:""})),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function ET(n){let e,t;return e=new mn({props:{t:n[9].humanSingular}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&1&&(h.t=i[9].humanSingular),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function Xy(n,e){let t,i,o,h,u,l;const p=[ET,AT],y=[];function k(C,S){return C[3]||C[0].inverted?0:1}return i=k(e),o=y[i]=p[i](e),{key:n,first:null,c(){t=et("option"),o.c(),h=xt(),t.__value=u=e[9].canonical,t.value=t.__value,this.first=t},m(C,S){qe(C,t,S),y[i].m(t,null),ue(t,h),l=!0},p(C,S){e=C;let z=i;i=k(e),i===z?y[i].p(e,S):(oi(),Ce(y[z],1,1,()=>{y[z]=null}),ai(),o=y[i],o?o.p(e,S):(o=y[i]=p[i](e),o.c()),we(o,1),o.m(t,h)),(!l||S&1&&u!==(u=e[9].canonical))&&(t.__value=u,t.value=t.__value)},i(C){l||(we(o),l=!0)},o(C){Ce(o),l=!1},d(C){C&&je(t),y[i].d()}}}function zT(n){let e,t,i=[],o=new Map,h,u,l,p=n[0].inverted&&Gy(),y=n[0].denominations;const k=C=>C[9].canonical;for(let C=0;C<y.length;C+=1){let S=$y(n,y,C),z=k(S);o.set(z,i[C]=Xy(z,S))}return{c(){p&&p.c(),e=xt(),t=et("select");for(let C=0;C<i.length;C+=1)i[C].c();n[2]===void 0&&Id(()=>n[8].call(t))},m(C,S){p&&p.m(C,S),qe(C,e,S),qe(C,t,S);for(let z=0;z<i.length;z+=1)i[z]&&i[z].m(t,null);Qo(t,n[2],!0),h=!0,u||(l=Je(t,"change",n[8]),u=!0)},p(C,[S]){C[0].inverted?p||(p=Gy(),p.c(),p.m(e.parentNode,e)):p&&(p.d(1),p=null),S&9&&(y=C[0].denominations,oi(),i=B0(i,S,k,1,C,y,o,t,O0,Xy,null,$y),ai()),S&5&&Qo(t,C[2])},i(C){if(!h){for(let S=0;S<y.length;S+=1)we(i[S]);h=!0}},o(C){for(let S=0;S<i.length;S+=1)Ce(i[S]);h=!1},d(C){p&&p.d(C),C&&je(e),C&&je(t);for(let S=0;S<i.length;S+=1)i[S].d();u=!1,l()}}}function DT(n,e,t){let i,o=St,h=()=>(o(),o=vo(C,R=>t(2,i=R)),C),u;n.$$.on_destroy.push(()=>o());let{unit:l}=e,{textValue:p}=e,{upstreamValue:y}=e,k=p.map(R=>Number(R)===1);pn(n,k,R=>t(3,u=R));let{selectedUnit:C=new Tt(void 0)}=e;h();let{getCountry:S=()=>"?"}=e;Td(()=>{if(console.log("Setting selected unit based on country",S(),y.data),y.data===void 0||y.data===""){let R=l.getDefaultDenomination(S);console.log("Found denom",R.canonical),C.setData(R.canonical)}}),rr(y.addCallbackAndRun(R=>{if(R===void 0||R==="")return;let j=l.getDefaultDenomination(S);const H=l.findDenomination(R,S);H&&(j=H[1]),C.setData(j.canonical)})),rr(p.addCallbackAndRunD(R=>{const[j,H]=l.findDenomination(R,S);j===void 0||H===void 0||j!==R&&(p.setData(j),C.setData(H.canonical))}));function z(){i=Ad(this),C.set(i),t(0,l)}return n.$$set=R=>{"unit"in R&&t(0,l=R.unit),"textValue"in R&&t(5,p=R.textValue),"upstreamValue"in R&&t(6,y=R.upstreamValue),"selectedUnit"in R&&h(t(1,C=R.selectedUnit)),"getCountry"in R&&t(7,S=R.getCountry)},[l,C,i,u,k,p,y,S,z]}class LT extends Gt{constructor(e){super(),Xt(this,e,DT,zT,Kt,{unit:0,textValue:5,upstreamValue:6,selectedUnit:1,getCountry:7})}}function RT(n){let e,t,i,o,h,u,l,p,y,k=!n[9]&&Ky(),C=n[2]!==void 0&&Yy(n);return{c(){var S;e=et("div"),t=et("input"),o=xt(),k&&k.c(),h=xt(),C&&C.c(),ie(t,"class","w-full"),ie(t,"inputmode",i=((S=n[5])==null?void 0:S.inputmode)??"text"),ie(t,"placeholder",n[7]),ie(e,"class",u=Fl("inline-flex",n[0]))},m(S,z){qe(S,e,z),ue(e,t),n[19](t),qr(t,n[8]),ue(e,o),k&&k.m(e,null),ue(e,h),C&&C.m(e,null),l=!0,p||(y=[Je(t,"input",n[20]),Je(t,"keypress",n[11])],p=!0)},p(S,z){var R;(!l||z&32&&i!==(i=((R=S[5])==null?void 0:R.inputmode)??"text"))&&ie(t,"inputmode",i),(!l||z&128)&&ie(t,"placeholder",S[7]),z&256&&t.value!==S[8]&&qr(t,S[8]),S[9]?k&&(oi(),Ce(k,1,1,()=>{k=null}),ai()):k?z&512&&we(k,1):(k=Ky(),k.c(),we(k,1),k.m(e,h)),S[2]!==void 0?C?(C.p(S,z),z&4&&we(C,1)):(C=Yy(S),C.c(),we(C,1),C.m(e,null)):C&&(oi(),Ce(C,1,1,()=>{C=null}),ai()),(!l||z&1&&u!==(u=Fl("inline-flex",S[0])))&&ie(e,"class",u)},i(S){l||(we(k),we(C),l=!0)},o(S){Ce(k),Ce(C),l=!1},d(S){S&&je(e),n[19](null),k&&k.d(),C&&C.d(),p=!1,es(y)}}}function FT(n){let e,t,i,o;return{c(){var h;e=et("textarea"),ie(e,"class","w-full"),ie(e,"inputmode",t=((h=n[5])==null?void 0:h.inputmode)??"text"),ie(e,"placeholder",n[7])},m(h,u){qe(h,e,u),qr(e,n[8]),n[18](e),i||(o=[Je(e,"input",n[17]),Je(e,"keypress",n[11])],i=!0)},p(h,u){var l;u&32&&t!==(t=((l=h[5])==null?void 0:l.inputmode)??"text")&&ie(e,"inputmode",t),u&128&&ie(e,"placeholder",h[7]),u&256&&qr(e,h[8])},i:St,o:St,d(h){h&&je(e),n[18](null),i=!1,es(o)}}}function Ky(n){let e,t;return e=new Dv({props:{class:"-ml-6 h-6 w-6"}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function Yy(n){let e,t;return e=new LT({props:{unit:n[2],selectedUnit:n[10],textValue:n[4],upstreamValue:n[3],getCountry:n[1]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&4&&(h.unit=i[2]),o&16&&(h.textValue=i[4]),o&8&&(h.upstreamValue=i[3]),o&2&&(h.getCountry=i[1]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function BT(n){let e,t,i,o;const h=[FT,RT],u=[];function l(p,y){var k;return(k=p[5])!=null&&k.textArea?0:1}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,[y]){let k=e;e=l(p),e===k?u[e].p(p,y):(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai(),t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i))},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function OT(n,e,t){let i,o=St,h=()=>(o(),o=vo(j,Oe=>t(8,i=Oe)),j),u;n.$$.on_destroy.push(()=>o());let{type:l}=e,{feedback:p=void 0}=e,{cls:y=void 0}=e,{getCountry:k=void 0}=e,{placeholder:C=void 0}=e,{autofocus:S=!1}=e,{unit:z=void 0}=e,{value:R}=e,{unvalidatedText:j=new Tt(R.data??"")}=e;if(h(),j==R)throw"Value and unvalidatedText may not be the same store!";let H=Qf.get(l??"string");H===void 0&&console.warn("Didn't find a validator for type",l);let X=new Tt(void 0),re=C??(H==null?void 0:H.getPlaceholder())??l;function W(){if(z&&R.data){const[Oe,It]=z==null?void 0:z.findDenomination(R.data,k);It?(j.setData(Oe),X.setData(It.canonical)):j.setData(R.data??"")}else j.setData(R.data??"")}function ae(Oe){Oe.key==="Enter"&&(!H.textArea||Oe.ctrlKey)&&(Oe.stopPropagation(),Oe.preventDefault(),pe("submit"))}W();function de(){const Oe=j.data;if(Oe===""){R.setData(void 0),p==null||p.setData(void 0);return}if(p==null||p.setData(H==null?void 0:H.getFeedback(Oe,k)),!(H!=null&&H.isValid(Oe,k))){R.setData(void 0);return}X.data?R.setData(z.toOsm(Oe,X.data)):R.setData(Oe)}if(rr(j.addCallbackAndRun(Oe=>de())),z===void 0&&rr(R.addCallbackAndRunD(Oe=>{j.data!==Oe&&Oe!==""&&j.setData(Oe)})),rr(X.addCallback(Oe=>de())),H===void 0)throw"Not a valid type (no validator found) for type '"+l+"'; did you perhaps mean one of: "+Ni.sortedByLevenshteinDistance(l,Qf.AllValidators.map(Oe=>Oe.name),Oe=>Oe).slice(0,5).join(", ");const Ae=j.map(Oe=>(H==null?void 0:H.isValid(Oe,k))??!0);pn(n,Ae,Oe=>t(9,u=Oe));let xe,pe=Pd();function ke(){i=this.value,j.set(i)}function Ie(Oe){xo[Oe?"unshift":"push"](()=>{xe=Oe,t(6,xe),t(23,pe),t(16,S)})}function Ve(Oe){xo[Oe?"unshift":"push"](()=>{xe=Oe,t(6,xe),t(23,pe),t(16,S)})}function We(){i=this.value,j.set(i)}return n.$$set=Oe=>{"type"in Oe&&t(13,l=Oe.type),"feedback"in Oe&&t(14,p=Oe.feedback),"cls"in Oe&&t(0,y=Oe.cls),"getCountry"in Oe&&t(1,k=Oe.getCountry),"placeholder"in Oe&&t(15,C=Oe.placeholder),"autofocus"in Oe&&t(16,S=Oe.autofocus),"unit"in Oe&&t(2,z=Oe.unit),"value"in Oe&&t(3,R=Oe.value),"unvalidatedText"in Oe&&h(t(4,j=Oe.unvalidatedText))},n.$$.update=()=>{var Oe;n.$$.dirty&57394&&(t(5,H=Qf.get(l??"string")),t(7,re=C??(H==null?void 0:H.getPlaceholder())??l),((Oe=j.data)==null?void 0:Oe.length)>0?p==null||p.setData(H==null?void 0:H.getFeedback(j.data,k)):p==null||p.setData(void 0),W()),n.$$.dirty&65600&&xe!==void 0&&(t(6,xe.onfocus=()=>pe("selected"),xe),S&&Ni.focusOn(xe))},[y,k,z,R,j,H,xe,re,i,u,X,ae,Ae,l,p,C,S,ke,Ie,Ve,We]}class Np extends Gt{constructor(e){super(),Xt(this,e,OT,BT,Kt,{type:13,feedback:14,cls:0,getCountry:1,placeholder:15,autofocus:16,unit:2,value:3,unvalidatedText:4})}}class Up{static constructMapProperties(e){var h,u;let t=(h=e==null?void 0:e.mapProperties)==null?void 0:h.location;if(!t){const[l,p]=L0.centerpointCoordinates(e.feature);t=new Tt({lon:l,lat:p})}let i=(e==null?void 0:e.mapProperties)??{location:t};i.location||(i={...i,location:t});let o=17;if(((u=e==null?void 0:e.args)==null?void 0:u[0])!==void 0&&(o=Number(e.args[0]),isNaN(o)))throw"Invalid zoom level for argument at 'length'-input";return i.zoom||(i={...i,zoom:new Tt(o)}),i.rasterLayer,i}}Ge(Up,"hideInputField",["translation","simple_tag","tag"]);function VT(n){let e,t;return{c(){e=et("img"),yp(e.src,t=n[1])||ie(e,"src",t)},m(i,o){qe(i,e,o)},p(i,[o]){o&2&&!yp(e.src,t=i[1])&&ie(e,"src",t)},i:St,o:St,d(i){i&&je(e)}}}function NT(n,e,t){let i,o=St,h=()=>(o(),o=vo(u,l=>t(1,i=l)),u);n.$$.on_destroy.push(()=>o());let{value:u}=e;return h(),n.$$set=l=>{"value"in l&&h(t(0,u=l.value))},[u,i]}class UT extends Gt{constructor(e){super(),Xt(this,e,NT,VT,Kt,{value:0})}}function Jy(n,e,t){const i=n.slice();return i[16]=e[t],i}function Qy(n,e,t){const i=n.slice();return i[19]=e[t],i}function e0(n){let e;return{c(){e=Si("*")},m(t,i){qe(t,e,i)},d(t){t&&je(e)}}}function t0(n){var l;let e,t=n[19]+"",i,o,h,u=((l=n[2])==null?void 0:l[n[19]])!==void 0&&e0();return{c(){e=et("option"),i=Si(t),o=xt(),u&&u.c(),h=xt(),e.__value=n[19],e.value=e.__value},m(p,y){qe(p,e,y),ue(e,i),ue(e,o),u&&u.m(e,null),ue(e,h)},p(p,y){var k;((k=p[2])==null?void 0:k[p[19]])!==void 0?u||(u=e0(),u.c(),u.m(e,h)):u&&(u.d(1),u=null)},d(p){p&&je(e),u&&u.d()}}}function i0(n){let e,t,i,o=n[16]+"",h,u,l,p=n[2][n[16]]+"",y,k,C,S;function z(){return n[14](n[16])}return{c(){e=et("li"),t=et("button"),i=et("b"),h=Si(o),u=Si(":"),l=xt(),y=Si(p),k=xt(),ie(t,"class","small")},m(R,j){qe(R,e,j),ue(e,t),ue(t,i),ue(i,h),ue(i,u),ue(t,l),ue(t,y),ue(e,k),C||(S=Je(t,"click",z),C=!0)},p(R,j){n=R,j&4&&o!==(o=n[16]+"")&&zs(h,o),j&4&&p!==(p=n[2][n[16]]+"")&&zs(y,p)},d(R){R&&je(e),C=!1,S()}}}function jT(n){let e,t,i,o,h,u,l,p,y,k,C,S,z,R,j=n[5],H=[];for(let W=0;W<j.length;W+=1)H[W]=t0(Qy(n,j,W));l=new Np({props:{type:"string",cls:"w-full",value:n[7],unvalidatedText:n[8]}}),l.$on("submit",n[13]);let X=Object.keys(n[2]),re=[];for(let W=0;W<X.length;W+=1)re[W]=i0(Jy(n,X,W));return{c(){e=et("div"),t=et("div"),i=et("span"),i.textContent=`${n[3]}`,o=xt(),h=et("select");for(let W=0;W<H.length;W+=1)H[W].c();u=xt(),lt(l.$$.fragment),p=xt(),y=et("span"),y.textContent=`${n[4]}`,k=Si(`
  You have currently set translations for
  `),C=et("ul");for(let W=0;W<re.length;W+=1)re[W].c();n[1]===void 0&&Id(()=>n[12].call(h)),ie(t,"class","interactive m-1 mt-2 flex space-x-1 font-bold"),ie(e,"class","flex flex-col gap-y-1")},m(W,ae){qe(W,e,ae),ue(e,t),ue(t,i),ue(t,o),ue(t,h);for(let de=0;de<H.length;de+=1)H[de]&&H[de].m(h,null);Qo(h,n[1],!0),ue(t,u),ct(l,t,null),ue(t,p),ue(t,y),ue(e,k),ue(e,C);for(let de=0;de<re.length;de+=1)re[de]&&re[de].m(C,null);S=!0,z||(R=Je(h,"change",n[12]),z=!0)},p(W,[ae]){if(ae&36){j=W[5];let de;for(de=0;de<j.length;de+=1){const Ae=Qy(W,j,de);H[de]?H[de].p(Ae,ae):(H[de]=t0(Ae),H[de].c(),H[de].m(h,null))}for(;de<H.length;de+=1)H[de].d(1);H.length=j.length}if(ae&34&&Qo(h,W[1]),ae&68){X=Object.keys(W[2]);let de;for(de=0;de<X.length;de+=1){const Ae=Jy(W,X,de);re[de]?re[de].p(Ae,ae):(re[de]=i0(Ae),re[de].c(),re[de].m(C,null))}for(;de<re.length;de+=1)re[de].d(1);re.length=X.length}},i(W){S||(we(l.$$.fragment,W),S=!0)},o(W){Ce(l.$$.fragment,W),S=!1},d(W){W&&je(e),Fa(H,W),ht(l),Fa(re,W),z=!1,R()}}}function qT(n,e,t){let i,o,{value:h=new Tt({})}=e,{args:u=[]}=e,l=u[0]??"",p=u[1]??"",y=h;pn(n,y,W=>t(2,o=W));const k=bv.usedLanguagesSorted;let C=new Tt("en");pn(n,C,W=>t(1,i=W));const S=new Tt(""),z=new Tt("");let R=Pd();function j(){let W=z.data;const ae=C.data;if(console.log("Updating translation input for value",W," and language",ae),(y.data===""||y.data===void 0)&&t(0,y.data={},y),W===""){delete y.data[ae],y.ping();return}y.data[ae]!==W&&(t(0,y.data[ae]=W,y),y.ping())}rr(C.addCallbackAndRunD(W=>{y.data||t(0,y.data={},y),t(0,y.data[W]=y.data[W]??"",y),y.data[W]===""&&delete y.data[W],S.setData(y.data[W]??""),z.setData(y.data[W])})),rr(z.addCallbackAndRunD(()=>{j()}));function H(){i=Ad(this),C.set(i),t(5,k)}const X=()=>R("submit"),re=W=>C.setData(W);return n.$$set=W=>{"value"in W&&t(10,h=W.value),"args"in W&&t(11,u=W.args)},[y,i,o,l,p,k,C,S,z,R,h,u,H,X,re]}class HT extends Gt{constructor(e){super(),Xt(this,e,qT,jT,Kt,{value:10,args:11})}}const Ns=class Ns{constructor(e="https://taginfo.openstreetmap.org/"){Ge(this,"_backend");this._backend=e}async getStats(e,t){let i;return t?i=`${this._backend}api/4/tag/stats?key=${encodeURIComponent(e)}&value=${encodeURIComponent(t)}`:i=`${this._backend}api/4/key/stats?key=${encodeURIComponent(e)}`,await Ni.downloadJsonCached(i,1e3*60*60)}webUrl(e,t){return t?`${this._backend}/tags/${e}=${t}#overview`:`${this._backend}/keys/${e}#overview`}static async geofabrikCountries(){if(Ns._geofabrikCountries)return Ns._geofabrikCountries;const e=await Ni.downloadJsonCached("https://download.geofabrik.de/index-v1-nogeom.json",24*1e3*60*60);return Ns._geofabrikCountries=e.features.map(t=>t.properties),Ns._geofabrikCountries}static async getInstanceFor(e){const t=await this.geofabrikCountries();e=e.toUpperCase();const i=t.find(h=>{var u;return((u=h["iso3166-1:alpha2"])==null?void 0:u.indexOf(e))>=0});if(!i||!(i!=null&&i.parent)||!(i!=null&&i.id))return;const o=`https://taginfo.geofabrik.de/${i.parent}:${i.id}/`;return new Ns(o)}static async getDistributionsFor(e,t,i){if(!e)return;const o=await Ns.getInstanceFor(e);if(o)try{return await o.getStats(t,i)}catch(h){console.warn("Could not fetch info for",e,t,i,"due to",h);return}}static async getGlobalDistributionsFor(e,t){const o=(await this.geofabrikCountries()).map(l=>{var p;return(p=l["iso3166-1:alpha2"])==null?void 0:p[0]}).filter(l=>!!l&&Ns.blacklist.indexOf(l)<0),h={},u=await Promise.all(o.map(l=>Ns.getDistributionsFor(l,e,t)));for(let l=0;l<o.length;l++){const p=o[l];u[l]&&(h[p]=u[l])}return h}};Ge(Ns,"global",new Ns),Ge(Ns,"_geofabrikCountries"),Ge(Ns,"blacklist",["VI","GF","PR"]);let yd=Ns;function WT(n){let e,t,i,o,h,u;return{c(){e=et("a"),t=Si(n[5]),i=Si(` features have
    `),o=et("span"),h=Si(n[3]),ie(o,"class","literal-code"),ie(e,"href",n[6]),ie(e,"target","_blank"),ie(e,"class",u=Fl(n[5]<250?"alert":"thanks","link-underline w-fit"))},m(l,p){qe(l,e,p),ue(e,t),ue(e,i),ue(e,o),ue(o,h)},p(l,p){p&32&&zs(t,l[5]),p&8&&zs(h,l[3]),p&64&&ie(e,"href",l[6]),p&32&&u!==(u=Fl(l[5]<250?"alert":"thanks","link-underline w-fit"))&&ie(e,"class",u)},i:St,o:St,d(l){l&&je(e)}}}function ZT(n){let e,t,i=!n[0]&&n0();return{c(){i&&i.c(),e=Di()},m(o,h){i&&i.m(o,h),qe(o,e,h),t=!0},p(o,h){o[0]?i&&(oi(),Ce(i,1,1,()=>{i=null}),ai()):i?h&1&&we(i,1):(i=n0(),i.c(),we(i,1),i.m(e.parentNode,e))},i(o){t||(we(i),t=!0)},o(o){Ce(i),t=!1},d(o){i&&i.d(o),o&&je(e)}}}function n0(n){let e,t;return e=new Wp({}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function $T(n){let e,t,i,o;const h=[ZT,WT],u=[];function l(p,y){return p[2]!==p[3]?0:p[4]&&(!p[0]||p[5]<250)?1:-1}return~(e=l(n))&&(t=u[e]=h[e](n)),{c(){t&&t.c(),i=Di()},m(p,y){~e&&u[e].m(p,y),qe(p,i,y),o=!0},p(p,[y]){let k=e;e=l(p),e===k?~e&&u[e].p(p,y):(t&&(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai()),~e?(t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i)):t=null)},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){~e&&u[e].d(p),p&&je(i)}}}function GT(n,e,t){let i,o,h=St,u=()=>(h(),h=vo(C,H=>t(3,o=H)),C),l,p,y;n.$$.on_destroy.push(()=>h());let{silent:k=!1}=e,{tag:C}=e;u();const S=C.stabilized(500);pn(n,S,H=>t(2,i=H));const z=S.bind(H=>{if(H)try{const X=Mr.Tag(H),re=X.key;let W=X.value;return typeof W!="string"&&(W=void 0),re?Tt.FromPromise(yd.global.getStats(re,W)):void 0}catch{return}});pn(n,z,H=>t(4,l=H));const R=S.mapD(H=>{try{const X=Mr.Tag(H),re=X.key;let W=X.value;return typeof W!="string"&&(W=void 0),re?yd.global.webUrl(re,W):void 0}catch{return}});pn(n,R,H=>t(6,y=H));const j=z.mapD(H=>H.data.find(X=>X.type==="all").count);return pn(n,j,H=>t(5,p=H)),n.$$set=H=>{"silent"in H&&t(0,k=H.silent),"tag"in H&&u(t(1,C=H.tag))},[k,C,i,o,l,p,y,S,z,R,j]}class XT extends Gt{constructor(e){super(),Xt(this,e,GT,$T,Kt,{silent:0,tag:1})}}function s0(n,e,t){const i=n.slice();return i[22]=e[t],i}function r0(n){let e,t=n[22]+"",i,o;return{c(){e=et("option"),i=Si(t),o=xt(),e.__value=n[22],e.value=e.__value},m(h,u){qe(h,e,u),ue(e,i),ue(e,o)},p:St,d(h){h&&je(e)}}}function KT(n){let e,t;return e=new mn({props:{cls:"alert",t:n[6]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&64&&(h.t=i[6]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function YT(n){let e,t;return e=new mn({props:{cls:"alert",t:n[5]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&32&&(h.t=i[5]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function JT(n){let e,t;return e=new mn({props:{cls:"alert",t:n[4]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&16&&(h.t=i[4]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function QT(n){let e,t,i,o,h,u,l,p,y,k,C,S,z,R,j,H,X,re;i=new Np({props:{feedback:n[8],placeholder:"The key of the tag",type:"key",value:n[9],autofocus:!0}}),i.$on("submit",n[16]);let W=n[12],ae=[];for(let pe=0;pe<W.length;pe+=1)ae[pe]=r0(s0(n,W,pe));l=new Np({props:{feedback:n[10],placeholder:"The value of the tag",type:"string",value:n[11]}}),l.$on("submit",n[20]),k=new y2({props:{class:"h-6 w-6"}});const de=[JT,YT,KT],Ae=[];function xe(pe,ke){return pe[4]?0:pe[5]?1:pe[6]?2:-1}return~(S=xe(n))&&(z=Ae[S]=de[S](n)),j=new XT({props:{silent:n[3],tag:n[1]}}),{c(){e=et("div"),t=et("div"),lt(i.$$.fragment),o=xt(),h=et("select");for(let pe=0;pe<ae.length;pe+=1)ae[pe].c();u=xt(),lt(l.$$.fragment),p=xt(),y=et("a"),lt(k.$$.fragment),C=xt(),z&&z.c(),R=xt(),lt(j.$$.fragment),n[0]===void 0&&Id(()=>n[17].call(h)),ie(t,"class","flex h-fit"),ie(y,"target","_blank"),ie(y,"href","https://github.com/pietervdvn/MapComplete/blob/develop/Docs/Tags_format.md"),ie(e,"class","flex items-center")},m(pe,ke){qe(pe,e,ke),ue(e,t),ct(i,t,null),ue(t,o),ue(t,h);for(let Ie=0;Ie<ae.length;Ie+=1)ae[Ie]&&ae[Ie].m(h,null);Qo(h,n[0],!0),ue(t,u),ct(l,t,null),ue(e,p),ue(e,y),ct(k,y,null),ue(e,C),~S&&Ae[S].m(e,null),ue(e,R),ct(j,e,null),H=!0,X||(re=[Je(h,"change",n[17]),Je(h,"focusin",n[18]),Je(h,"focusout",n[19])],X=!0)},p(pe,[ke]){if(ke&4096){W=pe[12];let We;for(We=0;We<W.length;We+=1){const Oe=s0(pe,W,We);ae[We]?ae[We].p(Oe,ke):(ae[We]=r0(Oe),ae[We].c(),ae[We].m(h,null))}for(;We<ae.length;We+=1)ae[We].d(1);ae.length=W.length}ke&4097&&Qo(h,pe[0]);let Ie=S;S=xe(pe),S===Ie?~S&&Ae[S].p(pe,ke):(z&&(oi(),Ce(Ae[Ie],1,1,()=>{Ae[Ie]=null}),ai()),~S?(z=Ae[S],z?z.p(pe,ke):(z=Ae[S]=de[S](pe),z.c()),we(z,1),z.m(e,R)):z=null);const Ve={};ke&8&&(Ve.silent=pe[3]),ke&2&&(Ve.tag=pe[1]),j.$set(Ve)},i(pe){H||(we(i.$$.fragment,pe),we(l.$$.fragment,pe),we(k.$$.fragment,pe),we(z),we(j.$$.fragment,pe),H=!0)},o(pe){Ce(i.$$.fragment,pe),Ce(l.$$.fragment,pe),Ce(k.$$.fragment,pe),Ce(z),Ce(j.$$.fragment,pe),H=!1},d(pe){pe&&je(e),ht(i),Fa(ae,pe),ht(l),ht(k),~S&&Ae[S].d(),ht(j),X=!1,es(re)}}}function eM(n,e,t){let i,o,h,{tag:u=new Tt(void 0)}=e,{uploadableOnly:l}=e,{overpassSupportNeeded:p}=e,{dropdownFocussed:y=new Tt(!1)}=e,{silent:k=!1}=e,{selected:C=new Tt(!1)}=e,S=u.map(ke=>{if(ke)try{Mr.Tag(ke);return}catch(Ie){return Ie}});pn(n,S,ke=>t(6,h=ke));let z=new Tt(void 0);pn(n,z,ke=>t(4,i=ke));let R=new Tt(void 0),j=new Tt(void 0);pn(n,j,ke=>t(5,o=ke));let H=new Tt(void 0),{mode:X="="}=e,re=[];for(const ke in Mr.modeDocumentation){const Ie=Mr.modeDocumentation[ke];p&&!Ie.overpassSupport||l&&!Ie.uploadable||re.push(ke)}if(!l&&!p&&re.push(...Mr.comparators.map(ke=>ke[0])),u.data){const ke=[...re];ke.sort((Ve,We)=>We.length-Ve.length);const Ie=u.data;console.log(Ie);for(const Ve of ke)if(Ie.indexOf(Ve)>=0){const[We,Oe]=Ie.split(Ve);R.setData(We),H.setData(Oe),X=Ve;break}}rr(H.addCallbackAndRun(W)),rr(R.addCallbackAndRun(W));function W(ke){const Ie=R.data,Ve=H.data??"";if(Ie===void 0||Ie===""){u.setData(void 0);return}const We=Ie+X+Ve;try{Mr.Tag(We),u.setData(We)}catch{u.setData(void 0)}}function ae(ke){_t.call(this,n,ke)}function de(){X=Ad(this),t(0,X),t(12,re)}const Ae=()=>y.setData(!0),xe=()=>y.setData(!1);function pe(ke){_t.call(this,n,ke)}return n.$$set=ke=>{"tag"in ke&&t(1,u=ke.tag),"uploadableOnly"in ke&&t(13,l=ke.uploadableOnly),"overpassSupportNeeded"in ke&&t(14,p=ke.overpassSupportNeeded),"dropdownFocussed"in ke&&t(2,y=ke.dropdownFocussed),"silent"in ke&&t(3,k=ke.silent),"selected"in ke&&t(15,C=ke.selected),"mode"in ke&&t(0,X=ke.mode)},n.$$.update=()=>{n.$$.dirty&1&&W()},[X,u,y,k,i,o,h,S,z,R,j,H,re,l,p,C,ae,de,Ae,xe,pe]}class hb extends Gt{constructor(e){super(),Xt(this,e,eM,QT,Kt,{tag:1,uploadableOnly:13,overpassSupportNeeded:14,dropdownFocussed:2,silent:3,selected:15,mode:0})}}const tM=n=>({}),o0=n=>({});function a0(n,e,t){const i=n.slice();return i[24]=e[t],i}function l0(n,e,t){const i=n.slice();return i[27]=e[t],i}function c0(n){let e,t,i,o,h;return{c(){e=et("select"),t=et("option"),t.textContent="and",i=et("option"),i.textContent="or",t.__value="and",t.value=t.__value,i.__value="or",i.value=i.__value,n[3]===void 0&&Id(()=>n[14].call(e))},m(u,l){qe(u,e,l),ue(e,t),ue(e,i),Qo(e,n[3],!0),o||(h=Je(e,"change",n[14]),o=!0)},p(u,l){l&8&&Qo(e,u[3])},d(u){u&&je(e),o=!1,h()}}}function h0(n){let e,t,i,o,h;t=new N0({props:{class:"h-4 w-4 p-1"}});function u(){return n[16](n[27])}return{c(){e=et("button"),lt(t.$$.fragment),ie(e,"class","h-fit w-fit rounded-full border border-black p-0")},m(l,p){qe(l,e,p),ct(t,e,null),i=!0,o||(h=Je(e,"click",u),o=!0)},p(l,p){n=l},i(l){i||(we(t.$$.fragment,l),i=!0)},o(l){Ce(t.$$.fragment,l),i=!1},d(l){l&&je(e),ht(t),o=!1,h()}}}function u0(n,e){let t,i,o,h;i=new hb({props:{silent:e[2],overpassSupportNeeded:e[1],uploadableOnly:e[0],tag:e[27]}}),i.$on("submit",e[15]);let u=e[4].length+e[5].length>1&&h0(e);return{key:n,first:null,c(){t=et("div"),lt(i.$$.fragment),o=xt(),u&&u.c(),ie(t,"class","flex"),this.first=t},m(l,p){qe(l,t,p),ct(i,t,null),ue(t,o),u&&u.m(t,null),h=!0},p(l,p){e=l;const y={};p&4&&(y.silent=e[2]),p&2&&(y.overpassSupportNeeded=e[1]),p&1&&(y.uploadableOnly=e[0]),p&16&&(y.tag=e[27]),i.$set(y),e[4].length+e[5].length>1?u?(u.p(e,p),p&48&&we(u,1)):(u=h0(e),u.c(),we(u,1),u.m(t,null)):u&&(oi(),Ce(u,1,1,()=>{u=null}),ai())},i(l){h||(we(i.$$.fragment,l),we(u),h=!0)},o(l){Ce(i.$$.fragment,l),Ce(u),h=!1},d(l){l&&je(t),ht(i),u&&u.d()}}}function iM(n){let e,t,i,o,h,u;t=new N0({props:{class:"h-3 w-3 p-0"}});function l(){return n[17](n[24])}return{c(){e=et("button"),lt(t.$$.fragment),i=Si(`
          Delete subexpression`),ie(e,"class","small"),ie(e,"slot","delete")},m(p,y){qe(p,e,y),ct(t,e,null),ue(e,i),o=!0,h||(u=Je(e,"click",l),h=!0)},p(p,y){n=p},i(p){o||(we(t.$$.fragment,p),o=!0)},o(p){Ce(t.$$.fragment,p),o=!1},d(p){p&&je(e),ht(t),h=!1,u()}}}function d0(n){let e,t;return e=new ub({props:{silent:n[2],overpassSupportNeeded:n[1],uploadableOnly:n[0],tag:n[24],$$slots:{delete:[iM]},$$scope:{ctx:n}}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&4&&(h.silent=i[2]),o&2&&(h.overpassSupportNeeded=i[1]),o&1&&(h.uploadableOnly=i[0]),o&32&&(h.tag=i[24]),o&1048608&&(h.$$scope={dirty:o,ctx:i}),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function f0(n){let e,t,i;return{c(){e=et("button"),e.textContent="Add an expression",ie(e,"class","small w-fit")},m(o,h){qe(o,e,h),t||(i=Je(e,"click",n[19]),t=!0)},p:St,d(o){o&&je(e),t=!1,i()}}}function nM(n){let e,t,i,o=[],h=new Map,u,l,p,y,k,C,S,z,R,j=!n[0]&&c0(n),H=n[4];const X=pe=>pe[27];for(let pe=0;pe<H.length;pe+=1){let ke=l0(n,H,pe),Ie=X(ke);h.set(Ie,o[pe]=u0(Ie,ke))}let re=n[5],W=[];for(let pe=0;pe<re.length;pe+=1)W[pe]=d0(a0(n,re,pe));const ae=pe=>Ce(W[pe],1,1,()=>{W[pe]=null});let de=!n[0]&&f0(n);const Ae=n[13].delete,xe=jn(Ae,n,n[20],o0);return{c(){e=et("div"),j&&j.c(),t=xt(),i=et("div");for(let pe=0;pe<o.length;pe+=1)o[pe].c();u=xt();for(let pe=0;pe<W.length;pe+=1)W[pe].c();l=xt(),p=et("div"),y=et("button"),y.textContent="Add a tag",k=xt(),de&&de.c(),C=xt(),xe&&xe.c(),ie(y,"class","small w-fit"),ie(p,"class","flex"),ie(i,"class","ml-1 flex flex-col border-l-4 border-black pl-1"),ie(e,"class","flex items-center")},m(pe,ke){qe(pe,e,ke),j&&j.m(e,null),ue(e,t),ue(e,i);for(let Ie=0;Ie<o.length;Ie+=1)o[Ie]&&o[Ie].m(i,null);ue(i,u);for(let Ie=0;Ie<W.length;Ie+=1)W[Ie]&&W[Ie].m(i,null);ue(i,l),ue(i,p),ue(p,y),ue(p,k),de&&de.m(p,null),ue(p,C),xe&&xe.m(p,null),S=!0,z||(R=Je(y,"click",n[18]),z=!0)},p(pe,[ke]){if(pe[0]?j&&(j.d(1),j=null):j?j.p(pe,ke):(j=c0(pe),j.c(),j.m(e,t)),ke&567&&(H=pe[4],oi(),o=B0(o,ke,X,1,pe,H,h,i,O0,u0,u,l0),ai()),ke&1063){re=pe[5];let Ie;for(Ie=0;Ie<re.length;Ie+=1){const Ve=a0(pe,re,Ie);W[Ie]?(W[Ie].p(Ve,ke),we(W[Ie],1)):(W[Ie]=d0(Ve),W[Ie].c(),we(W[Ie],1),W[Ie].m(i,l))}for(oi(),Ie=re.length;Ie<W.length;Ie+=1)ae(Ie);ai()}pe[0]?de&&(de.d(1),de=null):de?de.p(pe,ke):(de=f0(pe),de.c(),de.m(p,C)),xe&&xe.p&&(!S||ke&1048576)&&qn(xe,Ae,pe,pe[20],S?Wn(Ae,pe[20],ke,tM):Hn(pe[20]),o0)},i(pe){if(!S){for(let ke=0;ke<H.length;ke+=1)we(o[ke]);for(let ke=0;ke<re.length;ke+=1)we(W[ke]);we(xe,pe),S=!0}},o(pe){for(let ke=0;ke<o.length;ke+=1)Ce(o[ke]);W=W.filter(Boolean);for(let ke=0;ke<W.length;ke+=1)Ce(W[ke]);Ce(xe,pe),S=!1},d(pe){pe&&je(e),j&&j.d();for(let ke=0;ke<o.length;ke+=1)o[ke].d();Fa(W,pe),de&&de.d(),xe&&xe.d(pe),z=!1,R()}}}function sM(n,e,t){let i,o,{$$slots:h={},$$scope:u}=e,{tag:l}=e,p="and",y=new Tt([]);pn(n,y,Ve=>t(4,i=Ve));let k=new Tt([]);pn(n,k,Ve=>t(5,o=Ve));let{uploadableOnly:C}=e,{overpassSupportNeeded:S}=e,{silent:z}=e;function R(Ve){let We={};if(!p)return;const Oe=[],It=y.data.concat(k.data);for(const mt of It){const Ft=mt.data;if(!Ft){l.setData(void 0);return}Oe.push(Ft)}Oe.length===1?l.setData(Oe[0]):(We[p]=Oe,l.setData(We))}function j(Ve){const We=new Tt(Ve);y.data.push(We),y.ping(),We.addCallbackAndRunD(Oe=>R())}function H(Ve){const We=y.data.indexOf(Ve);console.log("Removing",We,Ve),We>=0&&(Ve.setData(void 0),y.data.splice(We,1),y.ping())}function X(Ve){const We=k.data.indexOf(Ve);We>=0&&(Ve.setData(void 0),k.data.splice(We,1),k.ping())}function re(Ve){const We=new Tt(Ve);k.data.push(We),k.ping(),We.addCallbackAndRunD(Oe=>R())}k.addCallback(Ve=>R()),y.addCallback(Ve=>R());let W=l.data;function ae(Ve){if(typeof Ve=="string")if(Ve.startsWith("{"))Ve=JSON.parse(Ve);else{j(Ve);return}t(3,p=Object.keys(Ve)[0]);const We=Ve[p];if(!(!We||We.length==0)){if(We.length==1){ae(We[0]);return}for(const Oe of We)typeof Oe=="string"?j(Oe):re(Oe)}}W?ae(W):j();function de(){p=Ad(this),t(3,p)}function Ae(Ve){_t.call(this,n,Ve)}const xe=Ve=>H(Ve),pe=Ve=>X(Ve),ke=()=>j(),Ie=()=>re();return n.$$set=Ve=>{"tag"in Ve&&t(12,l=Ve.tag),"uploadableOnly"in Ve&&t(0,C=Ve.uploadableOnly),"overpassSupportNeeded"in Ve&&t(1,S=Ve.overpassSupportNeeded),"silent"in Ve&&t(2,z=Ve.silent),"$$scope"in Ve&&t(20,u=Ve.$$scope)},n.$$.update=()=>{n.$$.dirty&8&&R()},[C,S,z,p,i,o,y,k,j,H,X,re,l,h,de,Ae,xe,pe,ke,Ie,u]}class rM extends Gt{constructor(e){super(),Xt(this,e,sM,nM,Kt,{tag:12,uploadableOnly:0,overpassSupportNeeded:1,silent:2})}}const oM=n=>({}),p0=n=>({slot:"delete"});function aM(n){let e;const t=n[4].delete,i=jn(t,n,n[6],p0);return{c(){i&&i.c()},m(o,h){i&&i.m(o,h),e=!0},p(o,h){i&&i.p&&(!e||h&64)&&qn(i,t,o,o[6],e?Wn(t,o[6],h,oM):Hn(o[6]),p0)},i(o){e||(we(i,o),e=!0)},o(o){Ce(i,o),e=!1},d(o){i&&i.d(o)}}}function lM(n){let e,t,i;return t=new rM({props:{silent:n[3],overpassSupportNeeded:n[2],tag:n[0],uploadableOnly:n[1],$$slots:{delete:[aM]},$$scope:{ctx:n}}}),t.$on("submit",n[5]),{c(){e=et("div"),lt(t.$$.fragment),ie(e,"class","m-2")},m(o,h){qe(o,e,h),ct(t,e,null),i=!0},p(o,[h]){const u={};h&8&&(u.silent=o[3]),h&4&&(u.overpassSupportNeeded=o[2]),h&1&&(u.tag=o[0]),h&2&&(u.uploadableOnly=o[1]),h&64&&(u.$$scope={dirty:h,ctx:o}),t.$set(u)},i(o){i||(we(t.$$.fragment,o),i=!0)},o(o){Ce(t.$$.fragment,o),i=!1},d(o){o&&je(e),ht(t)}}}function cM(n,e,t){let{$$slots:i={},$$scope:o}=e,{tag:h}=e,{uploadableOnly:u}=e,{overpassSupportNeeded:l}=e,{silent:p}=e;function y(k){_t.call(this,n,k)}return n.$$set=k=>{"tag"in k&&t(0,h=k.tag),"uploadableOnly"in k&&t(1,u=k.uploadableOnly),"overpassSupportNeeded"in k&&t(2,l=k.overpassSupportNeeded),"silent"in k&&t(3,p=k.silent),"$$scope"in k&&t(6,o=k.$$scope)},[h,u,l,p,i,y,o]}class ub extends Gt{constructor(e){super(),Xt(this,e,cM,lM,Kt,{tag:0,uploadableOnly:1,overpassSupportNeeded:2,silent:3})}}function hM(n){let e,t;return e=new ub({props:{overpassSupportNeeded:n[1],silent:n[2],tag:n[3],uploadableOnly:n[0]}}),e.$on("submit",n[5]),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,[o]){const h={};o&2&&(h.overpassSupportNeeded=i[1]),o&4&&(h.silent=i[2]),o&1&&(h.uploadableOnly=i[0]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function uM(n,e,t){let{value:i}=e,{uploadableOnly:o}=e,{overpassSupportNeeded:h}=e,{silent:u=!1}=e,l=i;function p(y){_t.call(this,n,y)}return n.$$set=y=>{"value"in y&&t(4,i=y.value),"uploadableOnly"in y&&t(0,o=y.uploadableOnly),"overpassSupportNeeded"in y&&t(1,h=y.overpassSupportNeeded),"silent"in y&&t(2,u=y.silent)},[o,h,u,l,i,p]}class dM extends Gt{constructor(e){super(),Xt(this,e,uM,hM,Kt,{value:4,uploadableOnly:0,overpassSupportNeeded:1,silent:2})}}function gm(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Ua=gm();function db(n){Ua=n}const fb=/[&<>"']/,fM=new RegExp(fb.source,"g"),pb=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,pM=new RegExp(pb.source,"g"),mM={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},m0=n=>mM[n];function nr(n,e){if(e){if(fb.test(n))return n.replace(fM,m0)}else if(pb.test(n))return n.replace(pM,m0);return n}const gM=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function _M(n){return n.replace(gM,(e,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const yM=/(^|[^\[])\^/g;function zi(n,e){let t=typeof n=="string"?n:n.source;e=e||"";const i={replace:(o,h)=>{let u=typeof h=="string"?h:h.source;return u=u.replace(yM,"$1"),t=t.replace(o,u),i},getRegex:()=>new RegExp(t,e)};return i}function g0(n){try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const dh={exec:()=>null};function _0(n,e){const t=n.replace(/\|/g,(h,u,l)=>{let p=!1,y=u;for(;--y>=0&&l[y]==="\\";)p=!p;return p?"|":" |"}),i=t.split(/ \|/);let o=0;if(i[0].trim()||i.shift(),i.length>0&&!i[i.length-1].trim()&&i.pop(),e)if(i.length>e)i.splice(e);else for(;i.length<e;)i.push("");for(;o<i.length;o++)i[o]=i[o].trim().replace(/\\\|/g,"|");return i}function Qu(n,e,t){const i=n.length;if(i===0)return"";let o=0;for(;o<i;){const h=n.charAt(i-o-1);if(h===e&&!t)o++;else if(h!==e&&t)o++;else break}return n.slice(0,i-o)}function bM(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let i=0;i<n.length;i++)if(n[i]==="\\")i++;else if(n[i]===e[0])t++;else if(n[i]===e[1]&&(t--,t<0))return i;return-1}function y0(n,e,t,i){const o=e.href,h=e.title?nr(e.title):null,u=n[1].replace(/\\([\[\]])/g,"$1");if(n[0].charAt(0)!=="!"){i.state.inLink=!0;const l={type:"link",raw:t,href:o,title:h,text:u,tokens:i.inlineTokens(u)};return i.state.inLink=!1,l}return{type:"image",raw:t,href:o,title:h,text:nr(u)}}function xM(n,e){const t=n.match(/^(\s+)(?:```)/);if(t===null)return e;const i=t[1];return e.split(`
`).map(o=>{const h=o.match(/^\s+/);if(h===null)return o;const[u]=h;return u.length>=i.length?o.slice(i.length):o}).join(`
`)}class bd{constructor(e){Ge(this,"options");Ge(this,"rules");Ge(this,"lexer");this.options=e||Ua}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const i=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?i:Qu(i,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const i=t[0],o=xM(i,t[3]||"");return{type:"code",raw:i,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:o}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let i=t[2].trim();if(/#$/.test(i)){const o=Qu(i,"#");(this.options.pedantic||!o||/ $/.test(o))&&(i=o.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:i,tokens:this.lexer.inline(i)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let i=t[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);i=Qu(i.replace(/^ *>[ \t]?/gm,""),`
`);const o=this.lexer.state.top;this.lexer.state.top=!0;const h=this.lexer.blockTokens(i);return this.lexer.state.top=o,{type:"blockquote",raw:t[0],tokens:h,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let i=t[1].trim();const o=i.length>1,h={type:"list",raw:"",ordered:o,start:o?+i.slice(0,-1):"",loose:!1,items:[]};i=o?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=o?i:"[*+-]");const u=new RegExp(`^( {0,3}${i})((?:[	 ][^\\n]*)?(?:\\n|$))`);let l="",p="",y=!1;for(;e;){let k=!1;if(!(t=u.exec(e))||this.rules.block.hr.test(e))break;l=t[0],e=e.substring(l.length);let C=t[2].split(`
`,1)[0].replace(/^\t+/,X=>" ".repeat(3*X.length)),S=e.split(`
`,1)[0],z=0;this.options.pedantic?(z=2,p=C.trimStart()):(z=t[2].search(/[^ ]/),z=z>4?1:z,p=C.slice(z),z+=t[1].length);let R=!1;if(!C&&/^ *$/.test(S)&&(l+=S+`
`,e=e.substring(S.length+1),k=!0),!k){const X=new RegExp(`^ {0,${Math.min(3,z-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),re=new RegExp(`^ {0,${Math.min(3,z-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),W=new RegExp(`^ {0,${Math.min(3,z-1)}}(?:\`\`\`|~~~)`),ae=new RegExp(`^ {0,${Math.min(3,z-1)}}#`);for(;e;){const de=e.split(`
`,1)[0];if(S=de,this.options.pedantic&&(S=S.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),W.test(S)||ae.test(S)||X.test(S)||re.test(e))break;if(S.search(/[^ ]/)>=z||!S.trim())p+=`
`+S.slice(z);else{if(R||C.search(/[^ ]/)>=4||W.test(C)||ae.test(C)||re.test(C))break;p+=`
`+S}!R&&!S.trim()&&(R=!0),l+=de+`
`,e=e.substring(de.length+1),C=S.slice(z)}}h.loose||(y?h.loose=!0:/\n *\n *$/.test(l)&&(y=!0));let j=null,H;this.options.gfm&&(j=/^\[[ xX]\] /.exec(p),j&&(H=j[0]!=="[ ] ",p=p.replace(/^\[[ xX]\] +/,""))),h.items.push({type:"list_item",raw:l,task:!!j,checked:H,loose:!1,text:p,tokens:[]}),h.raw+=l}h.items[h.items.length-1].raw=l.trimEnd(),h.items[h.items.length-1].text=p.trimEnd(),h.raw=h.raw.trimEnd();for(let k=0;k<h.items.length;k++)if(this.lexer.state.top=!1,h.items[k].tokens=this.lexer.blockTokens(h.items[k].text,[]),!h.loose){const C=h.items[k].tokens.filter(z=>z.type==="space"),S=C.length>0&&C.some(z=>/\n.*\n/.test(z.raw));h.loose=S}if(h.loose)for(let k=0;k<h.items.length;k++)h.items[k].loose=!0;return h}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const i=t[1].toLowerCase().replace(/\s+/g," "),o=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",h=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:i,raw:t[0],href:o,title:h}}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const i=_0(t[1]),o=t[2].replace(/^\||\| *$/g,"").split("|"),h=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],u={type:"table",raw:t[0],header:[],align:[],rows:[]};if(i.length===o.length){for(const l of o)/^ *-+: *$/.test(l)?u.align.push("right"):/^ *:-+: *$/.test(l)?u.align.push("center"):/^ *:-+ *$/.test(l)?u.align.push("left"):u.align.push(null);for(const l of i)u.header.push({text:l,tokens:this.lexer.inline(l)});for(const l of h)u.rows.push(_0(l,u.header.length).map(p=>({text:p,tokens:this.lexer.inline(p)})));return u}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const i=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:i,tokens:this.lexer.inline(i)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:nr(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const i=t[2].trim();if(!this.options.pedantic&&/^</.test(i)){if(!/>$/.test(i))return;const u=Qu(i.slice(0,-1),"\\");if((i.length-u.length)%2===0)return}else{const u=bM(t[2],"()");if(u>-1){const p=(t[0].indexOf("!")===0?5:4)+t[1].length+u;t[2]=t[2].substring(0,u),t[0]=t[0].substring(0,p).trim(),t[3]=""}}let o=t[2],h="";if(this.options.pedantic){const u=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(o);u&&(o=u[1],h=u[3])}else h=t[3]?t[3].slice(1,-1):"";return o=o.trim(),/^</.test(o)&&(this.options.pedantic&&!/>$/.test(i)?o=o.slice(1):o=o.slice(1,-1)),y0(t,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:h&&h.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let i;if((i=this.rules.inline.reflink.exec(e))||(i=this.rules.inline.nolink.exec(e))){const o=(i[2]||i[1]).replace(/\s+/g," "),h=t[o.toLowerCase()];if(!h){const u=i[0].charAt(0);return{type:"text",raw:u,text:u}}return y0(i,h,i[0],this.lexer)}}emStrong(e,t,i=""){let o=this.rules.inline.emStrongLDelim.exec(e);if(!o||o[3]&&i.match(/[\p{L}\p{N}]/u))return;if(!(o[1]||o[2]||"")||!i||this.rules.inline.punctuation.exec(i)){const u=[...o[0]].length-1;let l,p,y=u,k=0;const C=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(C.lastIndex=0,t=t.slice(-1*e.length+u);(o=C.exec(t))!=null;){if(l=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!l)continue;if(p=[...l].length,o[3]||o[4]){y+=p;continue}else if((o[5]||o[6])&&u%3&&!((u+p)%3)){k+=p;continue}if(y-=p,y>0)continue;p=Math.min(p,p+y+k);const S=[...o[0]][0].length,z=e.slice(0,u+o.index+S+p);if(Math.min(u,p)%2){const j=z.slice(1,-1);return{type:"em",raw:z,text:j,tokens:this.lexer.inlineTokens(j)}}const R=z.slice(2,-2);return{type:"strong",raw:z,text:R,tokens:this.lexer.inlineTokens(R)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let i=t[2].replace(/\n/g," ");const o=/[^ ]/.test(i),h=/^ /.test(i)&&/ $/.test(i);return o&&h&&(i=i.substring(1,i.length-1)),i=nr(i,!0),{type:"codespan",raw:t[0],text:i}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let i,o;return t[2]==="@"?(i=nr(t[1]),o="mailto:"+i):(i=nr(t[1]),o=i),{type:"link",raw:t[0],text:i,href:o,tokens:[{type:"text",raw:i,text:i}]}}}url(e){var i;let t;if(t=this.rules.inline.url.exec(e)){let o,h;if(t[2]==="@")o=nr(t[0]),h="mailto:"+o;else{let u;do u=t[0],t[0]=((i=this.rules.inline._backpedal.exec(t[0]))==null?void 0:i[0])??"";while(u!==t[0]);o=nr(t[0]),t[1]==="www."?h="http://"+t[0]:h=t[0]}return{type:"link",raw:t[0],text:o,href:h,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let i;return this.lexer.state.inRawBlock?i=t[0]:i=nr(t[0]),{type:"text",raw:t[0],text:i}}}}const vM=/^(?: *(?:\n|$))+/,wM=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,kM=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ah=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,SM=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,mb=/(?:[*+-]|\d{1,9}[.)])/,gb=zi(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,mb).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),_m=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,CM=/^[^\n]+/,ym=/(?!\s*\])(?:\\.|[^\[\]\\])+/,TM=zi(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",ym).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),MM=zi(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,mb).getRegex(),Gd="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",bm=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,PM=zi("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",bm).replace("tag",Gd).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),_b=zi(_m).replace("hr",Ah).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Gd).getRegex(),IM=zi(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",_b).getRegex(),xm={blockquote:IM,code:wM,def:TM,fences:kM,heading:SM,hr:Ah,html:PM,lheading:gb,list:MM,newline:vM,paragraph:_b,table:dh,text:CM},b0=zi("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ah).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Gd).getRegex(),AM={...xm,table:b0,paragraph:zi(_m).replace("hr",Ah).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",b0).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Gd).getRegex()},EM={...xm,html:zi(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",bm).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:dh,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:zi(_m).replace("hr",Ah).replace("heading",` *#{1,6} *[^
]`).replace("lheading",gb).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},yb=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,zM=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,bb=/^( {2,}|\\)\n(?!\s*$)/,DM=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Eh="\\p{P}\\p{S}",LM=zi(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Eh).getRegex(),RM=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,FM=zi(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Eh).getRegex(),BM=zi("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Eh).getRegex(),OM=zi("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Eh).getRegex(),VM=zi(/\\([punct])/,"gu").replace(/punct/g,Eh).getRegex(),NM=zi(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),UM=zi(bm).replace("(?:-->|$)","-->").getRegex(),jM=zi("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",UM).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),xd=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,qM=zi(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",xd).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),xb=zi(/^!?\[(label)\]\[(ref)\]/).replace("label",xd).replace("ref",ym).getRegex(),vb=zi(/^!?\[(ref)\](?:\[\])?/).replace("ref",ym).getRegex(),HM=zi("reflink|nolink(?!\\()","g").replace("reflink",xb).replace("nolink",vb).getRegex(),vm={_backpedal:dh,anyPunctuation:VM,autolink:NM,blockSkip:RM,br:bb,code:zM,del:dh,emStrongLDelim:FM,emStrongRDelimAst:BM,emStrongRDelimUnd:OM,escape:yb,link:qM,nolink:vb,punctuation:LM,reflink:xb,reflinkSearch:HM,tag:jM,text:DM,url:dh},WM={...vm,link:zi(/^!?\[(label)\]\((.*?)\)/).replace("label",xd).getRegex(),reflink:zi(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",xd).getRegex()},jp={...vm,escape:zi(yb).replace("])","~|])").getRegex(),url:zi(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ZM={...jp,br:zi(bb).replace("{2,}","*").getRegex(),text:zi(jp.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ed={normal:xm,gfm:AM,pedantic:EM},ih={normal:vm,gfm:jp,breaks:ZM,pedantic:WM};class Nr{constructor(e){Ge(this,"tokens");Ge(this,"options");Ge(this,"state");Ge(this,"tokenizer");Ge(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ua,this.options.tokenizer=this.options.tokenizer||new bd,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:ed.normal,inline:ih.normal};this.options.pedantic?(t.block=ed.pedantic,t.inline=ih.pedantic):this.options.gfm&&(t.block=ed.gfm,this.options.breaks?t.inline=ih.breaks:t.inline=ih.gfm),this.tokenizer.rules=t}static get rules(){return{block:ed,inline:ih}}static lex(e,t){return new Nr(t).lex(e)}static lexInline(e,t){return new Nr(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const i=this.inlineQueue[t];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(l,p,y)=>p+"    ".repeat(y.length));let i,o,h,u;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(l=>(i=l.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))){if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length),i.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length),o=t[t.length-1],o&&(o.type==="paragraph"||o.type==="text")?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue[this.inlineQueue.length-1].src=o.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length),o=t[t.length-1],o&&(o.type==="paragraph"||o.type==="text")?(o.raw+=`
`+i.raw,o.text+=`
`+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(h=e,this.options.extensions&&this.options.extensions.startBlock){let l=1/0;const p=e.slice(1);let y;this.options.extensions.startBlock.forEach(k=>{y=k.call({lexer:this},p),typeof y=="number"&&y>=0&&(l=Math.min(l,y))}),l<1/0&&l>=0&&(h=e.substring(0,l+1))}if(this.state.top&&(i=this.tokenizer.paragraph(h))){o=t[t.length-1],u&&o.type==="paragraph"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=o.text):t.push(i),u=h.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length),o=t[t.length-1],o&&o.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=o.text):t.push(i);continue}if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let i,o,h,u=e,l,p,y;if(this.tokens.links){const k=Object.keys(this.tokens.links);if(k.length>0)for(;(l=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)k.includes(l[0].slice(l[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(l=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,l.index)+"["+"a".repeat(l[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(l=this.tokenizer.rules.inline.anyPunctuation.exec(u))!=null;)u=u.slice(0,l.index)+"++"+u.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(p||(y=""),p=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(k=>(i=k.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))){if(i=this.tokenizer.escape(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.tag(e)){e=e.substring(i.raw.length),o=t[t.length-1],o&&i.type==="text"&&o.type==="text"?(o.raw+=i.raw,o.text+=i.text):t.push(i);continue}if(i=this.tokenizer.link(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(i.raw.length),o=t[t.length-1],o&&i.type==="text"&&o.type==="text"?(o.raw+=i.raw,o.text+=i.text):t.push(i);continue}if(i=this.tokenizer.emStrong(e,u,y)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.codespan(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.br(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.del(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.autolink(e)){e=e.substring(i.raw.length),t.push(i);continue}if(!this.state.inLink&&(i=this.tokenizer.url(e))){e=e.substring(i.raw.length),t.push(i);continue}if(h=e,this.options.extensions&&this.options.extensions.startInline){let k=1/0;const C=e.slice(1);let S;this.options.extensions.startInline.forEach(z=>{S=z.call({lexer:this},C),typeof S=="number"&&S>=0&&(k=Math.min(k,S))}),k<1/0&&k>=0&&(h=e.substring(0,k+1))}if(i=this.tokenizer.inlineText(h)){e=e.substring(i.raw.length),i.raw.slice(-1)!=="_"&&(y=i.raw.slice(-1)),p=!0,o=t[t.length-1],o&&o.type==="text"?(o.raw+=i.raw,o.text+=i.text):t.push(i);continue}if(e){const k="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(k);break}else throw new Error(k)}}return t}}class vd{constructor(e){Ge(this,"options");this.options=e||Ua}code(e,t,i){var h;const o=(h=(t||"").match(/^\S*/))==null?void 0:h[0];return e=e.replace(/\n$/,"")+`
`,o?'<pre><code class="language-'+nr(o)+'">'+(i?e:nr(e,!0))+`</code></pre>
`:"<pre><code>"+(i?e:nr(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,i){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}list(e,t,i){const o=t?"ol":"ul",h=t&&i!==1?' start="'+i+'"':"";return"<"+o+h+`>
`+e+"</"+o+`>
`}listitem(e,t,i){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const i=t.header?"th":"td";return(t.align?`<${i} align="${t.align}">`:`<${i}>`)+e+`</${i}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,i){const o=g0(e);if(o===null)return i;e=o;let h='<a href="'+e+'"';return t&&(h+=' title="'+t+'"'),h+=">"+i+"</a>",h}image(e,t,i){const o=g0(e);if(o===null)return i;e=o;let h=`<img src="${e}" alt="${i}"`;return t&&(h+=` title="${t}"`),h+=">",h}text(e){return e}}class wm{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,i){return""+i}image(e,t,i){return""+i}br(){return""}}class Ur{constructor(e){Ge(this,"options");Ge(this,"renderer");Ge(this,"textRenderer");this.options=e||Ua,this.options.renderer=this.options.renderer||new vd,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new wm}static parse(e,t){return new Ur(t).parse(e)}static parseInline(e,t){return new Ur(t).parseInline(e)}parse(e,t=!0){let i="";for(let o=0;o<e.length;o++){const h=e[o];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[h.type]){const u=h,l=this.options.extensions.renderers[u.type].call({parser:this},u);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(u.type)){i+=l||"";continue}}switch(h.type){case"space":continue;case"hr":{i+=this.renderer.hr();continue}case"heading":{const u=h;i+=this.renderer.heading(this.parseInline(u.tokens),u.depth,_M(this.parseInline(u.tokens,this.textRenderer)));continue}case"code":{const u=h;i+=this.renderer.code(u.text,u.lang,!!u.escaped);continue}case"table":{const u=h;let l="",p="";for(let k=0;k<u.header.length;k++)p+=this.renderer.tablecell(this.parseInline(u.header[k].tokens),{header:!0,align:u.align[k]});l+=this.renderer.tablerow(p);let y="";for(let k=0;k<u.rows.length;k++){const C=u.rows[k];p="";for(let S=0;S<C.length;S++)p+=this.renderer.tablecell(this.parseInline(C[S].tokens),{header:!1,align:u.align[S]});y+=this.renderer.tablerow(p)}i+=this.renderer.table(l,y);continue}case"blockquote":{const u=h,l=this.parse(u.tokens);i+=this.renderer.blockquote(l);continue}case"list":{const u=h,l=u.ordered,p=u.start,y=u.loose;let k="";for(let C=0;C<u.items.length;C++){const S=u.items[C],z=S.checked,R=S.task;let j="";if(S.task){const H=this.renderer.checkbox(!!z);y?S.tokens.length>0&&S.tokens[0].type==="paragraph"?(S.tokens[0].text=H+" "+S.tokens[0].text,S.tokens[0].tokens&&S.tokens[0].tokens.length>0&&S.tokens[0].tokens[0].type==="text"&&(S.tokens[0].tokens[0].text=H+" "+S.tokens[0].tokens[0].text)):S.tokens.unshift({type:"text",text:H+" "}):j+=H+" "}j+=this.parse(S.tokens,y),k+=this.renderer.listitem(j,R,!!z)}i+=this.renderer.list(k,l,p);continue}case"html":{const u=h;i+=this.renderer.html(u.text,u.block);continue}case"paragraph":{const u=h;i+=this.renderer.paragraph(this.parseInline(u.tokens));continue}case"text":{let u=h,l=u.tokens?this.parseInline(u.tokens):u.text;for(;o+1<e.length&&e[o+1].type==="text";)u=e[++o],l+=`
`+(u.tokens?this.parseInline(u.tokens):u.text);i+=t?this.renderer.paragraph(l):l;continue}default:{const u='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return i}parseInline(e,t){t=t||this.renderer;let i="";for(let o=0;o<e.length;o++){const h=e[o];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[h.type]){const u=this.options.extensions.renderers[h.type].call({parser:this},h);if(u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(h.type)){i+=u||"";continue}}switch(h.type){case"escape":{const u=h;i+=t.text(u.text);break}case"html":{const u=h;i+=t.html(u.text);break}case"link":{const u=h;i+=t.link(u.href,u.title,this.parseInline(u.tokens,t));break}case"image":{const u=h;i+=t.image(u.href,u.title,u.text);break}case"strong":{const u=h;i+=t.strong(this.parseInline(u.tokens,t));break}case"em":{const u=h;i+=t.em(this.parseInline(u.tokens,t));break}case"codespan":{const u=h;i+=t.codespan(u.text);break}case"br":{i+=t.br();break}case"del":{const u=h;i+=t.del(this.parseInline(u.tokens,t));break}case"text":{const u=h;i+=t.text(u.text);break}default:{const u='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return i}}class fh{constructor(e){Ge(this,"options");this.options=e||Ua}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}}Ge(fh,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var wh,qp,kd,wb;class $M{constructor(...e){Jf(this,wh);Jf(this,kd);Ge(this,"defaults",gm());Ge(this,"options",this.setOptions);Ge(this,"parse",Vu(this,wh,qp).call(this,Nr.lex,Ur.parse));Ge(this,"parseInline",Vu(this,wh,qp).call(this,Nr.lexInline,Ur.parseInline));Ge(this,"Parser",Ur);Ge(this,"Renderer",vd);Ge(this,"TextRenderer",wm);Ge(this,"Lexer",Nr);Ge(this,"Tokenizer",bd);Ge(this,"Hooks",fh);this.use(...e)}walkTokens(e,t){var o,h;let i=[];for(const u of e)switch(i=i.concat(t.call(this,u)),u.type){case"table":{const l=u;for(const p of l.header)i=i.concat(this.walkTokens(p.tokens,t));for(const p of l.rows)for(const y of p)i=i.concat(this.walkTokens(y.tokens,t));break}case"list":{const l=u;i=i.concat(this.walkTokens(l.items,t));break}default:{const l=u;(h=(o=this.defaults.extensions)==null?void 0:o.childTokens)!=null&&h[l.type]?this.defaults.extensions.childTokens[l.type].forEach(p=>{const y=l[p].flat(1/0);i=i.concat(this.walkTokens(y,t))}):l.tokens&&(i=i.concat(this.walkTokens(l.tokens,t)))}}return i}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(i=>{const o={...i};if(o.async=this.defaults.async||o.async||!1,i.extensions&&(i.extensions.forEach(h=>{if(!h.name)throw new Error("extension name required");if("renderer"in h){const u=t.renderers[h.name];u?t.renderers[h.name]=function(...l){let p=h.renderer.apply(this,l);return p===!1&&(p=u.apply(this,l)),p}:t.renderers[h.name]=h.renderer}if("tokenizer"in h){if(!h.level||h.level!=="block"&&h.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const u=t[h.level];u?u.unshift(h.tokenizer):t[h.level]=[h.tokenizer],h.start&&(h.level==="block"?t.startBlock?t.startBlock.push(h.start):t.startBlock=[h.start]:h.level==="inline"&&(t.startInline?t.startInline.push(h.start):t.startInline=[h.start]))}"childTokens"in h&&h.childTokens&&(t.childTokens[h.name]=h.childTokens)}),o.extensions=t),i.renderer){const h=this.defaults.renderer||new vd(this.defaults);for(const u in i.renderer){if(!(u in h))throw new Error(`renderer '${u}' does not exist`);if(u==="options")continue;const l=u,p=i.renderer[l],y=h[l];h[l]=(...k)=>{let C=p.apply(h,k);return C===!1&&(C=y.apply(h,k)),C||""}}o.renderer=h}if(i.tokenizer){const h=this.defaults.tokenizer||new bd(this.defaults);for(const u in i.tokenizer){if(!(u in h))throw new Error(`tokenizer '${u}' does not exist`);if(["options","rules","lexer"].includes(u))continue;const l=u,p=i.tokenizer[l],y=h[l];h[l]=(...k)=>{let C=p.apply(h,k);return C===!1&&(C=y.apply(h,k)),C}}o.tokenizer=h}if(i.hooks){const h=this.defaults.hooks||new fh;for(const u in i.hooks){if(!(u in h))throw new Error(`hook '${u}' does not exist`);if(u==="options")continue;const l=u,p=i.hooks[l],y=h[l];fh.passThroughHooks.has(u)?h[l]=k=>{if(this.defaults.async)return Promise.resolve(p.call(h,k)).then(S=>y.call(h,S));const C=p.call(h,k);return y.call(h,C)}:h[l]=(...k)=>{let C=p.apply(h,k);return C===!1&&(C=y.apply(h,k)),C}}o.hooks=h}if(i.walkTokens){const h=this.defaults.walkTokens,u=i.walkTokens;o.walkTokens=function(l){let p=[];return p.push(u.call(this,l)),h&&(p=p.concat(h.call(this,l))),p}}this.defaults={...this.defaults,...o}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return Nr.lex(e,t??this.defaults)}parser(e,t){return Ur.parse(e,t??this.defaults)}}wh=new WeakSet,qp=function(e,t){return(i,o)=>{const h={...o},u={...this.defaults,...h};this.defaults.async===!0&&h.async===!1&&(u.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),u.async=!0);const l=Vu(this,kd,wb).call(this,!!u.silent,!!u.async);if(typeof i>"u"||i===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof i!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(i)+", string expected"));if(u.hooks&&(u.hooks.options=u),u.async)return Promise.resolve(u.hooks?u.hooks.preprocess(i):i).then(p=>e(p,u)).then(p=>u.hooks?u.hooks.processAllTokens(p):p).then(p=>u.walkTokens?Promise.all(this.walkTokens(p,u.walkTokens)).then(()=>p):p).then(p=>t(p,u)).then(p=>u.hooks?u.hooks.postprocess(p):p).catch(l);try{u.hooks&&(i=u.hooks.preprocess(i));let p=e(i,u);u.hooks&&(p=u.hooks.processAllTokens(p)),u.walkTokens&&this.walkTokens(p,u.walkTokens);let y=t(p,u);return u.hooks&&(y=u.hooks.postprocess(y)),y}catch(p){return l(p)}}},kd=new WeakSet,wb=function(e,t){return i=>{if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const o="<p>An error occurred:</p><pre>"+nr(i.message+"",!0)+"</pre>";return t?Promise.resolve(o):o}if(t)return Promise.reject(i);throw i}};const Va=new $M;function bi(n,e){return Va.parse(n,e)}bi.options=bi.setOptions=function(n){return Va.setOptions(n),bi.defaults=Va.defaults,db(bi.defaults),bi};bi.getDefaults=gm;bi.defaults=Ua;bi.use=function(...n){return Va.use(...n),bi.defaults=Va.defaults,db(bi.defaults),bi};bi.walkTokens=function(n,e){return Va.walkTokens(n,e)};bi.parseInline=Va.parseInline;bi.Parser=Ur;bi.parser=Ur.parse;bi.Renderer=vd;bi.TextRenderer=wm;bi.Lexer=Nr;bi.lexer=Nr.lex;bi.Tokenizer=bd;bi.Hooks=fh;bi.parse=bi;bi.options;bi.setOptions;bi.use;bi.walkTokens;bi.parseInline;Ur.parse;Nr.lex;function x0(n){let e,t=bi.parse(n[0])+"",i;return{c(){e=new Mv(!1),i=Di(),e.a=i},m(o,h){e.m(t,o,h),qe(o,i,h)},p(o,h){h&1&&t!==(t=bi.parse(o[0])+"")&&e.p(t)},d(o){o&&je(i),o&&e.d()}}}function GM(n){var i;let e,t=((i=n[0])==null?void 0:i.length)>0&&x0(n);return{c(){t&&t.c(),e=Di()},m(o,h){t&&t.m(o,h),qe(o,e,h)},p(o,[h]){var u;((u=o[0])==null?void 0:u.length)>0?t?t.p(o,h):(t=x0(o),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:St,o:St,d(o){t&&t.d(o),o&&je(e)}}}function XM(n,e,t){let{src:i=void 0}=e,{srcWritable:o=void 0}=e;if(o==null||o.addCallbackAndRunD(h=>{t(0,i=h)}),i!==void 0&&typeof i!="string")throw console.trace("Got a non-string object in Markdown",i),"Markdown.svelte got a non-string object";return n.$$set=h=>{"src"in h&&t(0,i=h.src),"srcWritable"in h&&t(1,o=h.srcWritable)},[i,o]}class KM extends Gt{constructor(e){super(),Xt(this,e,XM,GM,Kt,{src:0,srcWritable:1})}}function v0(n){let e,t,i=n[4].name+"",o,h,u,l;return u=new KM({props:{src:n[4].docs}}),{c(){e=et("div"),t=et("b"),o=Si(i),h=xt(),lt(u.$$.fragment),ie(e,"class","m-2 border border-dashed border-black p-2")},m(p,y){qe(p,e,y),ue(e,t),ue(t,o),ue(e,h),ct(u,e,null),l=!0},p(p,y){(!l||y&16)&&i!==(i=p[4].name+"")&&zs(o,i);const k={};y&16&&(k.src=p[4].docs),u.$set(k)},i(p){l||(we(u.$$.fragment,p),l=!0)},o(p){Ce(u.$$.fragment,p),l=!1},d(p){p&&je(e),ht(u)}}}function YM(n){let e,t,i,o,h;function u(y){n[9](y)}let l={dropdownFocussed:n[7],overpassSupportNeeded:n[1],silent:n[2],tag:n[0],uploadableOnly:n[6]};n[3]!==void 0&&(l.mode=n[3]),e=new hb({props:l}),xo.push(()=>Pv(e,"mode",u)),e.$on("submit",n[10]);let p=n[5]&&v0(n);return{c(){lt(e.$$.fragment),i=xt(),p&&p.c(),o=Di()},m(y,k){ct(e,y,k),qe(y,i,k),p&&p.m(y,k),qe(y,o,k),h=!0},p(y,[k]){const C={};k&2&&(C.overpassSupportNeeded=y[1]),k&4&&(C.silent=y[2]),k&1&&(C.tag=y[0]),!t&&k&8&&(t=!0,C.mode=y[3],Iv(()=>t=!1)),e.$set(C),y[5]?p?(p.p(y,k),k&32&&we(p,1)):(p=v0(y),p.c(),we(p,1),p.m(o.parentNode,o)):p&&(oi(),Ce(p,1,1,()=>{p=null}),ai())},i(y){h||(we(e.$$.fragment,y),we(p),h=!0)},o(y){Ce(e.$$.fragment,y),Ce(p),h=!1},d(y){ht(e,y),y&&je(i),p&&p.d(y),y&&je(o)}}}function JM(n,e,t){let i,{value:o}=e,{args:h=[]}=e,u=h[0]==="uploadableOnly",{overpassSupportNeeded:l}=e,{silent:p=!1}=e,y="=",k=new Tt(!1);pn(n,k,R=>t(5,i=R));let C=Mr.modeDocumentation[y];function S(R){y=R,t(3,y)}function z(R){_t.call(this,n,R)}return n.$$set=R=>{"value"in R&&t(0,o=R.value),"args"in R&&t(8,h=R.args),"overpassSupportNeeded"in R&&t(1,l=R.overpassSupportNeeded),"silent"in R&&t(2,p=R.silent)},n.$$.update=()=>{n.$$.dirty&8&&t(4,C=Mr.modeDocumentation[y])},[o,l,p,y,C,i,u,k,h,S,z]}class QM extends Gt{constructor(e){super(),Xt(this,e,JM,YM,Kt,{value:0,args:8,overpassSupportNeeded:1,silent:2})}}function e4(n){let e,t,i,o,h,u,l,p,y=[n[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}],k={};for(let C=0;C<y.length;C+=1)k=Ht(k,y[C]);return{c(){e=Re("svg"),t=Re("g"),i=Re("path"),o=Re("path"),h=Re("path"),u=Re("path"),Le(i,"fill","none",1),Le(i,"stroke-width","6"),Le(i,"stroke-linecap","round"),Le(i,"stroke-linejoin","round"),Le(i,"stroke","rgb(97.254902%,100%,96.078432%)"),Le(i,"stroke-opacity","1"),Le(i,"stroke-miterlimit","4"),ie(i,"d","M -177.48351 -16.993714 C -177.484166 101.48875 -226.288922 214.739751 -312.411923 296.10684 C -398.528411 377.467771 -514.363074 419.770216 -632.651731 413.060164 "),ie(i,"transform","matrix(-0.316636,-0.299423,0.299423,-0.316636,0,0)"),Le(o,"fill","none",1),Le(o,"stroke-width","6"),Le(o,"stroke-linecap","butt"),Le(o,"stroke-linejoin","miter"),Le(o,"stroke","rgb(100%,100%,100%)"),Le(o,"stroke-opacity","1"),Le(o,"stroke-miterlimit","4"),ie(o,"d","M 743.478328 134.561833 L 430.253662 430.253662 L 117.002105 134.508051 "),ie(o,"transform","matrix(0.435789,0,0,0.435789,0,0)"),Le(h,"fill","none",1),Le(h,"stroke-width","3"),Le(h,"stroke-linecap","round"),Le(h,"stroke-linejoin","round"),Le(h,"stroke",n[0]),Le(h,"stroke-opacity","1"),Le(h,"stroke-miterlimit","4"),ie(h,"d","M -177.48351 -16.993714 C -177.484166 101.48875 -226.288922 214.739751 -312.411923 296.10684 C -398.528411 377.467771 -514.363074 419.770216 -632.651731 413.060164 "),ie(h,"transform","matrix(-0.316636,-0.299423,0.299423,-0.316636,0,0)"),Le(u,"fill","none",1),Le(u,"stroke-width","3"),Le(u,"stroke-linecap","butt"),Le(u,"stroke-linejoin","miter"),Le(u,"stroke",n[0]),Le(u,"stroke-opacity","1"),Le(u,"stroke-miterlimit","4"),ie(u,"d","M 743.478328 134.561833 L 430.253662 430.253662 L 117.002105 134.508051 "),ie(u,"transform","matrix(0.435789,0,0,0.435789,0,0)"),ie(t,"id","surface1"),An(e,k)},m(C,S){qe(C,e,S),ue(e,t),ue(t,i),ue(t,o),ue(t,h),ue(t,u),l||(p=[Je(e,"click",n[2]),Je(e,"mouseover",n[3]),Je(e,"mouseenter",n[4]),Je(e,"mouseleave",n[5]),Je(e,"keydown",n[6]),Je(e,"focus",n[7])],l=!0)},p(C,[S]){S&1&&Le(h,"stroke",C[0]),S&1&&Le(u,"stroke",C[0]),An(e,k=bs(y,[S&2&&C[1],{xmlns:"http://www.w3.org/2000/svg"},{width:"375px"},{height:"375px"},{viewBox:"0 0 375 375"},{version:"1.1"}]))},i:St,o:St,d(C){C&&je(e),l=!1,es(p)}}}function t4(n,e,t){const i=["color"];let o=Ui(e,i),{color:h="#000000"}=e;function u(S){_t.call(this,n,S)}function l(S){_t.call(this,n,S)}function p(S){_t.call(this,n,S)}function y(S){_t.call(this,n,S)}function k(S){_t.call(this,n,S)}function C(S){_t.call(this,n,S)}return n.$$set=S=>{e=Ht(Ht({},e),_s(S)),t(1,o=Ui(e,i)),"color"in S&&t(0,h=S.color)},[h,o,u,l,p,y,k,C]}class i4 extends Gt{constructor(e){super(),Xt(this,e,t4,e4,Kt,{color:0})}}function n4(n){let e,t,i,o,h,u,l,p,y;return i=new q0({props:{mapProperties:n[4],map:n[3]}}),u=new i4({}),{c(){e=et("div"),t=et("div"),lt(i.$$.fragment),o=xt(),h=et("div"),lt(u.$$.fragment),ie(t,"class","absolute top-0 left-0 h-full w-full cursor-pointer"),ie(h,"class","absolute top-0 left-0 h-full w-full"),ie(e,"class","relative h-48 w-48 cursor-pointer overflow-hidden")},m(k,C){qe(k,e,C),ue(e,t),ct(i,t,null),ue(e,o),ue(e,h),ct(u,h,null),n[8](h),n[9](e),l=!0,p||(y=[Je(e,"click",n[10]),Je(e,"mousedown",n[11]),Je(e,"mousemove",n[12]),Je(e,"mouseup",n[13]),Je(e,"touchmove",n[14]),Je(e,"touchstart",n[15])],p=!0)},p:St,i(k){l||(we(i.$$.fragment,k),we(u.$$.fragment,k),l=!0)},o(k){Ce(i.$$.fragment,k),Ce(u.$$.fragment,k),l=!1},d(k){k&&je(e),ht(i),ht(u),n[8](null),n[9](null),p=!1,es(y)}}}function s4(n,e,t){let{value:i}=e,{mapProperties:o}=e,h=new Tt(void 0),u=new Cp(h,o);u.allowMoving.setData(!1),u.allowZooming.setData(!1);let l,p;function y(W,ae){const de=p.getBoundingClientRect(),Ae=-(de.left+de.right)/2+W,xe=(de.top+de.bottom)/2-ae,pe=180*Math.atan2(xe,Ae)/Math.PI,ke=Math.floor((450-pe)%360);i.setData(""+ke)}let k=!1;function C(W){xo[W?"unshift":"push"](()=>{l=W,t(0,l),t(6,i)})}function S(W){xo[W?"unshift":"push"](()=>{p=W,t(1,p)})}const z=W=>y(W.x,W.y),R=W=>{t(2,k=!0),y(W.clientX,W.clientY)},j=W=>{k&&(y(W.clientX,W.clientY),W.preventDefault())},H=()=>{t(2,k=!1)},X=W=>{y(W.touches[0].clientX,W.touches[0].clientY),W.preventDefault()},re=W=>y(W.touches[0].clientX,W.touches[0].clientY);return n.$$set=W=>{"value"in W&&t(6,i=W.value),"mapProperties"in W&&t(7,o=W.mapProperties)},n.$$.update=()=>{n.$$.dirty&65&&i.addCallbackAndRunD(W=>{l!==void 0&&t(0,l.style.rotate=W+"deg",l)})},[l,p,k,h,u,y,i,o,C,S,z,R,j,H,X,re]}class r4 extends Gt{constructor(e){super(),Xt(this,e,s4,n4,Kt,{value:6,mapProperties:7})}}function o4(n){let e,t,i;return{c(){e=et("input"),ie(e,"type","date")},m(o,h){qe(o,e,h),qr(e,n[1]),t||(i=Je(e,"input",n[2]),t=!0)},p(o,[h]){h&2&&qr(e,o[1])},i:St,o:St,d(o){o&&je(e),t=!1,i()}}}function a4(n,e,t){let i,o=St,h=()=>(o(),o=vo(u,p=>t(1,i=p)),u);n.$$.on_destroy.push(()=>o());let{value:u}=e;h();function l(){i=this.value,u.set(i)}return n.$$set=p=>{"value"in p&&h(t(0,u=p.value))},[u,i,l]}class l4 extends Gt{constructor(e){super(),Xt(this,e,a4,o4,Kt,{value:0})}}function c4(n){let e,t,i;return{c(){e=et("input"),ie(e,"type","color")},m(o,h){qe(o,e,h),qr(e,n[1]),t||(i=Je(e,"input",n[2]),t=!0)},p(o,[h]){h&2&&qr(e,o[1])},i:St,o:St,d(o){o&&je(e),t=!1,i()}}}function h4(n,e,t){let i,o=St,h=()=>(o(),o=vo(u,p=>t(1,i=p)),u);n.$$.on_destroy.push(()=>o());let{value:u}=e;h();function l(){i=this.value,u.set(i)}return n.$$set=p=>{"value"in p&&h(t(0,u=p.value))},[u,i,l]}class u4 extends Gt{constructor(e){super(),Xt(this,e,h4,c4,Kt,{value:0})}}class d4{constructor(e=new Tt(""),t="",i=""){Ge(this,"normalOhs");Ge(this,"leftoverRules");Ge(this,"phSelectorValue");var l;let o=e;t!==""&&i!==""&&(o=e.sync(p=>{if(p!==void 0)return p===""?"":p.startsWith(t)&&p.endsWith(i)?p.substring(t.length,p.length-i.length):p},[],p=>{if(p!==void 0)return p===""?"":p.startsWith(t)&&p.endsWith(i)?p:t+p+i})),this.leftoverRules=o.map(p=>{if(p===void 0)return[];const y=[],k=p.split(";");for(const C of k)Il.ParseRule(C)===null&&Il.ParsePHRule(C)===null&&(y.indexOf(C)>=0||y.push(C));return y});let h="";const u=((l=o.data)==null?void 0:l.split(";"))??[];for(const p of u)if(Il.ParsePHRule(p)!==null){h=p;break}this.phSelectorValue=new Tt(h??""),this.normalOhs=o.sync(p=>Il.Parse(p),[this.leftoverRules,this.phSelectorValue],(p,y)=>{let k=Il.ToString(p)+";";const C=this.phSelectorValue.data;for(C&&(k+=C+";"),k+=this.leftoverRules.data.join(";")+";",k=k.trim();k.endsWith(";");)k=k.substring(0,k.length-1);return k.startsWith(";")&&(k=k.substring(1)),k.trim(),k===y?y:k})}}class f4 extends kh{}class wd extends f4{constructor(t){super();Ge(this,"enterPressed",new Tt(void 0));Ge(this,"value");Ge(this,"_actualField");Ge(this,"_isValid");Ge(this,"_rawValue");Ge(this,"_isFocused",!1);Ge(this,"_options");this._options=t??{},t=t??{},this.value=(t==null?void 0:t.value)??new Tt(void 0),this._rawValue=new Tt(""),this._isValid=t.isValid??(i=>!0)}static SetCursorPosition(t,i){t!=null&&(i===-1&&(i=t.value.length),t.focus(),t.setSelectionRange(i,i))}GetValue(){return this.value}IsValid(t){return t==null?!1:this._isValid(t)}InnerConstructElement(){const t=this._options,i=this;let o,h="";t.placeholder&&(typeof t.placeholder=="string"?(h=t.placeholder,o=void 0):(t.placeholder instanceof gv&&t.placeholder.data!==void 0?o=t.placeholder:t.placeholder instanceof Al&&t.placeholder.translations!==void 0&&(o=Cd.language.map(y=>t.placeholder.textFor(y))),h=(o==null?void 0:o.data)??h??"")),this.SetClass("form-text-field");let u;if(t.htmlType==="area"){this.SetClass("w-full box-border max-w-full");const y=document.createElement("textarea");y.placeholder=h,y.rows=t.textAreaRows,y.cols=50,y.style.width="100%",y.dir="auto",u=y,o&&o.addCallbackAndRunD(k=>y.placeholder=k)}else{const y=document.createElement("input");y.type=t.htmlType??"text",y.inputMode=t.inputMode,y.placeholder=h,y.style.cssText=t.inputStyle??"width: 100%;",y.dir="auto",u=y,o&&o.addCallbackAndRunD(k=>y.placeholder=k)}const l=document.createElement("form");l.appendChild(u),l.onsubmit=()=>!1,t.label&&l.appendChild(t.label.ConstructElement());const p=u;return this.value.addCallbackAndRunD(y=>{p.value=y}),p.oninput=()=>{const y=p.value.substring(p.selectionEnd).replace(/ /g,"").length;let k=p.value;i._rawValue.setData(k),i.IsValid(k)?i.value.setData(k):i.value.setData(void 0),k=p.value;let C=k.length-y;for(;C>=0&&k.substr(C).replace(/ /g,"").length<y;)C--;wd.SetCursorPosition(p,C)},p.addEventListener("keyup",function(y){y.key==="Enter"&&i.enterPressed.setData(p.value)}),this._isFocused&&p.focus(),this._actualField=p,l}focus(){this._actualField===void 0?this._isFocused=!0:this._actualField.focus()}}function p4(n){let e,t,i,o,h,u,l,p,y,k,C,S;return t=new mn({props:{t:n[3].ph_not_known}}),h=new mn({props:{t:n[3].ph_closed}}),p=new mn({props:{t:n[3].ph_open_as_usual}}),C=new mn({props:{t:n[3].ph_open}}),{c(){e=et("option"),lt(t.$$.fragment),i=xt(),o=et("option"),lt(h.$$.fragment),u=xt(),l=et("option"),lt(p.$$.fragment),y=xt(),k=et("option"),lt(C.$$.fragment),e.__value="",e.value=e.__value,o.__value="off",o.value=o.__value,l.__value="open",l.value=l.__value,k.__value=" ",k.value=k.__value},m(z,R){qe(z,e,R),ct(t,e,null),qe(z,i,R),qe(z,o,R),ct(h,o,null),qe(z,u,R),qe(z,l,R),ct(p,l,null),qe(z,y,R),qe(z,k,R),ct(C,k,null),S=!0},p:St,i(z){S||(we(t.$$.fragment,z),we(h.$$.fragment,z),we(p.$$.fragment,z),we(C.$$.fragment,z),S=!0)},o(z){Ce(t.$$.fragment,z),Ce(h.$$.fragment,z),Ce(p.$$.fragment,z),Ce(C.$$.fragment,z),S=!1},d(z){z&&je(e),ht(t),z&&je(i),z&&je(o),ht(h),z&&je(u),z&&je(l),ht(p),z&&je(y),z&&je(k),ht(C)}}}function w0(n){let e,t,i,o,h,u,l,p,y;return t=new mn({props:{t:n[3].opensAt}}),o=new M_({props:{construct:new wd({value:n[1],placeholder:"starthour",htmlType:"time"}).SetClass("inline-block")}}),u=new mn({props:{t:n[3].openTill}}),p=new M_({props:{construct:new wd({value:n[2],placeholder:"endhour",htmlType:"time"}).SetClass("inline-block")}}),{c(){e=et("div"),lt(t.$$.fragment),i=xt(),lt(o.$$.fragment),h=xt(),lt(u.$$.fragment),l=xt(),lt(p.$$.fragment),ie(e,"class","flex")},m(k,C){qe(k,e,C),ct(t,e,null),ue(e,i),ct(o,e,null),ue(e,h),ct(u,e,null),ue(e,l),ct(p,e,null),y=!0},p:St,i(k){y||(we(t.$$.fragment,k),we(o.$$.fragment,k),we(u.$$.fragment,k),we(p.$$.fragment,k),y=!0)},o(k){Ce(t.$$.fragment,k),Ce(o.$$.fragment,k),Ce(u.$$.fragment,k),Ce(p.$$.fragment,k),y=!1},d(k){k&&je(e),ht(t),ht(o),ht(u),ht(p)}}}function m4(n){let e,t,i,o,h,u,l;t=new mn({props:{t:n[3].open_during_ph}}),o=new Ov({props:{value:n[4],$$slots:{default:[p4]},$$scope:{ctx:n}}});let p=n[0]===" "&&w0(n);return{c(){e=et("label"),lt(t.$$.fragment),i=xt(),lt(o.$$.fragment),h=xt(),p&&p.c(),u=Di()},m(y,k){qe(y,e,k),ct(t,e,null),ue(e,i),ct(o,e,null),qe(y,h,k),p&&p.m(y,k),qe(y,u,k),l=!0},p(y,[k]){const C={};k&128&&(C.$$scope={dirty:k,ctx:y}),o.$set(C),y[0]===" "?p?(p.p(y,k),k&1&&we(p,1)):(p=w0(y),p.c(),we(p,1),p.m(u.parentNode,u)):p&&(oi(),Ce(p,1,1,()=>{p=null}),ai())},i(y){l||(we(t.$$.fragment,y),we(o.$$.fragment,y),we(p),l=!0)},o(y){Ce(t.$$.fragment,y),Ce(o.$$.fragment,y),Ce(p),l=!1},d(y){y&&je(e),ht(t),ht(o),y&&je(h),p&&p.d(y),y&&je(u)}}}function g4(n,e,t){let i,{value:o}=e,h=new Tt(void 0),u=new Tt(void 0);const l=gs.t.general.opening_hours;let p=new Tt("");pn(n,p,k=>t(0,i=k)),o.map(k=>Il.ParsePHRule(k)).addCallbackAndRunD(k=>{k!==null&&(p.setData(k.mode),h.setData(k.start),u.setData(k.end))});function y(){p.data===void 0||p.data===""?o.setData(""):p.data==="off"?o.setData("PH off"):p.data==="open"?o.setData("PH open"):h.data===void 0||u.data===void 0?o.setData(void 0):o.setData(`PH ${h.data}-${u.data}`)}return h.addCallbackAndRunD(()=>y()),u.addCallbackAndRunD(()=>y()),p.addCallbackAndRunD(()=>y()),n.$$set=k=>{"value"in k&&t(5,o=k.value)},[i,h,u,l,p,o]}class _4 extends Gt{constructor(e){super(),Xt(this,e,g4,m4,Kt,{value:5})}}function y4(n){let e,t,i,o,h,u,l;return e=new Lv({props:{value:n[0].normalOhs}}),o=new v2({props:{class:"shrink-0 w-6 h-6 m-0 p-0",color:"white"}}),{c(){lt(e.$$.fragment),t=xt(),i=et("button"),lt(o.$$.fragment),ie(i,"class","absolute left-0 bottom-0 primary pointer-events-auto h-8 w-10 rounded-full")},m(p,y){ct(e,p,y),qe(p,t,y),qe(p,i,y),ct(o,i,null),h=!0,u||(l=Je(i,"click",n[4]),u=!0)},p:St,i(p){h||(we(e.$$.fragment,p),we(o.$$.fragment,p),h=!0)},o(p){Ce(e.$$.fragment,p),Ce(o.$$.fragment,p),h=!1},d(p){ht(e,p),p&&je(t),p&&je(i),ht(o),u=!1,l()}}}function b4(n){let e,t,i,o,h,u,l,p;return e=new Uk({props:{bodyPadding:"p-0",shown:n[1],$$slots:{default:[y4]},$$scope:{ctx:n}}}),h=new _4({props:{value:n[0].phSelectorValue}}),{c(){lt(e.$$.fragment),t=xt(),i=et("button"),i.textContent="Pick opening hours",o=xt(),lt(h.$$.fragment)},m(y,k){ct(e,y,k),qe(y,t,k),qe(y,i,k),qe(y,o,k),ct(h,y,k),u=!0,l||(p=Je(i,"click",n[5]),l=!0)},p(y,[k]){const C={};k&256&&(C.$$scope={dirty:k,ctx:y}),e.$set(C)},i(y){u||(we(e.$$.fragment,y),we(h.$$.fragment,y),u=!0)},o(y){Ce(e.$$.fragment,y),Ce(h.$$.fragment,y),u=!1},d(y){ht(e,y),y&&je(t),y&&je(i),y&&je(o),ht(h,y),l=!1,p()}}}function x4(n,e,t){let{value:i}=e,{args:o}=e,h="",u="";if(o)try{const C=JSON.stringify(o);C.prefix&&(h=C.prefix),C.postfix&&(u=C.postfix)}catch{console.error("Could not parse arguments")}const l=new d4(i);let p=new Tt(!1);const y=()=>p.set(!1),k=()=>p.set(!0);return n.$$set=C=>{"value"in C&&t(2,i=C.value),"args"in C&&t(3,o=C.args)},[l,p,i,o,y,k]}class v4 extends Gt{constructor(e){super(),Xt(this,e,x4,b4,Kt,{value:2,args:3})}}const w4=n=>({}),k0=n=>({});function k4(n){let e;const t=n[3].else,i=jn(t,n,n[2],k0);return{c(){i&&i.c()},m(o,h){i&&i.m(o,h),e=!0},p(o,h){i&&i.p&&(!e||h&4)&&qn(i,t,o,o[2],e?Wn(t,o[2],h,w4):Hn(o[2]),k0)},i(o){e||(we(i,o),e=!0)},o(o){Ce(i,o),e=!1},d(o){i&&i.d(o)}}}function S4(n){let e;const t=n[3].default,i=jn(t,n,n[2],null);return{c(){i&&i.c()},m(o,h){i&&i.m(o,h),e=!0},p(o,h){i&&i.p&&(!e||h&4)&&qn(i,t,o,o[2],e?Wn(t,o[2],h,null):Hn(o[2]),null)},i(o){e||(we(i,o),e=!0)},o(o){Ce(i,o),e=!1},d(o){i&&i.d(o)}}}function C4(n){let e,t,i,o;const h=[S4,k4],u=[];function l(p,y){return p[0]?0:1}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,[y]){let k=e;e=l(p),e===k?u[e].p(p,y):(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai(),t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i))},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function T4(n,e,t){let{$$slots:i={},$$scope:o}=e,{condition:h}=e,u=h.data;return rr(h.addCallback(l=>(t(0,u=l),!1))),n.$$set=l=>{"condition"in l&&t(1,h=l.condition),"$$scope"in l&&t(2,o=l.$$scope)},[u,h,o,i]}class M4 extends Gt{constructor(e){super(),Xt(this,e,T4,C4,Kt,{condition:1})}}function S0(n){var W;let e,t,i,o,h,u,l,p,y,k,C,S,z,R,j,H,X,re;return z=new mn({props:{t:gs.t.validation.slope.inputExplanation}}),j=new M4({props:{condition:((W=n[0])==null?void 0:W.featureSwitchIsTesting)??new id(!0),$$slots:{default:[A4]},$$scope:{ctx:n}}}),{c(){e=et("div"),t=et("div"),i=et("div"),o=et("div"),h=Si(n[3]),u=xt(),l=et("div"),p=Si(n[4]),y=xt(),k=et("button"),k.textContent="Select this incline",C=xt(),S=et("div"),lt(z.$$.fragment),R=xt(),lt(j.$$.fragment),ie(i,"class","flex w-full items-center justify-around text-5xl font-bold"),ie(t,"class","flex w-full"),ie(k,"class","primary"),ie(e,"class","m-2 flex flex-col")},m(ae,de){qe(ae,e,de),ue(e,t),ue(t,i),ue(i,o),ue(o,h),ue(i,u),ue(i,l),ue(l,p),ue(e,y),ue(e,k),ue(e,C),ue(e,S),ct(z,S,null),ue(e,R),ct(j,e,null),H=!0,X||(re=Je(k,"click",n[16]),X=!0)},p(ae,de){var xe;(!H||de&8)&&zs(h,ae[3]),(!H||de&16)&&zs(p,ae[4]);const Ae={};de&1&&(Ae.condition=((xe=ae[0])==null?void 0:xe.featureSwitchIsTesting)??new id(!0)),de&1048674&&(Ae.$$scope={dirty:de,ctx:ae}),j.$set(Ae)},i(ae){H||(we(z.$$.fragment,ae),we(j.$$.fragment,ae),H=!0)},o(ae){Ce(z.$$.fragment,ae),Ce(j.$$.fragment,ae),H=!1},d(ae){ae&&je(e),ht(z),ht(j),X=!1,re()}}}function P4(n){let e;return{c(){e=Si("Backward")},m(t,i){qe(t,e,i)},d(t){t&&je(e)}}}function I4(n){let e;return{c(){e=Si("Forward")},m(t,i){qe(t,e,i)},d(t){t&&je(e)}}}function A4(n){let e,t,i,o,h,u,l=n[1]-n[5]+"",p,y;function k(z,R){return z[6]===1?I4:P4}let C=k(n),S=C(n);return{c(){e=et("span"),t=Si("Way: "),i=Si(n[1]),o=Si("°, compass: "),h=Si(n[5]),u=Si("°, diff: "),p=Si(l),y=xt(),S.c(),ie(e,"class","subtle")},m(z,R){qe(z,e,R),ue(e,t),ue(e,i),ue(e,o),ue(e,h),ue(e,u),ue(e,p),ue(e,y),S.m(e,null)},p(z,R){R&2&&zs(i,z[1]),R&32&&zs(h,z[5]),R&34&&l!==(l=z[1]-z[5]+"")&&zs(p,l),C!==(C=k(z))&&(S.d(1),S=C(z),S&&(S.c(),S.m(e,null)))},d(z){z&&je(e),S.d()}}}function E4(n){let e,t,i=n[2]&&S0(n);return{c(){i&&i.c(),e=Di()},m(o,h){i&&i.m(o,h),qe(o,e,h),t=!0},p(o,[h]){o[2]?i?(i.p(o,h),h&4&&we(i,1)):(i=S0(o),i.c(),we(i,1),i.m(e.parentNode,e)):i&&(oi(),Ce(i,1,1,()=>{i=null}),ai())},i(o){t||(we(i),t=!0)},o(o){Ce(i),t=!1},d(o){i&&i.d(o),o&&je(e)}}}function C0(n){const e=Math.tan(n*Math.PI/180)*100;return Math.round(e/2.5)*2.5+"%"}function z4(n,e,t){var xe;let i,o,h,u,l,{value:p=new Tt(void 0)}=e,y=new Tt(void 0),{mode:k="percentage"}=e,{feature:C=void 0}=e,{state:S=void 0}=e,z=45;((xe=C==null?void 0:C.geometry)==null?void 0:xe.type)==="LineString"&&(z=Math.round(L0.bearing(C.geometry.coordinates[0],C.geometry.coordinates.at(-1))));let R=new Tt(void 0);pn(n,R,pe=>t(3,o=pe));let j=new Tt(void 0);pn(n,j,pe=>t(4,h=pe));const H=wv.singleton;H.startMeasurements();const X=H.alpha;pn(n,X,pe=>t(5,u=pe));const re=H.beta;let W=H.gotMeasurement;pn(n,W,pe=>t(2,i=pe));let ae=X.map(pe=>{if(z===void 0)return 1;z<0&&t(1,z+=360);let ke=Math.abs(z-pe)%360;return ke<90||ke>270?1:-1});pn(n,ae,pe=>t(6,l=pe)),re.map(pe=>{let ke=ae.data;k==="degrees"?y.setData(ke*pe+"°"):y.setData(C0(ke*pe)),R.setData(pe+"°"),j.setData(C0(pe))},[ae,re]);function de(){y.data&&p.setData(y.data)}const Ae=()=>de();return n.$$set=pe=>{"value"in pe&&t(13,p=pe.value),"mode"in pe&&t(14,k=pe.mode),"feature"in pe&&t(15,C=pe.feature),"state"in pe&&t(0,S=pe.state)},[S,z,i,o,h,u,l,R,j,X,W,ae,de,p,k,C,Ae]}class D4 extends Gt{constructor(e){super(),Xt(this,e,z4,E4,Kt,{value:13,mode:14,feature:15,state:0})}}const Da=class Da{static RegisterHotkey(e,t,i,o){const h=e.onUp?"keyup":"keypress";let u=e.ctrl??e.shift??e.alt??e.nomod;u.length==1&&(u=u.toLowerCase(),e.shift!==void 0&&(u=u.toUpperCase())),this._docs.data.push({key:e,documentation:t,alsoTriggeredBy:o}),this._docs.ping(),!Ni.runningFromConsole&&(e.ctrl!==void 0?document.addEventListener("keydown",function(l){l.ctrlKey&&l.key===u&&i()!==!1&&l.preventDefault()}):e.shift!==void 0?document.addEventListener(h,function(l){Da.textElementSelected(l)||l.shiftKey&&l.key===u&&i()!==!1&&l.preventDefault()}):e.alt!==void 0?document.addEventListener(h,function(l){l.altKey&&l.key===u&&i()!==!1&&l.preventDefault()}):e.nomod!==void 0&&document.addEventListener(h,function(l){Da.textElementSelected(l)&&u!=="Escape"||l.key===u&&i()!==!1&&l.preventDefault()}))}static prepareDocumentation(e){let t=e.map(({key:i,documentation:o,alsoTriggeredBy:h})=>{const u=Object.keys(i).filter(p=>p!=="nomod"&&p!=="onUp");let l=i.ctrl??i.shift??i.alt??i.nomod;return l.length==1&&(l=l.toUpperCase()),l===" "&&(l="Spacebar"),u.push(l),[u.join("+"),o,h]}).sort();t=Ni.NoNull(t);for(let i=t.length-1;i>0;i--)t[i-1][0]===t[i][0]&&t.splice(i,1);return t}static generateDocumentationFor(e,t){const i=gs.t.hotkeyDocumentation;function o(u){return typeof u=="string"?u:u.textFor(t)}const h=this.prepareDocumentation(e).map(([u,l,p])=>[[u,...p??[]].map(k=>"`"+o(k)+"`").join(" "),o(l)]);return["# "+o(i.title),o(i.intro),kv.table([o(i.key),o(i.action)],h)].join(`
`)}static generateDocumentation(e){return Da.generateDocumentationFor(Da._docs.data,e??Cd.language.data)}static textElementSelected(e){var t,i;return e.ctrlKey||e.altKey||e.key==="Escape"?!1:["input","textarea"].includes((i=(t=document==null?void 0:document.activeElement)==null?void 0:t.tagName)==null?void 0:i.toLowerCase())}};Ge(Da,"_docs",new Tt([]));let T0=Da;function L4(n){let e,t,i,o,h,u,l,p,y,k;h=new Sv({props:{"aria-hidden":"true",class:"h-6 w-6 self-end"}}),h.$on("click",n[10]);let C=n[5]!==void 0&&M0(n);return{c(){e=et("div"),t=et("input"),o=xt(),lt(h.$$.fragment),u=xt(),C&&C.c(),l=Di(),ie(t,"type","search"),ie(t,"class","mx-2 w-full outline-none"),ie(e,"class","flex w-full rounded-full border border-gray-300")},m(S,z){qe(S,e,z),ue(e,t),n[7](t),qr(t,n[4]),ue(e,o),ct(h,e,null),qe(S,u,z),C&&C.m(S,z),qe(S,l,z),p=!0,y||(k=[Je(t,"keypress",n[8]),Je(t,"input",n[9]),sd(i=Cv.call(null,t,n[1])),sd(D0.call(null,t,gs.t.general.search.search))],y=!0)},p(S,z){z&16&&t.value!==S[4]&&qr(t,S[4]),i&&Av(i.update)&&z&2&&i.update.call(null,S[1]),S[5]!==void 0?C?C.p(S,z):(C=M0(S),C.c(),C.m(l.parentNode,l)):C&&(C.d(1),C=null)},i(S){p||(we(h.$$.fragment,S),p=!0)},o(S){Ce(h.$$.fragment,S),p=!1},d(S){S&&je(e),n[7](null),ht(h),S&&je(u),C&&C.d(S),S&&je(l),y=!1,es(k)}}}function R4(n){let e,t;return e=new Wp({props:{$$slots:{default:[F4]},$$scope:{ctx:n}}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&4096&&(h.$$scope={dirty:o,ctx:i}),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function M0(n){let e,t;return{c(){e=et("div"),t=Si(n[5]),ie(e,"class","alert"),ie(e,"role","alert"),ie(e,"aria-live","assertive")},m(i,o){qe(i,e,o),ue(e,t)},p(i,o){o&32&&zs(t,i[5])},d(i){i&&je(e)}}}function F4(n){let e=gs.t.general.search.searching+"",t;return{c(){t=Si(e)},m(i,o){qe(i,t,o)},p:St,d(i){i&&je(t)}}}function B4(n){let e,t,i,o,h,u,l;const p=[R4,L4],y=[];function k(C,S){return 1}return i=k(),o=y[i]=p[i](n),{c(){e=et("div"),t=et("form"),o.c(),ie(t,"class","flex w-full flex-wrap"),ie(e,"class","normal-background flex justify-between rounded-full")},m(C,S){qe(C,e,S),ue(e,t),y[i].m(t,null),h=!0,u||(l=Je(t,"submit",F0(O4)),u=!0)},p(C,[S]){o.p(C,S)},i(C){h||(we(o),h=!0)},o(C){Ce(o),h=!1},d(C){C&&je(e),y[i].d(),u=!1,l()}}}const O4=()=>{};function V4(n,e,t){let i,o=St,h=()=>(o(),o=vo(k,W=>t(4,i=W)),k),u,l=St,p=()=>(l(),l=vo(S,W=>t(5,u=W)),S);n.$$.on_destroy.push(()=>o()),n.$$.on_destroy.push(()=>l());const y=Pd();let{searchValue:k}=e;h();let{placeholderText:C=gs.t.general.search.search}=e,{feedback:S=new Tt(void 0)}=e;p();let z;function R(){y("search",k.data)}function j(W){xo[W?"unshift":"push"](()=>{z=W,t(3,z)})}const H=W=>(S.set(void 0),W.key==="Enter"?R():void 0);function X(){i=this.value,k.set(i)}const re=W=>R();return n.$$set=W=>{"searchValue"in W&&h(t(0,k=W.searchValue)),"placeholderText"in W&&t(1,C=W.placeholderText),"feedback"in W&&p(t(2,S=W.feedback))},[k,C,S,z,i,u,R,j,H,X,re]}class N4 extends Gt{constructor(e){super(),Xt(this,e,V4,B4,Kt,{searchValue:0,placeholderText:1,feedback:2})}}function P0(n,e,t){const i=n.slice();return i[21]=e[t],i[22]=e,i[23]=t,i}function I0(n,e,t){const i=n.slice();return i[21]=e[t],i[24]=e,i[25]=t,i}function U4(n){let e,t,i,o;const h=[$4,Z4],u=[];function l(p,y){return p[6].success.length===0?0:1}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,y){let k=e;e=l(p),e===k?u[e].p(p,y):(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai(),t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i))},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function j4(n){let e,t,i;return t=new mn({props:{cls:"alert",t:n[8].failed}}),{c(){e=et("div"),lt(t.$$.fragment),ie(e,"class","flex w-full justify-center p-4")},m(o,h){qe(o,e,h),ct(t,e,null),i=!0},p:St,i(o){i||(we(t.$$.fragment,o),i=!0)},o(o){Ce(t.$$.fragment,o),i=!1},d(o){o&&je(e),ht(t)}}}function q4(n){let e,t,i;return t=new Wp({props:{$$slots:{default:[K4]},$$scope:{ctx:n}}}),{c(){e=et("div"),lt(t.$$.fragment),ie(e,"class","flex w-full justify-center p-4")},m(o,h){qe(o,e,h),ct(t,e,null),i=!0},p(o,h){const u={};h&67108864&&(u.$$scope={dirty:h,ctx:o}),t.$set(u)},i(o){i||(we(t.$$.fragment,o),i=!0)},o(o){Ce(t.$$.fragment,o),i=!1},d(o){o&&je(e),ht(t)}}}function H4(n){let e,t;return e=new mn({props:{t:n[8].searchToShort}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p:St,i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function W4(n){let e,t;return e=new mn({props:{cls:"w-full flex justify-center p-4",t:n[8].doSearch}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p:St,i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function Z4(n){let e,t,i=n[6].success,o=[];for(let u=0;u<i.length;u+=1)o[u]=A0(I0(n,i,u));const h=u=>Ce(o[u],1,1,()=>{o[u]=null});return{c(){for(let u=0;u<o.length;u+=1)o[u].c();e=Di()},m(u,l){for(let p=0;p<o.length;p+=1)o[p]&&o[p].m(u,l);qe(u,e,l),t=!0},p(u,l){if(l&92){i=u[6].success;let p;for(p=0;p<i.length;p+=1){const y=I0(u,i,p);o[p]?(o[p].p(y,l),we(o[p],1)):(o[p]=A0(y),o[p].c(),we(o[p],1),o[p].m(e.parentNode,e))}for(oi(),p=i.length;p<o.length;p+=1)h(p);ai()}},i(u){if(!t){for(let l=0;l<i.length;l+=1)we(o[l]);t=!0}},o(u){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)Ce(o[l]);t=!1},d(u){Fa(o,u),u&&je(e)}}}function $4(n){let e,t;return e=new mn({props:{cls:"w-full flex justify-center p-4",t:n[8].noResults.Subs({search:n[5]})}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&32&&(h.t=i[8].noResults.Subs({search:i[5]})),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function G4(n){let e,t,i=!1,o,h,u;return o=V0(n[16][0]),{c(){e=et("input"),ie(e,"type","radio"),ie(e,"name","selectedWikidata"),e.__value=t=n[21],e.value=e.__value,o.p(e)},m(l,p){qe(l,e,p),e.checked=e.__value===n[3],h||(u=Je(e,"change",n[15]),h=!0)},p(l,p){p&64&&t!==(t=l[21])&&(e.__value=t,e.value=e.__value,i=!0),(i||p&136)&&(e.checked=e.__value===l[3])},d(l){l&&je(e),o.r(),h=!1,u()}}}function X4(n){let e,t,i;function o(){n[14].call(e,n[21])}return{c(){e=et("input"),ie(e,"type","checkbox")},m(h,u){qe(h,e,u),e.checked=n[4][n[21].id],t||(i=Je(e,"change",o),t=!0)},p(h,u){n=h,u&80&&(e.checked=n[4][n[21].id])},d(h){h&&je(e),t=!1,i()}}}function A0(n){let e,t,i,o,h;function u(y,k){return y[2]?X4:G4}let l=u(n),p=l(n);return i=new h1({props:{wikidata:n[21]}}),{c(){e=et("label"),p.c(),t=xt(),lt(i.$$.fragment),o=xt(),ie(e,"class","low-interaction m-4 flex items-center rounded-xl p-2")},m(y,k){qe(y,e,k),p.m(e,null),ue(e,t),ct(i,e,null),ue(e,o),h=!0},p(y,k){l===(l=u(y))&&p?p.p(y,k):(p.d(1),p=l(y),p&&(p.c(),p.m(e,t)));const C={};k&64&&(C.wikidata=y[21]),i.$set(C)},i(y){h||(we(i.$$.fragment,y),h=!0)},o(y){Ce(i.$$.fragment,y),h=!1},d(y){y&&je(e),p.d(),ht(i)}}}function K4(n){let e,t;return e=new mn({props:{t:gs.t.general.loading}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p:St,i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function Y4(n){let e,t,i=!1,o,h,u;return o=V0(n[16][0]),{c(){e=et("input"),ie(e,"type","radio"),ie(e,"name","selectedWikidata"),e.__value=t=n[21],e.value=e.__value,o.p(e)},m(l,p){qe(l,e,p),e.checked=e.__value===n[3],h||(u=Je(e,"change",n[18]),h=!0)},p(l,p){p&128&&t!==(t=l[21])&&(e.__value=t,e.value=e.__value,i=!0),(i||p&136)&&(e.checked=e.__value===l[3])},d(l){l&&je(e),o.r(),h=!1,u()}}}function J4(n){let e,t,i;function o(){n[17].call(e,n[21])}return{c(){e=et("input"),ie(e,"type","checkbox")},m(h,u){qe(h,e,u),e.checked=n[4][n[21].id],t||(i=Je(e,"change",o),t=!0)},p(h,u){n=h,u&144&&(e.checked=n[4][n[21].id])},d(h){h&&je(e),t=!1,i()}}}function E0(n){let e,t,i,o,h;function u(y,k){return y[2]?J4:Y4}let l=u(n),p=l(n);return i=new h1({props:{wikidata:n[21]}}),{c(){e=et("label"),p.c(),t=xt(),lt(i.$$.fragment),o=xt(),ie(e,"class","low-interaction m-4 flex items-center rounded-xl p-2")},m(y,k){qe(y,e,k),p.m(e,null),ue(e,t),ct(i,e,null),ue(e,o),h=!0},p(y,k){l===(l=u(y))&&p?p.p(y,k):(p.d(1),p=l(y),p&&(p.c(),p.m(e,t)));const C={};k&128&&(C.wikidata=y[21]),i.$set(C)},i(y){h||(we(i.$$.fragment,y),h=!0)},o(y){Ce(i.$$.fragment,y),h=!1},d(y){y&&je(e),p.d(),ht(i)}}}function Q4(n){let e,t,i,o,h,u,l,p,y,k,C,S;t=new mn({props:{t:gs.t.general.wikipedia.searchWikidata}}),h=new N4({props:{searchValue:n[0],placeholderText:n[1]}});const z=[W4,H4,q4,j4,U4],R=[];function j(W,ae){return ae&32&&(l=null),ae&32&&(p=null),l==null&&(l=W[5].trim().length===0),l?0:(p==null&&(p=W[5].trim().length<3),p?1:W[6]===void 0?2:W[6].error!==void 0?3:W[6].success?4:-1)}~(y=j(n,-1))&&(k=R[y]=z[y](n));let H=n[7],X=[];for(let W=0;W<H.length;W+=1)X[W]=E0(P0(n,H,W));const re=W=>Ce(X[W],1,1,()=>{X[W]=null});return{c(){e=et("h3"),lt(t.$$.fragment),i=xt(),o=et("form"),lt(h.$$.fragment),u=xt(),k&&k.c(),C=xt();for(let W=0;W<X.length;W+=1)X[W].c()},m(W,ae){qe(W,e,ae),ct(t,e,null),qe(W,i,ae),qe(W,o,ae),ct(h,o,null),ue(o,u),~y&&R[y].m(o,null),ue(o,C);for(let de=0;de<X.length;de+=1)X[de]&&X[de].m(o,null);S=!0},p(W,[ae]){const de={};ae&1&&(de.searchValue=W[0]),ae&2&&(de.placeholderText=W[1]),h.$set(de);let Ae=y;if(y=j(W,ae),y===Ae?~y&&R[y].p(W,ae):(k&&(oi(),Ce(R[Ae],1,1,()=>{R[Ae]=null}),ai()),~y?(k=R[y],k?k.p(W,ae):(k=R[y]=z[y](W),k.c()),we(k,1),k.m(o,C)):k=null),ae&156){H=W[7];let xe;for(xe=0;xe<H.length;xe+=1){const pe=P0(W,H,xe);X[xe]?(X[xe].p(pe,ae),we(X[xe],1)):(X[xe]=E0(pe),X[xe].c(),we(X[xe],1),X[xe].m(o,null))}for(oi(),xe=H.length;xe<X.length;xe+=1)re(xe);ai()}},i(W){if(!S){we(t.$$.fragment,W),we(h.$$.fragment,W),we(k);for(let ae=0;ae<H.length;ae+=1)we(X[ae]);S=!0}},o(W){Ce(t.$$.fragment,W),Ce(h.$$.fragment,W),Ce(k),X=X.filter(Boolean);for(let ae=0;ae<X.length;ae+=1)Ce(X[ae]);S=!1},d(W){W&&je(e),ht(t),W&&je(i),W&&je(o),ht(h),~y&&R[y].d(),Fa(X,W)}}}function eP(n,e,t){let i,o=St,h=()=>(o(),o=vo(y,Ie=>t(5,i=Ie)),y),u,l;n.$$.on_destroy.push(()=>o());const p=gs.t.general.wikipedia;let{searchValue:y=new Tt(void 0)}=e;h();let{placeholder:k=p.searchWikidata}=e,{allowMultiple:C=!1}=e,{notInstanceOf:S=[]}=e,{instanceOf:z=[]}=e,{value:R}=e,j,H={},X=new Map,re=new id({success:void 0}),W=y.bind(Ie=>{if(Ie.length<3&&!Ie.match(/[qQ][0-9]+/))return re;const Ve=Cd.language.data,We=Ve+":"+Ie;let Oe=_p._searchCache.get(We);return Oe===void 0&&(Oe=mh.searchAndFetch(Ie,{lang:Ve,maxCount:5,notInstanceOf:S,instanceOf:z}),_p._searchCache.set(We,Oe)),gp.FromPromiseWithErr(Oe)});pn(n,W,Ie=>t(6,u=Ie));let ae=W.map(Ie=>{var Oe;for(const It of(Ie==null?void 0:Ie.success)??[])X.set(It.id,It);let Ve=new Set((Oe=Ie==null?void 0:Ie.success)==null?void 0:Oe.map(It=>It.id));const We=[j];for(const It in H)if(H[It]){const mt=X.get(It);We.push(mt)}return Ni.NoNull(We).filter(It=>!Ve.has(It.id))});pn(n,ae,Ie=>t(7,l=Ie));const de=[[]];function Ae(Ie){H[Ie.id]=this.checked,t(4,H)}function xe(){j=this.__value,t(3,j)}function pe(Ie){H[Ie.id]=this.checked,t(4,H)}function ke(){j=this.__value,t(3,j)}return n.$$set=Ie=>{"searchValue"in Ie&&h(t(0,y=Ie.searchValue)),"placeholder"in Ie&&t(1,k=Ie.placeholder),"allowMultiple"in Ie&&t(2,C=Ie.allowMultiple),"notInstanceOf"in Ie&&t(11,S=Ie.notInstanceOf),"instanceOf"in Ie&&t(12,z=Ie.instanceOf),"value"in Ie&&t(13,R=Ie.value)},n.$$.update=()=>{if(n.$$.dirty&8200&&j&&R.setData(j.id),n.$$.dirty&8208){const Ie=[];for(const Ve in H)H[Ve]&&Ie.push(Ve);R.setData(Ie.join(";"))}},[y,k,C,j,H,i,u,l,p,W,ae,S,z,R,Ae,xe,de,pe,ke]}class tP extends Gt{constructor(e){super(),Xt(this,e,eP,Q4,Kt,{searchValue:0,placeholder:1,allowMultiple:2,notInstanceOf:11,instanceOf:12,value:13})}}function iP(n){let e,t;return e=new tP({props:{searchValue:n[1],value:n[0],instanceOf:n[2],notInstanceOf:n[3],allowMultiple:n[4]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,[o]){const h={};o&1&&(h.value=i[0]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function nP(n,e,t){let{args:i=[]}=e,{feature:o}=e,{value:h}=e,l=(i[0]??"name").split(";").map(R=>{var j;return(j=o==null?void 0:o.properties[R])==null?void 0:j.toLowerCase()}).find(R=>!!R)??"";const p=i[1];let y=new Tt(l);rr(Cd.language.addCallbackAndRunD(R=>{if(console.log(p),l!==void 0&&p!==void 0){const j=p.removePostfixes??[],H=p.removePrefixes??[],X=_p.removePostAndPrefixes(l,H,j,R);console.log("Got clipped value:",X,j,H),y.setData(X)}}));let k=Ni.NoNull(((p==null?void 0:p.instanceOf)??[]).map(R=>mh.QIdToNumber(R))),C=Ni.NoNull(((p==null?void 0:p.notInstanceOf)??[]).map(R=>mh.QIdToNumber(R))),S=p==null?void 0:p.multiple,z=S==="yes"||""+S=="true";return n.$$set=R=>{"args"in R&&t(5,i=R.args),"feature"in R&&t(6,o=R.feature),"value"in R&&t(0,h=R.value)},[h,y,k,C,z,i,o]}class sP extends Gt{constructor(e){super(),Xt(this,e,nP,iP,Kt,{args:5,feature:6,value:0})}}const rP=n=>({}),z0=n=>({});function oP(n){let e;const t=n[6].fallback,i=jn(t,n,n[5],z0);return{c(){i&&i.c()},m(o,h){i&&i.m(o,h),e=!0},p(o,h){i&&i.p&&(!e||h&32)&&qn(i,t,o,o[5],e?Wn(t,o[5],h,rP):Hn(o[5]),z0)},i(o){e||(we(i,o),e=!0)},o(o){Ce(i,o),e=!1},d(o){i&&i.d(o)}}}function aP(n){let e,t;return e=new sP({props:{value:n[1],feature:n[2],state:n[4],args:n[3]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),o&4&&(h.feature=i[2]),o&16&&(h.state=i[4]),o&8&&(h.args=i[3]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function lP(n){let e,t;return e=new D4({props:{value:n[1],feature:n[2],state:n[4]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),o&4&&(h.feature=i[2]),o&16&&(h.state=i[4]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function cP(n){let e,t;return e=new v4({props:{value:n[1],args:n[3]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),o&8&&(h.args=i[3]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function hP(n){let e,t;return e=new QM({props:{value:n[1],args:n[3]}}),e.$on("submit",n[9]),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),o&8&&(h.args=i[3]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function uP(n){let e,t;return e=new dM({props:{value:n[1]}}),e.$on("submit",n[8]),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function dP(n){let e,t;return e=new UT({props:{value:n[1]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function fP(n){let e,t;return e=new u4({props:{value:n[1]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function pP(n){let e,t;return e=new l4({props:{value:n[1]}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function mP(n){let e,t;return e=new r4({props:{value:n[1],mapProperties:Up.constructMapProperties({feature:n[2],args:n[3]??[]})}}),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),o&12&&(h.mapProperties=Up.constructMapProperties({feature:i[2],args:i[3]??[]})),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function gP(n){let e,t;return e=new HT({props:{value:n[1],args:n[3]}}),e.$on("submit",n[7]),{c(){lt(e.$$.fragment)},m(i,o){ct(e,i,o),t=!0},p(i,o){const h={};o&2&&(h.value=i[1]),o&8&&(h.args=i[3]),e.$set(h)},i(i){t||(we(e.$$.fragment,i),t=!0)},o(i){Ce(e.$$.fragment,i),t=!1},d(i){ht(e,i)}}}function _P(n){let e,t,i,o;const h=[gP,mP,pP,fP,dP,uP,hP,cP,lP,aP,oP],u=[];function l(p,y){return p[0]==="translation"?0:p[0]==="direction"?1:p[0]==="date"?2:p[0]==="color"?3:p[0]==="image"?4:p[0]==="tag"?5:p[0]==="simple_tag"?6:p[0]==="opening_hours"?7:p[0]==="slope"?8:p[0]==="wikidata"?9:10}return e=l(n),t=u[e]=h[e](n),{c(){t.c(),i=Di()},m(p,y){u[e].m(p,y),qe(p,i,y),o=!0},p(p,[y]){let k=e;e=l(p),e===k?u[e].p(p,y):(oi(),Ce(u[k],1,1,()=>{u[k]=null}),ai(),t=u[e],t?t.p(p,y):(t=u[e]=h[e](p),t.c()),we(t,1),t.m(i.parentNode,i))},i(p){o||(we(t),o=!0)},o(p){Ce(t),o=!1},d(p){u[e].d(p),p&&je(i)}}}function yP(n,e,t){let{$$slots:i={},$$scope:o}=e,{type:h}=e,{value:u}=e,{feature:l=void 0}=e,{args:p=void 0}=e,{state:y=void 0}=e;function k(z){_t.call(this,n,z)}function C(z){_t.call(this,n,z)}function S(z){_t.call(this,n,z)}return n.$$set=z=>{"type"in z&&t(0,h=z.type),"value"in z&&t(1,u=z.value),"feature"in z&&t(2,l=z.feature),"args"in z&&t(3,p=z.args),"state"in z&&t(4,y=z.state),"$$scope"in z&&t(5,o=z.$$scope)},[h,u,l,p,y,o,i,k,C,S]}class OP extends Gt{constructor(e){super(),Xt(this,e,yP,_P,Kt,{type:0,value:1,feature:2,args:3,state:4})}}export{u1 as C,Xo as F,T0 as H,M4 as I,E2 as L,Cp as M,Uk as P,DP as S,M_ as T,w2 as U,Np as V,LP as W,q0 as a,zd as b,A2 as c,Tp as d,h1 as e,RP as f,mm as g,FP as h,OP as i,Up as j,KM as k,cb as l,rd as m};
//# sourceMappingURL=InputHelper-85a6eb20.js.map
