var Be=Object.defineProperty;var Pe=(_,s,n)=>s in _?Be(_,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):_[s]=n;var f=(_,s,n)=>(Pe(_,typeof s!="symbol"?s+"":s,n),n);import{j as ne,d as _e,b as se,k as De,O as ie,l as de,m as re,R as Oe,S as ke,n as Ee,o as Ne,T as B,p as H,E as ze,q as Ve,r as We,s as Ge,F as Ue,t as be}from"./theme_overview-d341944d.js";import{c as F,B as G,G as O,d as R,A as Ie,a as V,C as Z,S as je}from"./UserRelatedState-412636a1.js";import{U as S,V as I,T as x,C as y,a as U,S as D,c as oe,H as Te,d as qe,f as Ce,g as $e}from"./Translations-a6028387.js";import{L as Me,S as M}from"./SubtleButton-e04b9078.js";import{T as k}from"./DropDown-4255bf69.js";import{L as ue,F as ve,c as Se,M as Qe,b as Le,A as Ze}from"./Button-3795f46a.js";import{T as q}from"./List-c552296b.js";const W=class{constructor(s,n,e,t,o){f(this,"totalValue",0);f(this,"showCount",0);f(this,"hiddenCount",0);f(this,"features",new S(W.empty));f(this,"name");f(this,"_parent");f(this,"_root");f(this,"_z");f(this,"_x");f(this,"_y");f(this,"_tileIndex");f(this,"_counter");f(this,"_subtiles",[void 0,void 0,void 0,void 0]);f(this,"featuresStatic",[]);f(this,"featureProperties");f(this,"_state");f(this,"updateSignal",new S(void 0));this._parent=s,this._state=n,this._root=(s==null?void 0:s._root)??this,this._z=e,this._x=t,this._y=o,this._tileIndex=F.tile_index(e,t,o),this.name="Count("+this._tileIndex+")";const i={id:""+this._tileIndex,tileId:""+this._tileIndex,count:"0",kilocount:"0",showCount:"0",totalCount:"0"};this.featureProperties=i;const u=new Date,l={type:"Feature",properties:i,geometry:{type:"Point",coordinates:F.centerPointOf(e,t,o)}};this.featuresStatic.push({feature:l,freshness:u});const a=G.fromTile(e,t,o),c={type:"Feature",properties:i,geometry:{type:"Polygon",coordinates:[[[a.minLon,a.minLat],[a.minLon,a.maxLat],[a.maxLon,a.maxLat],[a.maxLon,a.minLat],[a.minLon,a.minLat]]]}};this.featuresStatic.push({feature:c,freshness:u})}static createHierarchy(s){return new W(void 0,s,0,0,0)}getTile(s){var l;if(s===this._tileIndex)return this;let[n,e,t]=F.tile_from_index(s);for(;n-1>this._z;)e=Math.floor(e/2),t=Math.floor(t/2),n--;const o=e-2*this._x,u=(t-2*this._y)*2+o;return(l=this._subtiles[u])==null?void 0:l.getTile(s)}addTile(s){const n=this;if(s.tileIndex===this._tileIndex)this._counter===void 0&&(this._counter=new He(this._tileIndex),this._counter.countsPerLayer.addCallbackAndRun(e=>n.update())),this._counter.addTileCount(s);else{let[e,t,o]=F.tile_from_index(s.tileIndex);for(;e-1>this._z;)t=Math.floor(t/2),o=Math.floor(o/2),e--;const i=t-2*this._x,l=(o-2*this._y)*2+i;this._subtiles[l]===void 0&&(this._subtiles[l]=new W(this,this._state,e,t,o)),this._subtiles[l].addTile(s)}this.updateSignal.setData(s)}getCountsForZoom(s,n,e=0){const t=this,o=[],i=n.map(u=>u.zoom).map(u=>{if(u-1>s.maxZoom)return o;const l=[];return t.visitSubTiles(a=>a.showCount<e?!1:a._z===u?(l.push(...a.features.data),!1):a._z<=u),l},[this.updateSignal.stabilized(500)]);return new ne(i)}update(){var i,u,l,a;const s=new Map;let n=0,e=0,t=0,o=new Map;for(const c of this._state.filteredLayers.data)o.set(c.layerDef.id,c);(l=(u=(i=this==null?void 0:this._counter)==null?void 0:i.countsPerLayer)==null?void 0:u.data)==null||l.forEach((c,r)=>{s.set("layer:"+r,c),n+=c,this.featureProperties["direct_layer:"+r]=c;const d=o.get(r);d.isDisplayed.data&&this._z>=d.layerDef.minzoom?t+=c:e+=c});for(const c of this._subtiles)if(c!==void 0){n+=c.totalValue,t+=c.showCount,e+=c.hiddenCount;for(const r in c.featureProperties)r.startsWith("layer:")&&s.set(r,(s.get(r)??0)+Number(c.featureProperties[r]??0))}this.totalValue=n,this.showCount=t,this.hiddenCount=e,(a=this._parent)==null||a.update(),n===0?this.features.setData(W.empty):(this.featureProperties.count=""+n,this.featureProperties.kilocount=""+Math.floor(n/1e3),this.featureProperties.showCount=""+t,this.featureProperties.totalCount=""+n,s.forEach((c,r)=>{this.featureProperties[r]=""+c}),this.features.data=this.featuresStatic,this.features.ping())}visitSubTiles(s){s(this)&&this._subtiles.forEach(e=>e==null?void 0:e.visitSubTiles(s))}};let J=W;f(J,"empty",[]);class He{constructor(s){f(this,"bbox");f(this,"tileIndex");f(this,"countsPerLayer",new S(new Map));f(this,"z");f(this,"x");f(this,"y");f(this,"registeredLayers",new Map);this.tileIndex=s,this.bbox=G.fromTileIndex(s);const[n,e,t]=F.tile_from_index(s);this.z=n,this.x=e,this.y=t}addTileCount(s){const n=s.layer.layerDef;this.registeredLayers.set(n.id,n);const e=this;s.features.map(t=>{const o=s.layer.isDisplayed.data;e.countsPerLayer.data.set(n.id,o?t.length:0),e.countsPerLayer.ping()},[s.layer.isDisplayed])}}const Je="cluster_style",Ke="The style for the clustering in all themes. Enable `debug=true` to peak into clustered tiles",Xe={osmTags:"tileId~*"},Ye="Clustered data",et=["all_tags"],tt=[{label:{render:"<div class='rounded-full text-xl font-bold' style='width: 2rem; height: 2rem; background: white'>{showCount}</div>",mappings:[{if:"showCount>1000",then:"<div class='rounded-full text-xl font-bold flex flex-col' style='width: 2.5rem; height: 2.5rem; background: white'>{kilocount}K</div>"}]},location:["point"]},{color:{render:"#3c3",mappings:[{if:"showCount>200",then:"#f33"},{if:"showCount>100",then:"#c93"},{if:"showCount>50",then:"#cc3"}]},width:{render:"1"}}],nt={id:Je,description:Ke,source:Xe,title:Ye,tagRenderings:et,mapRendering:tt},pe=class{constructor(s,n){const e=s.source,t=e.features.map(o=>{const i=e.bbox,[u,l,a]=F.tile_from_index(e.tileIndex),c={type:"Feature",properties:{z:u,x:l,y:a,tileIndex:e.tileIndex,source:e.name,count:o.length,tileId:e.name+"/"+e.tileIndex},geometry:{type:"Polygon",coordinates:[[[i.minLon,i.minLat],[i.minLon,i.maxLat],[i.maxLon,i.maxLat],[i.maxLon,i.minLat],[i.minLon,i.minLat]]]}},r=O.centerpoint(c);return[c,r].map(d=>({feature:d,freshness:new Date}))});new se({layerToShow:pe.styling,features:new ne(t),leafletMap:s.leafletMap,doShowLayer:s.doShowLayer,state:n})}};let K=pe;f(K,"styling",new _e(nt,"ShowTileInfo",!0));const me=class{constructor(s,n){f(this,"hash");f(this,"state");this.hash=s,this.state=n;const e=this;s.addCallback(()=>e.setSelectedElementFromHash()),this.initialLoad()}initialLoad(){const s=this.hash.data;s===void 0||s===""||s.indexOf("-")>=0||me._no_trigger_on.has(s)||(s.startsWith("node")||s.startsWith("way")||s.startsWith("relation"))&&R.DownloadObjectAsync(s).then(n=>{try{console.log("Downloaded selected object from OSM-API for initial load: ",s);const e=n.asGeoJson();this.state.allElements.addOrGetElement(e),this.state.selectedElement.setData(e),this.zoomToSelectedFeature()}catch(e){console.error(e)}})}setSelectedElementFromHash(){var e;const s=this.state,n=this.hash.data;if(n===void 0||n==="")s.selectedElement.setData(void 0);else{const t=s.allElements.ContainingFeatures.get(n);if(t===void 0)return;const o=s.selectedElement.data;if(o===void 0){s.selectedElement.setData(t);return}if(((e=o.properties)==null?void 0:e.id)===t.properties.id)return;s.selectedElement.setData(t)}}zoomToSelectedFeature(){var o,i;const s=this.state.selectedElement.data;if(s===void 0)return;const n=O.centerpointCoordinates(s),e=this.state.locationControl;e.data.lon=n[0],e.data.lat=n[1];const t=Math.max(14,...((i=(o=this.state.layoutToUse)==null?void 0:o.layers)==null?void 0:i.map(u=>u.minzoomVisible))??[]);e.data.zoom<t&&(e.data.zoom=t),e.ping()}};let X=me;f(X,"_no_trigger_on",new Set(["welcome","copyright","layers","new","filters","location_track","",void 0]));class st extends I{constructor(n,e){const t=new S([]),o=e.tagsSource,i=e.units;e.showAllQuestionsAtOnce=e.showAllQuestionsAtOnce??!1;const u=e.tagRenderings.filter(d=>d.question!==void 0).filter(d=>d.question!==null);let l=()=>{};const a=u.map((d,h)=>new Me(()=>new De(o,d,n,{units:i,afterSave:()=>{t.ping(),l()},cancelButton:x.t.general.skip.Clone().SetClass("btn btn-secondary").onClick(()=>{t.data.push(h),t.ping(),l()})}))),c=x.t.general.skippedQuestions.onClick(()=>{t.setData([])});o.map(d=>{if(d!==void 0)for(let h=0;h<a.length;h++){let p=u[h];if(!(t.data.indexOf(h)>=0)&&!p.IsKnown(d)&&!(p.condition&&!p.condition.matchesProperties(d)))return h}},[t]);const r=o.map(d=>{if(d===void 0)return[];const h=[];for(let p=0;p<a.length;p++){let g=u[p];t.data.indexOf(p)>=0||g.IsKnown(d)||g.condition&&!g.condition.matchesProperties(d)||h.push(a[p])}return h},[t]);super(r.map(d=>{const h=n.osmConnection.apiIsOnline.data;if(h!=="online"&&h!=="unknown")return;const p=[];return e.showAllQuestionsAtOnce===!0||e.showAllQuestionsAtOnce.data?p.push(...r.data):p.push(d[0]),t.data.length>0&&p.push(c),new y(p).SetClass("block mb-8")},[n.osmConnection.apiIsOnline]));f(this,"skippedQuestions");f(this,"restingQuestions");this.skippedQuestions=t,this.restingQuestions=r,l=()=>this.ScrollIntoView()}}class ot extends ie{constructor(n,e,t,o){var i;super(n,!0);f(this,"_softDeletionTags");f(this,"meta");f(this,"_id");f(this,"_hardDelete");this._id=n,this._hardDelete=o,this.meta={...t,changeType:"deletion"},((i=e==null?void 0:e.usedKeys())==null?void 0:i.indexOf("fixme"))>=0?this._softDeletionTags=e:this._softDeletionTags=new Ie(U.NoNull([e,new V("fixme",`A mapcomplete user marked this feature to be deleted (${t.specialMotivation})`)]))}async CreateChangeDescriptions(n,e){const t=e??await R.DownloadObjectAsync(this._id);return this._hardDelete?[{meta:this.meta,doDelete:!0,type:t.type,id:t.id}]:await new de(this._id,this._softDeletionTags,t.tags,{...this.meta,changeType:"soft-delete"}).CreateChangeDescriptions(n)}}class $ extends k{constructor(s,n,e){const t=new it(s,n,e.neededChangesets),o=n.allElements.getEventSourceById(s),i=new S(!1),u=!!e.softDeletionTags,l=new S(!1);function a(w){var L,C,j;let T;w.retagTo!==void 0?T=new de(s,w.retagTo,o.data,{theme:((L=n==null?void 0:n.layoutToUse)==null?void 0:L.id)??"unkown",changeType:"special-delete"}):T=new ot(s,e.softDeletionTags,{theme:((C=n==null?void 0:n.layoutToUse)==null?void 0:C.id)??"unkown",specialMotivation:w.deleteReason},t.canBeDeleted.data.canBeDeleted),(j=n.changes)==null||j.applyAction(T),i.setData(!0)}const c=x.t.delete,r=c.cancel.SetClass("block btn btn-secondary").onClick(()=>l.setData(!1)),d=new M(D.delete_icon_svg().SetStyle("width: 1.5rem; height: 1.5rem;"),c.delete).onClick(()=>{t.CheckDeleteability(!0),l.setData(!0)}),h=o.map(w=>w.id.indexOf("-")<0),p=$.constructMultipleChoice(e,o,n),g=new y([new q(new re(c.whyDelete,o,n).SetClass("question-text"),3),p,new y([$.constructExplanation(p.GetValue(),t,o,n),new y([r,$.constructConfirmButton(p.GetValue()).onClick(()=>a(p.GetValue().data))]).SetClass("flex justify-end flex-wrap-reverse")]).SetClass("flex mt-2 justify-between")]).SetClass("question"),b=new k(new k(new k(g,new M(D.envelope_ui(),c.readMessages),n.osmConnection.userDetails.map(w=>w.csCount>Z.userJourney.addNewPointWithUnreadMessagesUnlock||w.unreadMessages==0)),d,l),new I(t.canBeDeleted.map(w=>new y([D.delete_not_allowed_svg().SetStyle("height: 2rem; width: auto").SetClass("mr-2"),new y([c.cannotBeDeleted,w.reason.SetClass("subtle"),c.useSomethingElse.SetClass("subtle")]).SetClass("flex flex-col")]).SetClass("flex m-2 p-2 rounded-lg bg-gray-200 bg-gray-200"))),t.canBeDeleted.map(w=>u||w.canBeDeleted!==!1));super(new k(new y([D.delete_icon_svg().SetClass("h-16 w-16 p-2 m-2 block bg-gray-300 rounded-full"),c.isDeleted]).SetClass("flex m-2 rounded-full"),new ue(b,void 0,n),i),void 0,h);const m=this;l.addCallbackAndRunD(w=>{w&&m.ScrollIntoView()})}static constructConfirmButton(s){const n=x.t.delete,e=new y([D.delete_icon_ui().SetClass("w-6 h-6 mr-3 block"),n.delete]).SetClass("flex btn bg-red-500"),t=new y([D.delete_icon_ui().SetClass("w-6 h-6 mr-3 block"),n.delete]).SetClass("flex btn btn-disabled bg-red-200");return new k(e,t,s.map(o=>o!==void 0))}static constructExplanation(s,n,e,t){const o=x.t.delete;return new I(s.map(i=>{if(i===void 0)return o.explanations.selectReason.SetClass("subtle");const u=i.retagTo;if(u!==void 0)return new y([o.explanations.retagNoOtherThemes,De.CreateTagExplanation(new S(u),e,t).SetClass("subtle")]);if(i.deleteReason!==void 0)return new I(n.canBeDeleted.map(({canBeDeleted:a,reason:c})=>a?o.explanations.hardDelete:o.explanations.softDelete.Subs({reason:c})))},[n.canBeDeleted])).SetClass("block")}static constructMultipleChoice(s,n,e){const t=[];for(const o of s.nonDeleteMappings)t.push(new ve(new re(o.then,n,e),{retagTo:o.if}));for(const o of s.deleteReasons??[])t.push(new ve(new re(o.explanation,n,e),{deleteReason:o.changesetMessage}));return new Oe(t,{selectFirstAsDefault:!1})}}class it{constructor(s,n,e){f(this,"canBeDeleted");f(this,"_id");f(this,"_allowDeletionAtChangesetCount");f(this,"_state");this._id=s,this._state=n,this._allowDeletionAtChangesetCount=e??Number.MAX_VALUE,this.canBeDeleted=new S({canBeDeleted:void 0,reason:x.t.delete.loading}),this.CheckDeleteability(!1)}CheckDeleteability(s){const n=x.t.delete,e=this._id,t=this.canBeDeleted,o=this;if(!e.startsWith("node")){this.canBeDeleted.setData({canBeDeleted:!1,reason:n.isntAPoint});return}const i=this._state.osmConnection.userDetails.map(h=>{if(h!==void 0)return h.loggedIn?h.csCount>=Math.min(Z.userJourney.deletePointsOfOthersUnlock,this._allowDeletionAtChangesetCount):!1}),u=new S(void 0),l=u.map(h=>{if(h==null)return null;const p=o._state.osmConnection.userDetails.data.uid;return!h.some(g=>g!==p)},[o._state.osmConnection.userDetails]),a=i.map(h=>{if(h===void 0)return!1;if(h===!0||(l.data===null&&s&&R.DownloadHistory(e).map(g=>g.map(b=>Number(b.tags["_last_edit:contributor:uid"]))).addCallbackAndRunD(g=>u.setData(g)),l.data===!0))return!0;if(l.data===!1)return!1},[l]),c=new S(null),r=new S(null);a.addCallbackAndRunD(h=>{if(h===!1)return t.setData({canBeDeleted:!1,reason:n.notEnoughExperience}),!0;if(s)return R.DownloadReferencingRelations(e).then(p=>{c.setData(p.length>0)}),R.DownloadReferencingWays(e).then(p=>{r.setData(p.length>0)}),!0}),c.map(h=>h===!0||r.data===!0?!0:r.data===null||h===null?null:r.data===!1&&h===!1?!1:null,[r]).addCallbackAndRun(h=>{h!=null&&(h?t.setData({canBeDeleted:!1,reason:n.partOfOthers}):t.setData({canBeDeleted:!0,reason:l.data===!0?n.onlyEditedByLoggedInUser:n.safeDelete}))})}}class he extends ie{constructor(n,e){super("relation/"+n.relation.id,!1);f(this,"_input");f(this,"_theme");this._input=n,this._theme=e}async targetNodeAt(n,e){const t=this._input.relation.members[n];if(t!==void 0){if(t.type==="node")return t.ref;if(t.type==="way"){const i=(await R.DownloadObjectAsync("way/"+t.ref)).nodes;return e?i[0]:i[i.length-1]}t.type}}}class at extends he{constructor(s,n){super(s,n)}async CreateChangeDescriptions(s){return this._input.relation.tags.type==="restriction"?new rt(this._input,this._theme).CreateChangeDescriptions(s):new Ae(this._input,this._theme).CreateChangeDescriptions(s)}}class rt extends he{constructor(s,n){super(s,n)}async CreateChangeDescriptions(s){const n=this._input.relation,e=n.members,t=e.filter(d=>d.type==="way"&&d.ref===this._input.originalWayId);t.length>1&&console.warn("Detected a turn restriction where this way has multiple occurances. This is an error");const o=t[0];if(o.role==="via")return new Ae(this._input,this._theme).CreateChangeDescriptions(s);let i=await this.targetNodeAt(e.indexOf(o),!0),u=await this.targetNodeAt(e.indexOf(o),!1),l=i??u;const a=this._input.allWaysNodesInOrder.map((d,h)=>({nodes:d,id:this._input.allWayIdsInOrder[h]})).filter(d=>{const h=d.nodes;return h[0]==l||h[h.length-1]==l})[0];if(a===void 0)return console.error("No common point found, this was a broken turn restriction!",n.id),[];const c=this._input.originalWayId;if(a.id===c)return console.log("Turn_restriction fixer: the original ID can be kept, nothing to do"),[];const r=n.members.map(d=>d.type==="way"&&d.ref===c?{ref:a.id,type:"way",role:d.role}:d);return[{type:"relation",id:n.id,changes:{members:r},meta:{theme:this._theme,changeType:"relation-fix:turn_restriction"}}]}}class Ae extends he{constructor(s,n){super(s,n)}async CreateChangeDescriptions(s){const n=this._input.originalWayId,e=this._input.relation,t=e.members,o=this._input.originalNodes,i=o[0],u=o[o.length-1],l=[];for(let a=0;a<t.length;a++){const c=t[a];if(c.type!=="way"||c.ref!==n){l.push(c);continue}const r=await this.targetNodeAt(a-1,!1),d=await this.targetNodeAt(a+1,!0);if((r===void 0||r===i)&&(d===void 0||d===u)){for(const m of this._input.allWayIdsInOrder)l.push({ref:m,type:"way",role:c.role});continue}if(r===void 0||r===u||(d===void 0||d===i)){for(let m=this._input.allWayIdsInOrder.length-1;m>=0;m--){const w=this._input.allWayIdsInOrder[m];l.push({ref:w,type:"way",role:c.role})}continue}for(const m of this._input.allWayIdsInOrder)l.push({ref:m,type:"way",role:c.role})}return[{id:e.id,type:"relation",changes:{members:l},meta:{changeType:"relation-fix",theme:this._theme}}]}}class fe extends ie{constructor(n,e,t,o=5,i){super(n,!0);f(this,"wayId");f(this,"_splitPointsCoordinates");f(this,"_meta");f(this,"_toleranceInMeters");f(this,"_withNewCoordinates");this.wayId=n,this._splitPointsCoordinates=e,this._toleranceInMeters=o,this._withNewCoordinates=i,this._meta={...t,changeType:"split"}}static SegmentSplitInfo(n){const e=[];let t=[];for(const o of n)t.push(o),o.doSplit&&(e.push(t),t=[o]);return e.push(t),e.filter(o=>o.length>0)}async CreateChangeDescriptions(n){const e=await R.DownloadObjectAsync(this.wayId),t=e.nodes,o=this.CalculateSplitCoordinates(e,this._toleranceInMeters);for(const d of o)d.originalIndex>=0?d.originalIndex=e.nodes[d.originalIndex]:d.originalIndex=n.getNewID();const i=fe.SegmentSplitInfo(o);let u;for(const d of i){if(u===void 0){u=d;continue}d.length>u.length&&(u=d)}const l=[];for(const d of o)d.originalIndex>=0||l.push({type:"node",id:d.originalIndex,changes:{lon:d.lngLat[0],lat:d.lngLat[1]},meta:this._meta});const a=[],c=[];for(const d of i)if(d===u){const p=d.map(b=>b.originalIndex),g=d.map(b=>b.lngLat);l.push({type:"way",id:e.id,changes:{coordinates:g,nodes:p},meta:this._meta}),this._withNewCoordinates&&this._withNewCoordinates(g),a.push(e.id),c.push(p)}else{let p=n.getNewID();const g=[];for(const m in e.tags)e.tags.hasOwnProperty(m)&&(m.startsWith("_")||m==="id"||g.push({k:m,v:e.tags[m]}));const b=d.map(m=>m.originalIndex);if(b.length<=1){console.error("Got a segment with only one node - skipping");continue}l.push({type:"way",id:p,tags:g,changes:{coordinates:d.map(m=>m.lngLat),nodes:b},meta:this._meta}),a.push(p),c.push(b)}const r=await R.DownloadReferencingRelations(this.wayId);for(const d of r){const h=await new at({relation:d,allWayIdsInOrder:a,originalNodes:t,allWaysNodesInOrder:c,originalWayId:e.id},this._meta.theme).CreateChangeDescriptions(n);l.push(...h)}return l}CalculateSplitCoordinates(n,e=5){const t=n.asGeoJson(),o=n.coordinates.map(a=>[a[1],a[0]]),i=this._splitPointsCoordinates.map(a=>{let c=O.nearestPoint(t,a);return{coordinates:a,isSplitPoint:!0,dist:c.properties.dist,location:c.properties.location}});for(let a=0;a<o.length;a++){let c=o[a],r=O.nearestPoint(t,c);i.push({coordinates:c,isSplitPoint:!1,location:r.properties.location,originalIndex:a,dist:r.properties.dist})}i.sort((a,c)=>a.location-c.location);for(let a=i.length-2;a>=1;a--){const c=i[a];if(c.originalIndex!==void 0)continue;const r=i[a+1],d=i[a-1],h=r.location-c.location,p=c.location-d.location;if(h*1e3>e&&p*1e3>e)continue;let g=r;h>p&&(g=d),!(g.originalIndex===0||g.originalIndex===o.length)&&(g.isSplitPoint=!0,i.splice(a,1))}const u=[];let l=-1;for(const a of i){let c=a.originalIndex;c===void 0&&(c=l,l--);const r={originalIndex:c,lngLat:a.coordinates,doSplit:a.isSplitPoint};u.push(r)}return u}}const lt="split_point",ct="Layer rendering the little scissors for the minimap in the 'splitRoadWizard'",dt=1,ut={osmTags:"_split_point=yes"},ht="Split point",ft="Split point",pt=[{location:["point","centroid"],icon:"circle:white;./assets/svg/scissors.svg",iconSize:"30,30,center"}],mt={id:lt,description:ct,minzoom:dt,source:ut,name:ht,title:ft,mapRendering:pt},Q=class extends y{constructor(n,e){const t=x.t.split,o=new S([]),i=new S(!1),u=new S(!1),l=new S(Q.setupMapComponent(n,o,e)),a=new M(D.scissors_ui().SetStyle("height: 1.5rem; width: auto"),new k(t.splitAgain.Clone().SetClass("text-lg font-bold"),t.inviteToSplit.Clone().SetClass("text-lg font-bold"),i)),c=new ue(a,t.loginToSplit.Clone(),e),r=new Se(t.split.Clone(),async()=>{var T;i.setData(!0),u.setData(!1);const w=new fe(n,o.data.map(L=>L.feature.geometry.coordinates),{theme:(T=e==null?void 0:e.layoutToUse)==null?void 0:T.id},5,L=>{e.allElements.ContainingFeatures.get(n).geometry.coordinates=L});await e.changes.applyAction(w),o.setData([]),l.setData(Q.setupMapComponent(n,o,e)),ke.collapse()});r.SetClass("btn btn-primary mr-3");const d=new Se(t.split.Clone(),void 0);d.SetClass("btn btn-disabled mr-3");const h=new k(d,r,o.map(w=>w.length===0)),p=x.t.general.cancel.Clone().SetClass("btn btn-secondary mr-3").onClick(()=>{o.setData([]),u.setData(!1)});p.SetClass("btn btn-secondary block");const g=new q(t.splitTitle),b=new y([g,new I(l),new y([p,h]).SetClass("flex flex-row")]);b.SetClass("question");super([k.If(i,()=>t.hasBeenSplit.Clone().SetClass("font-bold thanks block w-full")),new k(b,c,u)]);f(this,"dialogIsOpened");this.dialogIsOpened=u;const m=this;a.onClick(()=>{u.setData(!0),m.ScrollIntoView()})}static setupMapComponent(n,e,t){const o=t.allElements.ContainingFeatures.get(n),i=Qe.createMiniMap({background:t.backgroundLayer,allowMoving:!0,leafletOptions:{minZoom:14}});i.SetStyle("width: 100%; height: 24rem").SetClass("rounded-xl overflow-hidden"),i.installBounds(G.get(o).pad(.25),!1),new Ee({features:ne.fromGeojson([o]),layers:t.filteredLayers,leafletMap:i.leafletMap,zoomToFeatures:!0,state:t}),new se({features:new ne(e),leafletMap:i.leafletMap,zoomToFeatures:!1,layerToShow:Q.splitLayerStyling,state:t});function u(l){const a=e.data.map((r,d)=>[r.feature,d]).filter(r=>O.distanceBetween(r[0].geometry.coordinates,l)<5).map(r=>r[1]).sort((r,d)=>r-d).reverse();if(a.length>0){for(const r of a)e.data.splice(r,1);e.ping();return}const c=O.nearestPoint(o,l);c.properties._split_point="yes",e.data.push({feature:c,freshness:new Date}),e.ping()}return i.leafletMap.addCallbackAndRunD(l=>l.on("click",a=>{u([a.latlng.lng,a.latlng.lat])})),i}};let Y=Q;f(Y,"splitLayerStyling",new _e(mt,"(BUILTIN) SplitRoadWizard.ts",!0));class gt extends ie{constructor(n,e,t){super(n,!0);f(this,"_id");f(this,"_newLonLat");f(this,"_meta");if(!n.startsWith("node/"))throw"Invalid ID: only 'node/number' is accepted";this._id=Number(n.substring(5)),this._newLonLat=e,this._meta=t}async CreateChangeDescriptions(n){return[{changes:{lat:this._newLonLat[1],lon:this._newLonLat[0]},type:"node",id:this._id,meta:{changeType:"move",theme:this._meta.theme,specialMotivation:this._meta.reason}}]}}const ge=class{static async Search(s){var t,o;const n=((o=(t=te==null?void 0:te.state)==null?void 0:t.currentBounds)==null?void 0:o.data)??G.global,e=ge.host+`format=json&limit=1&viewbox=${n.getEast()},${n.getNorth()},${n.getWest()},${n.getSouth()}&accept-language=nl&q=`+s;return U.downloadJson(e)}};let ee=ge;f(ee,"host","https://nominatim.openstreetmap.org/search?");class wt extends y{constructor(n){const e=D.search_ui().SetClass("w-8 h-8 full-rounded border-black float-right"),t=new S(x.t.general.search.search),o=new Le({placeholder:t.map(u=>u.textFor(oe.language.data),[oe.language]),value:new S(""),inputStyle:` background: transparent;
    border: none;
    font-size: large;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    color: var(--foreground-color);`});o.SetClass("relative float-left mt-0 ml-2"),o.SetStyle("width: calc(100% - 3em);height: 100%");super([o,e]);f(this,"_searchField");this.SetClass("block h-8"),this.SetStyle("background: var(--background-color); color: var(--foreground-color); pointer-evetns:all;");async function i(){var l;const u=o.GetValue().data;if(!(u===void 0||u==="")){o.GetValue().setData(""),t.setData(x.t.general.search.searching);try{const a=await ee.Search(u);if(console.log("Search result",a),a.length==0){t.setData(x.t.general.search.nothing);return}const c=a[0],r=c.boundingbox,d=[[r[0],r[2]],[r[1],r[3]]];(l=n.selectedElement)==null||l.setData(void 0),Te.hash.setData(c.osm_type+"/"+c.osm_id),n.leafletMap.data.fitBounds(d),t.setData(x.t.general.search.search)}catch{o.GetValue().setData(""),t.setData(x.t.general.search.error)}}}o.enterPressed.addCallback(i),this._searchField=o,e.onClick(i)}focus(){this._searchField.focus()}}class yt extends k{constructor(s,n,e){const t=x.t.move;new k(t.loginToMove.SetClass("btn").onClick(()=>n.osmConnection.AttemptLogin()),void 0,n.featureSwitchUserbadge);const o=[];e.enableRelocation&&o.push({text:t.reasons.reasonRelocation,invitingText:t.inviteToMove.reasonRelocation,icon:D.relocation_svg(),changesetCommentValue:"relocated",lockBounds:!1,background:void 0,includeSearch:!0,startZoom:12,minZoom:6,eraseAddressFields:!0}),e.enableImproveAccuracy&&o.push({text:t.reasons.reasonInaccurate,invitingText:t.inviteToMove.reasonInaccurate,icon:D.crosshair_svg(),changesetCommentValue:"improve_accuracy",lockBounds:!0,includeSearch:!1,background:"photo",startZoom:17,minZoom:16,eraseAddressFields:!1});const i=new S("start"),u=new S(void 0);let l;if(o.length===1){const C=o[0];u.setData(C),l=new M(C.icon.SetStyle("height: 1.5rem; width: 1.5rem;"),x.T(C.invitingText)).onClick(()=>{i.setData("pick_location")})}else l=new M(D.move_ui().SetStyle("width: 1.5rem; height: 1.5rem"),t.inviteToMove.generic).onClick(()=>{i.setData("reason")});const a=new M(D.move_ui(),t.inviteToMoveAgain).onClick(()=>{i.setData("reason")}),c=new y(o.map(C=>new M(C.icon,C.text).onClick(()=>{u.setData(C),i.setData("pick_location")}))),r=new M(D.close_svg(),t.cancel).onClick(()=>i.setData("start")),[d,h]=O.centerpointCoordinates(s),p=u.map(C=>{if(C===void 0)return;const j=new S({lon:d,lat:h,zoom:(C==null?void 0:C.startZoom)??16});let ae;typeof C.background=="string"?ae=[C.background]:ae=C.background;const Re=Ze.SelectBestLayerAccordingTo(j,new S(ae)).data,E=new Ne({minZoom:C.minZoom,centerLocation:j,mapBackground:new S(Re),state:n});C.lockBounds&&E.installBounds(.05,!0);let we;C.includeSearch&&(we=new wt({leafletMap:E.leafletMap})),E.SetStyle("height: 17.5rem");const ye=new M(D.move_confirm_svg(),t.confirmMove);ye.onClick(async()=>{const N=E.GetValue().data;await n.changes.applyAction(new gt(s.properties.id,[N.lon,N.lat],{reason:C.changesetCommentValue,theme:n.layoutToUse.id})),s.properties._lat=N.lat,s.properties._lon=N.lon,C.eraseAddressFields&&await n.changes.applyAction(new de(s.properties.id,new Ie([new V("addr:housenumber",""),new V("addr:street",""),new V("addr:city",""),new V("addr:postcode","")]),s.properties,{changeType:"relocated",theme:n.layoutToUse.id})),n.allElements.getEventSourceById(m).ping(),i.setData("moved")});const Fe=t.zoomInFurther.SetClass("alert block m-6");return new y([we,E,new k(ye,Fe,E.GetValue().map(N=>N.zoom>=19))]).SetClass("flex flex-col")}),g="p-2 md:p-4 m-2 border border-gray-400 rounded-xl flex flex-col",b=new ue(new I(i.map(C=>{switch(C){case"start":return l;case"reason":return new y([t.whyMove.SetClass("text-lg font-bold"),c,r]).SetClass(g);case"pick_location":return new y([t.moveTitle.SetClass("text-lg font-bold"),new I(p),r]).SetClass(g);case"moved":return new y([t.pointIsMoved.SetClass("thanks"),a]).SetClass("flex flex-col")}})),void 0,n);let m=s.properties.id;const w=n.osmConnection._oauth_config.url;m.startsWith(w)&&(m=m.substring(w.length));const T=new S(void 0);m.startsWith("way")?T.setData(t.isWay):m.startsWith("relation")?T.setData(t.isRelation):m.indexOf("-")<0&&(R.DownloadReferencingWays(m).then(C=>{C.length>0&&(console.log("Got a referencing way, move not allowed"),T.setData(t.partOfAWay))}),R.DownloadReferencingRelations(m).then(C=>{C.length>0&&T.setData(t.partOfRelation)})),super(b,new y([D.move_not_allowed_svg().SetStyle("height: 2rem").SetClass("m-2"),new y([t.cannotBeMoved,new I(T).SetClass("subtle")]).SetClass("flex flex-col")]).SetClass("flex m-2 p-2 rounded-lg bg-gray-200"),T.map(C=>C===void 0));const L=this;i.addCallback(C=>{C!=="start"&&L.ScrollIntoView()})}}class P extends ke{constructor(s,n,e,t){if(e===void 0)throw"State is undefined!";if(super(()=>P.GenerateTitleBar(s,n,e),()=>P.GenerateContent(s,n,e),(t==null?void 0:t.hashToShow)??s.data.id??"item",t==null?void 0:t.isShown,t),n===void 0)throw"Undefined layerconfig"}static GenerateTitleBar(s,n,e){const t=new B(s,n.title??new H("POI"),e).SetClass("break-words font-bold sm:p-0.5 md:p-1 sm:p-1.5 md:p-2 text-2xl"),o=new y(n.titleIcons.map(i=>new B(s,i,e,"block h-8 max-h-8 align-baseline box-content sm:p-0.5 titleicon"))).SetClass("flex flex-row flex-wrap pt-0.5 sm:pt-1 items-center mr-2");return new y([new y([t,o]).SetClass("flex flex-col sm:flex-row flex-grow justify-between")])}static GenerateContent(s,n,e){return new k(new y([D.delete_icon_svg().SetClass("w-8 h-8"),x.t.delete.isDeleted]).SetClass("flex justify-center font-bold items-center"),P.GenerateMainContent(s,n,e),s.map(t=>t._deleted=="yes"))}static GenerateMainContent(s,n,e){var a,c;let t=new Map;const o=x.t.general,i=U.Dedup(n.tagRenderings.map(r=>r.group));if(((a=e==null?void 0:e.featureSwitchUserbadge)==null?void 0:a.data)??!0){const r=n.tagRenderings.filter(d=>d.id==="questions");for(const d of i){const h=n.tagRenderings.filter(b=>b.group===d),p=r.filter(b=>b.group===d)[0],g=new st(e,{tagsSource:s,tagRenderings:h,units:n.units,showAllQuestionsAtOnce:((c=p==null?void 0:p.freeform)==null?void 0:c.helperArgs.showAllQuestions)??e.featureSwitchShowAllQuestions});t.set(d,g)}}const u=n.tagRenderings.filter(r=>r.question!==void 0).length,l=[new I(s.map(r=>r[V.newlyCreated.key]).map(r=>{if(r===void 0)return;const d=new Date(r);if((Date.now()-d.getTime())/1e3>=60*5)return;const p=[],g=new y([D.party_svg().SetClass("w-12 h-12 shrink-0 p-1 m-1 bg-white rounded-full block"),o.newlyCreated]).SetClass("flex w-full thanks content-center");return p.push(g),u>0&&p.push(o.feelFreeToSkip),new y(p).SetClass("pb-4 mb-4 border-b block border-black")}))];for(let r=0;r<i.length;r++){const d=i[r],h=n.tagRenderings.filter(b=>b.group===d),p=[],g="block w-full break-word text-default m-1 p-1 border-b border-gray-200 mb-2 pb-2";for(const b of h)if(b.question===null||b.id==="questions"){const m=t.get(b.group);if(t.delete(b.group),b.render!==void 0){m.SetClass("text-sm");const w=new B(s,b,e,b.group+" questions","",{specialViz:new Map([["questions",m]])}),T=new k(w,void 0,m.restingQuestions.map(L=>(L==null?void 0:L.length)>0));p.push(T)}else p.push(m)}else{let m=p.length===0&&r>0;const w=new ze(s,b,n.units,e,{innerElementClasses:g});m&&w.SetClass("sticky top-0"),p.push(w)}l.push(...p)}return l.push(new k(new Me(()=>P.createEditElements(t,n,s,e)),void 0,e.featureSwitchUserbadge)),new y(l).SetClass("block")}static createEditElements(s,n,e,t){let o=[];return s.forEach(i=>{o.push(i)}),n.allowMove&&o.push(new I(e.map(i=>i.id).map(i=>{const u=t.allElements.ContainingFeatures.get(i);return u===void 0?"This feature is not register in the state.allElements and cannot be moved":new yt(u,t,n.allowMove)})).SetClass("text-base")),n.deletion&&o.push(new I(e.map(i=>i.id).map(i=>new $(i,t,n.deletion))).SetClass("text-base")),n.allowSplit&&o.push(new I(e.map(i=>i.id).map(i=>new Y(i,t))).SetClass("text-base")),o.push(new I(t.osmConnection.userDetails.map(i=>i.csCount).map(i=>{if(!(i<=Z.userJourney.historyLinkVisible&&t.featureSwitchIsDebugging.data==!1&&t.featureSwitchIsTesting.data===!1))return new B(e,Ve.SharedTagRendering.get("last_edit"),t)},[t.featureSwitchIsDebugging,t.featureSwitchIsTesting]))),o.push(k.If(t.featureSwitchIsDebugging,()=>{const i=new H({render:"{all_tags()}"},""),u=new H({render:"{export_as_geojson()}"},""),l=new H({render:"{open_in_iD()}"},"");return new y([new B(e,i,t),new B(e,u,t),new B(e,l,t),"This is layer "+n.id])})),new y(o).SetClass("flex flex-col")}}const A=class{static addMetatags(s,n,e,t,o){var a,c;if(s===void 0||s.length===0)return;console.log("Recalculating metatags...");const i=[];for(const r of je.metatags)r.includesDates?((o==null?void 0:o.includeDates)??!0)&&i.push(r):((o==null?void 0:o.includeNonDates)??!0)&&i.push(r);const u=this.createRetaggingFunc(e,t);let l=!1;for(let r=0;r<s.length;r++){const d=s[r],h=d.feature,p=d.freshness;let g=!1,b=new Set(Object.getOwnPropertyNames(h.properties));for(const m of i)try{if(!m.keys.some(w=>h.properties[w]===void 0))continue;if(m.isLazy){if(!m.keys.some(w=>!b.has(w)))continue;if(g=!0,m.applyMetaTagsOnFeature(h,p,e,t),o!=null&&o.evaluateStrict)for(const w of m.keys)h.properties[w]}else g=m.applyMetaTagsOnFeature(h,p,e,t)||g}catch(w){console.error("Could not calculate metatag for ",m.keys.join(","),":",w,w.stack)}if(u!==void 0){let m=!1;try{m=u(n,h)}catch(w){console.error(w)}g=g||m}g&&((c=(a=t==null?void 0:t.allElements)==null?void 0:a.getEventSourceById(h.properties.id))==null||c.ping(),l=!0)}return l}static createFunctionsForFeature(s,n){const e=[];for(const t of n){const o=t[0],i=t[1],u=t[2];if(i===void 0)continue;const l=c=>{try{let r=new Function("feat","return "+i+";")(c);return r!==void 0&&typeof r!="string"&&(r=JSON.stringify(r)),delete c.properties[o],c.properties[o]=r,r}catch(r){A.errorPrintCount<A.stopErrorOutputAt&&(console.warn("Could not calculate a "+(u?"strict ":"")+" calculated tag for key "+o+" defined by "+i+" (in layer"+s+`) due to 
`+r+`
. Are you the theme creator? Doublecheck your code. Note that the metatags might not be stable on new features`,r,r.stack),A.errorPrintCount++,A.errorPrintCount==A.stopErrorOutputAt&&console.error("Got ",A.stopErrorOutputAt," errors calculating this metatagging - stopping output now"));return}};if(u){e.push(l);continue}const a=c=>{delete c.properties[o],Object.defineProperty(c.properties,o,{configurable:!0,enumerable:!1,get:function(){return l(c)}})};e.push(a)}return e}static createRetaggingFunc(s,n){const e=s.calculatedTags;if(e===void 0||e.length===0)return;let t=A.retaggingFuncCache.get(s.id);return t===void 0&&(t=A.createFunctionsForFeature(s.id,e),A.retaggingFuncCache.set(s.id,t)),(o,i)=>{if(i.properties!==void 0){try{We.FullPatchFeature(o,i);for(const l of t)l(i)}catch(l){console.error("Invalid syntax in calculated tags or some other error: ",l)}return!0}}}};let z=A;f(z,"errorPrintCount",0),f(z,"stopErrorOutputAt",10),f(z,"retaggingFuncCache",new Map);class xe{constructor(s,n,e){f(this,"neededLayerBboxes",new Map);f(this,"source");f(this,"params");f(this,"state");f(this,"isDirty",new S(!1));this.state=n,this.source=s;const t=this;this.params={getFeatureById(o){return n.allElements.ContainingFeatures.get(o)},getFeaturesWithin(o,i){let u=t.neededLayerBboxes.get(o);return u===void 0?t.neededLayerBboxes.set(o,i):i.isContainedIn(u)||t.neededLayerBboxes.set(o,u.unionWith(i)),e.GetFeaturesWithin(o,i)},memberships:e.relationTracker},this.isDirty.stabilized(100).addCallback(o=>{o&&t.updateMetaTags()}),this.source.features.addCallbackAndRunD(o=>t.isDirty.setData(!0))}requestUpdate(){this.isDirty.setData(!0)}updateMetaTags(){const s=this.source.features.data;if(s.length===0){this.isDirty.setData(!1);return}z.addMetatags(s,this.params,this.source.layer.layerDef,this.state),this.isDirty.setData(!1)}}class bt{constructor(s,n){f(this,"_state");f(this,"_featurePipeline");f(this,"_alreadyRegistered",new Set);f(this,"_notifiers",[]);if(this._featurePipeline=n,this._state=s,s.currentView!==void 0){const e=new xe(s.currentView,this._state,this._featurePipeline);this._alreadyRegistered.add(s.currentView),this._notifiers.push(e),s.currentView.features.addCallback(t=>{console.debug("Requesting an update for currentView"),e.updateMetaTags()})}}registerSource(s,n=!1){if(s===void 0||this._alreadyRegistered.has(s))return;this._alreadyRegistered.add(s),this._notifiers.push(new xe(s,this._state,this._featurePipeline));const e=this;s.features.addCallbackAndRunD(t=>{const o=s.layer.layerDef.id;for(const i of e._notifiers){const u=i.neededLayerBboxes.get(o);u!=null&&(s.bbox===void 0||u.overlapsWith(s.bbox))&&i.requestUpdate()}})}}class Ct extends Ge{constructor(n){super(n);f(this,"featurePipeline");f(this,"featureAggregator");f(this,"metatagRecalculator");f(this,"popups",new Map);const e=n==null?void 0:n.clustering;this.featureAggregator=J.createHierarchy(this);const t=this.featureAggregator,o=this,i=[];function u(a){o.metatagRecalculator===void 0?i.push(a):o.metatagRecalculator.registerSource(a)}function l(a){t.addTile(a);const c=a.features.map(d=>G.bboxAroundAll(d.map(h=>G.get(h.feature)))),r=a.features.map(d=>{var w;const h=o.locationControl.data.zoom;if(!a.layer.isDisplayed.data)return!1;const p=o.currentBounds.data;if(p===void 0||!c.data.overlapsWith(p)||h<a.layer.layerDef.minzoom)return!1;if(h>e.maxZoom)return!0;if(d.length>e.minNeededElements)return!1;let[g,b,m]=F.tile_from_index(a.tileIndex);if(g>=h){for(;g>h;)g--,b=Math.floor(b/2),m=Math.floor(m/2);if(((w=t.getTile(F.tile_index(g,b,m)))==null?void 0:w.totalValue)>e.minNeededElements)return!1}return!0},[o.currentBounds,a.layer.isDisplayed,c]);new se({features:a,leafletMap:o.leafletMap,layerToShow:a.layer.layerDef,doShowLayer:r,selectedElement:o.selectedElement,state:o,popup:(d,h)=>o.CreatePopup(d,h)})}this.featurePipeline=new Ue(l,this,{handleRawFeatureSource:u}),this.metatagRecalculator=new bt(this,this.featurePipeline),this.metatagRecalculator.registerSource(this.currentView,!0),i.forEach(a=>o.metatagRecalculator.registerSource(a)),new X(Te.hash,this),this.AddClusteringToMap(this.leafletMap)}CreatePopup(n,e){if(this.popups.has(n.data.id))return this.popups.get(n.data.id);const t=new P(n,e,this);return this.popups.set(n.data.id,t),t}AddClusteringToMap(n){const e=this.layoutToUse.clustering,t=this;new se({features:this.featureAggregator.getCountsForZoom(e,this.locationControl,e.minNeededElements),leafletMap:n,layerToShow:K.styling,popup:this.featureSwitchIsDebugging.data?(o,i)=>new P(o,i,t):void 0,state:this})}}class te extends Ct{constructor(s){super(s)}}f(te,"state");const vt="personal",St={en:"Personal theme",nl:"Persoonlijk thema",es:"Interficie personal",ca:"Interfície personal",gl:"Tema personalizado",fr:"Thème personnalisé",de:"Persönliches Thema",ja:"個人的なテーマ",zh_Hant:"個人化主題",it:"Tema personale",nb_NO:"Personlig tema",id:"Tema pribadi",da:"Personligt tema",pa_PK:"چݨی تھیم"},xt={en:"Create a personal theme based on all the available layers of all themes. In order to show some data, open <a href='#filter'>layer selection</a>",nl:"Stel je eigen thema samen door lagen te combineren van alle andere themas",es:"Crea una interficie basada en todas las capas disponibles de todas las interficies",ca:"Crea un tema personal basat en totes les capes disponibles de totes els temes. Per a mostrar les dades, obri <a href='#filter'>selecció de capes</a>",gl:"Crea un tema baseado en todas as capas dispoñíbeis de todos os temas",fr:"Créez un thème personnalisé basé sur toutes les couches disponibles de tous les thèmes. Pour afficher des données, ouvrez <a href='#filter'>la sélection de couches</a>",de:"Stellen Sie Ihr persönliches Thema zusammen, das auf bereits verfügbaren Ebenen aller Themen basiert. Um diese anzuzeigen, öffnen Sie die <a href='#filter'>Ebenenauswahl</a>",ja:"すべてのテーマの使用可能なすべてのレイヤーに基づいて個人用テーマを作成する",zh_Hant:"從所有可用的主題圖層創建個人化主題",ru:"Создать персональную тему на основе доступных слоёв тем. Чтобы отобразить некоторые данные, откройте <a href='#filter'>выбор слоя</a>",it:"Crea un tema personale basato sui livelli disponibili per tutti i temi. Per mostrare dei dati, apri <a href='#filter'>selezione livello</a>",da:"Opret et personligt tema baseret på alle de tilgængelige lag af alle temaer. For at vise nogle data skal du åbne <a href='#filter'>lagvalg</a>"},_t="./assets/svg/addSmall.svg",Dt={maxZoom:19},kt=0,It=0,Tt=0,Mt=1.2,Lt=15,At={minzoom:17,syncSelection:"theme-only",shownByDefault:!1},Rt=!1,Ft=[],Bt={id:vt,title:St,description:xt,icon:_t,clustering:Dt,startLat:kt,startLon:It,startZoom:Tt,widenFactor:Mt,"#note":"The 'overpassMaxZoom' should be exactly the same as or less then the minzzom in overrideAll",overpassMaxZoom:Lt,overrideAll:At,enableNoteImports:Rt,layers:Ft};class le extends I{constructor(s,n,e){s=U.NoNull(s),super(n.map(t=>{if(t===void 0||t==="")return new y(s.map(i=>i.element)).SetClass((e==null?void 0:e.innerClasses)??"");const o=s.filter(i=>(i==null?void 0:i.predicate)!==void 0&&i.predicate(t));return o.length===0?e==null?void 0:e.onEmpty:new y(o.map(i=>i.element)).SetClass((e==null?void 0:e.innerClasses)??"")},[oe.language]))}}const v=class extends y{constructor(s,n=!1){const e=x.t.general.morescreen;let t="",o="";n&&(t="h-32 min-h-32 max-h-32 text-ellipsis overflow-hidden",o="md:grid md:grid-flow-row md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-g4 gap-4");const i=new Le({placeholder:e.searchForATheme});i.enterPressed.addCallbackD(l=>{l=l.toLowerCase(),l==="personal"&&(window.location.href=v.createUrlFor({id:"personal"},!1,s).data),(l==="bugs"||l==="issues")&&(window.location.href="https://github.com/pietervdvn/MapComplete/issues"),l==="source"&&(window.location.href="https://github.com/pietervdvn/MapComplete"),l==="docs"&&(window.location.href="https://github.com/pietervdvn/MapComplete/tree/develop/Docs"),(l==="osmcha"||l==="stats")&&(window.location.href=U.OsmChaLinkFor(7));const a=v.officialThemes.find(r=>r.hideFromOverview==!1&&r.id!=="personal"&&v.MatchesLayoutFunc(r)(l));a!==void 0&&(window.location.href=v.createUrlFor(a,!1,s).data);const c=v.officialThemes.find(r=>r.id!=="personal"&&v.MatchesLayoutFunc(r)(l));c!==void 0&&(window.location.href=v.createUrlFor(c,!1,s).data)}),n&&(i.focus(),document.addEventListener("keydown",function(l){l.ctrlKey&&l.code==="KeyF"&&(i.focus(),l.preventDefault())}));const u=new y([D.search_svg().SetClass("w-8"),i.SetClass("mr-4 w-full")]).SetClass("flex rounded-full border-2 border-black items-center my-2 w-1/2");super([new y([u]).SetClass("flex justify-center"),v.createOfficialThemesList(s,t,o,i.GetValue()),v.createPreviouslyVistedHiddenList(s,t,o,i.GetValue()),v.createUnofficialThemeList(t,s,o,i.GetValue()),e.streetcomplete.Clone().SetClass("block text-base mx-10 my-3 mb-10")])}static NothingFound(s){const n=x.t.general.morescreen;return new y([new q(n.noMatchingThemes,5).SetClass("w-max font-bold"),new M(D.search_disable_ui(),n.noSearch,{imgSize:"h-6"}).SetClass("h-12 w-max").onClick(()=>s.setData(""))]).SetClass("flex flex-col items-center w-full")}static createUrlFor(s,n,e){var l;if(s===void 0)return;if(s.id===void 0){console.error("ID is undefined for layout",s);return}if(s.id===((l=e==null?void 0:e.layoutToUse)==null?void 0:l.id))return;const t=e==null?void 0:e.locationControl;let o=window.location.pathname;o=o.substr(0,o.lastIndexOf("/")),o===""&&(o=".");let i=`${o}/${s.id.toLowerCase()}.html?`;(location.hostname==="localhost"||location.hostname==="127.0.0.1")&&(i=`${o}/theme.html?layout=${s.id}&`),n&&(i=`${o}/theme.html?userlayout=${s.id}&`);let u="";return s.definition!==void 0&&(u="#"+btoa(JSON.stringify(s.definition))),(t==null?void 0:t.map(a=>{const c=[["z",a==null?void 0:a.zoom],["lat",a==null?void 0:a.lat],["lon",a==null?void 0:a.lon]].filter(r=>r[1]!==void 0).map(r=>r[0]+"="+r[1]).join("&");return`${i}${c}${u}`}))??new qe(`${i}`)}static createLinkButton(s,n,e=!1){var i;const t=v.createUrlFor(n,e,s);let o=new y([new Ce(n.title,!e&&!n.mustHaveLanguage?"themes:"+n.id+".title":void 0),((i=new Ce(n.shortDescription))==null?void 0:i.SetClass("subtle"))??""]).SetClass("overflow-hidden flex flex-col");return s.layoutToUse===void 0&&(o=new y([o]).SetClass("flex flex-col justify-center h-24")),new M(n.icon,o,{url:t,newTab:!1})}static CreateProffessionalSerivesButton(){const s=x.t.professional.indexPage;return new y([new q(s.hook,4),s.hookMore,new M(void 0,s.button,{url:"./professional.html"})]).SetClass("flex flex-col border border-gray-300 p-2 rounded-lg")}static createUnofficialThemeList(s,n,e,t){var o=n.installedUserThemes,i=$e.ListStabilized(o);return new I(i.map(u=>{const l=[];for(const a of u){const c=n.GetUnofficialTheme(a);if(c===void 0)continue;const r=v.createLinkButton(n,c,!0);r!==void 0&&l.push({element:r.SetClass(s),predicate:d=>a.toLowerCase().indexOf(d)>=0})}if(!(l.length<=0))return new y([x.t.general.customThemeIntro,new le(l,t,{innerClasses:e,onEmpty:v.NothingFound(t)})])}))}static createPreviouslyVistedHiddenList(s,n,e,t){const o=x.t.general.morescreen,i="mapcomplete-hidden-theme-",u=be.filter(a=>a.hideFromOverview),l=u.length;return new k(new I(s.osmConnection.preferencesHandler.preferences.map(a=>{const c=new Set(U.NoNull(Object.keys(a).filter(h=>h.startsWith(i)).map(h=>h.substring(i.length,h.length-8))));if(c.size===0)return;const r=u.filter(h=>c.has(h.id)).map(h=>{var p;return{element:(p=v.createLinkButton(s,h))==null?void 0:p.SetClass(n),predicate:v.MatchesLayoutFunc(h)}}),d=new le(r,t,{innerClasses:e,onEmpty:v.NothingFound(t)});return new y([new q(o.previouslyHiddenTitle),o.hiddenExplanation.Subs({hidden_discovered:""+c.size,total_hidden:""+l}),d])})).SetClass("flex flex-col"),void 0,s.osmConnection.isLoggedIn)}static MatchesLayoutFunc(s){return n=>{var t;if(n=n.toLocaleLowerCase(),s.id.toLowerCase().indexOf(n)>=0)return!0;const e=[s.shortDescription,s.title,...s.keywords??[]];for(const o of e){if(o===void 0)continue;const i=o["*"]??o[oe.language.data];if(((t=i==null?void 0:i.toLowerCase())==null?void 0:t.indexOf(n))>=0)return!0}return!1}}static createOfficialThemesList(s,n,e,t){let o=v.officialThemes.map(l=>{var c;if(l===void 0){console.trace("Layout is undefined");return}if(l.hideFromOverview)return;const a=(c=v.createLinkButton(s,l))==null?void 0:c.SetClass(n);return l.id===Bt.id?{element:new I(s.osmConnection.userDetails.map(d=>d.csCount).map(d=>{if(!(d<Z.userJourney.personalLayoutUnlock))return a}))}:{element:a,predicate:v.MatchesLayoutFunc(l)}});const i=v.CreateProffessionalSerivesButton(),u=v.createCustomGeneratorButton(s);return o.splice(0,0,{element:u},{element:i}),new le(o,t,{innerClasses:e,onEmpty:v.NothingFound(t)})}static createCustomGeneratorButton(s){const n=x.t.general.morescreen;return new I(s.osmConnection.userDetails.map(e=>e.csCount<Z.userJourney.themeGeneratorReadOnlyUnlock?new M(null,n.requestATheme.Clone(),{url:"https://github.com/pietervdvn/MapComplete/issues",newTab:!0}):new M(D.pencil_ui(),n.createYourOwnTheme.Clone(),{url:"https://pietervdvn.github.io/mc/legacy/070/customGenerator.html",newTab:!1})))}};let ce=v;f(ce,"officialThemes",be);export{P as F,ce as M,te as S,wt as a,z as b,Ct as c};
